2025-12-13 12:41:09,552 - INFO - Created default predefined prompts
2025-12-13 12:41:09,552 - INFO - Saved 6 prompts to prompts.json
2025-12-13 12:53:23,372 - INFO - Loaded 6 predefined prompts
2025-12-13 13:04:41,379 - INFO - Loaded 6 predefined prompts
2025-12-13 13:05:33,254 - INFO - Loaded 3 API keys
2025-12-13 13:09:09,272 - WARNING - Invalid JSON content from response: b'<!DOCTYPE html>\n<html lang=en>\n  <meta charset=utf-8>\n  <meta name=viewport content="initial-scale=1, minimum-scale=1, width=device-width">\n  <title>Error 403 (Forbidden)!!1</title>\n  <style>\n    *{margin:0;padding:0}html,code{font:15px/22px arial,sans-serif}html{background:#fff;color:#222;padding:15px}body{margin:7% auto 0;max-width:390px;min-height:180px;padding:30px 0 15px}* > body{background:url(//www.google.com/images/errors/robot.png) 100% 5px no-repeat;padding-right:205px}p{margin:11px 0 22px;overflow:hidden}ins{color:#777;text-decoration:none}a img{border:0}@media screen and (max-width:772px){body{background:none;margin-top:0;max-width:none;padding-right:0}}#logo{background:url(//www.google.com/images/branding/googlelogo/1x/googlelogo_color_150x54dp.png) no-repeat;margin-left:-5px}@media only screen and (min-resolution:192dpi){#logo{background:url(//www.google.com/images/branding/googlelogo/2x/googlelogo_color_150x54dp.png) no-repeat 0% 0%/100% 100%;-moz-border-image:url(//www.google.com/images/branding/googlelogo/2x/googlelogo_color_150x54dp.png) 0}}@media only screen and (-webkit-min-device-pixel-ratio:2){#logo{background:url(//www.google.com/images/branding/googlelogo/2x/googlelogo_color_150x54dp.png) no-repeat;-webkit-background-size:100% 100%}}#logo{display:inline-block;height:54px;width:150px}\n  </style>\n  <a href=//www.google.com/><span id=logo aria-label=Google></span></a>\n  <p><b>403.</b> <ins>That\xe2\x80\x99s an error.</ins>\n  <p>Your client does not have permission to get URL <code>/$discovery/rest</code> from this server.  <ins>That\xe2\x80\x99s all we know.</ins>\n'
2025-12-13 13:09:09,275 - ERROR - PDF processing failed: <HttpError 403 when requesting https://generativelanguage.googleapis.com/$discovery/rest?version=v1beta&key=AIzaSyCB--3e9K9jXd45b8E0gRWj4M-XRS3T28Y returned "Forbidden". Details: "<!DOCTYPE html>
<html lang=en>
  <meta charset=utf-8>
  <meta name=viewport content="initial-scale=1, minimum-scale=1, width=device-width">
  <title>Error 403 (Forbidden)!!1</title>
  <style>
    *{margin:0;padding:0}html,code{font:15px/22px arial,sans-serif}html{background:#fff;color:#222;padding:15px}body{margin:7% auto 0;max-width:390px;min-height:180px;padding:30px 0 15px}* > body{background:url(//www.google.com/images/errors/robot.png) 100% 5px no-repeat;padding-right:205px}p{margin:11px 0 22px;overflow:hidden}ins{color:#777;text-decoration:none}a img{border:0}@media screen and (max-width:772px){body{background:none;margin-top:0;max-width:none;padding-right:0}}#logo{background:url(//www.google.com/images/branding/googlelogo/1x/googlelogo_color_150x54dp.png) no-repeat;margin-left:-5px}@media only screen and (min-resolution:192dpi){#logo{background:url(//www.google.com/images/branding/googlelogo/2x/googlelogo_color_150x54dp.png) no-repeat 0% 0%/100% 100%;-moz-border-image:url(//www.google.com/images/branding/googlelogo/2x/googlelogo_color_150x54dp.png) 0}}@media only screen and (-webkit-min-device-pixel-ratio:2){#logo{background:url(//www.google.com/images/branding/googlelogo/2x/googlelogo_color_150x54dp.png) no-repeat;-webkit-background-size:100% 100%}}#logo{display:inline-block;height:54px;width:150px}
  </style>
  <a href=//www.google.com/><span id=logo aria-label=Google></span></a>
  <p><b>403.</b> <ins>That’s an error.</ins>
  <p>Your client does not have permission to get URL <code>/$discovery/rest</code> from this server.  <ins>That’s all we know.</ins>
">
2025-12-13 13:09:17,844 - WARNING - Invalid JSON content from response: b'<!DOCTYPE html>\n<html lang=en>\n  <meta charset=utf-8>\n  <meta name=viewport content="initial-scale=1, minimum-scale=1, width=device-width">\n  <title>Error 403 (Forbidden)!!1</title>\n  <style>\n    *{margin:0;padding:0}html,code{font:15px/22px arial,sans-serif}html{background:#fff;color:#222;padding:15px}body{margin:7% auto 0;max-width:390px;min-height:180px;padding:30px 0 15px}* > body{background:url(//www.google.com/images/errors/robot.png) 100% 5px no-repeat;padding-right:205px}p{margin:11px 0 22px;overflow:hidden}ins{color:#777;text-decoration:none}a img{border:0}@media screen and (max-width:772px){body{background:none;margin-top:0;max-width:none;padding-right:0}}#logo{background:url(//www.google.com/images/branding/googlelogo/1x/googlelogo_color_150x54dp.png) no-repeat;margin-left:-5px}@media only screen and (min-resolution:192dpi){#logo{background:url(//www.google.com/images/branding/googlelogo/2x/googlelogo_color_150x54dp.png) no-repeat 0% 0%/100% 100%;-moz-border-image:url(//www.google.com/images/branding/googlelogo/2x/googlelogo_color_150x54dp.png) 0}}@media only screen and (-webkit-min-device-pixel-ratio:2){#logo{background:url(//www.google.com/images/branding/googlelogo/2x/googlelogo_color_150x54dp.png) no-repeat;-webkit-background-size:100% 100%}}#logo{display:inline-block;height:54px;width:150px}\n  </style>\n  <a href=//www.google.com/><span id=logo aria-label=Google></span></a>\n  <p><b>403.</b> <ins>That\xe2\x80\x99s an error.</ins>\n  <p>Your client does not have permission to get URL <code>/$discovery/rest</code> from this server.  <ins>That\xe2\x80\x99s all we know.</ins>\n'
2025-12-13 13:09:17,845 - ERROR - PDF processing failed: <HttpError 403 when requesting https://generativelanguage.googleapis.com/$discovery/rest?version=v1beta&key=AIzaSyAeEYiizFmdY7hB2UmQWDY_NP4Hf4GNAQc returned "Forbidden". Details: "<!DOCTYPE html>
<html lang=en>
  <meta charset=utf-8>
  <meta name=viewport content="initial-scale=1, minimum-scale=1, width=device-width">
  <title>Error 403 (Forbidden)!!1</title>
  <style>
    *{margin:0;padding:0}html,code{font:15px/22px arial,sans-serif}html{background:#fff;color:#222;padding:15px}body{margin:7% auto 0;max-width:390px;min-height:180px;padding:30px 0 15px}* > body{background:url(//www.google.com/images/errors/robot.png) 100% 5px no-repeat;padding-right:205px}p{margin:11px 0 22px;overflow:hidden}ins{color:#777;text-decoration:none}a img{border:0}@media screen and (max-width:772px){body{background:none;margin-top:0;max-width:none;padding-right:0}}#logo{background:url(//www.google.com/images/branding/googlelogo/1x/googlelogo_color_150x54dp.png) no-repeat;margin-left:-5px}@media only screen and (min-resolution:192dpi){#logo{background:url(//www.google.com/images/branding/googlelogo/2x/googlelogo_color_150x54dp.png) no-repeat 0% 0%/100% 100%;-moz-border-image:url(//www.google.com/images/branding/googlelogo/2x/googlelogo_color_150x54dp.png) 0}}@media only screen and (-webkit-min-device-pixel-ratio:2){#logo{background:url(//www.google.com/images/branding/googlelogo/2x/googlelogo_color_150x54dp.png) no-repeat;-webkit-background-size:100% 100%}}#logo{display:inline-block;height:54px;width:150px}
  </style>
  <a href=//www.google.com/><span id=logo aria-label=Google></span></a>
  <p><b>403.</b> <ins>That’s an error.</ins>
  <p>Your client does not have permission to get URL <code>/$discovery/rest</code> from this server.  <ins>That’s all we know.</ins>
">
2025-12-13 13:10:02,224 - WARNING - Invalid JSON content from response: b'<!DOCTYPE html>\n<html lang=en>\n  <meta charset=utf-8>\n  <meta name=viewport content="initial-scale=1, minimum-scale=1, width=device-width">\n  <title>Error 403 (Forbidden)!!1</title>\n  <style>\n    *{margin:0;padding:0}html,code{font:15px/22px arial,sans-serif}html{background:#fff;color:#222;padding:15px}body{margin:7% auto 0;max-width:390px;min-height:180px;padding:30px 0 15px}* > body{background:url(//www.google.com/images/errors/robot.png) 100% 5px no-repeat;padding-right:205px}p{margin:11px 0 22px;overflow:hidden}ins{color:#777;text-decoration:none}a img{border:0}@media screen and (max-width:772px){body{background:none;margin-top:0;max-width:none;padding-right:0}}#logo{background:url(//www.google.com/images/branding/googlelogo/1x/googlelogo_color_150x54dp.png) no-repeat;margin-left:-5px}@media only screen and (min-resolution:192dpi){#logo{background:url(//www.google.com/images/branding/googlelogo/2x/googlelogo_color_150x54dp.png) no-repeat 0% 0%/100% 100%;-moz-border-image:url(//www.google.com/images/branding/googlelogo/2x/googlelogo_color_150x54dp.png) 0}}@media only screen and (-webkit-min-device-pixel-ratio:2){#logo{background:url(//www.google.com/images/branding/googlelogo/2x/googlelogo_color_150x54dp.png) no-repeat;-webkit-background-size:100% 100%}}#logo{display:inline-block;height:54px;width:150px}\n  </style>\n  <a href=//www.google.com/><span id=logo aria-label=Google></span></a>\n  <p><b>403.</b> <ins>That\xe2\x80\x99s an error.</ins>\n  <p>Your client does not have permission to get URL <code>/$discovery/rest</code> from this server.  <ins>That\xe2\x80\x99s all we know.</ins>\n'
2025-12-13 13:10:02,227 - ERROR - PDF processing failed: <HttpError 403 when requesting https://generativelanguage.googleapis.com/$discovery/rest?version=v1beta&key=AIzaSyCZSapNa6rwXOE2ezmdo-LRTrHdGJR1y4Y returned "Forbidden". Details: "<!DOCTYPE html>
<html lang=en>
  <meta charset=utf-8>
  <meta name=viewport content="initial-scale=1, minimum-scale=1, width=device-width">
  <title>Error 403 (Forbidden)!!1</title>
  <style>
    *{margin:0;padding:0}html,code{font:15px/22px arial,sans-serif}html{background:#fff;color:#222;padding:15px}body{margin:7% auto 0;max-width:390px;min-height:180px;padding:30px 0 15px}* > body{background:url(//www.google.com/images/errors/robot.png) 100% 5px no-repeat;padding-right:205px}p{margin:11px 0 22px;overflow:hidden}ins{color:#777;text-decoration:none}a img{border:0}@media screen and (max-width:772px){body{background:none;margin-top:0;max-width:none;padding-right:0}}#logo{background:url(//www.google.com/images/branding/googlelogo/1x/googlelogo_color_150x54dp.png) no-repeat;margin-left:-5px}@media only screen and (min-resolution:192dpi){#logo{background:url(//www.google.com/images/branding/googlelogo/2x/googlelogo_color_150x54dp.png) no-repeat 0% 0%/100% 100%;-moz-border-image:url(//www.google.com/images/branding/googlelogo/2x/googlelogo_color_150x54dp.png) 0}}@media only screen and (-webkit-min-device-pixel-ratio:2){#logo{background:url(//www.google.com/images/branding/googlelogo/2x/googlelogo_color_150x54dp.png) no-repeat;-webkit-background-size:100% 100%}}#logo{display:inline-block;height:54px;width:150px}
  </style>
  <a href=//www.google.com/><span id=logo aria-label=Google></span></a>
  <p><b>403.</b> <ins>That’s an error.</ins>
  <p>Your client does not have permission to get URL <code>/$discovery/rest</code> from this server.  <ins>That’s all we know.</ins>
">
2025-12-13 14:11:37,663 - INFO - Loaded 6 predefined prompts
2025-12-13 14:12:03,002 - INFO - Loaded 3 API keys
2025-12-13 14:13:11,538 - INFO - Uploaded PDF file: Bolognia 5th Edition 2024 (1)-7-26-46-1-20.pdf
2025-12-13 14:13:23,759 - INFO - PDF processed successfully with gemini-2.5-flash
2025-12-13 14:19:19,426 - INFO - Loaded 6 predefined prompts
2025-12-13 14:19:42,114 - INFO - Loaded 3 API keys
2025-12-13 14:22:23,626 - INFO - Uploaded PDF file: Bolognia 5th Edition 2024 (1)-7-26-46-1-20.pdf
2025-12-13 14:22:33,185 - INFO - PDF processed successfully with gemini-2.5-flash
2025-12-13 14:22:33,190 - INFO - Response saved to: /home/mohammadbagher/Bolognia 5th Edition 2024 (1)-7-26-46-1-20_response_20251213_142233.txt
2025-12-13 14:26:21,149 - INFO - Loaded 6 predefined prompts
2025-12-13 14:30:09,395 - INFO - Loaded 3 API keys
2025-12-13 14:31:15,279 - INFO - Full prompt being sent (4635 chars): You are a meticulous medical OCR & structuring assistant. Your job is to extract **only** what is present on each provided textbook page image/PDF and convert it into clean, AI-ready text with structured sections. You MUST avoid hallucinations and preserve original medical meaning precisely. Follow these global rules:

GLOBAL PRINCIPLES
- NO HALLUCINATIONS: Output only content visible on the page(s). If unreadable/unclear, write: "[UNREADABLE]" or add an "uncertain" flag with brief reason.
- LANGUAGE & SPELLING: Preserve original English spelling and medical terminology; do not normalize British↔American spelling.
- CLEAN OCR: 
  - Remove page headers/footers, running titles, folios, and footers like “©Publisher 2023”.
  - Fix broken words at line breaks (e.g., "thera-\npy" → "therapy").
  - Replace ligatures (ﬁ, ﬂ) with normal letters.
  - Preserve meaningful capitalization, italics markers (use *italic*), bold (**bold**), and inline sub/superscripts as LaTeX if clearly indicated (e.g., CO$_2$).
- CITATIONS: Keep in-text citations literally (e.g., “[12]”, “(Smith 2021)”).
- MATH/CHEM: For formulae, use inline LaTeX: e.g., `pH = -\log_{10} [H^+]`.
- NO IMAGES: Describe figures/diagrams/charts in text form—succinct but complete. Do not invent unseen labels.

STRUCTURED OUTPUT FORMAT (Markdown with embedded JSON blocks)
Always produce in this exact order:

1) `# Page Metadata`
   - Book title (if visible), chapter title (if visible), page number (if visible or inferable), section headings found.
   - Confidence notes: short bullets where uncertainty exists.

2) `# Body`
   - Clean, continuous paragraph text. Keep section/subsection headings as `##` and `###`.

3) `# Tables`
   - For each table found, output a JSON block per table with:
   ```json
   {
     "type": "table",
     "title": "Table 3.2 Disease-modifying agents",
     "note": "footnotes or legends if present",
     "columns": ["Column A", "Column B", "Column C"],
     "rows": [
       ["cell(1,1)", "cell(1,2)", "cell(1,3)"],
       ["cell(2,1)", "cell(2,2)", "cell(2,3)"]
     ],
     "uncertain_cells": [{"row":2,"col":3,"reason":"blurry"}]
   }
If a table is complex (merged cells), normalize by repeating header labels; if impossible, add "structure_note".

# Algorithms / Clinical Approaches

Convert any flowchart, algorithm box, or approach diagram into BOTH:
a) Bulleted steps (plain text):

Step 1: …

If lab X > Y → do …

Else → …
b) Machine-readable pseudo-logic JSON:

json
Copy code
{
  "type": "algorithm",
  "title": "Approach to suspected DKA",
  "nodes": [
    {"id":"start","text":"Patient with hyperglycemia"},
    {"id":"n1","text":"Check ketones"},
    {"id":"n2","text":"If ketones positive → start insulin infusion"}
  ],
  "edges": [
    {"from":"start","to":"n1"},
    {"from":"n1","to":"n2","condition":"ketones positive"}
  ]
}
Use simple IDs; preserve clinical thresholds verbatim.

# Figures / Diagrams / Charts

For each figure, write a compact textual description capturing labels, axes, and key relationships.

If a chart encodes data values, extract the visible numbers as a small table. If not given, describe trends only.

Example JSON:

json
Copy code
{
  "type": "figure",
  "title": "Figure 5.1 Cardiac cycle",
  "description": "Schematic phases (isovolumetric contraction, ejection, …); labels: LV pressure, aortic pressure… Trend: LV pressure rises during …",
  "visible_labels": ["LV", "Aorta", "Mitral"],
  "data_points": null
}
# Lists & Key Points

Convert bullet lists and numbered lists cleanly.

For “pearls”, “high-yield” callouts, prefix with **HIGH-YIELD:**.

# References / Footnotes on Page

Transcribe verbatim; if footnote markers map to table/figure, cross-reference.

# Uncertain / OCR Issues

JSON array, where each item has: location (body/table/figure), snippet (if any), reason (e.g., “scan blur”), and confidence score 0–1.

ADDITIONAL RULES FOR DIFFICULT LAYOUTS

Multi-column pages: Respect reading order left→right, top→bottom per row.

Sidebars/callouts: Place them after the paragraph they visually relate to; prefix with > Note: or > Caution:; also mirror inside # Lists & Key Points if “pearls”.

Units & thresholds: Keep exact units (mg/kg, mmol/L). Do not convert units.

Drug names: Preserve capitalization of brand/generic as shown.

Abbreviations: On first obvious occurrence, if expansion is shown on page, include (abbr: expansion).

OUTPUT VALIDATION

Ensure valid JSON blocks (UTF-8, double quotes).

No trailing commas.

Do not wrap JSON in code fences other than the ones I asked above.

You will now receive a PDF, respond in the exact structure described above.
2025-12-13 14:31:24,980 - INFO - Uploaded PDF file: Bolognia 5th Edition 2024 (1)-7-26-46-1-20.pdf
2025-12-13 14:31:24,981 - INFO - Sending prompt (length: 4635 characters)
2025-12-13 14:31:32,399 - INFO - Response received (length: 101 characters)
2025-12-13 14:31:33,086 - INFO - PDF processed successfully with gemini-2.5-flash
2025-12-13 14:31:33,087 - INFO - Response length: 101 characters
2025-12-13 14:31:33,094 - WARNING - python-docx not available, saving as text file
2025-12-13 14:31:33,097 - ERROR - Error saving response: cannot access local variable 'prompt' where it is not associated with a value
2025-12-13 14:34:28,017 - INFO - Loaded 6 predefined prompts
2025-12-13 14:34:57,989 - INFO - Loaded 3 API keys
2025-12-13 14:35:49,321 - INFO - === Starting PDF Processing ===
2025-12-13 14:35:49,323 - INFO - Model: gemini-2.5-flash
2025-12-13 14:35:49,323 - INFO - PDF: /home/mohammadbagher/Downloads/Bolognia 5th Edition 2024 (1)-7-26-46-1-20.pdf
2025-12-13 14:35:49,327 - INFO - Full prompt being sent (4635 chars): You are a meticulous medical OCR & structuring assistant. Your job is to extract **only** what is present on each provided textbook page image/PDF and convert it into clean, AI-ready text with structured sections. You MUST avoid hallucinations and preserve original medical meaning precisely. Follow these global rules:

GLOBAL PRINCIPLES
- NO HALLUCINATIONS: Output only content visible on the page(s). If unreadable/unclear, write: "[UNREADABLE]" or add an "uncertain" flag with brief reason.
- LANGUAGE & SPELLING: Preserve original English spelling and medical terminology; do not normalize British↔American spelling.
- CLEAN OCR: 
  - Remove page headers/footers, running titles, folios, and footers like “©Publisher 2023”.
  - Fix broken words at line breaks (e.g., "thera-\npy" → "therapy").
  - Replace ligatures (ﬁ, ﬂ) with normal letters.
  - Preserve meaningful capitalization, italics markers (use *italic*), bold (**bold**), and inline sub/superscripts as LaTeX if clearly indicated (e.g., CO$_2$).
- CITATIONS: Keep in-text citations literally (e.g., “[12]”, “(Smith 2021)”).
- MATH/CHEM: For formulae, use inline LaTeX: e.g., `pH = -\log_{10} [H^+]`.
- NO IMAGES: Describe figures/diagrams/charts in text form—succinct but complete. Do not invent unseen labels.

STRUCTURED OUTPUT FORMAT (Markdown with embedded JSON blocks)
Always produce in this exact order:

1) `# Page Metadata`
   - Book title (if visible), chapter title (if visible), page number (if visible or inferable), section headings found.
   - Confidence notes: short bullets where uncertainty exists.

2) `# Body`
   - Clean, continuous paragraph text. Keep section/subsection headings as `##` and `###`.

3) `# Tables`
   - For each table found, output a JSON block per table with:
   ```json
   {
     "type": "table",
     "title": "Table 3.2 Disease-modifying agents",
     "note": "footnotes or legends if present",
     "columns": ["Column A", "Column B", "Column C"],
     "rows": [
       ["cell(1,1)", "cell(1,2)", "cell(1,3)"],
       ["cell(2,1)", "cell(2,2)", "cell(2,3)"]
     ],
     "uncertain_cells": [{"row":2,"col":3,"reason":"blurry"}]
   }
If a table is complex (merged cells), normalize by repeating header labels; if impossible, add "structure_note".

# Algorithms / Clinical Approaches

Convert any flowchart, algorithm box, or approach diagram into BOTH:
a) Bulleted steps (plain text):

Step 1: …

If lab X > Y → do …

Else → …
b) Machine-readable pseudo-logic JSON:

json
Copy code
{
  "type": "algorithm",
  "title": "Approach to suspected DKA",
  "nodes": [
    {"id":"start","text":"Patient with hyperglycemia"},
    {"id":"n1","text":"Check ketones"},
    {"id":"n2","text":"If ketones positive → start insulin infusion"}
  ],
  "edges": [
    {"from":"start","to":"n1"},
    {"from":"n1","to":"n2","condition":"ketones positive"}
  ]
}
Use simple IDs; preserve clinical thresholds verbatim.

# Figures / Diagrams / Charts

For each figure, write a compact textual description capturing labels, axes, and key relationships.

If a chart encodes data values, extract the visible numbers as a small table. If not given, describe trends only.

Example JSON:

json
Copy code
{
  "type": "figure",
  "title": "Figure 5.1 Cardiac cycle",
  "description": "Schematic phases (isovolumetric contraction, ejection, …); labels: LV pressure, aortic pressure… Trend: LV pressure rises during …",
  "visible_labels": ["LV", "Aorta", "Mitral"],
  "data_points": null
}
# Lists & Key Points

Convert bullet lists and numbered lists cleanly.

For “pearls”, “high-yield” callouts, prefix with **HIGH-YIELD:**.

# References / Footnotes on Page

Transcribe verbatim; if footnote markers map to table/figure, cross-reference.

# Uncertain / OCR Issues

JSON array, where each item has: location (body/table/figure), snippet (if any), reason (e.g., “scan blur”), and confidence score 0–1.

ADDITIONAL RULES FOR DIFFICULT LAYOUTS

Multi-column pages: Respect reading order left→right, top→bottom per row.

Sidebars/callouts: Place them after the paragraph they visually relate to; prefix with > Note: or > Caution:; also mirror inside # Lists & Key Points if “pearls”.

Units & thresholds: Keep exact units (mg/kg, mmol/L). Do not convert units.

Drug names: Preserve capitalization of brand/generic as shown.

Abbreviations: On first obvious occurrence, if expansion is shown on page, include (abbr: expansion).

OUTPUT VALIDATION

Ensure valid JSON blocks (UTF-8, double quotes).

No trailing commas.

Do not wrap JSON in code fences other than the ones I asked above.

You will now receive a PDF, respond in the exact structure described above.
2025-12-13 14:35:58,770 - INFO - Uploaded PDF file: Bolognia 5th Edition 2024 (1)-7-26-46-1-20.pdf
2025-12-13 14:35:58,771 - INFO - Using model: gemini-2.5-flash
2025-12-13 14:35:58,771 - INFO - Sending prompt (length: 4635 characters)
2025-12-13 14:35:58,772 - INFO - Max output tokens: 8192
2025-12-13 14:36:32,629 - INFO - Response received (length: 22595 characters)
2025-12-13 14:36:32,631 - WARNING - Response might be truncated - checking for finish reason
2025-12-13 14:36:32,632 - INFO - Candidate 0 finish reason: 2
2025-12-13 14:36:33,514 - INFO - Extracted response from response.text (22595 chars)
2025-12-13 14:36:33,514 - INFO - PDF processed successfully with gemini-2.5-flash
2025-12-13 14:36:33,515 - INFO - Full response length: 22595 characters
2025-12-13 14:36:33,558 - INFO - === Response Received ===
2025-12-13 14:36:33,558 - INFO - Response length: 22595 characters
2025-12-13 14:36:33,558 - INFO - Response preview (first 500 chars): # Page Metadata
- **Book title**: VESICULOBULLOUS DISEASES
- **Chapter title**: Pemphigoid Group
- **Page numbers**: 517-533.e3 (inclusive of e-figures)
- **Section headings found**:
  - Bullous Pemphigoid
  - Introduction
  - History
  - Epidemiology
  - Pathogenesis
  - Humoral and cellular responses
  - Clinical Features
  - Non-bullous pemphigoid
  - Bullous phase
  - Clinical variants
  - Associated Diseases
  - Drug-induced bullous pemphigoid
  - Diagnosis
  - Light microscopy
  - Direct i...
2025-12-13 14:36:33,558 - INFO - Response preview (last 500 chars): ...in adults, during childhood the condition is frequently associated with annular and polycyclic lesions, often with peripheral blisters, as well as involvement of the genital and perioral region. However, identical features are also observed in childhood BP (see Fig. 30.7B) [18,20].
- **Anti-p200 pemphigoid (anti-laminin $\gamma$1 pemphigoid).** Although patients often have features similar to BP, they tend to be younger and are more likely to have involvement of palmoplantar and cephalic regions
2025-12-13 14:36:33,560 - WARNING - python-docx not available, saving as text file
2025-12-13 14:36:33,562 - ERROR - Error saving response: cannot access local variable 'prompt' where it is not associated with a value
2025-12-14 08:26:11,809 - INFO - Loaded 6 predefined prompts
2025-12-14 08:43:58,560 - INFO - Loaded 6 predefined prompts
2025-12-14 08:44:48,860 - INFO - Loaded 3 API keys
2025-12-14 08:47:28,012 - INFO - === Starting PDF Processing ===
2025-12-14 08:47:28,012 - INFO - Model: gemini-2.5-flash
2025-12-14 08:47:28,013 - INFO - PDF: /home/mohammadbagher/Downloads/PDFs/ilovepdf_split/Bolognia 5th Edition 2024 (1)-1.pdf
2025-12-14 08:47:28,013 - INFO - Full prompt being sent (7497 chars): You are a meticulous medical OCR & structuring assistant. Your job is to extract **only** what is present on each provided textbook page image/PDF and convert it into clean, AI-ready text with structured sections. You MUST avoid hallucinations and preserve original medical meaning precisely. Follow these global rules:

GLOBAL PRINCIPLES
- NO HALLUCINATIONS: Output only content visible on the page(s). If unreadable/unclear, write: "[UNREADABLE]" or add an "uncertain" flag with brief reason.
- LANGUAGE & SPELLING: Preserve original English spelling and medical terminology; do not normalize British↔American spelling.
- CLEAN OCR: 
  - Remove page headers/footers, running titles, folios, and footers like “©Publisher 2023”.
  - Fix broken words at line breaks (e.g., "thera-\npy" → "therapy").
  - Replace ligatures (ﬁ, ﬂ) with normal letters.
  - Preserve meaningful capitalization, italics markers (use *italic*), bold (**bold**), and inline sub/superscripts as LaTeX if clearly indicated (e.g., CO$_2$).
- CITATIONS: Keep in-text citations literally (e.g., “[12]”, “(Smith 2021)”).
- MATH/CHEM: For formulae, use inline LaTeX: e.g., `pH = -\log_{10} [H^+]`.
- NO IMAGES: Describe figures/diagrams/charts in text form—succinct but complete. Do not invent unseen labels.

STRUCTURED OUTPUT FORMAT (Markdown with embedded JSON blocks)
Always produce in this exact order:

1) `# Page Metadata`
   - Book title (if visible), chapter title (if visible), page number (if visible or inferable), section headings found.
   - Confidence notes: short bullets where uncertainty exists.

2) `# Body`
   - Clean, continuous paragraph text. Keep section/subsection headings as `##` and `###`.

3) `# Tables`
   - For each table found, output a JSON block per table with:
   ```json
   {
     "type": "table",
     "title": "Table 3.2 Disease-modifying agents",
     "note": "footnotes or legends if present",
     "columns": ["Column A", "Column B", "Column C"],
     "rows": [
       ["cell(1,1)", "cell(1,2)", "cell(1,3)"],
       ["cell(2,1)", "cell(2,2)", "cell(2,3)"]
     ],
     "uncertain_cells": [{"row":2,"col":3,"reason":"blurry"}]
   }
If a table is complex (merged cells), normalize by repeating header labels; if impossible, add "structure_note".

# Algorithms / Clinical Approaches

Convert any flowchart, algorithm box, or approach diagram into BOTH:
a) Bulleted steps (plain text):

Step 1: …

If lab X > Y → do …

Else → …
b) Machine-readable pseudo-logic JSON:

json
Copy code
{
  "type": "algorithm",
  "title": "Approach to suspected DKA",
  "nodes": [
    {"id":"start","text":"Patient with hyperglycemia"},
    {"id":"n1","text":"Check ketones"},
    {"id":"n2","text":"If ketones positive → start insulin infusion"}
  ],
  "edges": [
    {"from":"start","to":"n1"},
    {"from":"n1","to":"n2","condition":"ketones positive"}
  ]
}
Use simple IDs; preserve clinical thresholds verbatim.

# Figures / Diagrams / Charts

For each figure, write a compact textual description capturing labels, axes, and key relationships.

If a chart encodes data values, extract the visible numbers as a small table. If not given, describe trends only.

Example JSON:

json
Copy code
{
  "type": "figure",
  "title": "Figure 5.1 Cardiac cycle",
  "description": "Schematic phases (isovolumetric contraction, ejection, …); labels: LV pressure, aortic pressure… Trend: LV pressure rises during …",
  "visible_labels": ["LV", "Aorta", "Mitral"],
  "data_points": null
}
# Lists & Key Points

Convert bullet lists and numbered lists cleanly.

For “pearls”, “high-yield” callouts, prefix with **HIGH-YIELD:**.

# References / Footnotes on Page

Transcribe verbatim; if footnote markers map to table/figure, cross-reference.

# Uncertain / OCR Issues

JSON array, where each item has: location (body/table/figure), snippet (if any), reason (e.g., “scan blur”), and confidence score 0–1.

ADDITIONAL RULES FOR DIFFICULT LAYOUTS

Multi-column pages: Respect reading order left→right, top→bottom per row.

Sidebars/callouts: Place them after the paragraph they visually relate to; prefix with > Note: or > Caution:; also mirror inside # Lists & Key Points if “pearls”.

Units & thresholds: Keep exact units (mg/kg, mmol/L). Do not convert units.

Drug names: Preserve capitalization of brand/generic as shown.

Abbreviations: On first obvious occurrence, if expansion is shown on page, include (abbr: expansion).

OUTPUT VALIDATION

Ensure valid JSON blocks (UTF-8, double quotes).

No trailing commas.

Do not wrap JSON in code fences other than the ones I asked above.

Final Output structure: your output must be sent is as a CSV in a code block with the delimiter of three consecutive semicolons like “;;;”. Each row is representative of a “page text” or “figure” or “Table”. So each “page text” and “figure” and “Table”  will have a row. The columns Headers are:
    1. Type
    2. Extraction
    3. Number
    4. Part
The “Type” column is for mentioning the type of the cell row data. The acceptable types are “page text” or “figure” or “Table”. If you are writing the page’s text in the extraction column, then the type will be “page text”. If the row in for figures, write “Figure”. And ”. If the row in for Tables, write “Table”.
The “Extraction” column is the main column for each row. If you are extracting a page’s text, write the complete text here. The JSONs of tables and figures must be written here as well.
The References in the end of the chapter must not be extracted. Ignore it.
The ”Number” column must show the page it is extracted from like 1 or 2 and more.
The “Part” column shows that the row’s content is included in which part. Use numbers like 1 or 2 and more.
How to define the parts for each row: in the beginning of the first page of the file there is a “Chapter contents” which demonstrates the parts of the chapter recommended by the author, which we call them “author parts”. I want you to make your own suggestion for dividing the parts, which we call them “Our parts”. The rules of dividing are as follows: an “our part” is consisted of as many as consecutive “author parts” without being the final “our part” more than 10 pages. For example if the “author part”s of the chapter are 2,4,5,3,1,7,5 pages respectively, the first “our part” will be consisted of the first two “author parts”. The second “our part” will be consisted of the third and fourth and fifth “author parts”. the third “our part” will be consisted of the sixth “author part”. the fourth “our part” will be consisted of the seventh “author part”.
If an “our part” ends in the middle of a page, some of the page text will be for the previous “our part” and some of the page will be for the next “our part”. The text of such pages must be written in two separate rows. One of them is related to the previous “our part” and one of them is related to next “our part”. Your goal should be avoiding a row’s content to be consisted of the data from two different “our part”s.
And for example if you decided to divide the chapter into 2 parts, you should write “1” for the contents of the first part and write “2” for the contents of the second part. 

VERY IMPORTANT: your output must be single line (minified). DO NOT EVER use the “ENTER” button inside the cells. It shouldn’t be html rich. Do not separate texts with ENTER.

بسیار مهم: خروجی ات به صورت تک خطی (Minified) باشد و به هیچ عنوان از دکمه Enter در خروجی ات استفاده نکن.



You will now receive a PDF, respond in the exact structure described above.
2025-12-14 08:47:52,210 - INFO - Uploaded PDF file: Bolognia 5th Edition 2024 (1)-1.pdf
2025-12-14 08:47:52,211 - INFO - Using max_output_tokens: 8192
2025-12-14 08:47:52,212 - INFO - Using model: gemini-2.5-flash
2025-12-14 08:47:52,213 - INFO - Sending prompt (length: 7497 characters)
2025-12-14 08:47:52,213 - INFO - Max output tokens: 8192
2025-12-14 08:48:43,578 - INFO - Response received (length: 1149 characters)
2025-12-14 08:48:43,580 - WARNING - Response might be truncated - checking for finish reason
2025-12-14 08:48:43,581 - INFO - Candidate 0 finish reason: MAX_TOKENS (truncated!)
2025-12-14 08:48:43,582 - ERROR - ❌ CRITICAL: Response was TRUNCATED due to MAX_TOKENS limit!
2025-12-14 08:48:43,583 - ERROR - Current max_output_tokens: 8192
2025-12-14 08:48:43,583 - ERROR - The response is INCOMPLETE! Consider:
2025-12-14 08:48:43,584 - ERROR -   1. Using gemini-2.5-pro model (better for long responses)
2025-12-14 08:48:43,585 - ERROR -   2. Breaking the task into smaller parts
2025-12-14 08:48:43,587 - ERROR -   3. Simplifying the prompt to get shorter responses
2025-12-14 08:48:44,225 - INFO - Extracted response from response.text (1149 chars)
2025-12-14 08:48:44,225 - INFO - PDF processed successfully with gemini-2.5-flash
2025-12-14 08:48:44,226 - INFO - Full response length: 1149 characters
2025-12-14 08:48:44,226 - INFO - Response preview (first 500 chars): ```csv
Type;;;Extraction;;;Number;;;Part
page text;;;# Page Metadata;;;Book title: Dermatology (Fifth Edition, Volume One);;;Chapter title: Volume One;;;Page number: 1;;;Section headings found: None;;;Confidence notes: None;;;# Body;;;Volume One;;;Enhanced DIGITAL VERSION Included;;;Fifth Edition;;;DERMATOLOGY;;;JEAN L. BOLOGNIA | JULIE V. SCHAFFER | LORENZO CERRONI;;;ASSOCIATE EDITORS;;;JEFFREY P. CALLEN | EDWARD W. COWEN;;;KARYNNE O. DUNCAN | GEORGE J. HRUZA;;;JONATHAN LEVENTHAL | LUIS REQUENA...
2025-12-14 08:48:44,227 - INFO - Response preview (last 500 chars): ... Dermatology;;;Page number: 2;;;Section headings found: ## INTRODUCTION TO CLINICAL DERMATOLOGY, ## Etiologic Premises, ## Inflammatory versus neoplastic, ## Morphology;;;Confidence notes: None;;;# Body;;;OVERVIEW OF BASIC SCIENCE SECTION 1;;;Basic Principles of Dermatology O;;;Whitney A. High, Carlo F. Tomasini, Giuseppe Argenziano, Iris Zalaudek, Marco Ardigò, Chiara Franceschini and Philipp Tschandl;;;Chapter Contents;;;Introduction to Clinical Dermatology. 1;;;The Role of Dermatopathology in
2025-12-14 08:48:44,228 - WARNING - ⚠️ Response might be cut off - doesn't end with proper punctuation
2025-12-14 08:48:58,928 - INFO - === Response Received ===
2025-12-14 08:48:58,929 - INFO - Response length: 1149 characters
2025-12-14 08:48:58,929 - INFO - Truncated: True
2025-12-14 08:48:58,930 - INFO - Response preview (first 500 chars): ```csv
Type;;;Extraction;;;Number;;;Part
page text;;;# Page Metadata;;;Book title: Dermatology (Fifth Edition, Volume One);;;Chapter title: Volume One;;;Page number: 1;;;Section headings found: None;;;Confidence notes: None;;;# Body;;;Volume One;;;Enhanced DIGITAL VERSION Included;;;Fifth Edition;;;DERMATOLOGY;;;JEAN L. BOLOGNIA | JULIE V. SCHAFFER | LORENZO CERRONI;;;ASSOCIATE EDITORS;;;JEFFREY P. CALLEN | EDWARD W. COWEN;;;KARYNNE O. DUNCAN | GEORGE J. HRUZA;;;JONATHAN LEVENTHAL | LUIS REQUENA...
2025-12-14 08:48:58,932 - INFO - Response preview (last 500 chars): ... Dermatology;;;Page number: 2;;;Section headings found: ## INTRODUCTION TO CLINICAL DERMATOLOGY, ## Etiologic Premises, ## Inflammatory versus neoplastic, ## Morphology;;;Confidence notes: None;;;# Body;;;OVERVIEW OF BASIC SCIENCE SECTION 1;;;Basic Principles of Dermatology O;;;Whitney A. High, Carlo F. Tomasini, Giuseppe Argenziano, Iris Zalaudek, Marco Ardigò, Chiara Franceschini and Philipp Tschandl;;;Chapter Contents;;;Introduction to Clinical Dermatology. 1;;;The Role of Dermatopathology in
2025-12-14 08:48:59,317 - WARNING - python-docx not available, saving as text file
2025-12-14 08:48:59,325 - INFO - Response displayed and saved to: /home/mohammadbagher/Desktop/Bolognia 5th Edition 2024 (1)-1_response_20251214_084859.txt
2025-12-14 08:52:42,333 - INFO - Loaded 6 predefined prompts
2025-12-14 08:53:05,310 - INFO - Loaded 3 API keys
2025-12-14 08:54:42,629 - INFO - === Starting PDF Processing ===
2025-12-14 08:54:42,629 - INFO - Model: gemini-2.5-flash
2025-12-14 08:54:42,629 - INFO - PDF: /home/mohammadbagher/Downloads/PDFs/ilovepdf_split/Bolognia 5th Edition 2024 (1)-1.pdf
2025-12-14 08:54:42,629 - INFO - Full prompt being sent (7497 chars): You are a meticulous medical OCR & structuring assistant. Your job is to extract **only** what is present on each provided textbook page image/PDF and convert it into clean, AI-ready text with structured sections. You MUST avoid hallucinations and preserve original medical meaning precisely. Follow these global rules:

GLOBAL PRINCIPLES
- NO HALLUCINATIONS: Output only content visible on the page(s). If unreadable/unclear, write: "[UNREADABLE]" or add an "uncertain" flag with brief reason.
- LANGUAGE & SPELLING: Preserve original English spelling and medical terminology; do not normalize British↔American spelling.
- CLEAN OCR: 
  - Remove page headers/footers, running titles, folios, and footers like “©Publisher 2023”.
  - Fix broken words at line breaks (e.g., "thera-\npy" → "therapy").
  - Replace ligatures (ﬁ, ﬂ) with normal letters.
  - Preserve meaningful capitalization, italics markers (use *italic*), bold (**bold**), and inline sub/superscripts as LaTeX if clearly indicated (e.g., CO$_2$).
- CITATIONS: Keep in-text citations literally (e.g., “[12]”, “(Smith 2021)”).
- MATH/CHEM: For formulae, use inline LaTeX: e.g., `pH = -\log_{10} [H^+]`.
- NO IMAGES: Describe figures/diagrams/charts in text form—succinct but complete. Do not invent unseen labels.

STRUCTURED OUTPUT FORMAT (Markdown with embedded JSON blocks)
Always produce in this exact order:

1) `# Page Metadata`
   - Book title (if visible), chapter title (if visible), page number (if visible or inferable), section headings found.
   - Confidence notes: short bullets where uncertainty exists.

2) `# Body`
   - Clean, continuous paragraph text. Keep section/subsection headings as `##` and `###`.

3) `# Tables`
   - For each table found, output a JSON block per table with:
   ```json
   {
     "type": "table",
     "title": "Table 3.2 Disease-modifying agents",
     "note": "footnotes or legends if present",
     "columns": ["Column A", "Column B", "Column C"],
     "rows": [
       ["cell(1,1)", "cell(1,2)", "cell(1,3)"],
       ["cell(2,1)", "cell(2,2)", "cell(2,3)"]
     ],
     "uncertain_cells": [{"row":2,"col":3,"reason":"blurry"}]
   }
If a table is complex (merged cells), normalize by repeating header labels; if impossible, add "structure_note".

# Algorithms / Clinical Approaches

Convert any flowchart, algorithm box, or approach diagram into BOTH:
a) Bulleted steps (plain text):

Step 1: …

If lab X > Y → do …

Else → …
b) Machine-readable pseudo-logic JSON:

json
Copy code
{
  "type": "algorithm",
  "title": "Approach to suspected DKA",
  "nodes": [
    {"id":"start","text":"Patient with hyperglycemia"},
    {"id":"n1","text":"Check ketones"},
    {"id":"n2","text":"If ketones positive → start insulin infusion"}
  ],
  "edges": [
    {"from":"start","to":"n1"},
    {"from":"n1","to":"n2","condition":"ketones positive"}
  ]
}
Use simple IDs; preserve clinical thresholds verbatim.

# Figures / Diagrams / Charts

For each figure, write a compact textual description capturing labels, axes, and key relationships.

If a chart encodes data values, extract the visible numbers as a small table. If not given, describe trends only.

Example JSON:

json
Copy code
{
  "type": "figure",
  "title": "Figure 5.1 Cardiac cycle",
  "description": "Schematic phases (isovolumetric contraction, ejection, …); labels: LV pressure, aortic pressure… Trend: LV pressure rises during …",
  "visible_labels": ["LV", "Aorta", "Mitral"],
  "data_points": null
}
# Lists & Key Points

Convert bullet lists and numbered lists cleanly.

For “pearls”, “high-yield” callouts, prefix with **HIGH-YIELD:**.

# References / Footnotes on Page

Transcribe verbatim; if footnote markers map to table/figure, cross-reference.

# Uncertain / OCR Issues

JSON array, where each item has: location (body/table/figure), snippet (if any), reason (e.g., “scan blur”), and confidence score 0–1.

ADDITIONAL RULES FOR DIFFICULT LAYOUTS

Multi-column pages: Respect reading order left→right, top→bottom per row.

Sidebars/callouts: Place them after the paragraph they visually relate to; prefix with > Note: or > Caution:; also mirror inside # Lists & Key Points if “pearls”.

Units & thresholds: Keep exact units (mg/kg, mmol/L). Do not convert units.

Drug names: Preserve capitalization of brand/generic as shown.

Abbreviations: On first obvious occurrence, if expansion is shown on page, include (abbr: expansion).

OUTPUT VALIDATION

Ensure valid JSON blocks (UTF-8, double quotes).

No trailing commas.

Do not wrap JSON in code fences other than the ones I asked above.

Final Output structure: your output must be sent is as a CSV in a code block with the delimiter of three consecutive semicolons like “;;;”. Each row is representative of a “page text” or “figure” or “Table”. So each “page text” and “figure” and “Table”  will have a row. The columns Headers are:
    1. Type
    2. Extraction
    3. Number
    4. Part
The “Type” column is for mentioning the type of the cell row data. The acceptable types are “page text” or “figure” or “Table”. If you are writing the page’s text in the extraction column, then the type will be “page text”. If the row in for figures, write “Figure”. And ”. If the row in for Tables, write “Table”.
The “Extraction” column is the main column for each row. If you are extracting a page’s text, write the complete text here. The JSONs of tables and figures must be written here as well.
The References in the end of the chapter must not be extracted. Ignore it.
The ”Number” column must show the page it is extracted from like 1 or 2 and more.
The “Part” column shows that the row’s content is included in which part. Use numbers like 1 or 2 and more.
How to define the parts for each row: in the beginning of the first page of the file there is a “Chapter contents” which demonstrates the parts of the chapter recommended by the author, which we call them “author parts”. I want you to make your own suggestion for dividing the parts, which we call them “Our parts”. The rules of dividing are as follows: an “our part” is consisted of as many as consecutive “author parts” without being the final “our part” more than 10 pages. For example if the “author part”s of the chapter are 2,4,5,3,1,7,5 pages respectively, the first “our part” will be consisted of the first two “author parts”. The second “our part” will be consisted of the third and fourth and fifth “author parts”. the third “our part” will be consisted of the sixth “author part”. the fourth “our part” will be consisted of the seventh “author part”.
If an “our part” ends in the middle of a page, some of the page text will be for the previous “our part” and some of the page will be for the next “our part”. The text of such pages must be written in two separate rows. One of them is related to the previous “our part” and one of them is related to next “our part”. Your goal should be avoiding a row’s content to be consisted of the data from two different “our part”s.
And for example if you decided to divide the chapter into 2 parts, you should write “1” for the contents of the first part and write “2” for the contents of the second part. 

VERY IMPORTANT: your output must be single line (minified). DO NOT EVER use the “ENTER” button inside the cells. It shouldn’t be html rich. Do not separate texts with ENTER.

بسیار مهم: خروجی ات به صورت تک خطی (Minified) باشد و به هیچ عنوان از دکمه Enter در خروجی ات استفاده نکن.



You will now receive a PDF, respond in the exact structure described above.
2025-12-14 08:55:19,003 - INFO - Uploaded PDF file: Bolognia 5th Edition 2024 (1)-1.pdf
2025-12-14 08:55:19,004 - INFO - Model: gemini-2.5-flash, Max tokens for model: 32768, Using: 32768
2025-12-14 08:55:19,005 - INFO - Using max_output_tokens: 32768
2025-12-14 08:55:19,005 - INFO - Using model: gemini-2.5-flash
2025-12-14 08:55:19,006 - INFO - Sending prompt (length: 7497 characters)
2025-12-14 08:55:19,006 - INFO - Max output tokens: 32768
2025-12-14 08:55:19,007 - INFO - Generating content with streaming enabled for complete response...
2025-12-14 08:57:10,754 - INFO - Streaming completed: 493 chunks, 105231 characters received
2025-12-14 08:57:10,755 - INFO - Streaming finish reason: MAX_TOKENS (truncated!)
2025-12-14 08:57:10,755 - WARNING - ⚠️ Response may be truncated (finish_reason: MAX_TOKENS (truncated!))
2025-12-14 08:57:10,756 - INFO - Response received (length: 105231 characters)
2025-12-14 08:57:10,756 - WARNING - Response might be truncated - checking for finish reason
2025-12-14 08:57:11,617 - INFO - Extracted response from response.text (105231 chars)
2025-12-14 08:57:11,618 - INFO - PDF processed successfully with gemini-2.5-flash
2025-12-14 08:57:11,619 - INFO - Full response length: 105231 characters
2025-12-14 08:57:11,620 - INFO - Response preview (first 500 chars): ```csv
Type;;;Extraction;;;Number;;;Part
page text;;;# Page Metadata\nBook title: Dermatology, Fifth Edition, Volume One\nChapter title: Basic Principles of Dermatology\nPage number: 1 (Chapter Page)\nSection headings found: INTRODUCTION TO CLINICAL DERMATOLOGY, Etiologic Premises, Inflammatory versus neoplastic, Morphology\nConfidence notes: The book title and edition are from the cover page (PDF page 1). Chapter page number is inferred from the chapter contents.;;;# Body\n## INTRODUCTION TO CL...
2025-12-14 08:57:11,621 - INFO - Response preview (last 500 chars): ...e to an underlying plasma cell dyscrasia, whereas in others, exogenous material has been purposefully or accidentally inoculated into the skin (e.g. cosmetic filler material, tattoo pigment). These materials may accumulate within the dermis, the subcutaneous fat, or both. Deposits of some materials, such as the silver in patients with argyria, may be limited to cutaneous adnexa. Use of polarized light or darkfield microscopy (where light enters tissue at an angle that is not perpendicular to the
2025-12-14 08:57:11,622 - INFO - ✓ Response is very long (105231 chars) - likely complete
2025-12-14 08:57:11,623 - WARNING - ⚠️ Response might be cut off - doesn't end with proper punctuation
2025-12-14 09:10:03,349 - INFO - Loaded 6 predefined prompts
2025-12-14 09:10:29,268 - INFO - Loaded 3 API keys
2025-12-14 09:11:05,978 - INFO - === Starting PDF Processing ===
2025-12-14 09:11:05,978 - INFO - Model: gemini-2.5-flash
2025-12-14 09:11:05,978 - INFO - PDF: /home/mohammadbagher/Downloads/PDFs/ilovepdf_split/Bolognia 5th Edition 2024 (1)-1.pdf
2025-12-14 09:11:05,978 - INFO - Full prompt being sent (7497 chars): You are a meticulous medical OCR & structuring assistant. Your job is to extract **only** what is present on each provided textbook page image/PDF and convert it into clean, AI-ready text with structured sections. You MUST avoid hallucinations and preserve original medical meaning precisely. Follow these global rules:

GLOBAL PRINCIPLES
- NO HALLUCINATIONS: Output only content visible on the page(s). If unreadable/unclear, write: "[UNREADABLE]" or add an "uncertain" flag with brief reason.
- LANGUAGE & SPELLING: Preserve original English spelling and medical terminology; do not normalize British↔American spelling.
- CLEAN OCR: 
  - Remove page headers/footers, running titles, folios, and footers like “©Publisher 2023”.
  - Fix broken words at line breaks (e.g., "thera-\npy" → "therapy").
  - Replace ligatures (ﬁ, ﬂ) with normal letters.
  - Preserve meaningful capitalization, italics markers (use *italic*), bold (**bold**), and inline sub/superscripts as LaTeX if clearly indicated (e.g., CO$_2$).
- CITATIONS: Keep in-text citations literally (e.g., “[12]”, “(Smith 2021)”).
- MATH/CHEM: For formulae, use inline LaTeX: e.g., `pH = -\log_{10} [H^+]`.
- NO IMAGES: Describe figures/diagrams/charts in text form—succinct but complete. Do not invent unseen labels.

STRUCTURED OUTPUT FORMAT (Markdown with embedded JSON blocks)
Always produce in this exact order:

1) `# Page Metadata`
   - Book title (if visible), chapter title (if visible), page number (if visible or inferable), section headings found.
   - Confidence notes: short bullets where uncertainty exists.

2) `# Body`
   - Clean, continuous paragraph text. Keep section/subsection headings as `##` and `###`.

3) `# Tables`
   - For each table found, output a JSON block per table with:
   ```json
   {
     "type": "table",
     "title": "Table 3.2 Disease-modifying agents",
     "note": "footnotes or legends if present",
     "columns": ["Column A", "Column B", "Column C"],
     "rows": [
       ["cell(1,1)", "cell(1,2)", "cell(1,3)"],
       ["cell(2,1)", "cell(2,2)", "cell(2,3)"]
     ],
     "uncertain_cells": [{"row":2,"col":3,"reason":"blurry"}]
   }
If a table is complex (merged cells), normalize by repeating header labels; if impossible, add "structure_note".

# Algorithms / Clinical Approaches

Convert any flowchart, algorithm box, or approach diagram into BOTH:
a) Bulleted steps (plain text):

Step 1: …

If lab X > Y → do …

Else → …
b) Machine-readable pseudo-logic JSON:

json
Copy code
{
  "type": "algorithm",
  "title": "Approach to suspected DKA",
  "nodes": [
    {"id":"start","text":"Patient with hyperglycemia"},
    {"id":"n1","text":"Check ketones"},
    {"id":"n2","text":"If ketones positive → start insulin infusion"}
  ],
  "edges": [
    {"from":"start","to":"n1"},
    {"from":"n1","to":"n2","condition":"ketones positive"}
  ]
}
Use simple IDs; preserve clinical thresholds verbatim.

# Figures / Diagrams / Charts

For each figure, write a compact textual description capturing labels, axes, and key relationships.

If a chart encodes data values, extract the visible numbers as a small table. If not given, describe trends only.

Example JSON:

json
Copy code
{
  "type": "figure",
  "title": "Figure 5.1 Cardiac cycle",
  "description": "Schematic phases (isovolumetric contraction, ejection, …); labels: LV pressure, aortic pressure… Trend: LV pressure rises during …",
  "visible_labels": ["LV", "Aorta", "Mitral"],
  "data_points": null
}
# Lists & Key Points

Convert bullet lists and numbered lists cleanly.

For “pearls”, “high-yield” callouts, prefix with **HIGH-YIELD:**.

# References / Footnotes on Page

Transcribe verbatim; if footnote markers map to table/figure, cross-reference.

# Uncertain / OCR Issues

JSON array, where each item has: location (body/table/figure), snippet (if any), reason (e.g., “scan blur”), and confidence score 0–1.

ADDITIONAL RULES FOR DIFFICULT LAYOUTS

Multi-column pages: Respect reading order left→right, top→bottom per row.

Sidebars/callouts: Place them after the paragraph they visually relate to; prefix with > Note: or > Caution:; also mirror inside # Lists & Key Points if “pearls”.

Units & thresholds: Keep exact units (mg/kg, mmol/L). Do not convert units.

Drug names: Preserve capitalization of brand/generic as shown.

Abbreviations: On first obvious occurrence, if expansion is shown on page, include (abbr: expansion).

OUTPUT VALIDATION

Ensure valid JSON blocks (UTF-8, double quotes).

No trailing commas.

Do not wrap JSON in code fences other than the ones I asked above.

Final Output structure: your output must be sent is as a CSV in a code block with the delimiter of three consecutive semicolons like “;;;”. Each row is representative of a “page text” or “figure” or “Table”. So each “page text” and “figure” and “Table”  will have a row. The columns Headers are:
    1. Type
    2. Extraction
    3. Number
    4. Part
The “Type” column is for mentioning the type of the cell row data. The acceptable types are “page text” or “figure” or “Table”. If you are writing the page’s text in the extraction column, then the type will be “page text”. If the row in for figures, write “Figure”. And ”. If the row in for Tables, write “Table”.
The “Extraction” column is the main column for each row. If you are extracting a page’s text, write the complete text here. The JSONs of tables and figures must be written here as well.
The References in the end of the chapter must not be extracted. Ignore it.
The ”Number” column must show the page it is extracted from like 1 or 2 and more.
The “Part” column shows that the row’s content is included in which part. Use numbers like 1 or 2 and more.
How to define the parts for each row: in the beginning of the first page of the file there is a “Chapter contents” which demonstrates the parts of the chapter recommended by the author, which we call them “author parts”. I want you to make your own suggestion for dividing the parts, which we call them “Our parts”. The rules of dividing are as follows: an “our part” is consisted of as many as consecutive “author parts” without being the final “our part” more than 10 pages. For example if the “author part”s of the chapter are 2,4,5,3,1,7,5 pages respectively, the first “our part” will be consisted of the first two “author parts”. The second “our part” will be consisted of the third and fourth and fifth “author parts”. the third “our part” will be consisted of the sixth “author part”. the fourth “our part” will be consisted of the seventh “author part”.
If an “our part” ends in the middle of a page, some of the page text will be for the previous “our part” and some of the page will be for the next “our part”. The text of such pages must be written in two separate rows. One of them is related to the previous “our part” and one of them is related to next “our part”. Your goal should be avoiding a row’s content to be consisted of the data from two different “our part”s.
And for example if you decided to divide the chapter into 2 parts, you should write “1” for the contents of the first part and write “2” for the contents of the second part. 

VERY IMPORTANT: your output must be single line (minified). DO NOT EVER use the “ENTER” button inside the cells. It shouldn’t be html rich. Do not separate texts with ENTER.

بسیار مهم: خروجی ات به صورت تک خطی (Minified) باشد و به هیچ عنوان از دکمه Enter در خروجی ات استفاده نکن.



You will now receive a PDF, respond in the exact structure described above.
2025-12-14 09:11:30,356 - INFO - Uploaded PDF file: Bolognia 5th Edition 2024 (1)-1.pdf
2025-12-14 09:11:30,357 - INFO - Model: gemini-2.5-flash, Max tokens for model: 32768, Using: 32768
2025-12-14 09:11:30,357 - INFO - Using max_output_tokens: 32768
2025-12-14 09:11:30,358 - INFO - Using model: gemini-2.5-flash
2025-12-14 09:11:30,358 - INFO - Sending prompt (length: 7497 characters)
2025-12-14 09:11:30,359 - INFO - Max output tokens: 32768
2025-12-14 09:11:30,359 - INFO - Generating content with streaming enabled for complete response...
2025-12-14 09:14:02,864 - INFO - Streaming completed: 342 chunks, 70844 characters received
2025-12-14 09:14:02,865 - INFO - Streaming finish reason: MAX_TOKENS (truncated!)
2025-12-14 09:14:02,866 - WARNING - ⚠️ Response may be truncated (finish_reason: MAX_TOKENS (truncated!))
2025-12-14 09:14:02,867 - INFO - Response received (length: 70844 characters)
2025-12-14 09:14:02,867 - WARNING - Response might be truncated - checking for finish reason
2025-12-14 09:14:03,715 - INFO - Extracted response from response.text (70844 chars)
2025-12-14 09:14:03,716 - WARNING - CSV code block missing closing marker - response may be truncated
2025-12-14 09:14:03,717 - INFO - PDF processed successfully with gemini-2.5-flash
2025-12-14 09:14:03,717 - INFO - Full response length: 70844 characters
2025-12-14 09:14:03,718 - INFO - Extracted CSV from code block: 70837 characters
2025-12-14 09:14:03,718 - INFO - Response preview (first 500 chars): Type;;;Extraction;;;Number;;;Part
page text;;;# Page Metadata\nBook title: DERMATOLOGY Volume One Fifth Edition\nChapter title: Basic Principles of Dermatology\nPage number: 1 (PDF page 2)\nSection headings found: Chapter Contents, INTRODUCTION TO CLINICAL DERMATOLOGY, Etiologic Premises, Inflammatory versus neoplastic, Morphology\nConfidence notes: none\n# Body\n## Chapter Contents\nIntroduction to Clinical Dermatology. 1\nThe Role of Dermatopathology in Clinicopathologic Correlation. . .12\nIn...
2025-12-14 09:14:03,718 - INFO - Response preview (last 500 chars): ...There is often associated exocytosis of inflammatory cells, with migration from the vasculature into the epidermis. It is important to note that even those spongiotic dermatitides that characteristically develop vesicles, for example acute allergic contact dermatitis, may not do so, i.e. patients have only macules and papules throughout the entire course of their disease.\nSpongiotic dermatoses may be further subdivided into acute, subacute, and chronic forms. In acute spongiotic dermatitis, the
2025-12-14 09:14:03,718 - INFO - ✓ Response is very long (70837 chars) - likely complete
2025-12-14 09:14:03,719 - INFO - ✓ CSV response appears complete (last row has delimiter)
2025-12-14 09:15:20,731 - INFO - === Response Received ===
2025-12-14 09:15:20,732 - INFO - Response length: 70837 characters
2025-12-14 09:15:20,732 - INFO - Truncated: True
2025-12-14 09:15:20,733 - INFO - Response preview (first 500 chars): Type;;;Extraction;;;Number;;;Part
page text;;;# Page Metadata\nBook title: DERMATOLOGY Volume One Fifth Edition\nChapter title: Basic Principles of Dermatology\nPage number: 1 (PDF page 2)\nSection headings found: Chapter Contents, INTRODUCTION TO CLINICAL DERMATOLOGY, Etiologic Premises, Inflammatory versus neoplastic, Morphology\nConfidence notes: none\n# Body\n## Chapter Contents\nIntroduction to Clinical Dermatology. 1\nThe Role of Dermatopathology in Clinicopathologic Correlation. . .12\nIn...
2025-12-14 09:15:20,736 - INFO - Response preview (last 500 chars): ...There is often associated exocytosis of inflammatory cells, with migration from the vasculature into the epidermis. It is important to note that even those spongiotic dermatitides that characteristically develop vesicles, for example acute allergic contact dermatitis, may not do so, i.e. patients have only macules and papules throughout the entire course of their disease.\nSpongiotic dermatoses may be further subdivided into acute, subacute, and chronic forms. In acute spongiotic dermatitis, the
2025-12-14 09:15:21,163 - INFO - Response saved to CSV file: /home/mohammadbagher/Downloads/PDFs/ilovepdf_split/Bolognia 5th Edition 2024 (1)-1_response_20251214_091521.csv
2025-12-14 09:15:21,165 - INFO - Response displayed and saved to: /home/mohammadbagher/Downloads/PDFs/ilovepdf_split/Bolognia 5th Edition 2024 (1)-1_response_20251214_091521.csv
2025-12-14 09:29:22,706 - INFO - Loaded 6 predefined prompts
2025-12-14 09:30:08,848 - INFO - Loaded 3 API keys
2025-12-14 09:32:50,087 - INFO - === Starting PDF Processing ===
2025-12-14 09:32:50,087 - INFO - Model: gemini-2.5-flash
2025-12-14 09:32:50,088 - INFO - PDF: /home/mohammadbagher/Downloads/PDFs/ilovepdf_split/Bolognia 5th Edition 2024 (1)-1.pdf
2025-12-14 09:32:50,088 - INFO - Full prompt being sent (7497 chars): You are a meticulous medical OCR & structuring assistant. Your job is to extract **only** what is present on each provided textbook page image/PDF and convert it into clean, AI-ready text with structured sections. You MUST avoid hallucinations and preserve original medical meaning precisely. Follow these global rules:

GLOBAL PRINCIPLES
- NO HALLUCINATIONS: Output only content visible on the page(s). If unreadable/unclear, write: "[UNREADABLE]" or add an "uncertain" flag with brief reason.
- LANGUAGE & SPELLING: Preserve original English spelling and medical terminology; do not normalize British↔American spelling.
- CLEAN OCR: 
  - Remove page headers/footers, running titles, folios, and footers like “©Publisher 2023”.
  - Fix broken words at line breaks (e.g., "thera-\npy" → "therapy").
  - Replace ligatures (ﬁ, ﬂ) with normal letters.
  - Preserve meaningful capitalization, italics markers (use *italic*), bold (**bold**), and inline sub/superscripts as LaTeX if clearly indicated (e.g., CO$_2$).
- CITATIONS: Keep in-text citations literally (e.g., “[12]”, “(Smith 2021)”).
- MATH/CHEM: For formulae, use inline LaTeX: e.g., `pH = -\log_{10} [H^+]`.
- NO IMAGES: Describe figures/diagrams/charts in text form—succinct but complete. Do not invent unseen labels.

STRUCTURED OUTPUT FORMAT (Markdown with embedded JSON blocks)
Always produce in this exact order:

1) `# Page Metadata`
   - Book title (if visible), chapter title (if visible), page number (if visible or inferable), section headings found.
   - Confidence notes: short bullets where uncertainty exists.

2) `# Body`
   - Clean, continuous paragraph text. Keep section/subsection headings as `##` and `###`.

3) `# Tables`
   - For each table found, output a JSON block per table with:
   ```json
   {
     "type": "table",
     "title": "Table 3.2 Disease-modifying agents",
     "note": "footnotes or legends if present",
     "columns": ["Column A", "Column B", "Column C"],
     "rows": [
       ["cell(1,1)", "cell(1,2)", "cell(1,3)"],
       ["cell(2,1)", "cell(2,2)", "cell(2,3)"]
     ],
     "uncertain_cells": [{"row":2,"col":3,"reason":"blurry"}]
   }
If a table is complex (merged cells), normalize by repeating header labels; if impossible, add "structure_note".

# Algorithms / Clinical Approaches

Convert any flowchart, algorithm box, or approach diagram into BOTH:
a) Bulleted steps (plain text):

Step 1: …

If lab X > Y → do …

Else → …
b) Machine-readable pseudo-logic JSON:

json
Copy code
{
  "type": "algorithm",
  "title": "Approach to suspected DKA",
  "nodes": [
    {"id":"start","text":"Patient with hyperglycemia"},
    {"id":"n1","text":"Check ketones"},
    {"id":"n2","text":"If ketones positive → start insulin infusion"}
  ],
  "edges": [
    {"from":"start","to":"n1"},
    {"from":"n1","to":"n2","condition":"ketones positive"}
  ]
}
Use simple IDs; preserve clinical thresholds verbatim.

# Figures / Diagrams / Charts

For each figure, write a compact textual description capturing labels, axes, and key relationships.

If a chart encodes data values, extract the visible numbers as a small table. If not given, describe trends only.

Example JSON:

json
Copy code
{
  "type": "figure",
  "title": "Figure 5.1 Cardiac cycle",
  "description": "Schematic phases (isovolumetric contraction, ejection, …); labels: LV pressure, aortic pressure… Trend: LV pressure rises during …",
  "visible_labels": ["LV", "Aorta", "Mitral"],
  "data_points": null
}
# Lists & Key Points

Convert bullet lists and numbered lists cleanly.

For “pearls”, “high-yield” callouts, prefix with **HIGH-YIELD:**.

# References / Footnotes on Page

Transcribe verbatim; if footnote markers map to table/figure, cross-reference.

# Uncertain / OCR Issues

JSON array, where each item has: location (body/table/figure), snippet (if any), reason (e.g., “scan blur”), and confidence score 0–1.

ADDITIONAL RULES FOR DIFFICULT LAYOUTS

Multi-column pages: Respect reading order left→right, top→bottom per row.

Sidebars/callouts: Place them after the paragraph they visually relate to; prefix with > Note: or > Caution:; also mirror inside # Lists & Key Points if “pearls”.

Units & thresholds: Keep exact units (mg/kg, mmol/L). Do not convert units.

Drug names: Preserve capitalization of brand/generic as shown.

Abbreviations: On first obvious occurrence, if expansion is shown on page, include (abbr: expansion).

OUTPUT VALIDATION

Ensure valid JSON blocks (UTF-8, double quotes).

No trailing commas.

Do not wrap JSON in code fences other than the ones I asked above.

Final Output structure: your output must be sent is as a CSV in a code block with the delimiter of three consecutive semicolons like “;;;”. Each row is representative of a “page text” or “figure” or “Table”. So each “page text” and “figure” and “Table”  will have a row. The columns Headers are:
    1. Type
    2. Extraction
    3. Number
    4. Part
The “Type” column is for mentioning the type of the cell row data. The acceptable types are “page text” or “figure” or “Table”. If you are writing the page’s text in the extraction column, then the type will be “page text”. If the row in for figures, write “Figure”. And ”. If the row in for Tables, write “Table”.
The “Extraction” column is the main column for each row. If you are extracting a page’s text, write the complete text here. The JSONs of tables and figures must be written here as well.
The References in the end of the chapter must not be extracted. Ignore it.
The ”Number” column must show the page it is extracted from like 1 or 2 and more.
The “Part” column shows that the row’s content is included in which part. Use numbers like 1 or 2 and more.
How to define the parts for each row: in the beginning of the first page of the file there is a “Chapter contents” which demonstrates the parts of the chapter recommended by the author, which we call them “author parts”. I want you to make your own suggestion for dividing the parts, which we call them “Our parts”. The rules of dividing are as follows: an “our part” is consisted of as many as consecutive “author parts” without being the final “our part” more than 10 pages. For example if the “author part”s of the chapter are 2,4,5,3,1,7,5 pages respectively, the first “our part” will be consisted of the first two “author parts”. The second “our part” will be consisted of the third and fourth and fifth “author parts”. the third “our part” will be consisted of the sixth “author part”. the fourth “our part” will be consisted of the seventh “author part”.
If an “our part” ends in the middle of a page, some of the page text will be for the previous “our part” and some of the page will be for the next “our part”. The text of such pages must be written in two separate rows. One of them is related to the previous “our part” and one of them is related to next “our part”. Your goal should be avoiding a row’s content to be consisted of the data from two different “our part”s.
And for example if you decided to divide the chapter into 2 parts, you should write “1” for the contents of the first part and write “2” for the contents of the second part. 

VERY IMPORTANT: your output must be single line (minified). DO NOT EVER use the “ENTER” button inside the cells. It shouldn’t be html rich. Do not separate texts with ENTER.

بسیار مهم: خروجی ات به صورت تک خطی (Minified) باشد و به هیچ عنوان از دکمه Enter در خروجی ات استفاده نکن.



You will now receive a PDF, respond in the exact structure described above.
2025-12-14 09:32:50,191 - INFO - Processing PDF with 100 pages in batches of 10 pages
2025-12-14 09:33:20,103 - INFO - Uploaded PDF file: Bolognia 5th Edition 2024 (1)-1.pdf
2025-12-14 09:33:20,106 - INFO - Processing batch 1/10: pages 1-10
2025-12-14 09:34:21,706 - INFO - Extracted content from generic code block
2025-12-14 09:34:21,708 - INFO - Batch pages 1-10: Extracted 22 rows
2025-12-14 09:34:21,713 - INFO - Processing batch 2/10: pages 11-20
2025-12-14 09:36:08,896 - INFO - Extracted content from generic code block
2025-12-14 09:36:08,898 - INFO - Batch pages 11-20: Extracted 29 rows
2025-12-14 09:36:08,902 - INFO - Processing batch 3/10: pages 21-30
2025-12-14 09:37:20,991 - INFO - Extracted content from generic code block
2025-12-14 09:37:20,994 - INFO - Batch pages 21-30: Extracted 27 rows
2025-12-14 09:37:20,999 - INFO - Processing batch 4/10: pages 31-40
2025-12-14 09:39:03,077 - WARNING - Code block missing closing marker - response may be truncated
2025-12-14 09:39:03,086 - WARNING - Could not extract JSON from response
2025-12-14 09:39:03,087 - WARNING - Batch pages 31-40: No JSON data extracted
2025-12-14 09:39:03,097 - WARNING - Batch 4 returned no results
2025-12-14 09:39:03,103 - INFO - Processing batch 5/10: pages 41-50
2025-12-14 09:40:08,332 - INFO - Batch pages 41-50: Extracted 28 rows
2025-12-14 09:40:08,337 - INFO - Processing batch 6/10: pages 51-60
2025-12-14 09:40:54,813 - INFO - Batch pages 51-60: Extracted 27 rows
2025-12-14 09:40:54,817 - INFO - Processing batch 7/10: pages 61-70
2025-12-14 09:42:17,153 - INFO - Extracted content from generic code block
2025-12-14 09:42:17,155 - INFO - Batch pages 61-70: Extracted 10 rows
2025-12-14 09:42:17,158 - INFO - Processing batch 8/10: pages 71-80
2025-12-14 09:43:25,275 - INFO - Extracted content from generic code block
2025-12-14 09:43:25,278 - INFO - Batch pages 71-80: Extracted 22 rows
2025-12-14 09:43:25,282 - INFO - Processing batch 9/10: pages 81-90
2025-12-14 09:44:35,776 - INFO - Batch pages 81-90: Extracted 28 rows
2025-12-14 09:44:35,782 - INFO - Processing batch 10/10: pages 91-100
2025-12-14 09:45:57,680 - INFO - Extracted content from generic code block
2025-12-14 09:45:57,683 - WARNING - Could not extract JSON from response
2025-12-14 09:45:57,684 - WARNING - Batch pages 91-100: No JSON data extracted
2025-12-14 09:45:57,687 - WARNING - Batch 10 returned no results
2025-12-14 09:45:59,077 - INFO - === Response Received ===
2025-12-14 09:45:59,077 - INFO - Response length: 401511 characters
2025-12-14 09:45:59,077 - INFO - Truncated: False
2025-12-14 09:45:59,077 - INFO - Response preview (first 500 chars): Type;;;Extraction;;;Number;;;Part
page text;;;# Page Metadata
- Book title: DERMATOLOGY Volume One, Fifth Edition
- Author(s): JEAN L. BOLOGNIA, JULIE V. SCHAFFER, LORENZO CERRONI (Associate Editors: JEFFREY P. CALLEN, EDWARD W. COWEN, KARYNNE O. DUNCAN, GEORGE J. HRUZA, JONATHAN LEVENTHAL, LUIS REQUENA, ANTONIO TORRELO, THOMAS WIESNER)
- Page number: 1 (Cover page)
- Section headings found: None
- Confidence notes: Page 1 is a cover page, no main body text content.;;;1;;;1
page text;;;# Page Me...
2025-12-14 09:45:59,077 - INFO - Response preview (last 500 chars): ..."ddTTP", "ddCTP", "ddGTP", "CA", "CACCGAAT", "CACCG", "CACCGA", "CACCGAATACAT", "CACCGAATACATCTG", "CACCGAA", "CACCGAATA", "CACCGAATACA", "CACCGAATACATCT", "CACCGAATACATC", "3'", "GTCTACATAAGCCAC", "CACCGAATACATCTG", "CACCGAATACATCT", "CACCGAATACATC", "CACCGAATACAT", "CACCGAATACA", "CACCGAATAC", "CACCGAATA", "CACCGAAT", "CACCGAA", "CACCGA", "CACCG", "CACC", "CAC", "CA", "5'", "Sequencing gel", "CACCGAATACATCTG", "80", "390", "Automated fluorescent sequencing scan"], "data_points": null};;;90;;;1
2025-12-14 09:45:59,389 - WARNING - python-docx not available, saving as text file
2025-12-14 09:45:59,397 - INFO - Response displayed and saved to: /home/mohammadbagher/Downloads/PDFs/ilovepdf_split/Bolognia 5th Edition 2024 (1)-1_response_20251214_094559.txt
2025-12-14 10:09:42,623 - INFO - Loaded 6 predefined prompts
2025-12-14 10:10:00,618 - INFO - Loaded 3 API keys
2025-12-14 10:10:55,885 - INFO - === Starting PDF Processing ===
2025-12-14 10:10:55,885 - INFO - Model: gemini-2.5-flash
2025-12-14 10:10:55,886 - INFO - PDF: /home/mohammadbagher/Downloads/PDFs/ilovepdf_split/Bolognia 5th Edition 2024 (1)-1.pdf
2025-12-14 10:10:55,886 - INFO - Full prompt being sent (7387 chars): You are a meticulous medical OCR & structuring assistant. Your job is to extract **only** what is present on each provided textbook page image/PDF and convert it into clean, AI-ready text with structured sections. You MUST avoid hallucinations and preserve original medical meaning precisely. Follow these global rules:

GLOBAL PRINCIPLES
- NO HALLUCINATIONS: Output only content visible on the page(s). If unreadable/unclear, write: "[UNREADABLE]" or add an "uncertain" flag with brief reason.
- LANGUAGE & SPELLING: Preserve original English spelling and medical terminology; do not normalize British↔American spelling.
- CLEAN OCR: 
  - Remove page headers/footers, running titles, folios, and footers like “©Publisher 2023”.
  - Fix broken words at line breaks (e.g., "thera-\npy" → "therapy").
  - Replace ligatures (ﬁ, ﬂ) with normal letters.
  - Preserve meaningful capitalization, italics markers (use *italic*), bold (**bold**), and inline sub/superscripts as LaTeX if clearly indicated (e.g., CO$_2$).
- CITATIONS: Keep in-text citations literally (e.g., “[12]”, “(Smith 2021)”).
- MATH/CHEM: For formulae, use inline LaTeX: e.g., `pH = -\log_{10} [H^+]`.
- NO IMAGES: Describe figures/diagrams/charts in text form—succinct but complete. Do not invent unseen labels.

STRUCTURED OUTPUT FORMAT (Markdown with embedded JSON blocks)
Always produce in this exact order:

1) `# Page Metadata`
   - Book title (if visible), chapter title (if visible), page number (if visible or inferable), section headings found.
   - Confidence notes: short bullets where uncertainty exists.

2) `# Body`
   - Clean, continuous paragraph text. Keep section/subsection headings as `##` and `###`.

3) `# Tables`
   - For each table found, output a JSON block per table with:
   ```json
   {
     "type": "table",
     "title": "Table 3.2 Disease-modifying agents",
     "note": "footnotes or legends if present",
     "columns": ["Column A", "Column B", "Column C"],
     "rows": [
       ["cell(1,1)", "cell(1,2)", "cell(1,3)"],
       ["cell(2,1)", "cell(2,2)", "cell(2,3)"]
     ],
     "uncertain_cells": [{"row":2,"col":3,"reason":"blurry"}]
   }
If a table is complex (merged cells), normalize by repeating header labels; if impossible, add "structure_note".

# Algorithms / Clinical Approaches

Convert any flowchart, algorithm box, or approach diagram into BOTH:
a) Bulleted steps (plain text):

Step 1: …

If lab X > Y → do …

Else → …
b) Machine-readable pseudo-logic JSON:

json
Copy code
{
  "type": "algorithm",
  "title": "Approach to suspected DKA",
  "nodes": [
    {"id":"start","text":"Patient with hyperglycemia"},
    {"id":"n1","text":"Check ketones"},
    {"id":"n2","text":"If ketones positive → start insulin infusion"}
  ],
  "edges": [
    {"from":"start","to":"n1"},
    {"from":"n1","to":"n2","condition":"ketones positive"}
  ]
}
Use simple IDs; preserve clinical thresholds verbatim.

# Figures / Diagrams / Charts

For each figure, write a compact textual description capturing labels, axes, and key relationships.

If a chart encodes data values, extract the visible numbers as a small table. If not given, describe trends only.

Example JSON:

json
Copy code
{
  "type": "figure",
  "title": "Figure 5.1 Cardiac cycle",
  "description": "Schematic phases (isovolumetric contraction, ejection, …); labels: LV pressure, aortic pressure… Trend: LV pressure rises during …",
  "visible_labels": ["LV", "Aorta", "Mitral"],
  "data_points": null
}
# Lists & Key Points

Convert bullet lists and numbered lists cleanly.

For “pearls”, “high-yield” callouts, prefix with **HIGH-YIELD:**.

# References / Footnotes on Page

Transcribe verbatim; if footnote markers map to table/figure, cross-reference.

# Uncertain / OCR Issues

JSON array, where each item has: location (body/table/figure), snippet (if any), reason (e.g., “scan blur”), and confidence score 0–1.

ADDITIONAL RULES FOR DIFFICULT LAYOUTS

Multi-column pages: Respect reading order left→right, top→bottom per row.

Sidebars/callouts: Place them after the paragraph they visually relate to; prefix with > Note: or > Caution:; also mirror inside # Lists & Key Points if “pearls”.

Units & thresholds: Keep exact units (mg/kg, mmol/L). Do not convert units.

Drug names: Preserve capitalization of brand/generic as shown.

Abbreviations: On first obvious occurrence, if expansion is shown on page, include (abbr: expansion).

OUTPUT VALIDATION

Ensure valid JSON blocks (UTF-8, double quotes).

No trailing commas.

Do not wrap JSON in code fences other than the ones I asked above.

Final Output structure: your output must be sent is as a CSV in a code block with the delimiter of three consecutive semicolons like “;;;”. Each row is representative of a “page text” or “figure” or “Table”. So each “page text” and “figure” and “Table”  will have a row. The columns Headers are:
    1. Type
    2. Extraction
    3. Number
    4. Part
The “Type” column is for mentioning the type of the cell row data. The acceptable types are “page text” or “figure” or “Table”. If you are writing the page’s text in the extraction column, then the type will be “page text”. If the row in for figures, write “Figure”. And ”. If the row in for Tables, write “Table”.
The “Extraction” column is the main column for each row. If you are extracting a page’s text, write the complete text here. The JSONs of tables and figures must be written here as well.
The References in the end of the chapter must not be extracted. Ignore it.
The ”Number” column must show the page it is extracted from like 1 or 2 and more.
The “Part” column shows that the row’s content is included in which part. Use numbers like 1 or 2 and more.
How to define the parts for each row: in the beginning of the first page of the file there is a “Chapter contents” which demonstrates the parts of the chapter recommended by the author, which we call them “author parts”. I want you to make your own suggestion for dividing the parts, which we call them “Our parts”. The rules of dividing are as follows: an “our part” is consisted of as many as consecutive “author parts” without being the final “our part” more than 10 pages. For example if the “author part”s of the chapter are 2,4,5,3,1,7,5 pages respectively, the first “our part” will be consisted of the first two “author parts”. The second “our part” will be consisted of the third and fourth and fifth “author parts”. the third “our part” will be consisted of the sixth “author part”. the fourth “our part” will be consisted of the seventh “author part”.
If an “our part” ends in the middle of a page, some of the page text will be for the previous “our part” and some of the page will be for the next “our part”. The text of such pages must be written in two separate rows. One of them is related to the previous “our part” and one of them is related to next “our part”. Your goal should be avoiding a row’s content to be consisted of the data from two different “our part”s.
And for example if you decided to divide the chapter into 2 parts, you should write “1” for the contents of the first part and write “2” for the contents of the second part. 

VERY IMPORTANT: your output must be single line (minified). DO NOT EVER use the “ENTER” button inside the cells. It shouldn’t be html rich. Do not separate texts with ENTER
You will now receive a PDF, respond in the exact structure described above.
2025-12-14 10:10:55,996 - INFO - Processing PDF with 100 pages in batches of 10 pages
2025-12-14 10:10:55,997 - INFO - Using original prompt with JSON output instruction for batch processing (prompt preserved)
2025-12-14 10:12:03,061 - INFO - Uploaded PDF file: Bolognia 5th Edition 2024 (1)-1.pdf
2025-12-14 10:12:03,064 - INFO - Processing batch 1/10: pages 1-10
2025-12-14 10:12:52,157 - INFO - ✓ Batch pages 1-10: Completed normally
2025-12-14 10:12:52,166 - INFO - Successfully extracted JSON array using regex with 26 items
2025-12-14 10:12:52,167 - INFO - Batch pages 1-10: Extracted 26 rows
2025-12-14 10:12:52,174 - INFO - Processing batch 2/10: pages 11-20
2025-12-14 10:13:48,536 - INFO - ✓ Batch pages 11-20: Completed normally
2025-12-14 10:13:48,537 - INFO - Extracted content from generic code block
2025-12-14 10:13:48,539 - INFO - Successfully parsed JSON array with 33 items
2025-12-14 10:13:48,540 - INFO - Batch pages 11-20: Extracted 33 rows
2025-12-14 10:13:48,547 - INFO - Processing batch 3/10: pages 21-30
2025-12-14 10:14:51,098 - INFO - ✓ Batch pages 21-30: Completed normally
2025-12-14 10:14:51,100 - INFO - Extracted content from generic code block
2025-12-14 10:14:51,103 - INFO - Successfully parsed JSON array with 26 items
2025-12-14 10:14:51,104 - INFO - Batch pages 21-30: Extracted 26 rows
2025-12-14 10:14:51,109 - INFO - Processing batch 4/10: pages 31-40
2025-12-14 10:16:00,280 - INFO - ✓ Batch pages 31-40: Completed normally
2025-12-14 10:16:00,281 - INFO - Extracted content from generic code block
2025-12-14 10:16:00,281 - INFO - Successfully parsed JSON array with 33 items
2025-12-14 10:16:00,281 - INFO - Batch pages 31-40: Extracted 33 rows
2025-12-14 10:16:00,282 - INFO - Processing batch 5/10: pages 41-50
2025-12-14 10:16:41,071 - INFO - ✓ Batch pages 41-50: Completed normally
2025-12-14 10:16:41,072 - INFO - Extracted content from generic code block
2025-12-14 10:16:41,074 - INFO - Successfully parsed JSON array with 16 items
2025-12-14 10:16:41,075 - INFO - Batch pages 41-50: Extracted 16 rows
2025-12-14 10:16:41,079 - INFO - Processing batch 6/10: pages 51-60
2025-12-14 10:17:38,176 - INFO - ✓ Batch pages 51-60: Completed normally
2025-12-14 10:17:38,178 - INFO - Extracted content from generic code block
2025-12-14 10:17:38,183 - INFO - Successfully parsed JSON array with 18 items
2025-12-14 10:17:38,183 - INFO - Batch pages 51-60: Extracted 18 rows
2025-12-14 10:17:38,187 - INFO - Processing batch 7/10: pages 61-70
2025-12-14 10:18:37,573 - INFO - ✓ Batch pages 61-70: Completed normally
2025-12-14 10:18:37,574 - INFO - Extracted content from generic code block
2025-12-14 10:18:37,576 - INFO - Successfully parsed JSON array with 23 items
2025-12-14 10:18:37,577 - INFO - Batch pages 61-70: Extracted 23 rows
2025-12-14 10:18:37,584 - INFO - Processing batch 8/10: pages 71-80
2025-12-14 10:20:18,939 - WARNING - ⚠️ Batch pages 71-80: Response may be truncated (MAX_TOKENS)
2025-12-14 10:20:18,941 - WARNING - Code block missing closing marker - response may be truncated
2025-12-14 10:20:18,954 - WARNING - Regex-extracted JSON also failed to parse: Unterminated string starting at: line 124 column 19 (char 63259)
2025-12-14 10:20:18,955 - WARNING - JSON appears to be truncated (missing closing bracket)
2025-12-14 10:20:18,957 - WARNING - Could not extract valid JSON from response
2025-12-14 10:20:18,958 - WARNING - Batch pages 71-80: No JSON data extracted
2025-12-14 10:20:18,964 - WARNING - Batch 8 returned no results
2025-12-14 10:20:19,034 - INFO - Processing batch 9/10: pages 81-90
2025-12-14 10:21:13,367 - INFO - ✓ Batch pages 81-90: Completed normally
2025-12-14 10:21:13,368 - INFO - Extracted content from generic code block
2025-12-14 10:21:13,374 - WARNING - Regex-extracted JSON also failed to parse: Expecting ',' delimiter: line 23 column 5 (char 14563)
2025-12-14 10:21:13,375 - WARNING - Could not extract valid JSON from response
2025-12-14 10:21:13,375 - WARNING - Batch pages 81-90: No JSON data extracted
2025-12-14 10:21:13,379 - WARNING - Batch 9 returned no results
2025-12-14 10:21:13,382 - INFO - Processing batch 10/10: pages 91-100
2025-12-14 10:22:12,482 - INFO - ✓ Batch pages 91-100: Completed normally
2025-12-14 10:22:12,485 - INFO - Extracted content from generic code block
2025-12-14 10:22:12,492 - INFO - Successfully parsed JSON array with 22 items
2025-12-14 10:22:12,494 - INFO - Batch pages 91-100: Extracted 22 rows
2025-12-14 10:22:12,551 - INFO - CSV saved to: /home/mohammadbagher/Desktop/tts app bagher/content_automation_project/Bolognia 5th Edition 2024 (1)-1_output_20251214_102212.csv
2025-12-14 10:22:12,591 - INFO - CSV saved to: /home/mohammadbagher/Desktop/tts app bagher/content_automation_project/Bolognia 5th Edition 2024 (1)-1_output_20251214_102212.csv
2025-12-14 10:22:14,356 - INFO - === Response Received ===
2025-12-14 10:22:14,356 - INFO - Response length: 369443 characters
2025-12-14 10:22:14,357 - INFO - Truncated: False
2025-12-14 10:22:14,357 - INFO - Response preview (first 500 chars): Type;;;Extraction;;;Number;;;Part
page text;;;# Page Metadata
- Book title: DERMATOLOGY
- Chapter title: Basic Principles of Dermatology
- Page number: 1
- Section headings: OVERVIEW OF BASIC SCIENCE SECTION 1, Chapter Contents, INTRODUCTION TO CLINICAL DERMATOLOGY, Etiologic Premises, Inflammatory versus neoplastic, Morphology

# Body
## Chapter Contents
Introduction to Clinical Dermatology. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 1
The Role of Dermatopathology i...
2025-12-14 10:22:14,357 - INFO - Response preview (last 500 chars): ...ion of phagosome with ER, retransport to cytoplasm, degradation by proteasomes, and entry into the TAP pathway.", "visible_labels": ["THE PATHWAY OF ENDOGENOUS ANTIGEN DELIVERY TO MHC CLASS I MOLECULES", "Cell membrane", "Endoplasmic reticulum", "Calnexin", "MHCI", "β₂m", "Cytoplasm", "Endogenous protein (viral, tumor)", "Proteasome", "Digested protein", "TAP, transporter associated with antigen processing", "Golgi apparatus", "TAP-1 and TAP-2", "MHCI", "Antigen"], "data_points": null};;;100;;;1
2025-12-14 10:22:14,730 - WARNING - python-docx not available, saving as text file
2025-12-14 10:22:14,742 - INFO - Response displayed and saved to: /home/mohammadbagher/Downloads/PDFs/ilovepdf_split/Bolognia 5th Edition 2024 (1)-1_response_20251214_102214.txt
2025-12-14 10:48:07,033 - INFO - Loaded 6 predefined prompts
2025-12-14 10:48:30,003 - INFO - Loaded 3 API keys
2025-12-14 10:49:43,525 - INFO - === Starting PDF Processing ===
2025-12-14 10:49:43,526 - INFO - Model: gemini-2.5-pro
2025-12-14 10:49:43,527 - INFO - PDF: /home/mohammadbagher/Downloads/PDFs/ilovepdf_split/Bolognia 5th Edition 2024 (1)-1.pdf
2025-12-14 10:49:43,528 - INFO - Full prompt being sent (7387 chars): You are a meticulous medical OCR & structuring assistant. Your job is to extract **only** what is present on each provided textbook page image/PDF and convert it into clean, AI-ready text with structured sections. You MUST avoid hallucinations and preserve original medical meaning precisely. Follow these global rules:

GLOBAL PRINCIPLES
- NO HALLUCINATIONS: Output only content visible on the page(s). If unreadable/unclear, write: "[UNREADABLE]" or add an "uncertain" flag with brief reason.
- LANGUAGE & SPELLING: Preserve original English spelling and medical terminology; do not normalize British↔American spelling.
- CLEAN OCR: 
  - Remove page headers/footers, running titles, folios, and footers like “©Publisher 2023”.
  - Fix broken words at line breaks (e.g., "thera-\npy" → "therapy").
  - Replace ligatures (ﬁ, ﬂ) with normal letters.
  - Preserve meaningful capitalization, italics markers (use *italic*), bold (**bold**), and inline sub/superscripts as LaTeX if clearly indicated (e.g., CO$_2$).
- CITATIONS: Keep in-text citations literally (e.g., “[12]”, “(Smith 2021)”).
- MATH/CHEM: For formulae, use inline LaTeX: e.g., `pH = -\log_{10} [H^+]`.
- NO IMAGES: Describe figures/diagrams/charts in text form—succinct but complete. Do not invent unseen labels.

STRUCTURED OUTPUT FORMAT (Markdown with embedded JSON blocks)
Always produce in this exact order:

1) `# Page Metadata`
   - Book title (if visible), chapter title (if visible), page number (if visible or inferable), section headings found.
   - Confidence notes: short bullets where uncertainty exists.

2) `# Body`
   - Clean, continuous paragraph text. Keep section/subsection headings as `##` and `###`.

3) `# Tables`
   - For each table found, output a JSON block per table with:
   ```json
   {
     "type": "table",
     "title": "Table 3.2 Disease-modifying agents",
     "note": "footnotes or legends if present",
     "columns": ["Column A", "Column B", "Column C"],
     "rows": [
       ["cell(1,1)", "cell(1,2)", "cell(1,3)"],
       ["cell(2,1)", "cell(2,2)", "cell(2,3)"]
     ],
     "uncertain_cells": [{"row":2,"col":3,"reason":"blurry"}]
   }
If a table is complex (merged cells), normalize by repeating header labels; if impossible, add "structure_note".

# Algorithms / Clinical Approaches

Convert any flowchart, algorithm box, or approach diagram into BOTH:
a) Bulleted steps (plain text):

Step 1: …

If lab X > Y → do …

Else → …
b) Machine-readable pseudo-logic JSON:

json
Copy code
{
  "type": "algorithm",
  "title": "Approach to suspected DKA",
  "nodes": [
    {"id":"start","text":"Patient with hyperglycemia"},
    {"id":"n1","text":"Check ketones"},
    {"id":"n2","text":"If ketones positive → start insulin infusion"}
  ],
  "edges": [
    {"from":"start","to":"n1"},
    {"from":"n1","to":"n2","condition":"ketones positive"}
  ]
}
Use simple IDs; preserve clinical thresholds verbatim.

# Figures / Diagrams / Charts

For each figure, write a compact textual description capturing labels, axes, and key relationships.

If a chart encodes data values, extract the visible numbers as a small table. If not given, describe trends only.

Example JSON:

json
Copy code
{
  "type": "figure",
  "title": "Figure 5.1 Cardiac cycle",
  "description": "Schematic phases (isovolumetric contraction, ejection, …); labels: LV pressure, aortic pressure… Trend: LV pressure rises during …",
  "visible_labels": ["LV", "Aorta", "Mitral"],
  "data_points": null
}
# Lists & Key Points

Convert bullet lists and numbered lists cleanly.

For “pearls”, “high-yield” callouts, prefix with **HIGH-YIELD:**.

# References / Footnotes on Page

Transcribe verbatim; if footnote markers map to table/figure, cross-reference.

# Uncertain / OCR Issues

JSON array, where each item has: location (body/table/figure), snippet (if any), reason (e.g., “scan blur”), and confidence score 0–1.

ADDITIONAL RULES FOR DIFFICULT LAYOUTS

Multi-column pages: Respect reading order left→right, top→bottom per row.

Sidebars/callouts: Place them after the paragraph they visually relate to; prefix with > Note: or > Caution:; also mirror inside # Lists & Key Points if “pearls”.

Units & thresholds: Keep exact units (mg/kg, mmol/L). Do not convert units.

Drug names: Preserve capitalization of brand/generic as shown.

Abbreviations: On first obvious occurrence, if expansion is shown on page, include (abbr: expansion).

OUTPUT VALIDATION

Ensure valid JSON blocks (UTF-8, double quotes).

No trailing commas.

Do not wrap JSON in code fences other than the ones I asked above.

Final Output structure: your output must be sent is as a JSON in a code block with the delimiter of three consecutive semicolons like “,”. Each row is representative of a “page text” or “figure” or “Table”. So each “page text” and “figure” and “Table”  will have a row. The columns Headers are:
    1. Type
    2. Extraction
    3. Number
    4. Part
The “Type” column is for mentioning the type of the cell row data. The acceptable types are “page text” or “figure” or “Table”. If you are writing the page’s text in the extraction column, then the type will be “page text”. If the row in for figures, write “Figure”. And ”. If the row in for Tables, write “Table”.
The “Extraction” column is the main column for each row. If you are extracting a page’s text, write the complete text here. The JSONs of tables and figures must be written here as well.
The References in the end of the chapter must not be extracted. Ignore it.
The ”Number” column must show the page it is extracted from like 1 or 2 and more.
The “Part” column shows that the row’s content is included in which part. Use numbers like 1 or 2 and more.
How to define the parts for each row: in the beginning of the first page of the file there is a “Chapter contents” which demonstrates the parts of the chapter recommended by the author, which we call them “author parts”. I want you to make your own suggestion for dividing the parts, which we call them “Our parts”. The rules of dividing are as follows: an “our part” is consisted of as many as consecutive “author parts” without being the final “our part” more than 10 pages. For example if the “author part”s of the chapter are 2,4,5,3,1,7,5 pages respectively, the first “our part” will be consisted of the first two “author parts”. The second “our part” will be consisted of the third and fourth and fifth “author parts”. the third “our part” will be consisted of the sixth “author part”. the fourth “our part” will be consisted of the seventh “author part”.
If an “our part” ends in the middle of a page, some of the page text will be for the previous “our part” and some of the page will be for the next “our part”. The text of such pages must be written in two separate rows. One of them is related to the previous “our part” and one of them is related to next “our part”. Your goal should be avoiding a row’s content to be consisted of the data from two different “our part”s.
And for example if you decided to divide the chapter into 2 parts, you should write “1” for the contents of the first part and write “2” for the contents of the second part. 

VERY IMPORTANT: your output must be single line (minified). DO NOT EVER use the “ENTER” button inside the cells. It shouldn’t be html rich. Do not separate texts with ENTER.
You will now receive a PDF, respond in the exact structure described above.
2025-12-14 10:50:40,424 - INFO - Uploaded PDF file: Bolognia 5th Edition 2024 (1)-1.pdf
2025-12-14 10:50:40,424 - INFO - Model: gemini-2.5-pro, Max tokens for model: 32768, Using: 32768
2025-12-14 10:50:40,424 - INFO - Using max_output_tokens: 32768
2025-12-14 10:50:40,424 - INFO - Using model: gemini-2.5-pro
2025-12-14 10:50:40,424 - INFO - Sending prompt (length: 7387 characters)
2025-12-14 10:50:40,424 - INFO - Max output tokens: 32768
2025-12-14 10:50:40,424 - INFO - Using original prompt with JSON output instruction (prompt preserved)
2025-12-14 10:50:40,424 - INFO - Generating content with streaming enabled for complete response...
2025-12-14 10:59:51,233 - WARNING - Streaming not available or failed: 429 Resource has been exhausted (e.g. check quota)., using non-streaming
2025-12-14 10:59:51,777 - ERROR - PDF processing failed: 429 Resource has been exhausted (e.g. check quota).
2025-12-14 11:08:16,387 - INFO - === Starting PDF Processing ===
2025-12-14 11:08:16,387 - INFO - Model: gemini-2.5-pro
2025-12-14 11:08:16,387 - INFO - PDF: /home/mohammadbagher/Downloads/PDFs/Bolognia 5th Edition 2024 (1)-7-26-46.pdf
2025-12-14 11:08:16,387 - INFO - Full prompt being sent (7387 chars): You are a meticulous medical OCR & structuring assistant. Your job is to extract **only** what is present on each provided textbook page image/PDF and convert it into clean, AI-ready text with structured sections. You MUST avoid hallucinations and preserve original medical meaning precisely. Follow these global rules:

GLOBAL PRINCIPLES
- NO HALLUCINATIONS: Output only content visible on the page(s). If unreadable/unclear, write: "[UNREADABLE]" or add an "uncertain" flag with brief reason.
- LANGUAGE & SPELLING: Preserve original English spelling and medical terminology; do not normalize British↔American spelling.
- CLEAN OCR: 
  - Remove page headers/footers, running titles, folios, and footers like “©Publisher 2023”.
  - Fix broken words at line breaks (e.g., "thera-\npy" → "therapy").
  - Replace ligatures (ﬁ, ﬂ) with normal letters.
  - Preserve meaningful capitalization, italics markers (use *italic*), bold (**bold**), and inline sub/superscripts as LaTeX if clearly indicated (e.g., CO$_2$).
- CITATIONS: Keep in-text citations literally (e.g., “[12]”, “(Smith 2021)”).
- MATH/CHEM: For formulae, use inline LaTeX: e.g., `pH = -\log_{10} [H^+]`.
- NO IMAGES: Describe figures/diagrams/charts in text form—succinct but complete. Do not invent unseen labels.

STRUCTURED OUTPUT FORMAT (Markdown with embedded JSON blocks)
Always produce in this exact order:

1) `# Page Metadata`
   - Book title (if visible), chapter title (if visible), page number (if visible or inferable), section headings found.
   - Confidence notes: short bullets where uncertainty exists.

2) `# Body`
   - Clean, continuous paragraph text. Keep section/subsection headings as `##` and `###`.

3) `# Tables`
   - For each table found, output a JSON block per table with:
   ```json
   {
     "type": "table",
     "title": "Table 3.2 Disease-modifying agents",
     "note": "footnotes or legends if present",
     "columns": ["Column A", "Column B", "Column C"],
     "rows": [
       ["cell(1,1)", "cell(1,2)", "cell(1,3)"],
       ["cell(2,1)", "cell(2,2)", "cell(2,3)"]
     ],
     "uncertain_cells": [{"row":2,"col":3,"reason":"blurry"}]
   }
If a table is complex (merged cells), normalize by repeating header labels; if impossible, add "structure_note".

# Algorithms / Clinical Approaches

Convert any flowchart, algorithm box, or approach diagram into BOTH:
a) Bulleted steps (plain text):

Step 1: …

If lab X > Y → do …

Else → …
b) Machine-readable pseudo-logic JSON:

json
Copy code
{
  "type": "algorithm",
  "title": "Approach to suspected DKA",
  "nodes": [
    {"id":"start","text":"Patient with hyperglycemia"},
    {"id":"n1","text":"Check ketones"},
    {"id":"n2","text":"If ketones positive → start insulin infusion"}
  ],
  "edges": [
    {"from":"start","to":"n1"},
    {"from":"n1","to":"n2","condition":"ketones positive"}
  ]
}
Use simple IDs; preserve clinical thresholds verbatim.

# Figures / Diagrams / Charts

For each figure, write a compact textual description capturing labels, axes, and key relationships.

If a chart encodes data values, extract the visible numbers as a small table. If not given, describe trends only.

Example JSON:

json
Copy code
{
  "type": "figure",
  "title": "Figure 5.1 Cardiac cycle",
  "description": "Schematic phases (isovolumetric contraction, ejection, …); labels: LV pressure, aortic pressure… Trend: LV pressure rises during …",
  "visible_labels": ["LV", "Aorta", "Mitral"],
  "data_points": null
}
# Lists & Key Points

Convert bullet lists and numbered lists cleanly.

For “pearls”, “high-yield” callouts, prefix with **HIGH-YIELD:**.

# References / Footnotes on Page

Transcribe verbatim; if footnote markers map to table/figure, cross-reference.

# Uncertain / OCR Issues

JSON array, where each item has: location (body/table/figure), snippet (if any), reason (e.g., “scan blur”), and confidence score 0–1.

ADDITIONAL RULES FOR DIFFICULT LAYOUTS

Multi-column pages: Respect reading order left→right, top→bottom per row.

Sidebars/callouts: Place them after the paragraph they visually relate to; prefix with > Note: or > Caution:; also mirror inside # Lists & Key Points if “pearls”.

Units & thresholds: Keep exact units (mg/kg, mmol/L). Do not convert units.

Drug names: Preserve capitalization of brand/generic as shown.

Abbreviations: On first obvious occurrence, if expansion is shown on page, include (abbr: expansion).

OUTPUT VALIDATION

Ensure valid JSON blocks (UTF-8, double quotes).

No trailing commas.

Do not wrap JSON in code fences other than the ones I asked above.

Final Output structure: your output must be sent is as a JSON in a code block with the delimiter of three consecutive semicolons like “,”. Each row is representative of a “page text” or “figure” or “Table”. So each “page text” and “figure” and “Table”  will have a row. The columns Headers are:
    1. Type
    2. Extraction
    3. Number
    4. Part
The “Type” column is for mentioning the type of the cell row data. The acceptable types are “page text” or “figure” or “Table”. If you are writing the page’s text in the extraction column, then the type will be “page text”. If the row in for figures, write “Figure”. And ”. If the row in for Tables, write “Table”.
The “Extraction” column is the main column for each row. If you are extracting a page’s text, write the complete text here. The JSONs of tables and figures must be written here as well.
The References in the end of the chapter must not be extracted. Ignore it.
The ”Number” column must show the page it is extracted from like 1 or 2 and more.
The “Part” column shows that the row’s content is included in which part. Use numbers like 1 or 2 and more.
How to define the parts for each row: in the beginning of the first page of the file there is a “Chapter contents” which demonstrates the parts of the chapter recommended by the author, which we call them “author parts”. I want you to make your own suggestion for dividing the parts, which we call them “Our parts”. The rules of dividing are as follows: an “our part” is consisted of as many as consecutive “author parts” without being the final “our part” more than 10 pages. For example if the “author part”s of the chapter are 2,4,5,3,1,7,5 pages respectively, the first “our part” will be consisted of the first two “author parts”. The second “our part” will be consisted of the third and fourth and fifth “author parts”. the third “our part” will be consisted of the sixth “author part”. the fourth “our part” will be consisted of the seventh “author part”.
If an “our part” ends in the middle of a page, some of the page text will be for the previous “our part” and some of the page will be for the next “our part”. The text of such pages must be written in two separate rows. One of them is related to the previous “our part” and one of them is related to next “our part”. Your goal should be avoiding a row’s content to be consisted of the data from two different “our part”s.
And for example if you decided to divide the chapter into 2 parts, you should write “1” for the contents of the first part and write “2” for the contents of the second part. 

VERY IMPORTANT: your output must be single line (minified). DO NOT EVER use the “ENTER” button inside the cells. It shouldn’t be html rich. Do not separate texts with ENTER.
You will now receive a PDF, respond in the exact structure described above.
2025-12-14 11:08:26,787 - INFO - Uploaded PDF file: Bolognia 5th Edition 2024 (1)-7-26-46.pdf
2025-12-14 11:08:26,788 - INFO - Model: gemini-2.5-pro, Max tokens for model: 32768, Using: 32768
2025-12-14 11:08:26,790 - INFO - Using max_output_tokens: 32768
2025-12-14 11:08:26,791 - INFO - Using model: gemini-2.5-pro
2025-12-14 11:08:26,791 - INFO - Sending prompt (length: 7387 characters)
2025-12-14 11:08:26,792 - INFO - Max output tokens: 32768
2025-12-14 11:08:26,792 - INFO - Using original prompt with JSON output instruction (prompt preserved)
2025-12-14 11:08:26,793 - INFO - Generating content with streaming enabled for complete response...
2025-12-14 11:08:28,132 - WARNING - Streaming not available or failed: 403 Your API key was reported as leaked. Please use another API key., using non-streaming
2025-12-14 11:08:28,509 - ERROR - PDF processing failed: 403 Your API key was reported as leaked. Please use another API key.
2025-12-14 11:08:48,876 - INFO - Loaded 6 predefined prompts
2025-12-14 11:09:23,963 - INFO - Loaded 3 API keys
2025-12-14 11:09:56,179 - INFO - === Starting PDF Processing ===
2025-12-14 11:09:56,179 - INFO - Model: gemini-1.5-pro
2025-12-14 11:09:56,179 - INFO - PDF: /home/mohammadbagher/Downloads/PDFs/Bolognia 5th Edition 2024 (1)-7-26-46.pdf
2025-12-14 11:09:56,179 - INFO - Full prompt being sent (7387 chars): You are a meticulous medical OCR & structuring assistant. Your job is to extract **only** what is present on each provided textbook page image/PDF and convert it into clean, AI-ready text with structured sections. You MUST avoid hallucinations and preserve original medical meaning precisely. Follow these global rules:

GLOBAL PRINCIPLES
- NO HALLUCINATIONS: Output only content visible on the page(s). If unreadable/unclear, write: "[UNREADABLE]" or add an "uncertain" flag with brief reason.
- LANGUAGE & SPELLING: Preserve original English spelling and medical terminology; do not normalize British↔American spelling.
- CLEAN OCR: 
  - Remove page headers/footers, running titles, folios, and footers like “©Publisher 2023”.
  - Fix broken words at line breaks (e.g., "thera-\npy" → "therapy").
  - Replace ligatures (ﬁ, ﬂ) with normal letters.
  - Preserve meaningful capitalization, italics markers (use *italic*), bold (**bold**), and inline sub/superscripts as LaTeX if clearly indicated (e.g., CO$_2$).
- CITATIONS: Keep in-text citations literally (e.g., “[12]”, “(Smith 2021)”).
- MATH/CHEM: For formulae, use inline LaTeX: e.g., `pH = -\log_{10} [H^+]`.
- NO IMAGES: Describe figures/diagrams/charts in text form—succinct but complete. Do not invent unseen labels.

STRUCTURED OUTPUT FORMAT (Markdown with embedded JSON blocks)
Always produce in this exact order:

1) `# Page Metadata`
   - Book title (if visible), chapter title (if visible), page number (if visible or inferable), section headings found.
   - Confidence notes: short bullets where uncertainty exists.

2) `# Body`
   - Clean, continuous paragraph text. Keep section/subsection headings as `##` and `###`.

3) `# Tables`
   - For each table found, output a JSON block per table with:
   ```json
   {
     "type": "table",
     "title": "Table 3.2 Disease-modifying agents",
     "note": "footnotes or legends if present",
     "columns": ["Column A", "Column B", "Column C"],
     "rows": [
       ["cell(1,1)", "cell(1,2)", "cell(1,3)"],
       ["cell(2,1)", "cell(2,2)", "cell(2,3)"]
     ],
     "uncertain_cells": [{"row":2,"col":3,"reason":"blurry"}]
   }
If a table is complex (merged cells), normalize by repeating header labels; if impossible, add "structure_note".

# Algorithms / Clinical Approaches

Convert any flowchart, algorithm box, or approach diagram into BOTH:
a) Bulleted steps (plain text):

Step 1: …

If lab X > Y → do …

Else → …
b) Machine-readable pseudo-logic JSON:

json
Copy code
{
  "type": "algorithm",
  "title": "Approach to suspected DKA",
  "nodes": [
    {"id":"start","text":"Patient with hyperglycemia"},
    {"id":"n1","text":"Check ketones"},
    {"id":"n2","text":"If ketones positive → start insulin infusion"}
  ],
  "edges": [
    {"from":"start","to":"n1"},
    {"from":"n1","to":"n2","condition":"ketones positive"}
  ]
}
Use simple IDs; preserve clinical thresholds verbatim.

# Figures / Diagrams / Charts

For each figure, write a compact textual description capturing labels, axes, and key relationships.

If a chart encodes data values, extract the visible numbers as a small table. If not given, describe trends only.

Example JSON:

json
Copy code
{
  "type": "figure",
  "title": "Figure 5.1 Cardiac cycle",
  "description": "Schematic phases (isovolumetric contraction, ejection, …); labels: LV pressure, aortic pressure… Trend: LV pressure rises during …",
  "visible_labels": ["LV", "Aorta", "Mitral"],
  "data_points": null
}
# Lists & Key Points

Convert bullet lists and numbered lists cleanly.

For “pearls”, “high-yield” callouts, prefix with **HIGH-YIELD:**.

# References / Footnotes on Page

Transcribe verbatim; if footnote markers map to table/figure, cross-reference.

# Uncertain / OCR Issues

JSON array, where each item has: location (body/table/figure), snippet (if any), reason (e.g., “scan blur”), and confidence score 0–1.

ADDITIONAL RULES FOR DIFFICULT LAYOUTS

Multi-column pages: Respect reading order left→right, top→bottom per row.

Sidebars/callouts: Place them after the paragraph they visually relate to; prefix with > Note: or > Caution:; also mirror inside # Lists & Key Points if “pearls”.

Units & thresholds: Keep exact units (mg/kg, mmol/L). Do not convert units.

Drug names: Preserve capitalization of brand/generic as shown.

Abbreviations: On first obvious occurrence, if expansion is shown on page, include (abbr: expansion).

OUTPUT VALIDATION

Ensure valid JSON blocks (UTF-8, double quotes).

No trailing commas.

Do not wrap JSON in code fences other than the ones I asked above.

Final Output structure: your output must be sent is as a JSON in a code block with the delimiter of three consecutive semicolons like “,”. Each row is representative of a “page text” or “figure” or “Table”. So each “page text” and “figure” and “Table”  will have a row. The columns Headers are:
    1. Type
    2. Extraction
    3. Number
    4. Part
The “Type” column is for mentioning the type of the cell row data. The acceptable types are “page text” or “figure” or “Table”. If you are writing the page’s text in the extraction column, then the type will be “page text”. If the row in for figures, write “Figure”. And ”. If the row in for Tables, write “Table”.
The “Extraction” column is the main column for each row. If you are extracting a page’s text, write the complete text here. The JSONs of tables and figures must be written here as well.
The References in the end of the chapter must not be extracted. Ignore it.
The ”Number” column must show the page it is extracted from like 1 or 2 and more.
The “Part” column shows that the row’s content is included in which part. Use numbers like 1 or 2 and more.
How to define the parts for each row: in the beginning of the first page of the file there is a “Chapter contents” which demonstrates the parts of the chapter recommended by the author, which we call them “author parts”. I want you to make your own suggestion for dividing the parts, which we call them “Our parts”. The rules of dividing are as follows: an “our part” is consisted of as many as consecutive “author parts” without being the final “our part” more than 10 pages. For example if the “author part”s of the chapter are 2,4,5,3,1,7,5 pages respectively, the first “our part” will be consisted of the first two “author parts”. The second “our part” will be consisted of the third and fourth and fifth “author parts”. the third “our part” will be consisted of the sixth “author part”. the fourth “our part” will be consisted of the seventh “author part”.
If an “our part” ends in the middle of a page, some of the page text will be for the previous “our part” and some of the page will be for the next “our part”. The text of such pages must be written in two separate rows. One of them is related to the previous “our part” and one of them is related to next “our part”. Your goal should be avoiding a row’s content to be consisted of the data from two different “our part”s.
And for example if you decided to divide the chapter into 2 parts, you should write “1” for the contents of the first part and write “2” for the contents of the second part. 

VERY IMPORTANT: your output must be single line (minified). DO NOT EVER use the “ENTER” button inside the cells. It shouldn’t be html rich. Do not separate texts with ENTER.
You will now receive a PDF, respond in the exact structure described above.
2025-12-14 11:10:06,088 - INFO - PDF uploaded successfully with API key: bagher
2025-12-14 11:10:06,088 - INFO - Uploaded PDF file: Bolognia 5th Edition 2024 (1)-7-26-46.pdf
2025-12-14 11:10:06,091 - INFO - Model: gemini-1.5-pro, Max tokens for model: 8192, Using: 8192
2025-12-14 11:10:06,092 - INFO - Using max_output_tokens: 8192
2025-12-14 11:10:06,094 - INFO - Using model: gemini-1.5-pro
2025-12-14 11:10:06,094 - INFO - Sending prompt (length: 7387 characters)
2025-12-14 11:10:06,094 - INFO - Max output tokens: 8192
2025-12-14 11:10:06,095 - INFO - Using original prompt with JSON output instruction (prompt preserved)
2025-12-14 11:10:06,095 - INFO - Generating content with streaming enabled for complete response...
2025-12-14 11:10:07,343 - ERROR - Error processing PDF: 'GeminiAPIClient' object has no attribute '_is_quota_error'
Traceback (most recent call last):
  File "/home/mohammadbagher/Desktop/tts app bagher/content_automation_project/api_layer.py", line 1074, in process_pdf_with_prompt
    response_stream = model.generate_content(
                      ^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/mohammadbagher/anaconda3/lib/python3.11/site-packages/google/generativeai/generative_models.py", line 325, in generate_content
    iterator = self._client.stream_generate_content(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/mohammadbagher/anaconda3/lib/python3.11/site-packages/google/ai/generativelanguage_v1beta/services/generative_service/client.py", line 1143, in stream_generate_content
    response = rpc(
               ^^^^
  File "/home/mohammadbagher/anaconda3/lib/python3.11/site-packages/google/api_core/gapic_v1/method.py", line 131, in __call__
    return wrapped_func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/mohammadbagher/anaconda3/lib/python3.11/site-packages/google/api_core/retry/retry_unary.py", line 294, in retry_wrapped_func
    return retry_target(
           ^^^^^^^^^^^^^
  File "/home/mohammadbagher/anaconda3/lib/python3.11/site-packages/google/api_core/retry/retry_unary.py", line 156, in retry_target
    next_sleep = _retry_error_helper(
                 ^^^^^^^^^^^^^^^^^^^^
  File "/home/mohammadbagher/anaconda3/lib/python3.11/site-packages/google/api_core/retry/retry_base.py", line 214, in _retry_error_helper
    raise final_exc from source_exc
  File "/home/mohammadbagher/anaconda3/lib/python3.11/site-packages/google/api_core/retry/retry_unary.py", line 147, in retry_target
    result = target()
             ^^^^^^^^
  File "/home/mohammadbagher/anaconda3/lib/python3.11/site-packages/google/api_core/timeout.py", line 130, in func_with_timeout
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/home/mohammadbagher/anaconda3/lib/python3.11/site-packages/google/api_core/grpc_helpers.py", line 173, in error_remapped_callable
    raise exceptions.from_grpc_error(exc) from exc
google.api_core.exceptions.NotFound: 404 models/gemini-1.5-pro is not found for API version v1beta, or is not supported for generateContent. Call ListModels to see the list of available models and their supported methods.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/mohammadbagher/Desktop/tts app bagher/content_automation_project/api_layer.py", line 1143, in process_pdf_with_prompt
    if self._is_quota_error(stream_error):
       ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'GeminiAPIClient' object has no attribute '_is_quota_error'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/mohammadbagher/Desktop/tts app bagher/content_automation_project/main_gui.py", line 566, in worker
    response = self.api_client.process_pdf_with_prompt(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/mohammadbagher/Desktop/tts app bagher/content_automation_project/api_layer.py", line 1342, in process_pdf_with_prompt
    if self._is_quota_error(e):
       ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'GeminiAPIClient' object has no attribute '_is_quota_error'
2025-12-14 11:11:50,982 - INFO - Loaded 6 predefined prompts
2025-12-14 11:12:22,396 - INFO - Loaded 3 API keys
2025-12-14 11:12:42,414 - INFO - === Starting PDF Processing ===
2025-12-14 11:12:42,414 - INFO - Model: gemini-2.5-pro
2025-12-14 11:12:42,414 - INFO - PDF: /home/mohammadbagher/Downloads/PDFs/Bolognia 5th Edition 2024 (1)-7-26-46.pdf
2025-12-14 11:12:42,414 - INFO - Full prompt being sent (7387 chars): You are a meticulous medical OCR & structuring assistant. Your job is to extract **only** what is present on each provided textbook page image/PDF and convert it into clean, AI-ready text with structured sections. You MUST avoid hallucinations and preserve original medical meaning precisely. Follow these global rules:

GLOBAL PRINCIPLES
- NO HALLUCINATIONS: Output only content visible on the page(s). If unreadable/unclear, write: "[UNREADABLE]" or add an "uncertain" flag with brief reason.
- LANGUAGE & SPELLING: Preserve original English spelling and medical terminology; do not normalize British↔American spelling.
- CLEAN OCR: 
  - Remove page headers/footers, running titles, folios, and footers like “©Publisher 2023”.
  - Fix broken words at line breaks (e.g., "thera-\npy" → "therapy").
  - Replace ligatures (ﬁ, ﬂ) with normal letters.
  - Preserve meaningful capitalization, italics markers (use *italic*), bold (**bold**), and inline sub/superscripts as LaTeX if clearly indicated (e.g., CO$_2$).
- CITATIONS: Keep in-text citations literally (e.g., “[12]”, “(Smith 2021)”).
- MATH/CHEM: For formulae, use inline LaTeX: e.g., `pH = -\log_{10} [H^+]`.
- NO IMAGES: Describe figures/diagrams/charts in text form—succinct but complete. Do not invent unseen labels.

STRUCTURED OUTPUT FORMAT (Markdown with embedded JSON blocks)
Always produce in this exact order:

1) `# Page Metadata`
   - Book title (if visible), chapter title (if visible), page number (if visible or inferable), section headings found.
   - Confidence notes: short bullets where uncertainty exists.

2) `# Body`
   - Clean, continuous paragraph text. Keep section/subsection headings as `##` and `###`.

3) `# Tables`
   - For each table found, output a JSON block per table with:
   ```json
   {
     "type": "table",
     "title": "Table 3.2 Disease-modifying agents",
     "note": "footnotes or legends if present",
     "columns": ["Column A", "Column B", "Column C"],
     "rows": [
       ["cell(1,1)", "cell(1,2)", "cell(1,3)"],
       ["cell(2,1)", "cell(2,2)", "cell(2,3)"]
     ],
     "uncertain_cells": [{"row":2,"col":3,"reason":"blurry"}]
   }
If a table is complex (merged cells), normalize by repeating header labels; if impossible, add "structure_note".

# Algorithms / Clinical Approaches

Convert any flowchart, algorithm box, or approach diagram into BOTH:
a) Bulleted steps (plain text):

Step 1: …

If lab X > Y → do …

Else → …
b) Machine-readable pseudo-logic JSON:

json
Copy code
{
  "type": "algorithm",
  "title": "Approach to suspected DKA",
  "nodes": [
    {"id":"start","text":"Patient with hyperglycemia"},
    {"id":"n1","text":"Check ketones"},
    {"id":"n2","text":"If ketones positive → start insulin infusion"}
  ],
  "edges": [
    {"from":"start","to":"n1"},
    {"from":"n1","to":"n2","condition":"ketones positive"}
  ]
}
Use simple IDs; preserve clinical thresholds verbatim.

# Figures / Diagrams / Charts

For each figure, write a compact textual description capturing labels, axes, and key relationships.

If a chart encodes data values, extract the visible numbers as a small table. If not given, describe trends only.

Example JSON:

json
Copy code
{
  "type": "figure",
  "title": "Figure 5.1 Cardiac cycle",
  "description": "Schematic phases (isovolumetric contraction, ejection, …); labels: LV pressure, aortic pressure… Trend: LV pressure rises during …",
  "visible_labels": ["LV", "Aorta", "Mitral"],
  "data_points": null
}
# Lists & Key Points

Convert bullet lists and numbered lists cleanly.

For “pearls”, “high-yield” callouts, prefix with **HIGH-YIELD:**.

# References / Footnotes on Page

Transcribe verbatim; if footnote markers map to table/figure, cross-reference.

# Uncertain / OCR Issues

JSON array, where each item has: location (body/table/figure), snippet (if any), reason (e.g., “scan blur”), and confidence score 0–1.

ADDITIONAL RULES FOR DIFFICULT LAYOUTS

Multi-column pages: Respect reading order left→right, top→bottom per row.

Sidebars/callouts: Place them after the paragraph they visually relate to; prefix with > Note: or > Caution:; also mirror inside # Lists & Key Points if “pearls”.

Units & thresholds: Keep exact units (mg/kg, mmol/L). Do not convert units.

Drug names: Preserve capitalization of brand/generic as shown.

Abbreviations: On first obvious occurrence, if expansion is shown on page, include (abbr: expansion).

OUTPUT VALIDATION

Ensure valid JSON blocks (UTF-8, double quotes).

No trailing commas.

Do not wrap JSON in code fences other than the ones I asked above.

Final Output structure: your output must be sent is as a JSON in a code block with the delimiter of three consecutive semicolons like “,”. Each row is representative of a “page text” or “figure” or “Table”. So each “page text” and “figure” and “Table”  will have a row. The columns Headers are:
    1. Type
    2. Extraction
    3. Number
    4. Part
The “Type” column is for mentioning the type of the cell row data. The acceptable types are “page text” or “figure” or “Table”. If you are writing the page’s text in the extraction column, then the type will be “page text”. If the row in for figures, write “Figure”. And ”. If the row in for Tables, write “Table”.
The “Extraction” column is the main column for each row. If you are extracting a page’s text, write the complete text here. The JSONs of tables and figures must be written here as well.
The References in the end of the chapter must not be extracted. Ignore it.
The ”Number” column must show the page it is extracted from like 1 or 2 and more.
The “Part” column shows that the row’s content is included in which part. Use numbers like 1 or 2 and more.
How to define the parts for each row: in the beginning of the first page of the file there is a “Chapter contents” which demonstrates the parts of the chapter recommended by the author, which we call them “author parts”. I want you to make your own suggestion for dividing the parts, which we call them “Our parts”. The rules of dividing are as follows: an “our part” is consisted of as many as consecutive “author parts” without being the final “our part” more than 10 pages. For example if the “author part”s of the chapter are 2,4,5,3,1,7,5 pages respectively, the first “our part” will be consisted of the first two “author parts”. The second “our part” will be consisted of the third and fourth and fifth “author parts”. the third “our part” will be consisted of the sixth “author part”. the fourth “our part” will be consisted of the seventh “author part”.
If an “our part” ends in the middle of a page, some of the page text will be for the previous “our part” and some of the page will be for the next “our part”. The text of such pages must be written in two separate rows. One of them is related to the previous “our part” and one of them is related to next “our part”. Your goal should be avoiding a row’s content to be consisted of the data from two different “our part”s.
And for example if you decided to divide the chapter into 2 parts, you should write “1” for the contents of the first part and write “2” for the contents of the second part. 

VERY IMPORTANT: your output must be single line (minified). DO NOT EVER use the “ENTER” button inside the cells. It shouldn’t be html rich. Do not separate texts with ENTER.
You will now receive a PDF, respond in the exact structure described above.
2025-12-14 11:12:54,933 - INFO - PDF uploaded successfully with API key: bagher
2025-12-14 11:12:54,934 - INFO - Uploaded PDF file: Bolognia 5th Edition 2024 (1)-7-26-46.pdf
2025-12-14 11:12:54,935 - INFO - Model: gemini-2.5-pro, Max tokens for model: 32768, Using: 32768
2025-12-14 11:12:54,936 - INFO - Using max_output_tokens: 32768
2025-12-14 11:12:54,936 - INFO - Using model: gemini-2.5-pro
2025-12-14 11:12:54,937 - INFO - Sending prompt (length: 7387 characters)
2025-12-14 11:12:54,938 - INFO - Max output tokens: 32768
2025-12-14 11:12:54,939 - INFO - Using original prompt with JSON output instruction (prompt preserved)
2025-12-14 11:12:54,939 - INFO - Generating content with streaming enabled for complete response...
2025-12-14 11:12:56,136 - WARNING - Streaming not available or failed: 403 Your API key was reported as leaked. Please use another API key., using non-streaming
2025-12-14 11:12:56,453 - ERROR - PDF processing failed: 403 Your API key was reported as leaked. Please use another API key.
2025-12-14 11:21:55,901 - INFO - Loaded 6 predefined prompts
2025-12-14 11:22:18,319 - INFO - Loaded 3 API keys
2025-12-14 11:22:46,107 - INFO - === Starting PDF Processing ===
2025-12-14 11:22:46,108 - INFO - Model: gemini-2.5-flash
2025-12-14 11:22:46,108 - INFO - PDF: /home/mohammadbagher/Downloads/PDFs/Bolognia 5th Edition 2024 (1)-7-26-46.pdf
2025-12-14 11:22:46,108 - INFO - Full prompt being sent (7387 chars): You are a meticulous medical OCR & structuring assistant. Your job is to extract **only** what is present on each provided textbook page image/PDF and convert it into clean, AI-ready text with structured sections. You MUST avoid hallucinations and preserve original medical meaning precisely. Follow these global rules:

GLOBAL PRINCIPLES
- NO HALLUCINATIONS: Output only content visible on the page(s). If unreadable/unclear, write: "[UNREADABLE]" or add an "uncertain" flag with brief reason.
- LANGUAGE & SPELLING: Preserve original English spelling and medical terminology; do not normalize British↔American spelling.
- CLEAN OCR: 
  - Remove page headers/footers, running titles, folios, and footers like “©Publisher 2023”.
  - Fix broken words at line breaks (e.g., "thera-\npy" → "therapy").
  - Replace ligatures (ﬁ, ﬂ) with normal letters.
  - Preserve meaningful capitalization, italics markers (use *italic*), bold (**bold**), and inline sub/superscripts as LaTeX if clearly indicated (e.g., CO$_2$).
- CITATIONS: Keep in-text citations literally (e.g., “[12]”, “(Smith 2021)”).
- MATH/CHEM: For formulae, use inline LaTeX: e.g., `pH = -\log_{10} [H^+]`.
- NO IMAGES: Describe figures/diagrams/charts in text form—succinct but complete. Do not invent unseen labels.

STRUCTURED OUTPUT FORMAT (Markdown with embedded JSON blocks)
Always produce in this exact order:

1) `# Page Metadata`
   - Book title (if visible), chapter title (if visible), page number (if visible or inferable), section headings found.
   - Confidence notes: short bullets where uncertainty exists.

2) `# Body`
   - Clean, continuous paragraph text. Keep section/subsection headings as `##` and `###`.

3) `# Tables`
   - For each table found, output a JSON block per table with:
   ```json
   {
     "type": "table",
     "title": "Table 3.2 Disease-modifying agents",
     "note": "footnotes or legends if present",
     "columns": ["Column A", "Column B", "Column C"],
     "rows": [
       ["cell(1,1)", "cell(1,2)", "cell(1,3)"],
       ["cell(2,1)", "cell(2,2)", "cell(2,3)"]
     ],
     "uncertain_cells": [{"row":2,"col":3,"reason":"blurry"}]
   }
If a table is complex (merged cells), normalize by repeating header labels; if impossible, add "structure_note".

# Algorithms / Clinical Approaches

Convert any flowchart, algorithm box, or approach diagram into BOTH:
a) Bulleted steps (plain text):

Step 1: …

If lab X > Y → do …

Else → …
b) Machine-readable pseudo-logic JSON:

json
Copy code
{
  "type": "algorithm",
  "title": "Approach to suspected DKA",
  "nodes": [
    {"id":"start","text":"Patient with hyperglycemia"},
    {"id":"n1","text":"Check ketones"},
    {"id":"n2","text":"If ketones positive → start insulin infusion"}
  ],
  "edges": [
    {"from":"start","to":"n1"},
    {"from":"n1","to":"n2","condition":"ketones positive"}
  ]
}
Use simple IDs; preserve clinical thresholds verbatim.

# Figures / Diagrams / Charts

For each figure, write a compact textual description capturing labels, axes, and key relationships.

If a chart encodes data values, extract the visible numbers as a small table. If not given, describe trends only.

Example JSON:

json
Copy code
{
  "type": "figure",
  "title": "Figure 5.1 Cardiac cycle",
  "description": "Schematic phases (isovolumetric contraction, ejection, …); labels: LV pressure, aortic pressure… Trend: LV pressure rises during …",
  "visible_labels": ["LV", "Aorta", "Mitral"],
  "data_points": null
}
# Lists & Key Points

Convert bullet lists and numbered lists cleanly.

For “pearls”, “high-yield” callouts, prefix with **HIGH-YIELD:**.

# References / Footnotes on Page

Transcribe verbatim; if footnote markers map to table/figure, cross-reference.

# Uncertain / OCR Issues

JSON array, where each item has: location (body/table/figure), snippet (if any), reason (e.g., “scan blur”), and confidence score 0–1.

ADDITIONAL RULES FOR DIFFICULT LAYOUTS

Multi-column pages: Respect reading order left→right, top→bottom per row.

Sidebars/callouts: Place them after the paragraph they visually relate to; prefix with > Note: or > Caution:; also mirror inside # Lists & Key Points if “pearls”.

Units & thresholds: Keep exact units (mg/kg, mmol/L). Do not convert units.

Drug names: Preserve capitalization of brand/generic as shown.

Abbreviations: On first obvious occurrence, if expansion is shown on page, include (abbr: expansion).

OUTPUT VALIDATION

Ensure valid JSON blocks (UTF-8, double quotes).

No trailing commas.

Do not wrap JSON in code fences other than the ones I asked above.

Final Output structure: your output must be sent is as a JSON in a code block with the delimiter of three consecutive semicolons like “,”. Each row is representative of a “page text” or “figure” or “Table”. So each “page text” and “figure” and “Table”  will have a row. The columns Headers are:
    1. Type
    2. Extraction
    3. Number
    4. Part
The “Type” column is for mentioning the type of the cell row data. The acceptable types are “page text” or “figure” or “Table”. If you are writing the page’s text in the extraction column, then the type will be “page text”. If the row in for figures, write “Figure”. And ”. If the row in for Tables, write “Table”.
The “Extraction” column is the main column for each row. If you are extracting a page’s text, write the complete text here. The JSONs of tables and figures must be written here as well.
The References in the end of the chapter must not be extracted. Ignore it.
The ”Number” column must show the page it is extracted from like 1 or 2 and more.
The “Part” column shows that the row’s content is included in which part. Use numbers like 1 or 2 and more.
How to define the parts for each row: in the beginning of the first page of the file there is a “Chapter contents” which demonstrates the parts of the chapter recommended by the author, which we call them “author parts”. I want you to make your own suggestion for dividing the parts, which we call them “Our parts”. The rules of dividing are as follows: an “our part” is consisted of as many as consecutive “author parts” without being the final “our part” more than 10 pages. For example if the “author part”s of the chapter are 2,4,5,3,1,7,5 pages respectively, the first “our part” will be consisted of the first two “author parts”. The second “our part” will be consisted of the third and fourth and fifth “author parts”. the third “our part” will be consisted of the sixth “author part”. the fourth “our part” will be consisted of the seventh “author part”.
If an “our part” ends in the middle of a page, some of the page text will be for the previous “our part” and some of the page will be for the next “our part”. The text of such pages must be written in two separate rows. One of them is related to the previous “our part” and one of them is related to next “our part”. Your goal should be avoiding a row’s content to be consisted of the data from two different “our part”s.
And for example if you decided to divide the chapter into 2 parts, you should write “1” for the contents of the first part and write “2” for the contents of the second part. 

VERY IMPORTANT: your output must be single line (minified). DO NOT EVER use the “ENTER” button inside the cells. It shouldn’t be html rich. Do not separate texts with ENTER.
You will now receive a PDF, respond in the exact structure described above.
2025-12-14 11:23:03,977 - INFO - PDF uploaded successfully with API key: bagher
2025-12-14 11:23:03,978 - INFO - Uploaded PDF file: Bolognia 5th Edition 2024 (1)-7-26-46.pdf
2025-12-14 11:23:03,979 - INFO - Model: gemini-2.5-flash, Max tokens for model: 32768, Using: 32768
2025-12-14 11:23:03,979 - INFO - Using max_output_tokens: 32768
2025-12-14 11:23:03,980 - INFO - Using model: gemini-2.5-flash
2025-12-14 11:23:03,980 - INFO - Sending prompt (length: 7387 characters)
2025-12-14 11:23:03,981 - INFO - Max output tokens: 32768
2025-12-14 11:23:03,981 - INFO - Using original prompt with JSON output instruction (prompt preserved)
2025-12-14 11:23:03,982 - INFO - Generating content with streaming enabled for complete response...
2025-12-14 11:23:05,281 - WARNING - ⚠️ API key leaked (403) or invalid. Attempting to switch to next key...
2025-12-14 11:23:05,282 - INFO - Retrying with API key 1/3: bagher
2025-12-14 11:23:14,384 - WARNING - API key bagher also leaked (403), trying next...
2025-12-14 11:23:14,385 - INFO - Retrying with API key 2/3: bagher
2025-12-14 11:25:38,434 - INFO - ✓ Successfully retried with new API key: bagher
2025-12-14 11:25:39,006 - INFO - === Response Received ===
2025-12-14 11:25:39,007 - INFO - Response length: 106590 characters
2025-12-14 11:25:39,007 - INFO - Truncated: False
2025-12-14 11:25:39,008 - INFO - Response preview (first 500 chars): [{"Type": "page text", "Extraction": "# Page Metadata\nBook title: VESICULOBULLOUS DISEASES SECTION 5\nChapter title: Pemphigoid Group 30\nPage number: 517\nSection headings: Bullous Pemphigoid, Synonym: Pemphigoid, Key features, Introduction, History, Epidemiology, Pathogenesis, Humoral and cellular responses\n\n# Body\n## BULLOUS PEMPHIGOID\n### Synonym: Pemphigoid\n\n### Key features\n- Bullous pemphigoid (BP) is the most common autoimmune subepidermal blistering disease, and its onset is oft...
2025-12-14 11:25:39,008 - INFO - Response preview (last 500 chars): ...rt": 2},
{"Type": "figure", "Extraction": "{\"type\": \"figure\", \"title\": \"eFig. 30.13 Mucous membrane pemphigoid. Desquamative gingivitis can be the presenting sign of the disease. Courtesy Jeffrey P. Callen, MD.\", \"description\": \"A photograph showing desquamative gingivitis on the gums, which can be a presenting sign of mucous membrane pemphigoid.\", \"visible_labels\": [], \"data_points\": null}", "Number": "533.e3", "Part": 2},
{"Type": "figure", "Extraction": "{\"type\": \"figure\",
2025-12-14 11:25:39,015 - ERROR - Error processing PDF: 'ContentAutomationGUI' object has no attribute 'is_json_format'
Traceback (most recent call last):
  File "/home/mohammadbagher/Desktop/tts app bagher/content_automation_project/main_gui.py", line 617, in worker
    is_json = self.is_json_format(response)
              ^^^^^^^^^^^^^^^^^^^
AttributeError: 'ContentAutomationGUI' object has no attribute 'is_json_format'
2025-12-14 11:30:10,925 - INFO - Loaded 6 predefined prompts
2025-12-14 11:30:31,043 - INFO - Loaded 3 API keys
2025-12-14 11:31:44,751 - INFO - === Starting PDF Processing ===
2025-12-14 11:31:44,752 - INFO - Model: gemini-2.5-pro
2025-12-14 11:31:44,752 - INFO - PDF: /home/mohammadbagher/Downloads/PDFs/Bolognia 5th Edition 2024 (1)-7-26-46.pdf
2025-12-14 11:31:44,753 - INFO - Full prompt being sent (7390 chars): You are a meticulous medical OCR & structuring assistant. Your job is to extract **only** what is present on each provided textbook page image/PDF and convert it into clean, AI-ready text with structured sections. You MUST avoid hallucinations and preserve original medical meaning precisely. Follow these global rules:

GLOBAL PRINCIPLES
- NO HALLUCINATIONS: Output only content visible on the page(s). If unreadable/unclear, write: "[UNREADABLE]" or add an "uncertain" flag with brief reason.
- LANGUAGE & SPELLING: Preserve original English spelling and medical terminology; do not normalize British↔American spelling.
- CLEAN OCR: 
  - Remove page headers/footers, running titles, folios, and footers like “©Publisher 2023”.
  - Fix broken words at line breaks (e.g., "thera-\npy" → "therapy").
  - Replace ligatures (ﬁ, ﬂ) with normal letters.
  - Preserve meaningful capitalization, italics markers (use *italic*), bold (**bold**), and inline sub/superscripts as LaTeX if clearly indicated (e.g., CO$_2$).
- CITATIONS: Keep in-text citations literally (e.g., “[12]”, “(Smith 2021)”).
- MATH/CHEM: For formulae, use inline LaTeX: e.g., `pH = -\log_{10} [H^+]`.
- NO IMAGES: Describe figures/diagrams/charts in text form—succinct but complete. Do not invent unseen labels.

STRUCTURED OUTPUT FORMAT (Markdown with embedded JSON blocks)
Always produce in this exact order:

1) `# Page Metadata`
   - Book title (if visible), chapter title (if visible), page number (if visible or inferable), section headings found.
   - Confidence notes: short bullets where uncertainty exists.

2) `# Body`
   - Clean, continuous paragraph text. Keep section/subsection headings as `##` and `###`.

3) `# Tables`
   - For each table found, output a JSON block per table with:
   ```json
   {
     "type": "table",
     "title": "Table 3.2 Disease-modifying agents",
     "note": "footnotes or legends if present",
     "columns": ["Column A", "Column B", "Column C"],
     "rows": [
       ["cell(1,1)", "cell(1,2)", "cell(1,3)"],
       ["cell(2,1)", "cell(2,2)", "cell(2,3)"]
     ],
     "uncertain_cells": [{"row":2,"col":3,"reason":"blurry"}]
   }
If a table is complex (merged cells), normalize by repeating header labels; if impossible, add "structure_note".

# Algorithms / Clinical Approaches

Convert any flowchart, algorithm box, or approach diagram into BOTH:
a) Bulleted steps (plain text):

Step 1: …

If lab X > Y → do …

Else → …
b) Machine-readable pseudo-logic JSON:

json
Copy code
{
  "type": "algorithm",
  "title": "Approach to suspected DKA",
  "nodes": [
    {"id":"start","text":"Patient with hyperglycemia"},
    {"id":"n1","text":"Check ketones"},
    {"id":"n2","text":"If ketones positive → start insulin infusion"}
  ],
  "edges": [
    {"from":"start","to":"n1"},
    {"from":"n1","to":"n2","condition":"ketones positive"}
  ]
}
Use simple IDs; preserve clinical thresholds verbatim.

# Figures / Diagrams / Charts

For each figure, write a compact textual description capturing labels, axes, and key relationships.

If a chart encodes data values, extract the visible numbers as a small table. If not given, describe trends only.

Example JSON:

json
Copy code
{
  "type": "figure",
  "title": "Figure 5.1 Cardiac cycle",
  "description": "Schematic phases (isovolumetric contraction, ejection, …); labels: LV pressure, aortic pressure… Trend: LV pressure rises during …",
  "visible_labels": ["LV", "Aorta", "Mitral"],
  "data_points": null
}
# Lists & Key Points

Convert bullet lists and numbered lists cleanly.

For “pearls”, “high-yield” callouts, prefix with **HIGH-YIELD:**.

# References / Footnotes on Page

Transcribe verbatim; if footnote markers map to table/figure, cross-reference.

# Uncertain / OCR Issues

JSON array, where each item has: location (body/table/figure), snippet (if any), reason (e.g., “scan blur”), and confidence score 0–1.

ADDITIONAL RULES FOR DIFFICULT LAYOUTS

Multi-column pages: Respect reading order left→right, top→bottom per row.

Sidebars/callouts: Place them after the paragraph they visually relate to; prefix with > Note: or > Caution:; also mirror inside # Lists & Key Points if “pearls”.

Units & thresholds: Keep exact units (mg/kg, mmol/L). Do not convert units.

Drug names: Preserve capitalization of brand/generic as shown.

Abbreviations: On first obvious occurrence, if expansion is shown on page, include (abbr: expansion).

OUTPUT VALIDATION

Ensure valid JSON blocks (UTF-8, double quotes).

No trailing commas.

Do not wrap JSON in code fences other than the ones I asked above.

Final Output structure: your output must be sent is as a JSON in a code block with the delimiter of three consecutive semicolons like “;;;”. Each row is representative of a “page text” or “figure” or “Table”. So each “page text” and “figure” and “Table”  will have a row. The columns Headers are:
    1. Type
    2. Extraction
    3. Number
    4. Part
The “Type” column is for mentioning the type of the cell row data. The acceptable types are “page text” or “figure” or “Table”. If you are writing the page’s text in the extraction column, then the type will be “page text”. If the row in for figures, write “Figure”. And ”. If the row in for Tables, write “Table”.
The “Extraction” column is the main column for each row. If you are extracting a page’s text, write the complete text here. The JSONs of tables and figures must be written here as well.
The References in the end of the chapter must not be extracted. Ignore it.
The ”Number” column must show the page it is extracted from like 1 or 2 and more.
The “Part” column shows that the row’s content is included in which part. Use numbers like 1 or 2 and more.
How to define the parts for each row: in the beginning of the first page of the file there is a “Chapter contents” which demonstrates the parts of the chapter recommended by the author, which we call them “author parts”. I want you to make your own suggestion for dividing the parts, which we call them “Our parts”. The rules of dividing are as follows: an “our part” is consisted of as many as consecutive “author parts” without being the final “our part” more than 10 pages. For example if the “author part”s of the chapter are 2,4,5,3,1,7,5 pages respectively, the first “our part” will be consisted of the first two “author parts”. The second “our part” will be consisted of the third and fourth and fifth “author parts”. the third “our part” will be consisted of the sixth “author part”. the fourth “our part” will be consisted of the seventh “author part”.
If an “our part” ends in the middle of a page, some of the page text will be for the previous “our part” and some of the page will be for the next “our part”. The text of such pages must be written in two separate rows. One of them is related to the previous “our part” and one of them is related to next “our part”. Your goal should be avoiding a row’s content to be consisted of the data from two different “our part”s.
And for example if you decided to divide the chapter into 2 parts, you should write “1” for the contents of the first part and write “2” for the contents of the second part. 

VERY IMPORTANT: your output must be single line (minified). DO NOT EVER use the “ENTER” button inside the cells. It shouldn’t be html rich. Do not separate texts with ENTER.

You will now receive a PDF, respond in the exact structure described above.
2025-12-14 11:31:44,826 - INFO - Processing PDF with 21 pages in batches of 10 pages
2025-12-14 11:31:44,826 - INFO - Using original prompt with JSON output instruction for batch processing (prompt preserved)
2025-12-14 11:31:56,815 - INFO - Uploaded PDF file: Bolognia 5th Edition 2024 (1)-7-26-46.pdf
2025-12-14 11:31:56,818 - INFO - Processing batch 1/3: pages 1-10
2025-12-14 11:31:58,038 - WARNING - ⚠️ API key leaked (403) in batch processing. Will try next key in next batch.
2025-12-14 11:31:58,038 - WARNING - Batch 1 returned no results
2025-12-14 11:31:58,039 - INFO - Processing batch 2/3: pages 11-20
2025-12-14 11:31:58,320 - WARNING - ⚠️ API key leaked (403) in batch processing. Will try next key in next batch.
2025-12-14 11:31:58,320 - WARNING - Batch 2 returned no results
2025-12-14 11:31:58,321 - INFO - Processing batch 3/3: pages 21-21
2025-12-14 11:31:58,603 - WARNING - ⚠️ API key leaked (403) in batch processing. Will try next key in next batch.
2025-12-14 11:31:58,603 - WARNING - Batch 3 returned no results
2025-12-14 11:31:58,603 - ERROR - No data extracted from any batch
2025-12-14 11:35:51,250 - INFO - Loaded 6 predefined prompts
2025-12-14 11:36:12,519 - INFO - Loaded 3 API keys
2025-12-14 11:36:42,837 - INFO - === Starting PDF Processing ===
2025-12-14 11:36:42,837 - INFO - Model: gemini-2.5-pro
2025-12-14 11:36:42,838 - INFO - PDF: /home/mohammadbagher/Downloads/PDFs/Bolognia 5th Edition 2024 (1)-7-26-46.pdf
2025-12-14 11:36:42,838 - INFO - Full prompt being sent (7390 chars): You are a meticulous medical OCR & structuring assistant. Your job is to extract **only** what is present on each provided textbook page image/PDF and convert it into clean, AI-ready text with structured sections. You MUST avoid hallucinations and preserve original medical meaning precisely. Follow these global rules:

GLOBAL PRINCIPLES
- NO HALLUCINATIONS: Output only content visible on the page(s). If unreadable/unclear, write: "[UNREADABLE]" or add an "uncertain" flag with brief reason.
- LANGUAGE & SPELLING: Preserve original English spelling and medical terminology; do not normalize British↔American spelling.
- CLEAN OCR: 
  - Remove page headers/footers, running titles, folios, and footers like “©Publisher 2023”.
  - Fix broken words at line breaks (e.g., "thera-\npy" → "therapy").
  - Replace ligatures (ﬁ, ﬂ) with normal letters.
  - Preserve meaningful capitalization, italics markers (use *italic*), bold (**bold**), and inline sub/superscripts as LaTeX if clearly indicated (e.g., CO$_2$).
- CITATIONS: Keep in-text citations literally (e.g., “[12]”, “(Smith 2021)”).
- MATH/CHEM: For formulae, use inline LaTeX: e.g., `pH = -\log_{10} [H^+]`.
- NO IMAGES: Describe figures/diagrams/charts in text form—succinct but complete. Do not invent unseen labels.

STRUCTURED OUTPUT FORMAT (Markdown with embedded JSON blocks)
Always produce in this exact order:

1) `# Page Metadata`
   - Book title (if visible), chapter title (if visible), page number (if visible or inferable), section headings found.
   - Confidence notes: short bullets where uncertainty exists.

2) `# Body`
   - Clean, continuous paragraph text. Keep section/subsection headings as `##` and `###`.

3) `# Tables`
   - For each table found, output a JSON block per table with:
   ```json
   {
     "type": "table",
     "title": "Table 3.2 Disease-modifying agents",
     "note": "footnotes or legends if present",
     "columns": ["Column A", "Column B", "Column C"],
     "rows": [
       ["cell(1,1)", "cell(1,2)", "cell(1,3)"],
       ["cell(2,1)", "cell(2,2)", "cell(2,3)"]
     ],
     "uncertain_cells": [{"row":2,"col":3,"reason":"blurry"}]
   }
If a table is complex (merged cells), normalize by repeating header labels; if impossible, add "structure_note".

# Algorithms / Clinical Approaches

Convert any flowchart, algorithm box, or approach diagram into BOTH:
a) Bulleted steps (plain text):

Step 1: …

If lab X > Y → do …

Else → …
b) Machine-readable pseudo-logic JSON:

json
Copy code
{
  "type": "algorithm",
  "title": "Approach to suspected DKA",
  "nodes": [
    {"id":"start","text":"Patient with hyperglycemia"},
    {"id":"n1","text":"Check ketones"},
    {"id":"n2","text":"If ketones positive → start insulin infusion"}
  ],
  "edges": [
    {"from":"start","to":"n1"},
    {"from":"n1","to":"n2","condition":"ketones positive"}
  ]
}
Use simple IDs; preserve clinical thresholds verbatim.

# Figures / Diagrams / Charts

For each figure, write a compact textual description capturing labels, axes, and key relationships.

If a chart encodes data values, extract the visible numbers as a small table. If not given, describe trends only.

Example JSON:

json
Copy code
{
  "type": "figure",
  "title": "Figure 5.1 Cardiac cycle",
  "description": "Schematic phases (isovolumetric contraction, ejection, …); labels: LV pressure, aortic pressure… Trend: LV pressure rises during …",
  "visible_labels": ["LV", "Aorta", "Mitral"],
  "data_points": null
}
# Lists & Key Points

Convert bullet lists and numbered lists cleanly.

For “pearls”, “high-yield” callouts, prefix with **HIGH-YIELD:**.

# References / Footnotes on Page

Transcribe verbatim; if footnote markers map to table/figure, cross-reference.

# Uncertain / OCR Issues

JSON array, where each item has: location (body/table/figure), snippet (if any), reason (e.g., “scan blur”), and confidence score 0–1.

ADDITIONAL RULES FOR DIFFICULT LAYOUTS

Multi-column pages: Respect reading order left→right, top→bottom per row.

Sidebars/callouts: Place them after the paragraph they visually relate to; prefix with > Note: or > Caution:; also mirror inside # Lists & Key Points if “pearls”.

Units & thresholds: Keep exact units (mg/kg, mmol/L). Do not convert units.

Drug names: Preserve capitalization of brand/generic as shown.

Abbreviations: On first obvious occurrence, if expansion is shown on page, include (abbr: expansion).

OUTPUT VALIDATION

Ensure valid JSON blocks (UTF-8, double quotes).

No trailing commas.

Do not wrap JSON in code fences other than the ones I asked above.

Final Output structure: your output must be sent is as a JSON in a code block with the delimiter of three consecutive semicolons like “;;;”. Each row is representative of a “page text” or “figure” or “Table”. So each “page text” and “figure” and “Table”  will have a row. The columns Headers are:
    1. Type
    2. Extraction
    3. Number
    4. Part
The “Type” column is for mentioning the type of the cell row data. The acceptable types are “page text” or “figure” or “Table”. If you are writing the page’s text in the extraction column, then the type will be “page text”. If the row in for figures, write “Figure”. And ”. If the row in for Tables, write “Table”.
The “Extraction” column is the main column for each row. If you are extracting a page’s text, write the complete text here. The JSONs of tables and figures must be written here as well.
The References in the end of the chapter must not be extracted. Ignore it.
The ”Number” column must show the page it is extracted from like 1 or 2 and more.
The “Part” column shows that the row’s content is included in which part. Use numbers like 1 or 2 and more.
How to define the parts for each row: in the beginning of the first page of the file there is a “Chapter contents” which demonstrates the parts of the chapter recommended by the author, which we call them “author parts”. I want you to make your own suggestion for dividing the parts, which we call them “Our parts”. The rules of dividing are as follows: an “our part” is consisted of as many as consecutive “author parts” without being the final “our part” more than 10 pages. For example if the “author part”s of the chapter are 2,4,5,3,1,7,5 pages respectively, the first “our part” will be consisted of the first two “author parts”. The second “our part” will be consisted of the third and fourth and fifth “author parts”. the third “our part” will be consisted of the sixth “author part”. the fourth “our part” will be consisted of the seventh “author part”.
If an “our part” ends in the middle of a page, some of the page text will be for the previous “our part” and some of the page will be for the next “our part”. The text of such pages must be written in two separate rows. One of them is related to the previous “our part” and one of them is related to next “our part”. Your goal should be avoiding a row’s content to be consisted of the data from two different “our part”s.
And for example if you decided to divide the chapter into 2 parts, you should write “1” for the contents of the first part and write “2” for the contents of the second part. 

VERY IMPORTANT: your output must be single line (minified). DO NOT EVER use the “ENTER” button inside the cells. It shouldn’t be html rich. Do not separate texts with ENTER.

You will now receive a PDF, respond in the exact structure described above.
2025-12-14 11:36:53,832 - INFO - PDF uploaded successfully with API key: bagher
2025-12-14 11:36:53,832 - INFO - Uploaded PDF file: Bolognia 5th Edition 2024 (1)-7-26-46.pdf
2025-12-14 11:36:53,833 - INFO - Model: gemini-2.5-pro, Max tokens for model: 32768, Using: 32768
2025-12-14 11:36:53,834 - INFO - Using max_output_tokens: 32768
2025-12-14 11:36:53,835 - INFO - Using model: gemini-2.5-pro
2025-12-14 11:36:53,835 - INFO - Sending prompt (length: 7390 characters)
2025-12-14 11:36:53,836 - INFO - Max output tokens: 32768
2025-12-14 11:36:53,836 - INFO - Using original prompt with JSON output instruction (prompt preserved)
2025-12-14 11:36:53,837 - INFO - Generating content with streaming enabled for complete response...
2025-12-14 11:36:55,080 - WARNING - ⚠️ API key leaked (403) or invalid. Attempting to switch to next key...
2025-12-14 11:36:55,080 - INFO - Retrying with API key 1/3: bagher
2025-12-14 11:37:08,312 - WARNING - API key bagher also leaked (403), trying next...
2025-12-14 11:37:08,314 - INFO - Retrying with API key 2/3: bagher
2025-12-14 11:37:18,504 - WARNING - API key bagher also leaked (403), trying next...
2025-12-14 11:37:18,505 - INFO - Retrying with API key 3/3: bagher
2025-12-14 11:37:21,031 - WARNING - API key bagher also leaked (403), trying next...
2025-12-14 11:37:21,032 - ERROR - ❌ All 3 API keys exhausted or failed. Cannot process request.
2025-12-14 11:37:47,159 - INFO - === Starting PDF Processing ===
2025-12-14 11:37:47,159 - INFO - Model: gemini-1.5-pro
2025-12-14 11:37:47,160 - INFO - PDF: /home/mohammadbagher/Downloads/PDFs/Bolognia 5th Edition 2024 (1)-7-26-46.pdf
2025-12-14 11:37:47,161 - INFO - Full prompt being sent (7390 chars): You are a meticulous medical OCR & structuring assistant. Your job is to extract **only** what is present on each provided textbook page image/PDF and convert it into clean, AI-ready text with structured sections. You MUST avoid hallucinations and preserve original medical meaning precisely. Follow these global rules:

GLOBAL PRINCIPLES
- NO HALLUCINATIONS: Output only content visible on the page(s). If unreadable/unclear, write: "[UNREADABLE]" or add an "uncertain" flag with brief reason.
- LANGUAGE & SPELLING: Preserve original English spelling and medical terminology; do not normalize British↔American spelling.
- CLEAN OCR: 
  - Remove page headers/footers, running titles, folios, and footers like “©Publisher 2023”.
  - Fix broken words at line breaks (e.g., "thera-\npy" → "therapy").
  - Replace ligatures (ﬁ, ﬂ) with normal letters.
  - Preserve meaningful capitalization, italics markers (use *italic*), bold (**bold**), and inline sub/superscripts as LaTeX if clearly indicated (e.g., CO$_2$).
- CITATIONS: Keep in-text citations literally (e.g., “[12]”, “(Smith 2021)”).
- MATH/CHEM: For formulae, use inline LaTeX: e.g., `pH = -\log_{10} [H^+]`.
- NO IMAGES: Describe figures/diagrams/charts in text form—succinct but complete. Do not invent unseen labels.

STRUCTURED OUTPUT FORMAT (Markdown with embedded JSON blocks)
Always produce in this exact order:

1) `# Page Metadata`
   - Book title (if visible), chapter title (if visible), page number (if visible or inferable), section headings found.
   - Confidence notes: short bullets where uncertainty exists.

2) `# Body`
   - Clean, continuous paragraph text. Keep section/subsection headings as `##` and `###`.

3) `# Tables`
   - For each table found, output a JSON block per table with:
   ```json
   {
     "type": "table",
     "title": "Table 3.2 Disease-modifying agents",
     "note": "footnotes or legends if present",
     "columns": ["Column A", "Column B", "Column C"],
     "rows": [
       ["cell(1,1)", "cell(1,2)", "cell(1,3)"],
       ["cell(2,1)", "cell(2,2)", "cell(2,3)"]
     ],
     "uncertain_cells": [{"row":2,"col":3,"reason":"blurry"}]
   }
If a table is complex (merged cells), normalize by repeating header labels; if impossible, add "structure_note".

# Algorithms / Clinical Approaches

Convert any flowchart, algorithm box, or approach diagram into BOTH:
a) Bulleted steps (plain text):

Step 1: …

If lab X > Y → do …

Else → …
b) Machine-readable pseudo-logic JSON:

json
Copy code
{
  "type": "algorithm",
  "title": "Approach to suspected DKA",
  "nodes": [
    {"id":"start","text":"Patient with hyperglycemia"},
    {"id":"n1","text":"Check ketones"},
    {"id":"n2","text":"If ketones positive → start insulin infusion"}
  ],
  "edges": [
    {"from":"start","to":"n1"},
    {"from":"n1","to":"n2","condition":"ketones positive"}
  ]
}
Use simple IDs; preserve clinical thresholds verbatim.

# Figures / Diagrams / Charts

For each figure, write a compact textual description capturing labels, axes, and key relationships.

If a chart encodes data values, extract the visible numbers as a small table. If not given, describe trends only.

Example JSON:

json
Copy code
{
  "type": "figure",
  "title": "Figure 5.1 Cardiac cycle",
  "description": "Schematic phases (isovolumetric contraction, ejection, …); labels: LV pressure, aortic pressure… Trend: LV pressure rises during …",
  "visible_labels": ["LV", "Aorta", "Mitral"],
  "data_points": null
}
# Lists & Key Points

Convert bullet lists and numbered lists cleanly.

For “pearls”, “high-yield” callouts, prefix with **HIGH-YIELD:**.

# References / Footnotes on Page

Transcribe verbatim; if footnote markers map to table/figure, cross-reference.

# Uncertain / OCR Issues

JSON array, where each item has: location (body/table/figure), snippet (if any), reason (e.g., “scan blur”), and confidence score 0–1.

ADDITIONAL RULES FOR DIFFICULT LAYOUTS

Multi-column pages: Respect reading order left→right, top→bottom per row.

Sidebars/callouts: Place them after the paragraph they visually relate to; prefix with > Note: or > Caution:; also mirror inside # Lists & Key Points if “pearls”.

Units & thresholds: Keep exact units (mg/kg, mmol/L). Do not convert units.

Drug names: Preserve capitalization of brand/generic as shown.

Abbreviations: On first obvious occurrence, if expansion is shown on page, include (abbr: expansion).

OUTPUT VALIDATION

Ensure valid JSON blocks (UTF-8, double quotes).

No trailing commas.

Do not wrap JSON in code fences other than the ones I asked above.

Final Output structure: your output must be sent is as a JSON in a code block with the delimiter of three consecutive semicolons like “;;;”. Each row is representative of a “page text” or “figure” or “Table”. So each “page text” and “figure” and “Table”  will have a row. The columns Headers are:
    1. Type
    2. Extraction
    3. Number
    4. Part
The “Type” column is for mentioning the type of the cell row data. The acceptable types are “page text” or “figure” or “Table”. If you are writing the page’s text in the extraction column, then the type will be “page text”. If the row in for figures, write “Figure”. And ”. If the row in for Tables, write “Table”.
The “Extraction” column is the main column for each row. If you are extracting a page’s text, write the complete text here. The JSONs of tables and figures must be written here as well.
The References in the end of the chapter must not be extracted. Ignore it.
The ”Number” column must show the page it is extracted from like 1 or 2 and more.
The “Part” column shows that the row’s content is included in which part. Use numbers like 1 or 2 and more.
How to define the parts for each row: in the beginning of the first page of the file there is a “Chapter contents” which demonstrates the parts of the chapter recommended by the author, which we call them “author parts”. I want you to make your own suggestion for dividing the parts, which we call them “Our parts”. The rules of dividing are as follows: an “our part” is consisted of as many as consecutive “author parts” without being the final “our part” more than 10 pages. For example if the “author part”s of the chapter are 2,4,5,3,1,7,5 pages respectively, the first “our part” will be consisted of the first two “author parts”. The second “our part” will be consisted of the third and fourth and fifth “author parts”. the third “our part” will be consisted of the sixth “author part”. the fourth “our part” will be consisted of the seventh “author part”.
If an “our part” ends in the middle of a page, some of the page text will be for the previous “our part” and some of the page will be for the next “our part”. The text of such pages must be written in two separate rows. One of them is related to the previous “our part” and one of them is related to next “our part”. Your goal should be avoiding a row’s content to be consisted of the data from two different “our part”s.
And for example if you decided to divide the chapter into 2 parts, you should write “1” for the contents of the first part and write “2” for the contents of the second part. 

VERY IMPORTANT: your output must be single line (minified). DO NOT EVER use the “ENTER” button inside the cells. It shouldn’t be html rich. Do not separate texts with ENTER.

You will now receive a PDF, respond in the exact structure described above.
2025-12-14 11:37:57,563 - INFO - PDF uploaded successfully with API key: bagher
2025-12-14 11:37:57,564 - INFO - Uploaded PDF file: Bolognia 5th Edition 2024 (1)-7-26-46.pdf
2025-12-14 11:37:57,565 - INFO - Model: gemini-1.5-pro, Max tokens for model: 8192, Using: 8192
2025-12-14 11:37:57,566 - INFO - Using max_output_tokens: 8192
2025-12-14 11:37:57,566 - INFO - Using model: gemini-1.5-pro
2025-12-14 11:37:57,567 - INFO - Sending prompt (length: 7390 characters)
2025-12-14 11:37:57,568 - INFO - Max output tokens: 8192
2025-12-14 11:37:57,569 - INFO - Using original prompt with JSON output instruction (prompt preserved)
2025-12-14 11:37:57,570 - INFO - Generating content with streaming enabled for complete response...
2025-12-14 11:37:58,968 - WARNING - Streaming not available or failed: 404 models/gemini-1.5-pro is not found for API version v1beta, or is not supported for generateContent. Call ListModels to see the list of available models and their supported methods., using non-streaming
2025-12-14 11:37:59,319 - ERROR - PDF processing failed: 404 models/gemini-1.5-pro is not found for API version v1beta, or is not supported for generateContent. Call ListModels to see the list of available models and their supported methods.
2025-12-14 11:38:14,861 - INFO - === Starting PDF Processing ===
2025-12-14 11:38:14,861 - INFO - Model: gemini-2.5-flash
2025-12-14 11:38:14,862 - INFO - PDF: /home/mohammadbagher/Downloads/PDFs/Bolognia 5th Edition 2024 (1)-7-26-46.pdf
2025-12-14 11:38:14,862 - INFO - Full prompt being sent (7390 chars): You are a meticulous medical OCR & structuring assistant. Your job is to extract **only** what is present on each provided textbook page image/PDF and convert it into clean, AI-ready text with structured sections. You MUST avoid hallucinations and preserve original medical meaning precisely. Follow these global rules:

GLOBAL PRINCIPLES
- NO HALLUCINATIONS: Output only content visible on the page(s). If unreadable/unclear, write: "[UNREADABLE]" or add an "uncertain" flag with brief reason.
- LANGUAGE & SPELLING: Preserve original English spelling and medical terminology; do not normalize British↔American spelling.
- CLEAN OCR: 
  - Remove page headers/footers, running titles, folios, and footers like “©Publisher 2023”.
  - Fix broken words at line breaks (e.g., "thera-\npy" → "therapy").
  - Replace ligatures (ﬁ, ﬂ) with normal letters.
  - Preserve meaningful capitalization, italics markers (use *italic*), bold (**bold**), and inline sub/superscripts as LaTeX if clearly indicated (e.g., CO$_2$).
- CITATIONS: Keep in-text citations literally (e.g., “[12]”, “(Smith 2021)”).
- MATH/CHEM: For formulae, use inline LaTeX: e.g., `pH = -\log_{10} [H^+]`.
- NO IMAGES: Describe figures/diagrams/charts in text form—succinct but complete. Do not invent unseen labels.

STRUCTURED OUTPUT FORMAT (Markdown with embedded JSON blocks)
Always produce in this exact order:

1) `# Page Metadata`
   - Book title (if visible), chapter title (if visible), page number (if visible or inferable), section headings found.
   - Confidence notes: short bullets where uncertainty exists.

2) `# Body`
   - Clean, continuous paragraph text. Keep section/subsection headings as `##` and `###`.

3) `# Tables`
   - For each table found, output a JSON block per table with:
   ```json
   {
     "type": "table",
     "title": "Table 3.2 Disease-modifying agents",
     "note": "footnotes or legends if present",
     "columns": ["Column A", "Column B", "Column C"],
     "rows": [
       ["cell(1,1)", "cell(1,2)", "cell(1,3)"],
       ["cell(2,1)", "cell(2,2)", "cell(2,3)"]
     ],
     "uncertain_cells": [{"row":2,"col":3,"reason":"blurry"}]
   }
If a table is complex (merged cells), normalize by repeating header labels; if impossible, add "structure_note".

# Algorithms / Clinical Approaches

Convert any flowchart, algorithm box, or approach diagram into BOTH:
a) Bulleted steps (plain text):

Step 1: …

If lab X > Y → do …

Else → …
b) Machine-readable pseudo-logic JSON:

json
Copy code
{
  "type": "algorithm",
  "title": "Approach to suspected DKA",
  "nodes": [
    {"id":"start","text":"Patient with hyperglycemia"},
    {"id":"n1","text":"Check ketones"},
    {"id":"n2","text":"If ketones positive → start insulin infusion"}
  ],
  "edges": [
    {"from":"start","to":"n1"},
    {"from":"n1","to":"n2","condition":"ketones positive"}
  ]
}
Use simple IDs; preserve clinical thresholds verbatim.

# Figures / Diagrams / Charts

For each figure, write a compact textual description capturing labels, axes, and key relationships.

If a chart encodes data values, extract the visible numbers as a small table. If not given, describe trends only.

Example JSON:

json
Copy code
{
  "type": "figure",
  "title": "Figure 5.1 Cardiac cycle",
  "description": "Schematic phases (isovolumetric contraction, ejection, …); labels: LV pressure, aortic pressure… Trend: LV pressure rises during …",
  "visible_labels": ["LV", "Aorta", "Mitral"],
  "data_points": null
}
# Lists & Key Points

Convert bullet lists and numbered lists cleanly.

For “pearls”, “high-yield” callouts, prefix with **HIGH-YIELD:**.

# References / Footnotes on Page

Transcribe verbatim; if footnote markers map to table/figure, cross-reference.

# Uncertain / OCR Issues

JSON array, where each item has: location (body/table/figure), snippet (if any), reason (e.g., “scan blur”), and confidence score 0–1.

ADDITIONAL RULES FOR DIFFICULT LAYOUTS

Multi-column pages: Respect reading order left→right, top→bottom per row.

Sidebars/callouts: Place them after the paragraph they visually relate to; prefix with > Note: or > Caution:; also mirror inside # Lists & Key Points if “pearls”.

Units & thresholds: Keep exact units (mg/kg, mmol/L). Do not convert units.

Drug names: Preserve capitalization of brand/generic as shown.

Abbreviations: On first obvious occurrence, if expansion is shown on page, include (abbr: expansion).

OUTPUT VALIDATION

Ensure valid JSON blocks (UTF-8, double quotes).

No trailing commas.

Do not wrap JSON in code fences other than the ones I asked above.

Final Output structure: your output must be sent is as a JSON in a code block with the delimiter of three consecutive semicolons like “;;;”. Each row is representative of a “page text” or “figure” or “Table”. So each “page text” and “figure” and “Table”  will have a row. The columns Headers are:
    1. Type
    2. Extraction
    3. Number
    4. Part
The “Type” column is for mentioning the type of the cell row data. The acceptable types are “page text” or “figure” or “Table”. If you are writing the page’s text in the extraction column, then the type will be “page text”. If the row in for figures, write “Figure”. And ”. If the row in for Tables, write “Table”.
The “Extraction” column is the main column for each row. If you are extracting a page’s text, write the complete text here. The JSONs of tables and figures must be written here as well.
The References in the end of the chapter must not be extracted. Ignore it.
The ”Number” column must show the page it is extracted from like 1 or 2 and more.
The “Part” column shows that the row’s content is included in which part. Use numbers like 1 or 2 and more.
How to define the parts for each row: in the beginning of the first page of the file there is a “Chapter contents” which demonstrates the parts of the chapter recommended by the author, which we call them “author parts”. I want you to make your own suggestion for dividing the parts, which we call them “Our parts”. The rules of dividing are as follows: an “our part” is consisted of as many as consecutive “author parts” without being the final “our part” more than 10 pages. For example if the “author part”s of the chapter are 2,4,5,3,1,7,5 pages respectively, the first “our part” will be consisted of the first two “author parts”. The second “our part” will be consisted of the third and fourth and fifth “author parts”. the third “our part” will be consisted of the sixth “author part”. the fourth “our part” will be consisted of the seventh “author part”.
If an “our part” ends in the middle of a page, some of the page text will be for the previous “our part” and some of the page will be for the next “our part”. The text of such pages must be written in two separate rows. One of them is related to the previous “our part” and one of them is related to next “our part”. Your goal should be avoiding a row’s content to be consisted of the data from two different “our part”s.
And for example if you decided to divide the chapter into 2 parts, you should write “1” for the contents of the first part and write “2” for the contents of the second part. 

VERY IMPORTANT: your output must be single line (minified). DO NOT EVER use the “ENTER” button inside the cells. It shouldn’t be html rich. Do not separate texts with ENTER.

You will now receive a PDF, respond in the exact structure described above.
2025-12-14 11:38:25,820 - INFO - PDF uploaded successfully with API key: bagher
2025-12-14 11:38:25,821 - INFO - Uploaded PDF file: Bolognia 5th Edition 2024 (1)-7-26-46.pdf
2025-12-14 11:38:25,822 - INFO - Model: gemini-2.5-flash, Max tokens for model: 32768, Using: 32768
2025-12-14 11:38:25,823 - INFO - Using max_output_tokens: 32768
2025-12-14 11:38:25,823 - INFO - Using model: gemini-2.5-flash
2025-12-14 11:38:25,823 - INFO - Sending prompt (length: 7390 characters)
2025-12-14 11:38:25,824 - INFO - Max output tokens: 32768
2025-12-14 11:38:25,824 - INFO - Using original prompt with JSON output instruction (prompt preserved)
2025-12-14 11:38:25,825 - INFO - Generating content with streaming enabled for complete response...
2025-12-14 11:38:27,177 - WARNING - ⚠️ API key leaked (403) or invalid. Attempting to switch to next key...
2025-12-14 11:38:27,178 - INFO - Retrying with API key 1/3: bagher
2025-12-14 11:38:39,936 - WARNING - API key bagher also leaked (403), trying next...
2025-12-14 11:38:39,937 - INFO - Retrying with API key 2/3: bagher
2025-12-14 11:38:49,832 - WARNING - API key bagher also leaked (403), trying next...
2025-12-14 11:38:49,833 - INFO - Retrying with API key 3/3: bagher
2025-12-14 11:38:52,274 - WARNING - API key bagher also leaked (403), trying next...
2025-12-14 11:38:52,275 - ERROR - ❌ All 3 API keys exhausted or failed. Cannot process request.
2025-12-14 11:44:51,738 - INFO - === Starting PDF Processing ===
2025-12-14 11:44:51,738 - INFO - Model: gemini-2.5-pro
2025-12-14 11:44:51,738 - INFO - PDF: /home/mohammadbagher/Downloads/PDFs/Bolognia 5th Edition 2024 (1)-7-26-46.pdf
2025-12-14 11:44:51,738 - INFO - Full prompt being sent (7390 chars): You are a meticulous medical OCR & structuring assistant. Your job is to extract **only** what is present on each provided textbook page image/PDF and convert it into clean, AI-ready text with structured sections. You MUST avoid hallucinations and preserve original medical meaning precisely. Follow these global rules:

GLOBAL PRINCIPLES
- NO HALLUCINATIONS: Output only content visible on the page(s). If unreadable/unclear, write: "[UNREADABLE]" or add an "uncertain" flag with brief reason.
- LANGUAGE & SPELLING: Preserve original English spelling and medical terminology; do not normalize British↔American spelling.
- CLEAN OCR: 
  - Remove page headers/footers, running titles, folios, and footers like “©Publisher 2023”.
  - Fix broken words at line breaks (e.g., "thera-\npy" → "therapy").
  - Replace ligatures (ﬁ, ﬂ) with normal letters.
  - Preserve meaningful capitalization, italics markers (use *italic*), bold (**bold**), and inline sub/superscripts as LaTeX if clearly indicated (e.g., CO$_2$).
- CITATIONS: Keep in-text citations literally (e.g., “[12]”, “(Smith 2021)”).
- MATH/CHEM: For formulae, use inline LaTeX: e.g., `pH = -\log_{10} [H^+]`.
- NO IMAGES: Describe figures/diagrams/charts in text form—succinct but complete. Do not invent unseen labels.

STRUCTURED OUTPUT FORMAT (Markdown with embedded JSON blocks)
Always produce in this exact order:

1) `# Page Metadata`
   - Book title (if visible), chapter title (if visible), page number (if visible or inferable), section headings found.
   - Confidence notes: short bullets where uncertainty exists.

2) `# Body`
   - Clean, continuous paragraph text. Keep section/subsection headings as `##` and `###`.

3) `# Tables`
   - For each table found, output a JSON block per table with:
   ```json
   {
     "type": "table",
     "title": "Table 3.2 Disease-modifying agents",
     "note": "footnotes or legends if present",
     "columns": ["Column A", "Column B", "Column C"],
     "rows": [
       ["cell(1,1)", "cell(1,2)", "cell(1,3)"],
       ["cell(2,1)", "cell(2,2)", "cell(2,3)"]
     ],
     "uncertain_cells": [{"row":2,"col":3,"reason":"blurry"}]
   }
If a table is complex (merged cells), normalize by repeating header labels; if impossible, add "structure_note".

# Algorithms / Clinical Approaches

Convert any flowchart, algorithm box, or approach diagram into BOTH:
a) Bulleted steps (plain text):

Step 1: …

If lab X > Y → do …

Else → …
b) Machine-readable pseudo-logic JSON:

json
Copy code
{
  "type": "algorithm",
  "title": "Approach to suspected DKA",
  "nodes": [
    {"id":"start","text":"Patient with hyperglycemia"},
    {"id":"n1","text":"Check ketones"},
    {"id":"n2","text":"If ketones positive → start insulin infusion"}
  ],
  "edges": [
    {"from":"start","to":"n1"},
    {"from":"n1","to":"n2","condition":"ketones positive"}
  ]
}
Use simple IDs; preserve clinical thresholds verbatim.

# Figures / Diagrams / Charts

For each figure, write a compact textual description capturing labels, axes, and key relationships.

If a chart encodes data values, extract the visible numbers as a small table. If not given, describe trends only.

Example JSON:

json
Copy code
{
  "type": "figure",
  "title": "Figure 5.1 Cardiac cycle",
  "description": "Schematic phases (isovolumetric contraction, ejection, …); labels: LV pressure, aortic pressure… Trend: LV pressure rises during …",
  "visible_labels": ["LV", "Aorta", "Mitral"],
  "data_points": null
}
# Lists & Key Points

Convert bullet lists and numbered lists cleanly.

For “pearls”, “high-yield” callouts, prefix with **HIGH-YIELD:**.

# References / Footnotes on Page

Transcribe verbatim; if footnote markers map to table/figure, cross-reference.

# Uncertain / OCR Issues

JSON array, where each item has: location (body/table/figure), snippet (if any), reason (e.g., “scan blur”), and confidence score 0–1.

ADDITIONAL RULES FOR DIFFICULT LAYOUTS

Multi-column pages: Respect reading order left→right, top→bottom per row.

Sidebars/callouts: Place them after the paragraph they visually relate to; prefix with > Note: or > Caution:; also mirror inside # Lists & Key Points if “pearls”.

Units & thresholds: Keep exact units (mg/kg, mmol/L). Do not convert units.

Drug names: Preserve capitalization of brand/generic as shown.

Abbreviations: On first obvious occurrence, if expansion is shown on page, include (abbr: expansion).

OUTPUT VALIDATION

Ensure valid JSON blocks (UTF-8, double quotes).

No trailing commas.

Do not wrap JSON in code fences other than the ones I asked above.

Final Output structure: your output must be sent is as a JSON in a code block with the delimiter of three consecutive semicolons like “;;;”. Each row is representative of a “page text” or “figure” or “Table”. So each “page text” and “figure” and “Table”  will have a row. The columns Headers are:
    1. Type
    2. Extraction
    3. Number
    4. Part
The “Type” column is for mentioning the type of the cell row data. The acceptable types are “page text” or “figure” or “Table”. If you are writing the page’s text in the extraction column, then the type will be “page text”. If the row in for figures, write “Figure”. And ”. If the row in for Tables, write “Table”.
The “Extraction” column is the main column for each row. If you are extracting a page’s text, write the complete text here. The JSONs of tables and figures must be written here as well.
The References in the end of the chapter must not be extracted. Ignore it.
The ”Number” column must show the page it is extracted from like 1 or 2 and more.
The “Part” column shows that the row’s content is included in which part. Use numbers like 1 or 2 and more.
How to define the parts for each row: in the beginning of the first page of the file there is a “Chapter contents” which demonstrates the parts of the chapter recommended by the author, which we call them “author parts”. I want you to make your own suggestion for dividing the parts, which we call them “Our parts”. The rules of dividing are as follows: an “our part” is consisted of as many as consecutive “author parts” without being the final “our part” more than 10 pages. For example if the “author part”s of the chapter are 2,4,5,3,1,7,5 pages respectively, the first “our part” will be consisted of the first two “author parts”. The second “our part” will be consisted of the third and fourth and fifth “author parts”. the third “our part” will be consisted of the sixth “author part”. the fourth “our part” will be consisted of the seventh “author part”.
If an “our part” ends in the middle of a page, some of the page text will be for the previous “our part” and some of the page will be for the next “our part”. The text of such pages must be written in two separate rows. One of them is related to the previous “our part” and one of them is related to next “our part”. Your goal should be avoiding a row’s content to be consisted of the data from two different “our part”s.
And for example if you decided to divide the chapter into 2 parts, you should write “1” for the contents of the first part and write “2” for the contents of the second part. 

VERY IMPORTANT: your output must be single line (minified). DO NOT EVER use the “ENTER” button inside the cells. It shouldn’t be html rich. Do not separate texts with ENTER.

You will now receive a PDF, respond in the exact structure described above.
2025-12-14 11:45:10,326 - INFO - PDF uploaded successfully with API key: bagher
2025-12-14 11:45:10,327 - INFO - Uploaded PDF file: Bolognia 5th Edition 2024 (1)-7-26-46.pdf
2025-12-14 11:45:10,328 - INFO - Model: gemini-2.5-pro, Max tokens for model: 32768, Using: 32768
2025-12-14 11:45:10,329 - INFO - Using max_output_tokens: 32768
2025-12-14 11:45:10,329 - INFO - Using model: gemini-2.5-pro
2025-12-14 11:45:10,330 - INFO - Sending prompt (length: 7390 characters)
2025-12-14 11:45:10,331 - INFO - Max output tokens: 32768
2025-12-14 11:45:10,331 - INFO - Using original prompt with JSON output instruction (prompt preserved)
2025-12-14 11:45:10,332 - INFO - Generating content with streaming enabled for complete response...
2025-12-14 11:45:11,811 - WARNING - ⚠️ API key leaked (403) or invalid. Attempting to switch to next key...
2025-12-14 11:45:11,812 - INFO - Retrying with API key 1/3: bagher
2025-12-14 11:45:27,664 - WARNING - API key bagher also leaked (403), trying next...
2025-12-14 11:45:27,664 - INFO - Retrying with API key 2/3: bagher
2025-12-14 11:45:39,526 - WARNING - API key bagher also leaked (403), trying next...
2025-12-14 11:45:39,527 - INFO - Retrying with API key 3/3: bagher
2025-12-14 11:45:42,046 - WARNING - API key bagher also leaked (403), trying next...
2025-12-14 11:45:42,047 - ERROR - ❌ All 3 API keys exhausted or failed. Cannot process request.
2025-12-14 12:07:04,356 - INFO - Loaded 6 predefined prompts
2025-12-14 12:07:32,579 - INFO - Loaded 3 API keys
2025-12-14 12:08:08,442 - INFO - === Starting PDF Processing ===
2025-12-14 12:08:08,443 - INFO - Model: gemini-2.5-flash
2025-12-14 12:08:08,443 - INFO - PDF: /home/mohammadbagher/Downloads/PDFs/Bolognia 5th Edition 2024 (1)-7-26-46.pdf
2025-12-14 12:08:08,443 - INFO - Full prompt being sent (7390 chars): You are a meticulous medical OCR & structuring assistant. Your job is to extract **only** what is present on each provided textbook page image/PDF and convert it into clean, AI-ready text with structured sections. You MUST avoid hallucinations and preserve original medical meaning precisely. Follow these global rules:

GLOBAL PRINCIPLES
- NO HALLUCINATIONS: Output only content visible on the page(s). If unreadable/unclear, write: "[UNREADABLE]" or add an "uncertain" flag with brief reason.
- LANGUAGE & SPELLING: Preserve original English spelling and medical terminology; do not normalize British↔American spelling.
- CLEAN OCR: 
  - Remove page headers/footers, running titles, folios, and footers like “©Publisher 2023”.
  - Fix broken words at line breaks (e.g., "thera-\npy" → "therapy").
  - Replace ligatures (ﬁ, ﬂ) with normal letters.
  - Preserve meaningful capitalization, italics markers (use *italic*), bold (**bold**), and inline sub/superscripts as LaTeX if clearly indicated (e.g., CO$_2$).
- CITATIONS: Keep in-text citations literally (e.g., “[12]”, “(Smith 2021)”).
- MATH/CHEM: For formulae, use inline LaTeX: e.g., `pH = -\log_{10} [H^+]`.
- NO IMAGES: Describe figures/diagrams/charts in text form—succinct but complete. Do not invent unseen labels.

STRUCTURED OUTPUT FORMAT (Markdown with embedded JSON blocks)
Always produce in this exact order:

1) `# Page Metadata`
   - Book title (if visible), chapter title (if visible), page number (if visible or inferable), section headings found.
   - Confidence notes: short bullets where uncertainty exists.

2) `# Body`
   - Clean, continuous paragraph text. Keep section/subsection headings as `##` and `###`.

3) `# Tables`
   - For each table found, output a JSON block per table with:
   ```json
   {
     "type": "table",
     "title": "Table 3.2 Disease-modifying agents",
     "note": "footnotes or legends if present",
     "columns": ["Column A", "Column B", "Column C"],
     "rows": [
       ["cell(1,1)", "cell(1,2)", "cell(1,3)"],
       ["cell(2,1)", "cell(2,2)", "cell(2,3)"]
     ],
     "uncertain_cells": [{"row":2,"col":3,"reason":"blurry"}]
   }
If a table is complex (merged cells), normalize by repeating header labels; if impossible, add "structure_note".

# Algorithms / Clinical Approaches

Convert any flowchart, algorithm box, or approach diagram into BOTH:
a) Bulleted steps (plain text):

Step 1: …

If lab X > Y → do …

Else → …
b) Machine-readable pseudo-logic JSON:

json
Copy code
{
  "type": "algorithm",
  "title": "Approach to suspected DKA",
  "nodes": [
    {"id":"start","text":"Patient with hyperglycemia"},
    {"id":"n1","text":"Check ketones"},
    {"id":"n2","text":"If ketones positive → start insulin infusion"}
  ],
  "edges": [
    {"from":"start","to":"n1"},
    {"from":"n1","to":"n2","condition":"ketones positive"}
  ]
}
Use simple IDs; preserve clinical thresholds verbatim.

# Figures / Diagrams / Charts

For each figure, write a compact textual description capturing labels, axes, and key relationships.

If a chart encodes data values, extract the visible numbers as a small table. If not given, describe trends only.

Example JSON:

json
Copy code
{
  "type": "figure",
  "title": "Figure 5.1 Cardiac cycle",
  "description": "Schematic phases (isovolumetric contraction, ejection, …); labels: LV pressure, aortic pressure… Trend: LV pressure rises during …",
  "visible_labels": ["LV", "Aorta", "Mitral"],
  "data_points": null
}
# Lists & Key Points

Convert bullet lists and numbered lists cleanly.

For “pearls”, “high-yield” callouts, prefix with **HIGH-YIELD:**.

# References / Footnotes on Page

Transcribe verbatim; if footnote markers map to table/figure, cross-reference.

# Uncertain / OCR Issues

JSON array, where each item has: location (body/table/figure), snippet (if any), reason (e.g., “scan blur”), and confidence score 0–1.

ADDITIONAL RULES FOR DIFFICULT LAYOUTS

Multi-column pages: Respect reading order left→right, top→bottom per row.

Sidebars/callouts: Place them after the paragraph they visually relate to; prefix with > Note: or > Caution:; also mirror inside # Lists & Key Points if “pearls”.

Units & thresholds: Keep exact units (mg/kg, mmol/L). Do not convert units.

Drug names: Preserve capitalization of brand/generic as shown.

Abbreviations: On first obvious occurrence, if expansion is shown on page, include (abbr: expansion).

OUTPUT VALIDATION

Ensure valid JSON blocks (UTF-8, double quotes).

No trailing commas.

Do not wrap JSON in code fences other than the ones I asked above.

Final Output structure: your output must be sent is as a JSON in a code block with the delimiter of three consecutive semicolons like “;;;”. Each row is representative of a “page text” or “figure” or “Table”. So each “page text” and “figure” and “Table”  will have a row. The columns Headers are:
    1. Type
    2. Extraction
    3. Number
    4. Part
The “Type” column is for mentioning the type of the cell row data. The acceptable types are “page text” or “figure” or “Table”. If you are writing the page’s text in the extraction column, then the type will be “page text”. If the row in for figures, write “Figure”. And ”. If the row in for Tables, write “Table”.
The “Extraction” column is the main column for each row. If you are extracting a page’s text, write the complete text here. The JSONs of tables and figures must be written here as well.
The References in the end of the chapter must not be extracted. Ignore it.
The ”Number” column must show the page it is extracted from like 1 or 2 and more.
The “Part” column shows that the row’s content is included in which part. Use numbers like 1 or 2 and more.
How to define the parts for each row: in the beginning of the first page of the file there is a “Chapter contents” which demonstrates the parts of the chapter recommended by the author, which we call them “author parts”. I want you to make your own suggestion for dividing the parts, which we call them “Our parts”. The rules of dividing are as follows: an “our part” is consisted of as many as consecutive “author parts” without being the final “our part” more than 10 pages. For example if the “author part”s of the chapter are 2,4,5,3,1,7,5 pages respectively, the first “our part” will be consisted of the first two “author parts”. The second “our part” will be consisted of the third and fourth and fifth “author parts”. the third “our part” will be consisted of the sixth “author part”. the fourth “our part” will be consisted of the seventh “author part”.
If an “our part” ends in the middle of a page, some of the page text will be for the previous “our part” and some of the page will be for the next “our part”. The text of such pages must be written in two separate rows. One of them is related to the previous “our part” and one of them is related to next “our part”. Your goal should be avoiding a row’s content to be consisted of the data from two different “our part”s.
And for example if you decided to divide the chapter into 2 parts, you should write “1” for the contents of the first part and write “2” for the contents of the second part. 

VERY IMPORTANT: your output must be single line (minified). DO NOT EVER use the “ENTER” button inside the cells. It shouldn’t be html rich. Do not separate texts with ENTER.

You will now receive a PDF, respond in the exact structure described above.
2025-12-14 12:08:17,847 - INFO - PDF uploaded successfully with API key: bagher
2025-12-14 12:08:17,847 - INFO - Uploaded PDF file: Bolognia 5th Edition 2024 (1)-7-26-46.pdf
2025-12-14 12:08:17,848 - INFO - Model: gemini-2.5-flash, Max tokens for model: 32768, Using: 32768
2025-12-14 12:08:17,848 - INFO - Using max_output_tokens: 32768
2025-12-14 12:08:17,848 - INFO - Using model: gemini-2.5-flash
2025-12-14 12:08:17,848 - INFO - Sending prompt (length: 7390 characters)
2025-12-14 12:08:17,848 - INFO - Max output tokens: 32768
2025-12-14 12:08:17,848 - INFO - Using original prompt with JSON output instruction (prompt preserved)
2025-12-14 12:08:17,848 - INFO - Generating content with streaming enabled for complete response...
2025-12-14 12:08:18,921 - WARNING - ⚠️ API key leaked (403) or invalid. Attempting to switch to next key...
2025-12-14 12:08:18,922 - INFO - Retrying with API key 1/3: bagher
2025-12-14 12:08:30,246 - WARNING - API key bagher also leaked (403), trying next...
2025-12-14 12:08:30,247 - INFO - Retrying with API key 2/3: bagher
2025-12-14 12:08:41,299 - WARNING - API key bagher also leaked (403), trying next...
2025-12-14 12:08:41,299 - INFO - Retrying with API key 3/3: bagher
2025-12-14 12:08:43,839 - WARNING - API key bagher also leaked (403), trying next...
2025-12-14 12:08:43,839 - ERROR - ❌ All 3 API keys failed. Cannot process request.
2025-12-14 12:08:43,839 - ERROR - 
2025-12-14 12:08:43,839 - ERROR - ============================================================
2025-12-14 12:08:43,839 - ERROR - API KEY ERROR - ACTION REQUIRED
2025-12-14 12:08:43,839 - ERROR - ============================================================
2025-12-14 12:08:43,840 - ERROR - 
2025-12-14 12:08:43,840 - ERROR - Possible reasons:
2025-12-14 12:08:43,840 - ERROR -   1. All API keys were reported as LEAKED (403 error)
2025-12-14 12:08:43,840 - ERROR -      → Solution: Remove leaked keys and add new valid API keys
2025-12-14 12:08:43,840 - ERROR - 
2025-12-14 12:08:43,840 - ERROR -   2. All API keys have QUOTA EXHAUSTED (429 error)
2025-12-14 12:08:43,840 - ERROR -      → Solution: Wait for quota reset or add more API keys
2025-12-14 12:08:43,840 - ERROR - 
2025-12-14 12:08:43,840 - ERROR -   3. API keys are INVALID or EXPIRED
2025-12-14 12:08:43,840 - ERROR -      → Solution: Generate new API keys from Google AI Studio
2025-12-14 12:08:43,841 - ERROR - 
2025-12-14 12:08:43,841 - ERROR - Steps to fix:
2025-12-14 12:08:43,841 - ERROR -   1. Open your API keys CSV file
2025-12-14 12:08:43,841 - ERROR -   2. Remove any leaked/invalid keys
2025-12-14 12:08:43,841 - ERROR -   3. Add new valid API keys from: https://aistudio.google.com/apikey
2025-12-14 12:08:43,841 - ERROR -   4. Save the CSV file and reload it in the application
2025-12-14 12:08:43,841 - ERROR -   5. Try processing again
2025-12-14 12:08:43,841 - ERROR - 
2025-12-14 12:08:43,841 - ERROR - ============================================================
2025-12-14 12:16:44,946 - INFO - Loaded 6 predefined prompts
2025-12-14 12:17:09,147 - ERROR - No valid API keys found in the file
2025-12-14 12:20:20,717 - ERROR - No valid API keys found in the file
2025-12-14 12:22:56,253 - INFO - Loaded 3 API keys
2025-12-14 12:23:25,727 - INFO - === Starting PDF Processing ===
2025-12-14 12:23:25,727 - INFO - Model: gemini-2.5-flash
2025-12-14 12:23:25,727 - INFO - PDF: /home/mohammadbagher/Downloads/PDFs/Bolognia 5th Edition 2024 (1)-7-26-46.pdf
2025-12-14 12:23:25,727 - INFO - Full prompt being sent (7390 chars): You are a meticulous medical OCR & structuring assistant. Your job is to extract **only** what is present on each provided textbook page image/PDF and convert it into clean, AI-ready text with structured sections. You MUST avoid hallucinations and preserve original medical meaning precisely. Follow these global rules:

GLOBAL PRINCIPLES
- NO HALLUCINATIONS: Output only content visible on the page(s). If unreadable/unclear, write: "[UNREADABLE]" or add an "uncertain" flag with brief reason.
- LANGUAGE & SPELLING: Preserve original English spelling and medical terminology; do not normalize British↔American spelling.
- CLEAN OCR: 
  - Remove page headers/footers, running titles, folios, and footers like “©Publisher 2023”.
  - Fix broken words at line breaks (e.g., "thera-\npy" → "therapy").
  - Replace ligatures (ﬁ, ﬂ) with normal letters.
  - Preserve meaningful capitalization, italics markers (use *italic*), bold (**bold**), and inline sub/superscripts as LaTeX if clearly indicated (e.g., CO$_2$).
- CITATIONS: Keep in-text citations literally (e.g., “[12]”, “(Smith 2021)”).
- MATH/CHEM: For formulae, use inline LaTeX: e.g., `pH = -\log_{10} [H^+]`.
- NO IMAGES: Describe figures/diagrams/charts in text form—succinct but complete. Do not invent unseen labels.

STRUCTURED OUTPUT FORMAT (Markdown with embedded JSON blocks)
Always produce in this exact order:

1) `# Page Metadata`
   - Book title (if visible), chapter title (if visible), page number (if visible or inferable), section headings found.
   - Confidence notes: short bullets where uncertainty exists.

2) `# Body`
   - Clean, continuous paragraph text. Keep section/subsection headings as `##` and `###`.

3) `# Tables`
   - For each table found, output a JSON block per table with:
   ```json
   {
     "type": "table",
     "title": "Table 3.2 Disease-modifying agents",
     "note": "footnotes or legends if present",
     "columns": ["Column A", "Column B", "Column C"],
     "rows": [
       ["cell(1,1)", "cell(1,2)", "cell(1,3)"],
       ["cell(2,1)", "cell(2,2)", "cell(2,3)"]
     ],
     "uncertain_cells": [{"row":2,"col":3,"reason":"blurry"}]
   }
If a table is complex (merged cells), normalize by repeating header labels; if impossible, add "structure_note".

# Algorithms / Clinical Approaches

Convert any flowchart, algorithm box, or approach diagram into BOTH:
a) Bulleted steps (plain text):

Step 1: …

If lab X > Y → do …

Else → …
b) Machine-readable pseudo-logic JSON:

json
Copy code
{
  "type": "algorithm",
  "title": "Approach to suspected DKA",
  "nodes": [
    {"id":"start","text":"Patient with hyperglycemia"},
    {"id":"n1","text":"Check ketones"},
    {"id":"n2","text":"If ketones positive → start insulin infusion"}
  ],
  "edges": [
    {"from":"start","to":"n1"},
    {"from":"n1","to":"n2","condition":"ketones positive"}
  ]
}
Use simple IDs; preserve clinical thresholds verbatim.

# Figures / Diagrams / Charts

For each figure, write a compact textual description capturing labels, axes, and key relationships.

If a chart encodes data values, extract the visible numbers as a small table. If not given, describe trends only.

Example JSON:

json
Copy code
{
  "type": "figure",
  "title": "Figure 5.1 Cardiac cycle",
  "description": "Schematic phases (isovolumetric contraction, ejection, …); labels: LV pressure, aortic pressure… Trend: LV pressure rises during …",
  "visible_labels": ["LV", "Aorta", "Mitral"],
  "data_points": null
}
# Lists & Key Points

Convert bullet lists and numbered lists cleanly.

For “pearls”, “high-yield” callouts, prefix with **HIGH-YIELD:**.

# References / Footnotes on Page

Transcribe verbatim; if footnote markers map to table/figure, cross-reference.

# Uncertain / OCR Issues

JSON array, where each item has: location (body/table/figure), snippet (if any), reason (e.g., “scan blur”), and confidence score 0–1.

ADDITIONAL RULES FOR DIFFICULT LAYOUTS

Multi-column pages: Respect reading order left→right, top→bottom per row.

Sidebars/callouts: Place them after the paragraph they visually relate to; prefix with > Note: or > Caution:; also mirror inside # Lists & Key Points if “pearls”.

Units & thresholds: Keep exact units (mg/kg, mmol/L). Do not convert units.

Drug names: Preserve capitalization of brand/generic as shown.

Abbreviations: On first obvious occurrence, if expansion is shown on page, include (abbr: expansion).

OUTPUT VALIDATION

Ensure valid JSON blocks (UTF-8, double quotes).

No trailing commas.

Do not wrap JSON in code fences other than the ones I asked above.

Final Output structure: your output must be sent is as a JSON in a code block with the delimiter of three consecutive semicolons like “;;;”. Each row is representative of a “page text” or “figure” or “Table”. So each “page text” and “figure” and “Table”  will have a row. The columns Headers are:
    1. Type
    2. Extraction
    3. Number
    4. Part
The “Type” column is for mentioning the type of the cell row data. The acceptable types are “page text” or “figure” or “Table”. If you are writing the page’s text in the extraction column, then the type will be “page text”. If the row in for figures, write “Figure”. And ”. If the row in for Tables, write “Table”.
The “Extraction” column is the main column for each row. If you are extracting a page’s text, write the complete text here. The JSONs of tables and figures must be written here as well.
The References in the end of the chapter must not be extracted. Ignore it.
The ”Number” column must show the page it is extracted from like 1 or 2 and more.
The “Part” column shows that the row’s content is included in which part. Use numbers like 1 or 2 and more.
How to define the parts for each row: in the beginning of the first page of the file there is a “Chapter contents” which demonstrates the parts of the chapter recommended by the author, which we call them “author parts”. I want you to make your own suggestion for dividing the parts, which we call them “Our parts”. The rules of dividing are as follows: an “our part” is consisted of as many as consecutive “author parts” without being the final “our part” more than 10 pages. For example if the “author part”s of the chapter are 2,4,5,3,1,7,5 pages respectively, the first “our part” will be consisted of the first two “author parts”. The second “our part” will be consisted of the third and fourth and fifth “author parts”. the third “our part” will be consisted of the sixth “author part”. the fourth “our part” will be consisted of the seventh “author part”.
If an “our part” ends in the middle of a page, some of the page text will be for the previous “our part” and some of the page will be for the next “our part”. The text of such pages must be written in two separate rows. One of them is related to the previous “our part” and one of them is related to next “our part”. Your goal should be avoiding a row’s content to be consisted of the data from two different “our part”s.
And for example if you decided to divide the chapter into 2 parts, you should write “1” for the contents of the first part and write “2” for the contents of the second part. 

VERY IMPORTANT: your output must be single line (minified). DO NOT EVER use the “ENTER” button inside the cells. It shouldn’t be html rich. Do not separate texts with ENTER.

You will now receive a PDF, respond in the exact structure described above.
2025-12-14 12:23:41,274 - INFO - PDF uploaded successfully with API key: bagher
2025-12-14 12:23:41,274 - INFO - Uploaded PDF file: Bolognia 5th Edition 2024 (1)-7-26-46.pdf
2025-12-14 12:23:41,274 - INFO - Model: gemini-2.5-flash, Max tokens for model: 32768, Using: 32768
2025-12-14 12:23:41,274 - INFO - Using max_output_tokens: 32768
2025-12-14 12:23:41,274 - INFO - Using model: gemini-2.5-flash
2025-12-14 12:23:41,275 - INFO - Sending prompt (length: 7390 characters)
2025-12-14 12:23:41,275 - INFO - Max output tokens: 32768
2025-12-14 12:23:41,275 - INFO - Using original prompt with JSON output instruction (prompt preserved)
2025-12-14 12:23:41,275 - INFO - Generating content with streaming enabled for complete response...
2025-12-14 12:25:50,613 - INFO - Streaming completed: 55 chunks, 10530 characters received
2025-12-14 12:25:50,614 - INFO - Streaming finish reason: MAX_TOKENS (truncated!)
2025-12-14 12:25:50,614 - WARNING - ⚠️ Response may be truncated (finish_reason: MAX_TOKENS (truncated!))
2025-12-14 12:25:50,614 - INFO - Response received (length: 10530 characters)
2025-12-14 12:25:50,614 - WARNING - Response might be truncated - checking for finish reason
2025-12-14 12:25:51,305 - INFO - Extracted response from response.text (10530 chars)
2025-12-14 12:25:51,306 - WARNING - Code block missing closing marker - response may be truncated
2025-12-14 12:25:51,307 - INFO - PDF processed successfully with gemini-2.5-flash
2025-12-14 12:25:51,308 - INFO - Full response length: 10530 characters
2025-12-14 12:25:51,309 - INFO - Extracted from code block: 10522 characters
2025-12-14 12:25:51,310 - INFO - Response preview (first 500 chars): [
  {
    "Type": "page text",
    "Extraction": "# Page Metadata\n- Book title: VESICULOBULLOUS DISEASES SECTION 5\n- Chapter title: Pemphigoid Group 30\n- Page number: 517\n- Section headings found: Chapter Contents, BULLOUS PEMPHIGOID, Synonym: Pemphigoid, Key features, Introduction, History, Epidemiology, Pathogenesis, Humoral and cellular responses.\n\n# Body\n## Chapter Contents\nBullous Pemphigoid...............................................517\nMucous Membrane Pemphigoid..................
2025-12-14 12:25:51,310 - INFO - Response preview (last 500 chars): ...nal pemphigoid\", \"BP180/BPAG2/collagen XVII\", \"180\", \"Hemidesmosomal plaque/anchoring filaments\"], [\"Gestational pemphigoid\", \"BP230/BPAG1e\", \"230\", \"Hemidesmosomal plaque\"], [\"Mucous membrane pemphigoid\", \"BP180/BPAG2/collagen XVII\", \"180\", \"Hemidesmosomal plaque/anchoring filaments\"], [\"Mucous membrane pemphigoid\", \"BP230/BPAG1e\\u2020\", \"230\", \"Hemidesmosomal plaque\"], [\"Mucous membrane pemphigoid\", \"Laminin 332 (laminin 5; \\u03b13\\u03b23\\u03b32; epiligrin
2025-12-14 12:25:51,311 - INFO - Returning raw response from model (no JSON extraction)
2025-12-14 12:25:51,312 - INFO - ✓ CSV response appears complete (last row has delimiter)
2025-12-14 12:26:53,078 - INFO - === Response Received ===
2025-12-14 12:26:53,078 - INFO - Response length: 10522 characters
2025-12-14 12:26:53,078 - INFO - Truncated: True
2025-12-14 12:26:53,078 - INFO - Response preview (first 500 chars): [
  {
    "Type": "page text",
    "Extraction": "# Page Metadata\n- Book title: VESICULOBULLOUS DISEASES SECTION 5\n- Chapter title: Pemphigoid Group 30\n- Page number: 517\n- Section headings found: Chapter Contents, BULLOUS PEMPHIGOID, Synonym: Pemphigoid, Key features, Introduction, History, Epidemiology, Pathogenesis, Humoral and cellular responses.\n\n# Body\n## Chapter Contents\nBullous Pemphigoid...............................................517\nMucous Membrane Pemphigoid..................
2025-12-14 12:26:53,078 - INFO - Response preview (last 500 chars): ...nal pemphigoid\", \"BP180/BPAG2/collagen XVII\", \"180\", \"Hemidesmosomal plaque/anchoring filaments\"], [\"Gestational pemphigoid\", \"BP230/BPAG1e\", \"230\", \"Hemidesmosomal plaque\"], [\"Mucous membrane pemphigoid\", \"BP180/BPAG2/collagen XVII\", \"180\", \"Hemidesmosomal plaque/anchoring filaments\"], [\"Mucous membrane pemphigoid\", \"BP230/BPAG1e\\u2020\", \"230\", \"Hemidesmosomal plaque\"], [\"Mucous membrane pemphigoid\", \"Laminin 332 (laminin 5; \\u03b13\\u03b23\\u03b32; epiligrin
2025-12-14 12:26:53,467 - WARNING - python-docx not available, saving as text file
2025-12-14 12:26:53,475 - INFO - Response displayed and saved to: /home/mohammadbagher/Downloads/PDFs/Bolognia 5th Edition 2024 (1)-7-26-46_response_20251214_122653.txt
2025-12-14 12:27:04,439 - INFO - === Starting PDF Processing ===
2025-12-14 12:27:04,439 - INFO - Model: gemini-2.5-pro
2025-12-14 12:27:04,439 - INFO - PDF: /home/mohammadbagher/Downloads/PDFs/Bolognia 5th Edition 2024 (1)-7-26-46.pdf
2025-12-14 12:27:04,439 - INFO - Full prompt being sent (7390 chars): You are a meticulous medical OCR & structuring assistant. Your job is to extract **only** what is present on each provided textbook page image/PDF and convert it into clean, AI-ready text with structured sections. You MUST avoid hallucinations and preserve original medical meaning precisely. Follow these global rules:

GLOBAL PRINCIPLES
- NO HALLUCINATIONS: Output only content visible on the page(s). If unreadable/unclear, write: "[UNREADABLE]" or add an "uncertain" flag with brief reason.
- LANGUAGE & SPELLING: Preserve original English spelling and medical terminology; do not normalize British↔American spelling.
- CLEAN OCR: 
  - Remove page headers/footers, running titles, folios, and footers like “©Publisher 2023”.
  - Fix broken words at line breaks (e.g., "thera-\npy" → "therapy").
  - Replace ligatures (ﬁ, ﬂ) with normal letters.
  - Preserve meaningful capitalization, italics markers (use *italic*), bold (**bold**), and inline sub/superscripts as LaTeX if clearly indicated (e.g., CO$_2$).
- CITATIONS: Keep in-text citations literally (e.g., “[12]”, “(Smith 2021)”).
- MATH/CHEM: For formulae, use inline LaTeX: e.g., `pH = -\log_{10} [H^+]`.
- NO IMAGES: Describe figures/diagrams/charts in text form—succinct but complete. Do not invent unseen labels.

STRUCTURED OUTPUT FORMAT (Markdown with embedded JSON blocks)
Always produce in this exact order:

1) `# Page Metadata`
   - Book title (if visible), chapter title (if visible), page number (if visible or inferable), section headings found.
   - Confidence notes: short bullets where uncertainty exists.

2) `# Body`
   - Clean, continuous paragraph text. Keep section/subsection headings as `##` and `###`.

3) `# Tables`
   - For each table found, output a JSON block per table with:
   ```json
   {
     "type": "table",
     "title": "Table 3.2 Disease-modifying agents",
     "note": "footnotes or legends if present",
     "columns": ["Column A", "Column B", "Column C"],
     "rows": [
       ["cell(1,1)", "cell(1,2)", "cell(1,3)"],
       ["cell(2,1)", "cell(2,2)", "cell(2,3)"]
     ],
     "uncertain_cells": [{"row":2,"col":3,"reason":"blurry"}]
   }
If a table is complex (merged cells), normalize by repeating header labels; if impossible, add "structure_note".

# Algorithms / Clinical Approaches

Convert any flowchart, algorithm box, or approach diagram into BOTH:
a) Bulleted steps (plain text):

Step 1: …

If lab X > Y → do …

Else → …
b) Machine-readable pseudo-logic JSON:

json
Copy code
{
  "type": "algorithm",
  "title": "Approach to suspected DKA",
  "nodes": [
    {"id":"start","text":"Patient with hyperglycemia"},
    {"id":"n1","text":"Check ketones"},
    {"id":"n2","text":"If ketones positive → start insulin infusion"}
  ],
  "edges": [
    {"from":"start","to":"n1"},
    {"from":"n1","to":"n2","condition":"ketones positive"}
  ]
}
Use simple IDs; preserve clinical thresholds verbatim.

# Figures / Diagrams / Charts

For each figure, write a compact textual description capturing labels, axes, and key relationships.

If a chart encodes data values, extract the visible numbers as a small table. If not given, describe trends only.

Example JSON:

json
Copy code
{
  "type": "figure",
  "title": "Figure 5.1 Cardiac cycle",
  "description": "Schematic phases (isovolumetric contraction, ejection, …); labels: LV pressure, aortic pressure… Trend: LV pressure rises during …",
  "visible_labels": ["LV", "Aorta", "Mitral"],
  "data_points": null
}
# Lists & Key Points

Convert bullet lists and numbered lists cleanly.

For “pearls”, “high-yield” callouts, prefix with **HIGH-YIELD:**.

# References / Footnotes on Page

Transcribe verbatim; if footnote markers map to table/figure, cross-reference.

# Uncertain / OCR Issues

JSON array, where each item has: location (body/table/figure), snippet (if any), reason (e.g., “scan blur”), and confidence score 0–1.

ADDITIONAL RULES FOR DIFFICULT LAYOUTS

Multi-column pages: Respect reading order left→right, top→bottom per row.

Sidebars/callouts: Place them after the paragraph they visually relate to; prefix with > Note: or > Caution:; also mirror inside # Lists & Key Points if “pearls”.

Units & thresholds: Keep exact units (mg/kg, mmol/L). Do not convert units.

Drug names: Preserve capitalization of brand/generic as shown.

Abbreviations: On first obvious occurrence, if expansion is shown on page, include (abbr: expansion).

OUTPUT VALIDATION

Ensure valid JSON blocks (UTF-8, double quotes).

No trailing commas.

Do not wrap JSON in code fences other than the ones I asked above.

Final Output structure: your output must be sent is as a JSON in a code block with the delimiter of three consecutive semicolons like “;;;”. Each row is representative of a “page text” or “figure” or “Table”. So each “page text” and “figure” and “Table”  will have a row. The columns Headers are:
    1. Type
    2. Extraction
    3. Number
    4. Part
The “Type” column is for mentioning the type of the cell row data. The acceptable types are “page text” or “figure” or “Table”. If you are writing the page’s text in the extraction column, then the type will be “page text”. If the row in for figures, write “Figure”. And ”. If the row in for Tables, write “Table”.
The “Extraction” column is the main column for each row. If you are extracting a page’s text, write the complete text here. The JSONs of tables and figures must be written here as well.
The References in the end of the chapter must not be extracted. Ignore it.
The ”Number” column must show the page it is extracted from like 1 or 2 and more.
The “Part” column shows that the row’s content is included in which part. Use numbers like 1 or 2 and more.
How to define the parts for each row: in the beginning of the first page of the file there is a “Chapter contents” which demonstrates the parts of the chapter recommended by the author, which we call them “author parts”. I want you to make your own suggestion for dividing the parts, which we call them “Our parts”. The rules of dividing are as follows: an “our part” is consisted of as many as consecutive “author parts” without being the final “our part” more than 10 pages. For example if the “author part”s of the chapter are 2,4,5,3,1,7,5 pages respectively, the first “our part” will be consisted of the first two “author parts”. The second “our part” will be consisted of the third and fourth and fifth “author parts”. the third “our part” will be consisted of the sixth “author part”. the fourth “our part” will be consisted of the seventh “author part”.
If an “our part” ends in the middle of a page, some of the page text will be for the previous “our part” and some of the page will be for the next “our part”. The text of such pages must be written in two separate rows. One of them is related to the previous “our part” and one of them is related to next “our part”. Your goal should be avoiding a row’s content to be consisted of the data from two different “our part”s.
And for example if you decided to divide the chapter into 2 parts, you should write “1” for the contents of the first part and write “2” for the contents of the second part. 

VERY IMPORTANT: your output must be single line (minified). DO NOT EVER use the “ENTER” button inside the cells. It shouldn’t be html rich. Do not separate texts with ENTER.

You will now receive a PDF, respond in the exact structure described above.
2025-12-14 12:27:12,570 - INFO - PDF uploaded successfully with API key: bagher
2025-12-14 12:27:12,571 - INFO - Uploaded PDF file: Bolognia 5th Edition 2024 (1)-7-26-46.pdf
2025-12-14 12:27:12,571 - INFO - Model: gemini-2.5-pro, Max tokens for model: 32768, Using: 32768
2025-12-14 12:27:12,571 - INFO - Using max_output_tokens: 32768
2025-12-14 12:27:12,571 - INFO - Using model: gemini-2.5-pro
2025-12-14 12:27:12,571 - INFO - Sending prompt (length: 7390 characters)
2025-12-14 12:27:12,571 - INFO - Max output tokens: 32768
2025-12-14 12:27:12,571 - INFO - Using original prompt with JSON output instruction (prompt preserved)
2025-12-14 12:27:12,571 - INFO - Generating content with streaming enabled for complete response...
2025-12-14 12:27:13,874 - WARNING - ⚠️ Quota exhausted (429) with current API key. Attempting to switch to next key...
2025-12-14 12:27:13,874 - INFO - Retrying with API key 1/3: bagher
2025-12-14 12:27:23,573 - WARNING - API key bagher also exhausted, trying next...
2025-12-14 12:27:23,573 - INFO - Retrying with API key 2/3: bagher
2025-12-14 12:27:33,970 - WARNING - API key bagher also exhausted, trying next...
2025-12-14 12:27:33,970 - INFO - Retrying with API key 3/3: bagher
2025-12-14 12:27:36,775 - WARNING - API key bagher also exhausted, trying next...
2025-12-14 12:27:36,775 - ERROR - ❌ All 3 API keys failed. Cannot process request.
2025-12-14 12:27:36,776 - ERROR - 
2025-12-14 12:27:36,776 - ERROR - ============================================================
2025-12-14 12:27:36,776 - ERROR - API KEY ERROR - ACTION REQUIRED
2025-12-14 12:27:36,776 - ERROR - ============================================================
2025-12-14 12:27:36,776 - ERROR - 
2025-12-14 12:27:36,776 - ERROR - Possible reasons:
2025-12-14 12:27:36,776 - ERROR -   1. All API keys were reported as LEAKED (403 error)
2025-12-14 12:27:36,776 - ERROR -      → Solution: Remove leaked keys and add new valid API keys
2025-12-14 12:27:36,776 - ERROR - 
2025-12-14 12:27:36,776 - ERROR -   2. All API keys have QUOTA EXHAUSTED (429 error)
2025-12-14 12:27:36,776 - ERROR -      → Solution: Wait for quota reset or add more API keys
2025-12-14 12:27:36,777 - ERROR - 
2025-12-14 12:27:36,778 - ERROR -   3. API keys are INVALID or EXPIRED
2025-12-14 12:27:36,778 - ERROR -      → Solution: Generate new API keys from Google AI Studio
2025-12-14 12:27:36,778 - ERROR - 
2025-12-14 12:27:36,778 - ERROR - Steps to fix:
2025-12-14 12:27:36,779 - ERROR -   1. Open your API keys CSV file
2025-12-14 12:27:36,779 - ERROR -   2. Remove any leaked/invalid keys
2025-12-14 12:27:36,779 - ERROR -   3. Add new valid API keys from: https://aistudio.google.com/apikey
2025-12-14 12:27:36,779 - ERROR -   4. Save the CSV file and reload it in the application
2025-12-14 12:27:36,779 - ERROR -   5. Try processing again
2025-12-14 12:27:36,779 - ERROR - 
2025-12-14 12:27:36,779 - ERROR - ============================================================
2025-12-14 12:33:16,988 - INFO - Loaded 6 predefined prompts
2025-12-14 12:33:46,312 - ERROR - No valid API keys found in the file
2025-12-14 12:33:54,448 - INFO - Loaded 3 API keys
2025-12-14 12:34:26,344 - INFO - === Starting PDF Processing ===
2025-12-14 12:34:26,345 - INFO - Model: gemini-2.5-pro
2025-12-14 12:34:26,345 - INFO - PDF: /home/mohammadbagher/Downloads/PDFs/Bolognia 5th Edition 2024 (1)-7-26-46.pdf
2025-12-14 12:34:26,345 - INFO - Full prompt being sent (7390 chars): You are a meticulous medical OCR & structuring assistant. Your job is to extract **only** what is present on each provided textbook page image/PDF and convert it into clean, AI-ready text with structured sections. You MUST avoid hallucinations and preserve original medical meaning precisely. Follow these global rules:

GLOBAL PRINCIPLES
- NO HALLUCINATIONS: Output only content visible on the page(s). If unreadable/unclear, write: "[UNREADABLE]" or add an "uncertain" flag with brief reason.
- LANGUAGE & SPELLING: Preserve original English spelling and medical terminology; do not normalize British↔American spelling.
- CLEAN OCR: 
  - Remove page headers/footers, running titles, folios, and footers like “©Publisher 2023”.
  - Fix broken words at line breaks (e.g., "thera-\npy" → "therapy").
  - Replace ligatures (ﬁ, ﬂ) with normal letters.
  - Preserve meaningful capitalization, italics markers (use *italic*), bold (**bold**), and inline sub/superscripts as LaTeX if clearly indicated (e.g., CO$_2$).
- CITATIONS: Keep in-text citations literally (e.g., “[12]”, “(Smith 2021)”).
- MATH/CHEM: For formulae, use inline LaTeX: e.g., `pH = -\log_{10} [H^+]`.
- NO IMAGES: Describe figures/diagrams/charts in text form—succinct but complete. Do not invent unseen labels.

STRUCTURED OUTPUT FORMAT (Markdown with embedded JSON blocks)
Always produce in this exact order:

1) `# Page Metadata`
   - Book title (if visible), chapter title (if visible), page number (if visible or inferable), section headings found.
   - Confidence notes: short bullets where uncertainty exists.

2) `# Body`
   - Clean, continuous paragraph text. Keep section/subsection headings as `##` and `###`.

3) `# Tables`
   - For each table found, output a JSON block per table with:
   ```json
   {
     "type": "table",
     "title": "Table 3.2 Disease-modifying agents",
     "note": "footnotes or legends if present",
     "columns": ["Column A", "Column B", "Column C"],
     "rows": [
       ["cell(1,1)", "cell(1,2)", "cell(1,3)"],
       ["cell(2,1)", "cell(2,2)", "cell(2,3)"]
     ],
     "uncertain_cells": [{"row":2,"col":3,"reason":"blurry"}]
   }
If a table is complex (merged cells), normalize by repeating header labels; if impossible, add "structure_note".

# Algorithms / Clinical Approaches

Convert any flowchart, algorithm box, or approach diagram into BOTH:
a) Bulleted steps (plain text):

Step 1: …

If lab X > Y → do …

Else → …
b) Machine-readable pseudo-logic JSON:

json
Copy code
{
  "type": "algorithm",
  "title": "Approach to suspected DKA",
  "nodes": [
    {"id":"start","text":"Patient with hyperglycemia"},
    {"id":"n1","text":"Check ketones"},
    {"id":"n2","text":"If ketones positive → start insulin infusion"}
  ],
  "edges": [
    {"from":"start","to":"n1"},
    {"from":"n1","to":"n2","condition":"ketones positive"}
  ]
}
Use simple IDs; preserve clinical thresholds verbatim.

# Figures / Diagrams / Charts

For each figure, write a compact textual description capturing labels, axes, and key relationships.

If a chart encodes data values, extract the visible numbers as a small table. If not given, describe trends only.

Example JSON:

json
Copy code
{
  "type": "figure",
  "title": "Figure 5.1 Cardiac cycle",
  "description": "Schematic phases (isovolumetric contraction, ejection, …); labels: LV pressure, aortic pressure… Trend: LV pressure rises during …",
  "visible_labels": ["LV", "Aorta", "Mitral"],
  "data_points": null
}
# Lists & Key Points

Convert bullet lists and numbered lists cleanly.

For “pearls”, “high-yield” callouts, prefix with **HIGH-YIELD:**.

# References / Footnotes on Page

Transcribe verbatim; if footnote markers map to table/figure, cross-reference.

# Uncertain / OCR Issues

JSON array, where each item has: location (body/table/figure), snippet (if any), reason (e.g., “scan blur”), and confidence score 0–1.

ADDITIONAL RULES FOR DIFFICULT LAYOUTS

Multi-column pages: Respect reading order left→right, top→bottom per row.

Sidebars/callouts: Place them after the paragraph they visually relate to; prefix with > Note: or > Caution:; also mirror inside # Lists & Key Points if “pearls”.

Units & thresholds: Keep exact units (mg/kg, mmol/L). Do not convert units.

Drug names: Preserve capitalization of brand/generic as shown.

Abbreviations: On first obvious occurrence, if expansion is shown on page, include (abbr: expansion).

OUTPUT VALIDATION

Ensure valid JSON blocks (UTF-8, double quotes).

No trailing commas.

Do not wrap JSON in code fences other than the ones I asked above.

Final Output structure: your output must be sent is as a JSON in a code block with the delimiter of three consecutive semicolons like “;;;”. Each row is representative of a “page text” or “figure” or “Table”. So each “page text” and “figure” and “Table”  will have a row. The columns Headers are:
    1. Type
    2. Extraction
    3. Number
    4. Part
The “Type” column is for mentioning the type of the cell row data. The acceptable types are “page text” or “figure” or “Table”. If you are writing the page’s text in the extraction column, then the type will be “page text”. If the row in for figures, write “Figure”. And ”. If the row in for Tables, write “Table”.
The “Extraction” column is the main column for each row. If you are extracting a page’s text, write the complete text here. The JSONs of tables and figures must be written here as well.
The References in the end of the chapter must not be extracted. Ignore it.
The ”Number” column must show the page it is extracted from like 1 or 2 and more.
The “Part” column shows that the row’s content is included in which part. Use numbers like 1 or 2 and more.
How to define the parts for each row: in the beginning of the first page of the file there is a “Chapter contents” which demonstrates the parts of the chapter recommended by the author, which we call them “author parts”. I want you to make your own suggestion for dividing the parts, which we call them “Our parts”. The rules of dividing are as follows: an “our part” is consisted of as many as consecutive “author parts” without being the final “our part” more than 10 pages. For example if the “author part”s of the chapter are 2,4,5,3,1,7,5 pages respectively, the first “our part” will be consisted of the first two “author parts”. The second “our part” will be consisted of the third and fourth and fifth “author parts”. the third “our part” will be consisted of the sixth “author part”. the fourth “our part” will be consisted of the seventh “author part”.
If an “our part” ends in the middle of a page, some of the page text will be for the previous “our part” and some of the page will be for the next “our part”. The text of such pages must be written in two separate rows. One of them is related to the previous “our part” and one of them is related to next “our part”. Your goal should be avoiding a row’s content to be consisted of the data from two different “our part”s.
And for example if you decided to divide the chapter into 2 parts, you should write “1” for the contents of the first part and write “2” for the contents of the second part. 

VERY IMPORTANT: your output must be single line (minified). DO NOT EVER use the “ENTER” button inside the cells. It shouldn’t be html rich. Do not separate texts with ENTER.

You will now receive a PDF, respond in the exact structure described above.
2025-12-14 12:34:34,686 - INFO - PDF uploaded successfully with API key: bagher
2025-12-14 12:34:34,687 - INFO - Uploaded PDF file: Bolognia 5th Edition 2024 (1)-7-26-46.pdf
2025-12-14 12:34:34,687 - INFO - Model: gemini-2.5-pro, Max tokens for model: 32768, Using: 32768
2025-12-14 12:34:34,687 - INFO - Using max_output_tokens: 32768
2025-12-14 12:34:34,687 - INFO - Using model: gemini-2.5-pro
2025-12-14 12:34:34,687 - INFO - Sending prompt (length: 7390 characters)
2025-12-14 12:34:34,687 - INFO - Max output tokens: 32768
2025-12-14 12:34:34,687 - INFO - Using original prompt with JSON output instruction (prompt preserved)
2025-12-14 12:34:34,687 - INFO - Generating content with streaming enabled for complete response...
2025-12-14 12:34:35,967 - WARNING - ⚠️ Quota exhausted (429) with current API key. Attempting to switch to next key...
2025-12-14 12:34:35,967 - INFO - Retrying with API key 1/3: bagher
2025-12-14 12:34:44,918 - WARNING - API key bagher also exhausted, trying next...
2025-12-14 12:34:44,918 - INFO - Retrying with API key 2/3: bagher
2025-12-14 12:34:54,747 - WARNING - API key bagher also exhausted, trying next...
2025-12-14 12:34:54,747 - INFO - Retrying with API key 3/3: bagher
2025-12-14 12:34:57,112 - WARNING - API key bagher also exhausted, trying next...
2025-12-14 12:34:57,113 - ERROR - ======================================================================
2025-12-14 12:34:57,113 - ERROR - ❌ All 3 API keys failed. Cannot process request.
2025-12-14 12:34:57,113 - ERROR - ======================================================================
2025-12-14 12:34:57,113 - ERROR - 
2025-12-14 12:34:57,113 - ERROR - Possible reasons:
2025-12-14 12:34:57,113 - ERROR -   • All keys LEAKED (403) → Remove leaked keys, add new ones
2025-12-14 12:34:57,113 - ERROR -   • All keys QUOTA EXHAUSTED (429) → Wait for reset or add more keys
2025-12-14 12:34:57,114 - ERROR -   • Keys INVALID/EXPIRED → Generate new keys from Google AI Studio
2025-12-14 12:34:57,114 - ERROR - 
2025-12-14 12:34:57,114 - ERROR - Quick fix:
2025-12-14 12:34:57,114 - ERROR -   1. Open API keys CSV file
2025-12-14 12:34:57,114 - ERROR -   2. Remove leaked/invalid keys
2025-12-14 12:34:57,115 - ERROR -   3. Add new keys from: https://aistudio.google.com/apikey
2025-12-14 12:34:57,115 - ERROR -   4. Save CSV and reload in application
2025-12-14 12:34:57,115 - ERROR -   5. Try again
2025-12-14 12:34:57,115 - ERROR - 
2025-12-14 12:34:57,115 - ERROR - ======================================================================
2025-12-14 12:40:08,769 - ERROR - No valid API keys found in the file
2025-12-14 12:41:25,220 - INFO - Loaded 2 API keys
2025-12-14 12:41:30,767 - INFO - === Starting PDF Processing ===
2025-12-14 12:41:30,768 - INFO - Model: gemini-2.5-pro
2025-12-14 12:41:30,768 - INFO - PDF: /home/mohammadbagher/Downloads/PDFs/Bolognia 5th Edition 2024 (1)-7-26-46.pdf
2025-12-14 12:41:30,768 - INFO - Full prompt being sent (7390 chars): You are a meticulous medical OCR & structuring assistant. Your job is to extract **only** what is present on each provided textbook page image/PDF and convert it into clean, AI-ready text with structured sections. You MUST avoid hallucinations and preserve original medical meaning precisely. Follow these global rules:

GLOBAL PRINCIPLES
- NO HALLUCINATIONS: Output only content visible on the page(s). If unreadable/unclear, write: "[UNREADABLE]" or add an "uncertain" flag with brief reason.
- LANGUAGE & SPELLING: Preserve original English spelling and medical terminology; do not normalize British↔American spelling.
- CLEAN OCR: 
  - Remove page headers/footers, running titles, folios, and footers like “©Publisher 2023”.
  - Fix broken words at line breaks (e.g., "thera-\npy" → "therapy").
  - Replace ligatures (ﬁ, ﬂ) with normal letters.
  - Preserve meaningful capitalization, italics markers (use *italic*), bold (**bold**), and inline sub/superscripts as LaTeX if clearly indicated (e.g., CO$_2$).
- CITATIONS: Keep in-text citations literally (e.g., “[12]”, “(Smith 2021)”).
- MATH/CHEM: For formulae, use inline LaTeX: e.g., `pH = -\log_{10} [H^+]`.
- NO IMAGES: Describe figures/diagrams/charts in text form—succinct but complete. Do not invent unseen labels.

STRUCTURED OUTPUT FORMAT (Markdown with embedded JSON blocks)
Always produce in this exact order:

1) `# Page Metadata`
   - Book title (if visible), chapter title (if visible), page number (if visible or inferable), section headings found.
   - Confidence notes: short bullets where uncertainty exists.

2) `# Body`
   - Clean, continuous paragraph text. Keep section/subsection headings as `##` and `###`.

3) `# Tables`
   - For each table found, output a JSON block per table with:
   ```json
   {
     "type": "table",
     "title": "Table 3.2 Disease-modifying agents",
     "note": "footnotes or legends if present",
     "columns": ["Column A", "Column B", "Column C"],
     "rows": [
       ["cell(1,1)", "cell(1,2)", "cell(1,3)"],
       ["cell(2,1)", "cell(2,2)", "cell(2,3)"]
     ],
     "uncertain_cells": [{"row":2,"col":3,"reason":"blurry"}]
   }
If a table is complex (merged cells), normalize by repeating header labels; if impossible, add "structure_note".

# Algorithms / Clinical Approaches

Convert any flowchart, algorithm box, or approach diagram into BOTH:
a) Bulleted steps (plain text):

Step 1: …

If lab X > Y → do …

Else → …
b) Machine-readable pseudo-logic JSON:

json
Copy code
{
  "type": "algorithm",
  "title": "Approach to suspected DKA",
  "nodes": [
    {"id":"start","text":"Patient with hyperglycemia"},
    {"id":"n1","text":"Check ketones"},
    {"id":"n2","text":"If ketones positive → start insulin infusion"}
  ],
  "edges": [
    {"from":"start","to":"n1"},
    {"from":"n1","to":"n2","condition":"ketones positive"}
  ]
}
Use simple IDs; preserve clinical thresholds verbatim.

# Figures / Diagrams / Charts

For each figure, write a compact textual description capturing labels, axes, and key relationships.

If a chart encodes data values, extract the visible numbers as a small table. If not given, describe trends only.

Example JSON:

json
Copy code
{
  "type": "figure",
  "title": "Figure 5.1 Cardiac cycle",
  "description": "Schematic phases (isovolumetric contraction, ejection, …); labels: LV pressure, aortic pressure… Trend: LV pressure rises during …",
  "visible_labels": ["LV", "Aorta", "Mitral"],
  "data_points": null
}
# Lists & Key Points

Convert bullet lists and numbered lists cleanly.

For “pearls”, “high-yield” callouts, prefix with **HIGH-YIELD:**.

# References / Footnotes on Page

Transcribe verbatim; if footnote markers map to table/figure, cross-reference.

# Uncertain / OCR Issues

JSON array, where each item has: location (body/table/figure), snippet (if any), reason (e.g., “scan blur”), and confidence score 0–1.

ADDITIONAL RULES FOR DIFFICULT LAYOUTS

Multi-column pages: Respect reading order left→right, top→bottom per row.

Sidebars/callouts: Place them after the paragraph they visually relate to; prefix with > Note: or > Caution:; also mirror inside # Lists & Key Points if “pearls”.

Units & thresholds: Keep exact units (mg/kg, mmol/L). Do not convert units.

Drug names: Preserve capitalization of brand/generic as shown.

Abbreviations: On first obvious occurrence, if expansion is shown on page, include (abbr: expansion).

OUTPUT VALIDATION

Ensure valid JSON blocks (UTF-8, double quotes).

No trailing commas.

Do not wrap JSON in code fences other than the ones I asked above.

Final Output structure: your output must be sent is as a JSON in a code block with the delimiter of three consecutive semicolons like “;;;”. Each row is representative of a “page text” or “figure” or “Table”. So each “page text” and “figure” and “Table”  will have a row. The columns Headers are:
    1. Type
    2. Extraction
    3. Number
    4. Part
The “Type” column is for mentioning the type of the cell row data. The acceptable types are “page text” or “figure” or “Table”. If you are writing the page’s text in the extraction column, then the type will be “page text”. If the row in for figures, write “Figure”. And ”. If the row in for Tables, write “Table”.
The “Extraction” column is the main column for each row. If you are extracting a page’s text, write the complete text here. The JSONs of tables and figures must be written here as well.
The References in the end of the chapter must not be extracted. Ignore it.
The ”Number” column must show the page it is extracted from like 1 or 2 and more.
The “Part” column shows that the row’s content is included in which part. Use numbers like 1 or 2 and more.
How to define the parts for each row: in the beginning of the first page of the file there is a “Chapter contents” which demonstrates the parts of the chapter recommended by the author, which we call them “author parts”. I want you to make your own suggestion for dividing the parts, which we call them “Our parts”. The rules of dividing are as follows: an “our part” is consisted of as many as consecutive “author parts” without being the final “our part” more than 10 pages. For example if the “author part”s of the chapter are 2,4,5,3,1,7,5 pages respectively, the first “our part” will be consisted of the first two “author parts”. The second “our part” will be consisted of the third and fourth and fifth “author parts”. the third “our part” will be consisted of the sixth “author part”. the fourth “our part” will be consisted of the seventh “author part”.
If an “our part” ends in the middle of a page, some of the page text will be for the previous “our part” and some of the page will be for the next “our part”. The text of such pages must be written in two separate rows. One of them is related to the previous “our part” and one of them is related to next “our part”. Your goal should be avoiding a row’s content to be consisted of the data from two different “our part”s.
And for example if you decided to divide the chapter into 2 parts, you should write “1” for the contents of the first part and write “2” for the contents of the second part. 

VERY IMPORTANT: your output must be single line (minified). DO NOT EVER use the “ENTER” button inside the cells. It shouldn’t be html rich. Do not separate texts with ENTER.

You will now receive a PDF, respond in the exact structure described above.
2025-12-14 12:41:30,769 - ERROR - PDF processing failed: list index out of range
2025-12-14 12:41:36,830 - INFO - === Starting PDF Processing ===
2025-12-14 12:41:36,830 - INFO - Model: gemini-2.5-pro
2025-12-14 12:41:36,830 - INFO - PDF: /home/mohammadbagher/Downloads/PDFs/Bolognia 5th Edition 2024 (1)-7-26-46.pdf
2025-12-14 12:41:36,831 - INFO - Full prompt being sent (7390 chars): You are a meticulous medical OCR & structuring assistant. Your job is to extract **only** what is present on each provided textbook page image/PDF and convert it into clean, AI-ready text with structured sections. You MUST avoid hallucinations and preserve original medical meaning precisely. Follow these global rules:

GLOBAL PRINCIPLES
- NO HALLUCINATIONS: Output only content visible on the page(s). If unreadable/unclear, write: "[UNREADABLE]" or add an "uncertain" flag with brief reason.
- LANGUAGE & SPELLING: Preserve original English spelling and medical terminology; do not normalize British↔American spelling.
- CLEAN OCR: 
  - Remove page headers/footers, running titles, folios, and footers like “©Publisher 2023”.
  - Fix broken words at line breaks (e.g., "thera-\npy" → "therapy").
  - Replace ligatures (ﬁ, ﬂ) with normal letters.
  - Preserve meaningful capitalization, italics markers (use *italic*), bold (**bold**), and inline sub/superscripts as LaTeX if clearly indicated (e.g., CO$_2$).
- CITATIONS: Keep in-text citations literally (e.g., “[12]”, “(Smith 2021)”).
- MATH/CHEM: For formulae, use inline LaTeX: e.g., `pH = -\log_{10} [H^+]`.
- NO IMAGES: Describe figures/diagrams/charts in text form—succinct but complete. Do not invent unseen labels.

STRUCTURED OUTPUT FORMAT (Markdown with embedded JSON blocks)
Always produce in this exact order:

1) `# Page Metadata`
   - Book title (if visible), chapter title (if visible), page number (if visible or inferable), section headings found.
   - Confidence notes: short bullets where uncertainty exists.

2) `# Body`
   - Clean, continuous paragraph text. Keep section/subsection headings as `##` and `###`.

3) `# Tables`
   - For each table found, output a JSON block per table with:
   ```json
   {
     "type": "table",
     "title": "Table 3.2 Disease-modifying agents",
     "note": "footnotes or legends if present",
     "columns": ["Column A", "Column B", "Column C"],
     "rows": [
       ["cell(1,1)", "cell(1,2)", "cell(1,3)"],
       ["cell(2,1)", "cell(2,2)", "cell(2,3)"]
     ],
     "uncertain_cells": [{"row":2,"col":3,"reason":"blurry"}]
   }
If a table is complex (merged cells), normalize by repeating header labels; if impossible, add "structure_note".

# Algorithms / Clinical Approaches

Convert any flowchart, algorithm box, or approach diagram into BOTH:
a) Bulleted steps (plain text):

Step 1: …

If lab X > Y → do …

Else → …
b) Machine-readable pseudo-logic JSON:

json
Copy code
{
  "type": "algorithm",
  "title": "Approach to suspected DKA",
  "nodes": [
    {"id":"start","text":"Patient with hyperglycemia"},
    {"id":"n1","text":"Check ketones"},
    {"id":"n2","text":"If ketones positive → start insulin infusion"}
  ],
  "edges": [
    {"from":"start","to":"n1"},
    {"from":"n1","to":"n2","condition":"ketones positive"}
  ]
}
Use simple IDs; preserve clinical thresholds verbatim.

# Figures / Diagrams / Charts

For each figure, write a compact textual description capturing labels, axes, and key relationships.

If a chart encodes data values, extract the visible numbers as a small table. If not given, describe trends only.

Example JSON:

json
Copy code
{
  "type": "figure",
  "title": "Figure 5.1 Cardiac cycle",
  "description": "Schematic phases (isovolumetric contraction, ejection, …); labels: LV pressure, aortic pressure… Trend: LV pressure rises during …",
  "visible_labels": ["LV", "Aorta", "Mitral"],
  "data_points": null
}
# Lists & Key Points

Convert bullet lists and numbered lists cleanly.

For “pearls”, “high-yield” callouts, prefix with **HIGH-YIELD:**.

# References / Footnotes on Page

Transcribe verbatim; if footnote markers map to table/figure, cross-reference.

# Uncertain / OCR Issues

JSON array, where each item has: location (body/table/figure), snippet (if any), reason (e.g., “scan blur”), and confidence score 0–1.

ADDITIONAL RULES FOR DIFFICULT LAYOUTS

Multi-column pages: Respect reading order left→right, top→bottom per row.

Sidebars/callouts: Place them after the paragraph they visually relate to; prefix with > Note: or > Caution:; also mirror inside # Lists & Key Points if “pearls”.

Units & thresholds: Keep exact units (mg/kg, mmol/L). Do not convert units.

Drug names: Preserve capitalization of brand/generic as shown.

Abbreviations: On first obvious occurrence, if expansion is shown on page, include (abbr: expansion).

OUTPUT VALIDATION

Ensure valid JSON blocks (UTF-8, double quotes).

No trailing commas.

Do not wrap JSON in code fences other than the ones I asked above.

Final Output structure: your output must be sent is as a JSON in a code block with the delimiter of three consecutive semicolons like “;;;”. Each row is representative of a “page text” or “figure” or “Table”. So each “page text” and “figure” and “Table”  will have a row. The columns Headers are:
    1. Type
    2. Extraction
    3. Number
    4. Part
The “Type” column is for mentioning the type of the cell row data. The acceptable types are “page text” or “figure” or “Table”. If you are writing the page’s text in the extraction column, then the type will be “page text”. If the row in for figures, write “Figure”. And ”. If the row in for Tables, write “Table”.
The “Extraction” column is the main column for each row. If you are extracting a page’s text, write the complete text here. The JSONs of tables and figures must be written here as well.
The References in the end of the chapter must not be extracted. Ignore it.
The ”Number” column must show the page it is extracted from like 1 or 2 and more.
The “Part” column shows that the row’s content is included in which part. Use numbers like 1 or 2 and more.
How to define the parts for each row: in the beginning of the first page of the file there is a “Chapter contents” which demonstrates the parts of the chapter recommended by the author, which we call them “author parts”. I want you to make your own suggestion for dividing the parts, which we call them “Our parts”. The rules of dividing are as follows: an “our part” is consisted of as many as consecutive “author parts” without being the final “our part” more than 10 pages. For example if the “author part”s of the chapter are 2,4,5,3,1,7,5 pages respectively, the first “our part” will be consisted of the first two “author parts”. The second “our part” will be consisted of the third and fourth and fifth “author parts”. the third “our part” will be consisted of the sixth “author part”. the fourth “our part” will be consisted of the seventh “author part”.
If an “our part” ends in the middle of a page, some of the page text will be for the previous “our part” and some of the page will be for the next “our part”. The text of such pages must be written in two separate rows. One of them is related to the previous “our part” and one of them is related to next “our part”. Your goal should be avoiding a row’s content to be consisted of the data from two different “our part”s.
And for example if you decided to divide the chapter into 2 parts, you should write “1” for the contents of the first part and write “2” for the contents of the second part. 

VERY IMPORTANT: your output must be single line (minified). DO NOT EVER use the “ENTER” button inside the cells. It shouldn’t be html rich. Do not separate texts with ENTER.

You will now receive a PDF, respond in the exact structure described above.
2025-12-14 12:41:36,834 - ERROR - PDF processing failed: list index out of range
2025-12-14 12:44:37,537 - INFO - === Starting PDF Processing ===
2025-12-14 12:44:37,538 - INFO - Model: gemini-2.5-pro
2025-12-14 12:44:37,538 - INFO - PDF: /home/mohammadbagher/Downloads/PDFs/Bolognia 5th Edition 2024 (1)-7-26-46.pdf
2025-12-14 12:44:37,538 - INFO - Full prompt being sent (7390 chars): You are a meticulous medical OCR & structuring assistant. Your job is to extract **only** what is present on each provided textbook page image/PDF and convert it into clean, AI-ready text with structured sections. You MUST avoid hallucinations and preserve original medical meaning precisely. Follow these global rules:

GLOBAL PRINCIPLES
- NO HALLUCINATIONS: Output only content visible on the page(s). If unreadable/unclear, write: "[UNREADABLE]" or add an "uncertain" flag with brief reason.
- LANGUAGE & SPELLING: Preserve original English spelling and medical terminology; do not normalize British↔American spelling.
- CLEAN OCR: 
  - Remove page headers/footers, running titles, folios, and footers like “©Publisher 2023”.
  - Fix broken words at line breaks (e.g., "thera-\npy" → "therapy").
  - Replace ligatures (ﬁ, ﬂ) with normal letters.
  - Preserve meaningful capitalization, italics markers (use *italic*), bold (**bold**), and inline sub/superscripts as LaTeX if clearly indicated (e.g., CO$_2$).
- CITATIONS: Keep in-text citations literally (e.g., “[12]”, “(Smith 2021)”).
- MATH/CHEM: For formulae, use inline LaTeX: e.g., `pH = -\log_{10} [H^+]`.
- NO IMAGES: Describe figures/diagrams/charts in text form—succinct but complete. Do not invent unseen labels.

STRUCTURED OUTPUT FORMAT (Markdown with embedded JSON blocks)
Always produce in this exact order:

1) `# Page Metadata`
   - Book title (if visible), chapter title (if visible), page number (if visible or inferable), section headings found.
   - Confidence notes: short bullets where uncertainty exists.

2) `# Body`
   - Clean, continuous paragraph text. Keep section/subsection headings as `##` and `###`.

3) `# Tables`
   - For each table found, output a JSON block per table with:
   ```json
   {
     "type": "table",
     "title": "Table 3.2 Disease-modifying agents",
     "note": "footnotes or legends if present",
     "columns": ["Column A", "Column B", "Column C"],
     "rows": [
       ["cell(1,1)", "cell(1,2)", "cell(1,3)"],
       ["cell(2,1)", "cell(2,2)", "cell(2,3)"]
     ],
     "uncertain_cells": [{"row":2,"col":3,"reason":"blurry"}]
   }
If a table is complex (merged cells), normalize by repeating header labels; if impossible, add "structure_note".

# Algorithms / Clinical Approaches

Convert any flowchart, algorithm box, or approach diagram into BOTH:
a) Bulleted steps (plain text):

Step 1: …

If lab X > Y → do …

Else → …
b) Machine-readable pseudo-logic JSON:

json
Copy code
{
  "type": "algorithm",
  "title": "Approach to suspected DKA",
  "nodes": [
    {"id":"start","text":"Patient with hyperglycemia"},
    {"id":"n1","text":"Check ketones"},
    {"id":"n2","text":"If ketones positive → start insulin infusion"}
  ],
  "edges": [
    {"from":"start","to":"n1"},
    {"from":"n1","to":"n2","condition":"ketones positive"}
  ]
}
Use simple IDs; preserve clinical thresholds verbatim.

# Figures / Diagrams / Charts

For each figure, write a compact textual description capturing labels, axes, and key relationships.

If a chart encodes data values, extract the visible numbers as a small table. If not given, describe trends only.

Example JSON:

json
Copy code
{
  "type": "figure",
  "title": "Figure 5.1 Cardiac cycle",
  "description": "Schematic phases (isovolumetric contraction, ejection, …); labels: LV pressure, aortic pressure… Trend: LV pressure rises during …",
  "visible_labels": ["LV", "Aorta", "Mitral"],
  "data_points": null
}
# Lists & Key Points

Convert bullet lists and numbered lists cleanly.

For “pearls”, “high-yield” callouts, prefix with **HIGH-YIELD:**.

# References / Footnotes on Page

Transcribe verbatim; if footnote markers map to table/figure, cross-reference.

# Uncertain / OCR Issues

JSON array, where each item has: location (body/table/figure), snippet (if any), reason (e.g., “scan blur”), and confidence score 0–1.

ADDITIONAL RULES FOR DIFFICULT LAYOUTS

Multi-column pages: Respect reading order left→right, top→bottom per row.

Sidebars/callouts: Place them after the paragraph they visually relate to; prefix with > Note: or > Caution:; also mirror inside # Lists & Key Points if “pearls”.

Units & thresholds: Keep exact units (mg/kg, mmol/L). Do not convert units.

Drug names: Preserve capitalization of brand/generic as shown.

Abbreviations: On first obvious occurrence, if expansion is shown on page, include (abbr: expansion).

OUTPUT VALIDATION

Ensure valid JSON blocks (UTF-8, double quotes).

No trailing commas.

Do not wrap JSON in code fences other than the ones I asked above.

Final Output structure: your output must be sent is as a JSON in a code block with the delimiter of three consecutive semicolons like “;;;”. Each row is representative of a “page text” or “figure” or “Table”. So each “page text” and “figure” and “Table”  will have a row. The columns Headers are:
    1. Type
    2. Extraction
    3. Number
    4. Part
The “Type” column is for mentioning the type of the cell row data. The acceptable types are “page text” or “figure” or “Table”. If you are writing the page’s text in the extraction column, then the type will be “page text”. If the row in for figures, write “Figure”. And ”. If the row in for Tables, write “Table”.
The “Extraction” column is the main column for each row. If you are extracting a page’s text, write the complete text here. The JSONs of tables and figures must be written here as well.
The References in the end of the chapter must not be extracted. Ignore it.
The ”Number” column must show the page it is extracted from like 1 or 2 and more.
The “Part” column shows that the row’s content is included in which part. Use numbers like 1 or 2 and more.
How to define the parts for each row: in the beginning of the first page of the file there is a “Chapter contents” which demonstrates the parts of the chapter recommended by the author, which we call them “author parts”. I want you to make your own suggestion for dividing the parts, which we call them “Our parts”. The rules of dividing are as follows: an “our part” is consisted of as many as consecutive “author parts” without being the final “our part” more than 10 pages. For example if the “author part”s of the chapter are 2,4,5,3,1,7,5 pages respectively, the first “our part” will be consisted of the first two “author parts”. The second “our part” will be consisted of the third and fourth and fifth “author parts”. the third “our part” will be consisted of the sixth “author part”. the fourth “our part” will be consisted of the seventh “author part”.
If an “our part” ends in the middle of a page, some of the page text will be for the previous “our part” and some of the page will be for the next “our part”. The text of such pages must be written in two separate rows. One of them is related to the previous “our part” and one of them is related to next “our part”. Your goal should be avoiding a row’s content to be consisted of the data from two different “our part”s.
And for example if you decided to divide the chapter into 2 parts, you should write “1” for the contents of the first part and write “2” for the contents of the second part. 

VERY IMPORTANT: your output must be single line (minified). DO NOT EVER use the “ENTER” button inside the cells. It shouldn’t be html rich. Do not separate texts with ENTER.

You will now receive a PDF, respond in the exact structure described above.
2025-12-14 12:44:37,539 - ERROR - PDF processing failed: list index out of range
2025-12-14 12:44:54,735 - INFO - Loaded 6 predefined prompts
2025-12-14 12:45:27,000 - INFO - Loaded 2 API keys
2025-12-14 12:46:04,053 - INFO - === Starting PDF Processing ===
2025-12-14 12:46:04,055 - INFO - Model: gemini-2.5-pro
2025-12-14 12:46:04,056 - INFO - PDF: /home/mohammadbagher/Downloads/PDFs/Bolognia 5th Edition 2024 (1)-7-26-46.pdf
2025-12-14 12:46:04,058 - INFO - Full prompt being sent (7390 chars): You are a meticulous medical OCR & structuring assistant. Your job is to extract **only** what is present on each provided textbook page image/PDF and convert it into clean, AI-ready text with structured sections. You MUST avoid hallucinations and preserve original medical meaning precisely. Follow these global rules:

GLOBAL PRINCIPLES
- NO HALLUCINATIONS: Output only content visible on the page(s). If unreadable/unclear, write: "[UNREADABLE]" or add an "uncertain" flag with brief reason.
- LANGUAGE & SPELLING: Preserve original English spelling and medical terminology; do not normalize British↔American spelling.
- CLEAN OCR: 
  - Remove page headers/footers, running titles, folios, and footers like “©Publisher 2023”.
  - Fix broken words at line breaks (e.g., "thera-\npy" → "therapy").
  - Replace ligatures (ﬁ, ﬂ) with normal letters.
  - Preserve meaningful capitalization, italics markers (use *italic*), bold (**bold**), and inline sub/superscripts as LaTeX if clearly indicated (e.g., CO$_2$).
- CITATIONS: Keep in-text citations literally (e.g., “[12]”, “(Smith 2021)”).
- MATH/CHEM: For formulae, use inline LaTeX: e.g., `pH = -\log_{10} [H^+]`.
- NO IMAGES: Describe figures/diagrams/charts in text form—succinct but complete. Do not invent unseen labels.

STRUCTURED OUTPUT FORMAT (Markdown with embedded JSON blocks)
Always produce in this exact order:

1) `# Page Metadata`
   - Book title (if visible), chapter title (if visible), page number (if visible or inferable), section headings found.
   - Confidence notes: short bullets where uncertainty exists.

2) `# Body`
   - Clean, continuous paragraph text. Keep section/subsection headings as `##` and `###`.

3) `# Tables`
   - For each table found, output a JSON block per table with:
   ```json
   {
     "type": "table",
     "title": "Table 3.2 Disease-modifying agents",
     "note": "footnotes or legends if present",
     "columns": ["Column A", "Column B", "Column C"],
     "rows": [
       ["cell(1,1)", "cell(1,2)", "cell(1,3)"],
       ["cell(2,1)", "cell(2,2)", "cell(2,3)"]
     ],
     "uncertain_cells": [{"row":2,"col":3,"reason":"blurry"}]
   }
If a table is complex (merged cells), normalize by repeating header labels; if impossible, add "structure_note".

# Algorithms / Clinical Approaches

Convert any flowchart, algorithm box, or approach diagram into BOTH:
a) Bulleted steps (plain text):

Step 1: …

If lab X > Y → do …

Else → …
b) Machine-readable pseudo-logic JSON:

json
Copy code
{
  "type": "algorithm",
  "title": "Approach to suspected DKA",
  "nodes": [
    {"id":"start","text":"Patient with hyperglycemia"},
    {"id":"n1","text":"Check ketones"},
    {"id":"n2","text":"If ketones positive → start insulin infusion"}
  ],
  "edges": [
    {"from":"start","to":"n1"},
    {"from":"n1","to":"n2","condition":"ketones positive"}
  ]
}
Use simple IDs; preserve clinical thresholds verbatim.

# Figures / Diagrams / Charts

For each figure, write a compact textual description capturing labels, axes, and key relationships.

If a chart encodes data values, extract the visible numbers as a small table. If not given, describe trends only.

Example JSON:

json
Copy code
{
  "type": "figure",
  "title": "Figure 5.1 Cardiac cycle",
  "description": "Schematic phases (isovolumetric contraction, ejection, …); labels: LV pressure, aortic pressure… Trend: LV pressure rises during …",
  "visible_labels": ["LV", "Aorta", "Mitral"],
  "data_points": null
}
# Lists & Key Points

Convert bullet lists and numbered lists cleanly.

For “pearls”, “high-yield” callouts, prefix with **HIGH-YIELD:**.

# References / Footnotes on Page

Transcribe verbatim; if footnote markers map to table/figure, cross-reference.

# Uncertain / OCR Issues

JSON array, where each item has: location (body/table/figure), snippet (if any), reason (e.g., “scan blur”), and confidence score 0–1.

ADDITIONAL RULES FOR DIFFICULT LAYOUTS

Multi-column pages: Respect reading order left→right, top→bottom per row.

Sidebars/callouts: Place them after the paragraph they visually relate to; prefix with > Note: or > Caution:; also mirror inside # Lists & Key Points if “pearls”.

Units & thresholds: Keep exact units (mg/kg, mmol/L). Do not convert units.

Drug names: Preserve capitalization of brand/generic as shown.

Abbreviations: On first obvious occurrence, if expansion is shown on page, include (abbr: expansion).

OUTPUT VALIDATION

Ensure valid JSON blocks (UTF-8, double quotes).

No trailing commas.

Do not wrap JSON in code fences other than the ones I asked above.

Final Output structure: your output must be sent is as a JSON in a code block with the delimiter of three consecutive semicolons like “;;;”. Each row is representative of a “page text” or “figure” or “Table”. So each “page text” and “figure” and “Table”  will have a row. The columns Headers are:
    1. Type
    2. Extraction
    3. Number
    4. Part
The “Type” column is for mentioning the type of the cell row data. The acceptable types are “page text” or “figure” or “Table”. If you are writing the page’s text in the extraction column, then the type will be “page text”. If the row in for figures, write “Figure”. And ”. If the row in for Tables, write “Table”.
The “Extraction” column is the main column for each row. If you are extracting a page’s text, write the complete text here. The JSONs of tables and figures must be written here as well.
The References in the end of the chapter must not be extracted. Ignore it.
The ”Number” column must show the page it is extracted from like 1 or 2 and more.
The “Part” column shows that the row’s content is included in which part. Use numbers like 1 or 2 and more.
How to define the parts for each row: in the beginning of the first page of the file there is a “Chapter contents” which demonstrates the parts of the chapter recommended by the author, which we call them “author parts”. I want you to make your own suggestion for dividing the parts, which we call them “Our parts”. The rules of dividing are as follows: an “our part” is consisted of as many as consecutive “author parts” without being the final “our part” more than 10 pages. For example if the “author part”s of the chapter are 2,4,5,3,1,7,5 pages respectively, the first “our part” will be consisted of the first two “author parts”. The second “our part” will be consisted of the third and fourth and fifth “author parts”. the third “our part” will be consisted of the sixth “author part”. the fourth “our part” will be consisted of the seventh “author part”.
If an “our part” ends in the middle of a page, some of the page text will be for the previous “our part” and some of the page will be for the next “our part”. The text of such pages must be written in two separate rows. One of them is related to the previous “our part” and one of them is related to next “our part”. Your goal should be avoiding a row’s content to be consisted of the data from two different “our part”s.
And for example if you decided to divide the chapter into 2 parts, you should write “1” for the contents of the first part and write “2” for the contents of the second part. 

VERY IMPORTANT: your output must be single line (minified). DO NOT EVER use the “ENTER” button inside the cells. It shouldn’t be html rich. Do not separate texts with ENTER.

You will now receive a PDF, respond in the exact structure described above.
2025-12-14 12:46:06,487 - ERROR - PDF processing failed: <HttpError 400 when requesting None returned "API key expired. Please renew the API key.". Details: "[{'@type': 'type.googleapis.com/google.rpc.ErrorInfo', 'reason': 'API_KEY_INVALID', 'domain': 'googleapis.com', 'metadata': {'service': 'generativelanguage.googleapis.com'}}, {'@type': 'type.googleapis.com/google.rpc.LocalizedMessage', 'locale': 'en-US', 'message': 'API key expired. Please renew the API key.'}]">
2025-12-14 12:55:16,748 - INFO - Loaded 3 API keys
2025-12-14 12:55:21,157 - INFO - === Starting PDF Processing ===
2025-12-14 12:55:21,157 - INFO - Model: gemini-2.5-pro
2025-12-14 12:55:21,158 - INFO - PDF: /home/mohammadbagher/Downloads/PDFs/Bolognia 5th Edition 2024 (1)-7-26-46.pdf
2025-12-14 12:55:21,159 - INFO - Full prompt being sent (7390 chars): You are a meticulous medical OCR & structuring assistant. Your job is to extract **only** what is present on each provided textbook page image/PDF and convert it into clean, AI-ready text with structured sections. You MUST avoid hallucinations and preserve original medical meaning precisely. Follow these global rules:

GLOBAL PRINCIPLES
- NO HALLUCINATIONS: Output only content visible on the page(s). If unreadable/unclear, write: "[UNREADABLE]" or add an "uncertain" flag with brief reason.
- LANGUAGE & SPELLING: Preserve original English spelling and medical terminology; do not normalize British↔American spelling.
- CLEAN OCR: 
  - Remove page headers/footers, running titles, folios, and footers like “©Publisher 2023”.
  - Fix broken words at line breaks (e.g., "thera-\npy" → "therapy").
  - Replace ligatures (ﬁ, ﬂ) with normal letters.
  - Preserve meaningful capitalization, italics markers (use *italic*), bold (**bold**), and inline sub/superscripts as LaTeX if clearly indicated (e.g., CO$_2$).
- CITATIONS: Keep in-text citations literally (e.g., “[12]”, “(Smith 2021)”).
- MATH/CHEM: For formulae, use inline LaTeX: e.g., `pH = -\log_{10} [H^+]`.
- NO IMAGES: Describe figures/diagrams/charts in text form—succinct but complete. Do not invent unseen labels.

STRUCTURED OUTPUT FORMAT (Markdown with embedded JSON blocks)
Always produce in this exact order:

1) `# Page Metadata`
   - Book title (if visible), chapter title (if visible), page number (if visible or inferable), section headings found.
   - Confidence notes: short bullets where uncertainty exists.

2) `# Body`
   - Clean, continuous paragraph text. Keep section/subsection headings as `##` and `###`.

3) `# Tables`
   - For each table found, output a JSON block per table with:
   ```json
   {
     "type": "table",
     "title": "Table 3.2 Disease-modifying agents",
     "note": "footnotes or legends if present",
     "columns": ["Column A", "Column B", "Column C"],
     "rows": [
       ["cell(1,1)", "cell(1,2)", "cell(1,3)"],
       ["cell(2,1)", "cell(2,2)", "cell(2,3)"]
     ],
     "uncertain_cells": [{"row":2,"col":3,"reason":"blurry"}]
   }
If a table is complex (merged cells), normalize by repeating header labels; if impossible, add "structure_note".

# Algorithms / Clinical Approaches

Convert any flowchart, algorithm box, or approach diagram into BOTH:
a) Bulleted steps (plain text):

Step 1: …

If lab X > Y → do …

Else → …
b) Machine-readable pseudo-logic JSON:

json
Copy code
{
  "type": "algorithm",
  "title": "Approach to suspected DKA",
  "nodes": [
    {"id":"start","text":"Patient with hyperglycemia"},
    {"id":"n1","text":"Check ketones"},
    {"id":"n2","text":"If ketones positive → start insulin infusion"}
  ],
  "edges": [
    {"from":"start","to":"n1"},
    {"from":"n1","to":"n2","condition":"ketones positive"}
  ]
}
Use simple IDs; preserve clinical thresholds verbatim.

# Figures / Diagrams / Charts

For each figure, write a compact textual description capturing labels, axes, and key relationships.

If a chart encodes data values, extract the visible numbers as a small table. If not given, describe trends only.

Example JSON:

json
Copy code
{
  "type": "figure",
  "title": "Figure 5.1 Cardiac cycle",
  "description": "Schematic phases (isovolumetric contraction, ejection, …); labels: LV pressure, aortic pressure… Trend: LV pressure rises during …",
  "visible_labels": ["LV", "Aorta", "Mitral"],
  "data_points": null
}
# Lists & Key Points

Convert bullet lists and numbered lists cleanly.

For “pearls”, “high-yield” callouts, prefix with **HIGH-YIELD:**.

# References / Footnotes on Page

Transcribe verbatim; if footnote markers map to table/figure, cross-reference.

# Uncertain / OCR Issues

JSON array, where each item has: location (body/table/figure), snippet (if any), reason (e.g., “scan blur”), and confidence score 0–1.

ADDITIONAL RULES FOR DIFFICULT LAYOUTS

Multi-column pages: Respect reading order left→right, top→bottom per row.

Sidebars/callouts: Place them after the paragraph they visually relate to; prefix with > Note: or > Caution:; also mirror inside # Lists & Key Points if “pearls”.

Units & thresholds: Keep exact units (mg/kg, mmol/L). Do not convert units.

Drug names: Preserve capitalization of brand/generic as shown.

Abbreviations: On first obvious occurrence, if expansion is shown on page, include (abbr: expansion).

OUTPUT VALIDATION

Ensure valid JSON blocks (UTF-8, double quotes).

No trailing commas.

Do not wrap JSON in code fences other than the ones I asked above.

Final Output structure: your output must be sent is as a JSON in a code block with the delimiter of three consecutive semicolons like “;;;”. Each row is representative of a “page text” or “figure” or “Table”. So each “page text” and “figure” and “Table”  will have a row. The columns Headers are:
    1. Type
    2. Extraction
    3. Number
    4. Part
The “Type” column is for mentioning the type of the cell row data. The acceptable types are “page text” or “figure” or “Table”. If you are writing the page’s text in the extraction column, then the type will be “page text”. If the row in for figures, write “Figure”. And ”. If the row in for Tables, write “Table”.
The “Extraction” column is the main column for each row. If you are extracting a page’s text, write the complete text here. The JSONs of tables and figures must be written here as well.
The References in the end of the chapter must not be extracted. Ignore it.
The ”Number” column must show the page it is extracted from like 1 or 2 and more.
The “Part” column shows that the row’s content is included in which part. Use numbers like 1 or 2 and more.
How to define the parts for each row: in the beginning of the first page of the file there is a “Chapter contents” which demonstrates the parts of the chapter recommended by the author, which we call them “author parts”. I want you to make your own suggestion for dividing the parts, which we call them “Our parts”. The rules of dividing are as follows: an “our part” is consisted of as many as consecutive “author parts” without being the final “our part” more than 10 pages. For example if the “author part”s of the chapter are 2,4,5,3,1,7,5 pages respectively, the first “our part” will be consisted of the first two “author parts”. The second “our part” will be consisted of the third and fourth and fifth “author parts”. the third “our part” will be consisted of the sixth “author part”. the fourth “our part” will be consisted of the seventh “author part”.
If an “our part” ends in the middle of a page, some of the page text will be for the previous “our part” and some of the page will be for the next “our part”. The text of such pages must be written in two separate rows. One of them is related to the previous “our part” and one of them is related to next “our part”. Your goal should be avoiding a row’s content to be consisted of the data from two different “our part”s.
And for example if you decided to divide the chapter into 2 parts, you should write “1” for the contents of the first part and write “2” for the contents of the second part. 

VERY IMPORTANT: your output must be single line (minified). DO NOT EVER use the “ENTER” button inside the cells. It shouldn’t be html rich. Do not separate texts with ENTER.

You will now receive a PDF, respond in the exact structure described above.
2025-12-14 12:55:30,461 - INFO - PDF uploaded successfully with API key: bagher
2025-12-14 12:55:30,461 - INFO - Uploaded PDF file: Bolognia 5th Edition 2024 (1)-7-26-46.pdf
2025-12-14 12:55:30,462 - INFO - Model: gemini-2.5-pro, Max tokens for model: 32768, Using: 32768
2025-12-14 12:55:30,462 - INFO - Using max_output_tokens: 32768
2025-12-14 12:55:30,462 - INFO - Using model: gemini-2.5-pro
2025-12-14 12:55:30,462 - INFO - Sending prompt (length: 7390 characters)
2025-12-14 12:55:30,462 - INFO - Max output tokens: 32768
2025-12-14 12:55:30,462 - INFO - Using original prompt with JSON output instruction (prompt preserved)
2025-12-14 12:55:30,463 - INFO - Generating content with streaming enabled for complete response...
2025-12-14 12:55:31,874 - WARNING - ⚠️ Quota exhausted (429) with current API key. Attempting to switch to next key...
2025-12-14 12:55:31,875 - INFO - Retrying with API key 1/3: bagher
2025-12-14 12:55:43,946 - WARNING - API key bagher also exhausted, trying next...
2025-12-14 12:55:43,946 - INFO - Retrying with API key 2/3: bagher
2025-12-14 12:55:54,049 - WARNING - API key bagher also exhausted, trying next...
2025-12-14 12:55:54,049 - INFO - Retrying with API key 3/3: bagher
2025-12-14 12:55:56,560 - WARNING - API key bagher also exhausted, trying next...
2025-12-14 12:55:56,560 - ERROR - ======================================================================
2025-12-14 12:55:56,561 - ERROR - ❌ All 3 API keys failed. Cannot process request.
2025-12-14 12:55:56,562 - ERROR - ======================================================================
2025-12-14 12:55:56,563 - ERROR - 
2025-12-14 12:55:56,563 - ERROR - Possible reasons:
2025-12-14 12:55:56,564 - ERROR -   • All keys LEAKED (403) → Remove leaked keys, add new ones
2025-12-14 12:55:56,565 - ERROR -   • All keys QUOTA EXHAUSTED (429) → Wait for reset or add more keys
2025-12-14 12:55:56,565 - ERROR -   • Keys INVALID/EXPIRED → Generate new keys from Google AI Studio
2025-12-14 12:55:56,566 - ERROR - 
2025-12-14 12:55:56,566 - ERROR - Quick fix:
2025-12-14 12:55:56,567 - ERROR -   1. Open API keys CSV file
2025-12-14 12:55:56,567 - ERROR -   2. Remove leaked/invalid keys
2025-12-14 12:55:56,568 - ERROR -   3. Add new keys from: https://aistudio.google.com/apikey
2025-12-14 12:55:56,568 - ERROR -   4. Save CSV and reload in application
2025-12-14 12:55:56,569 - ERROR -   5. Try again
2025-12-14 12:55:56,569 - ERROR - 
2025-12-14 12:55:56,570 - ERROR - ======================================================================
2025-12-14 13:00:54,153 - INFO - === Starting PDF Processing ===
2025-12-14 13:00:54,154 - INFO - Model: gemini-2.5-pro
2025-12-14 13:00:54,154 - INFO - PDF: /home/mohammadbagher/Downloads/PDFs/Bolognia 5th Edition 2024 (1)-7-26-46.pdf
2025-12-14 13:00:54,154 - INFO - Full prompt being sent (7390 chars): You are a meticulous medical OCR & structuring assistant. Your job is to extract **only** what is present on each provided textbook page image/PDF and convert it into clean, AI-ready text with structured sections. You MUST avoid hallucinations and preserve original medical meaning precisely. Follow these global rules:

GLOBAL PRINCIPLES
- NO HALLUCINATIONS: Output only content visible on the page(s). If unreadable/unclear, write: "[UNREADABLE]" or add an "uncertain" flag with brief reason.
- LANGUAGE & SPELLING: Preserve original English spelling and medical terminology; do not normalize British↔American spelling.
- CLEAN OCR: 
  - Remove page headers/footers, running titles, folios, and footers like “©Publisher 2023”.
  - Fix broken words at line breaks (e.g., "thera-\npy" → "therapy").
  - Replace ligatures (ﬁ, ﬂ) with normal letters.
  - Preserve meaningful capitalization, italics markers (use *italic*), bold (**bold**), and inline sub/superscripts as LaTeX if clearly indicated (e.g., CO$_2$).
- CITATIONS: Keep in-text citations literally (e.g., “[12]”, “(Smith 2021)”).
- MATH/CHEM: For formulae, use inline LaTeX: e.g., `pH = -\log_{10} [H^+]`.
- NO IMAGES: Describe figures/diagrams/charts in text form—succinct but complete. Do not invent unseen labels.

STRUCTURED OUTPUT FORMAT (Markdown with embedded JSON blocks)
Always produce in this exact order:

1) `# Page Metadata`
   - Book title (if visible), chapter title (if visible), page number (if visible or inferable), section headings found.
   - Confidence notes: short bullets where uncertainty exists.

2) `# Body`
   - Clean, continuous paragraph text. Keep section/subsection headings as `##` and `###`.

3) `# Tables`
   - For each table found, output a JSON block per table with:
   ```json
   {
     "type": "table",
     "title": "Table 3.2 Disease-modifying agents",
     "note": "footnotes or legends if present",
     "columns": ["Column A", "Column B", "Column C"],
     "rows": [
       ["cell(1,1)", "cell(1,2)", "cell(1,3)"],
       ["cell(2,1)", "cell(2,2)", "cell(2,3)"]
     ],
     "uncertain_cells": [{"row":2,"col":3,"reason":"blurry"}]
   }
If a table is complex (merged cells), normalize by repeating header labels; if impossible, add "structure_note".

# Algorithms / Clinical Approaches

Convert any flowchart, algorithm box, or approach diagram into BOTH:
a) Bulleted steps (plain text):

Step 1: …

If lab X > Y → do …

Else → …
b) Machine-readable pseudo-logic JSON:

json
Copy code
{
  "type": "algorithm",
  "title": "Approach to suspected DKA",
  "nodes": [
    {"id":"start","text":"Patient with hyperglycemia"},
    {"id":"n1","text":"Check ketones"},
    {"id":"n2","text":"If ketones positive → start insulin infusion"}
  ],
  "edges": [
    {"from":"start","to":"n1"},
    {"from":"n1","to":"n2","condition":"ketones positive"}
  ]
}
Use simple IDs; preserve clinical thresholds verbatim.

# Figures / Diagrams / Charts

For each figure, write a compact textual description capturing labels, axes, and key relationships.

If a chart encodes data values, extract the visible numbers as a small table. If not given, describe trends only.

Example JSON:

json
Copy code
{
  "type": "figure",
  "title": "Figure 5.1 Cardiac cycle",
  "description": "Schematic phases (isovolumetric contraction, ejection, …); labels: LV pressure, aortic pressure… Trend: LV pressure rises during …",
  "visible_labels": ["LV", "Aorta", "Mitral"],
  "data_points": null
}
# Lists & Key Points

Convert bullet lists and numbered lists cleanly.

For “pearls”, “high-yield” callouts, prefix with **HIGH-YIELD:**.

# References / Footnotes on Page

Transcribe verbatim; if footnote markers map to table/figure, cross-reference.

# Uncertain / OCR Issues

JSON array, where each item has: location (body/table/figure), snippet (if any), reason (e.g., “scan blur”), and confidence score 0–1.

ADDITIONAL RULES FOR DIFFICULT LAYOUTS

Multi-column pages: Respect reading order left→right, top→bottom per row.

Sidebars/callouts: Place them after the paragraph they visually relate to; prefix with > Note: or > Caution:; also mirror inside # Lists & Key Points if “pearls”.

Units & thresholds: Keep exact units (mg/kg, mmol/L). Do not convert units.

Drug names: Preserve capitalization of brand/generic as shown.

Abbreviations: On first obvious occurrence, if expansion is shown on page, include (abbr: expansion).

OUTPUT VALIDATION

Ensure valid JSON blocks (UTF-8, double quotes).

No trailing commas.

Do not wrap JSON in code fences other than the ones I asked above.

Final Output structure: your output must be sent is as a JSON in a code block with the delimiter of three consecutive semicolons like “;;;”. Each row is representative of a “page text” or “figure” or “Table”. So each “page text” and “figure” and “Table”  will have a row. The columns Headers are:
    1. Type
    2. Extraction
    3. Number
    4. Part
The “Type” column is for mentioning the type of the cell row data. The acceptable types are “page text” or “figure” or “Table”. If you are writing the page’s text in the extraction column, then the type will be “page text”. If the row in for figures, write “Figure”. And ”. If the row in for Tables, write “Table”.
The “Extraction” column is the main column for each row. If you are extracting a page’s text, write the complete text here. The JSONs of tables and figures must be written here as well.
The References in the end of the chapter must not be extracted. Ignore it.
The ”Number” column must show the page it is extracted from like 1 or 2 and more.
The “Part” column shows that the row’s content is included in which part. Use numbers like 1 or 2 and more.
How to define the parts for each row: in the beginning of the first page of the file there is a “Chapter contents” which demonstrates the parts of the chapter recommended by the author, which we call them “author parts”. I want you to make your own suggestion for dividing the parts, which we call them “Our parts”. The rules of dividing are as follows: an “our part” is consisted of as many as consecutive “author parts” without being the final “our part” more than 10 pages. For example if the “author part”s of the chapter are 2,4,5,3,1,7,5 pages respectively, the first “our part” will be consisted of the first two “author parts”. The second “our part” will be consisted of the third and fourth and fifth “author parts”. the third “our part” will be consisted of the sixth “author part”. the fourth “our part” will be consisted of the seventh “author part”.
If an “our part” ends in the middle of a page, some of the page text will be for the previous “our part” and some of the page will be for the next “our part”. The text of such pages must be written in two separate rows. One of them is related to the previous “our part” and one of them is related to next “our part”. Your goal should be avoiding a row’s content to be consisted of the data from two different “our part”s.
And for example if you decided to divide the chapter into 2 parts, you should write “1” for the contents of the first part and write “2” for the contents of the second part. 

VERY IMPORTANT: your output must be single line (minified). DO NOT EVER use the “ENTER” button inside the cells. It shouldn’t be html rich. Do not separate texts with ENTER.

You will now receive a PDF, respond in the exact structure described above.
2025-12-14 13:01:03,493 - INFO - PDF uploaded successfully with API key: bagher
2025-12-14 13:01:03,493 - INFO - Uploaded PDF file: Bolognia 5th Edition 2024 (1)-7-26-46.pdf
2025-12-14 13:01:03,494 - INFO - Model: gemini-2.5-pro, Max tokens for model: 32768, Using: 32768
2025-12-14 13:01:03,495 - INFO - Using max_output_tokens: 32768
2025-12-14 13:01:03,495 - INFO - Using model: gemini-2.5-pro
2025-12-14 13:01:03,496 - INFO - Sending prompt (length: 7390 characters)
2025-12-14 13:01:03,496 - INFO - Max output tokens: 32768
2025-12-14 13:01:03,497 - INFO - Using original prompt with JSON output instruction (prompt preserved)
2025-12-14 13:01:03,497 - INFO - Generating content with streaming enabled for complete response...
2025-12-14 13:01:04,769 - WARNING - ⚠️ Quota exhausted (429) with current API key. Attempting to switch to next key...
2025-12-14 13:01:04,769 - INFO - Retrying with API key 1/3: bagher
2025-12-14 13:01:15,802 - INFO - Loaded 6 predefined prompts
2025-12-14 13:01:36,438 - INFO - Loaded 3 API keys
2025-12-14 13:02:28,319 - INFO - === Starting PDF Processing ===
2025-12-14 13:02:28,320 - INFO - Model: gemini-2.5-pro
2025-12-14 13:02:28,321 - INFO - PDF: /home/mohammadbagher/Downloads/PDFs/Bolognia 5th Edition 2024 (1)-7-26-46.pdf
2025-12-14 13:02:28,322 - INFO - Full prompt being sent (7390 chars): You are a meticulous medical OCR & structuring assistant. Your job is to extract **only** what is present on each provided textbook page image/PDF and convert it into clean, AI-ready text with structured sections. You MUST avoid hallucinations and preserve original medical meaning precisely. Follow these global rules:

GLOBAL PRINCIPLES
- NO HALLUCINATIONS: Output only content visible on the page(s). If unreadable/unclear, write: "[UNREADABLE]" or add an "uncertain" flag with brief reason.
- LANGUAGE & SPELLING: Preserve original English spelling and medical terminology; do not normalize British↔American spelling.
- CLEAN OCR: 
  - Remove page headers/footers, running titles, folios, and footers like “©Publisher 2023”.
  - Fix broken words at line breaks (e.g., "thera-\npy" → "therapy").
  - Replace ligatures (ﬁ, ﬂ) with normal letters.
  - Preserve meaningful capitalization, italics markers (use *italic*), bold (**bold**), and inline sub/superscripts as LaTeX if clearly indicated (e.g., CO$_2$).
- CITATIONS: Keep in-text citations literally (e.g., “[12]”, “(Smith 2021)”).
- MATH/CHEM: For formulae, use inline LaTeX: e.g., `pH = -\log_{10} [H^+]`.
- NO IMAGES: Describe figures/diagrams/charts in text form—succinct but complete. Do not invent unseen labels.

STRUCTURED OUTPUT FORMAT (Markdown with embedded JSON blocks)
Always produce in this exact order:

1) `# Page Metadata`
   - Book title (if visible), chapter title (if visible), page number (if visible or inferable), section headings found.
   - Confidence notes: short bullets where uncertainty exists.

2) `# Body`
   - Clean, continuous paragraph text. Keep section/subsection headings as `##` and `###`.

3) `# Tables`
   - For each table found, output a JSON block per table with:
   ```json
   {
     "type": "table",
     "title": "Table 3.2 Disease-modifying agents",
     "note": "footnotes or legends if present",
     "columns": ["Column A", "Column B", "Column C"],
     "rows": [
       ["cell(1,1)", "cell(1,2)", "cell(1,3)"],
       ["cell(2,1)", "cell(2,2)", "cell(2,3)"]
     ],
     "uncertain_cells": [{"row":2,"col":3,"reason":"blurry"}]
   }
If a table is complex (merged cells), normalize by repeating header labels; if impossible, add "structure_note".

# Algorithms / Clinical Approaches

Convert any flowchart, algorithm box, or approach diagram into BOTH:
a) Bulleted steps (plain text):

Step 1: …

If lab X > Y → do …

Else → …
b) Machine-readable pseudo-logic JSON:

json
Copy code
{
  "type": "algorithm",
  "title": "Approach to suspected DKA",
  "nodes": [
    {"id":"start","text":"Patient with hyperglycemia"},
    {"id":"n1","text":"Check ketones"},
    {"id":"n2","text":"If ketones positive → start insulin infusion"}
  ],
  "edges": [
    {"from":"start","to":"n1"},
    {"from":"n1","to":"n2","condition":"ketones positive"}
  ]
}
Use simple IDs; preserve clinical thresholds verbatim.

# Figures / Diagrams / Charts

For each figure, write a compact textual description capturing labels, axes, and key relationships.

If a chart encodes data values, extract the visible numbers as a small table. If not given, describe trends only.

Example JSON:

json
Copy code
{
  "type": "figure",
  "title": "Figure 5.1 Cardiac cycle",
  "description": "Schematic phases (isovolumetric contraction, ejection, …); labels: LV pressure, aortic pressure… Trend: LV pressure rises during …",
  "visible_labels": ["LV", "Aorta", "Mitral"],
  "data_points": null
}
# Lists & Key Points

Convert bullet lists and numbered lists cleanly.

For “pearls”, “high-yield” callouts, prefix with **HIGH-YIELD:**.

# References / Footnotes on Page

Transcribe verbatim; if footnote markers map to table/figure, cross-reference.

# Uncertain / OCR Issues

JSON array, where each item has: location (body/table/figure), snippet (if any), reason (e.g., “scan blur”), and confidence score 0–1.

ADDITIONAL RULES FOR DIFFICULT LAYOUTS

Multi-column pages: Respect reading order left→right, top→bottom per row.

Sidebars/callouts: Place them after the paragraph they visually relate to; prefix with > Note: or > Caution:; also mirror inside # Lists & Key Points if “pearls”.

Units & thresholds: Keep exact units (mg/kg, mmol/L). Do not convert units.

Drug names: Preserve capitalization of brand/generic as shown.

Abbreviations: On first obvious occurrence, if expansion is shown on page, include (abbr: expansion).

OUTPUT VALIDATION

Ensure valid JSON blocks (UTF-8, double quotes).

No trailing commas.

Do not wrap JSON in code fences other than the ones I asked above.

Final Output structure: your output must be sent is as a JSON in a code block with the delimiter of three consecutive semicolons like “;;;”. Each row is representative of a “page text” or “figure” or “Table”. So each “page text” and “figure” and “Table”  will have a row. The columns Headers are:
    1. Type
    2. Extraction
    3. Number
    4. Part
The “Type” column is for mentioning the type of the cell row data. The acceptable types are “page text” or “figure” or “Table”. If you are writing the page’s text in the extraction column, then the type will be “page text”. If the row in for figures, write “Figure”. And ”. If the row in for Tables, write “Table”.
The “Extraction” column is the main column for each row. If you are extracting a page’s text, write the complete text here. The JSONs of tables and figures must be written here as well.
The References in the end of the chapter must not be extracted. Ignore it.
The ”Number” column must show the page it is extracted from like 1 or 2 and more.
The “Part” column shows that the row’s content is included in which part. Use numbers like 1 or 2 and more.
How to define the parts for each row: in the beginning of the first page of the file there is a “Chapter contents” which demonstrates the parts of the chapter recommended by the author, which we call them “author parts”. I want you to make your own suggestion for dividing the parts, which we call them “Our parts”. The rules of dividing are as follows: an “our part” is consisted of as many as consecutive “author parts” without being the final “our part” more than 10 pages. For example if the “author part”s of the chapter are 2,4,5,3,1,7,5 pages respectively, the first “our part” will be consisted of the first two “author parts”. The second “our part” will be consisted of the third and fourth and fifth “author parts”. the third “our part” will be consisted of the sixth “author part”. the fourth “our part” will be consisted of the seventh “author part”.
If an “our part” ends in the middle of a page, some of the page text will be for the previous “our part” and some of the page will be for the next “our part”. The text of such pages must be written in two separate rows. One of them is related to the previous “our part” and one of them is related to next “our part”. Your goal should be avoiding a row’s content to be consisted of the data from two different “our part”s.
And for example if you decided to divide the chapter into 2 parts, you should write “1” for the contents of the first part and write “2” for the contents of the second part. 

VERY IMPORTANT: your output must be single line (minified). DO NOT EVER use the “ENTER” button inside the cells. It shouldn’t be html rich. Do not separate texts with ENTER.

You will now receive a PDF, respond in the exact structure described above.
2025-12-14 13:02:37,973 - INFO - PDF uploaded successfully with API key: bagher
2025-12-14 13:02:37,974 - INFO - Uploaded PDF file: Bolognia 5th Edition 2024 (1)-7-26-46.pdf
2025-12-14 13:02:37,974 - INFO - Model: gemini-2.5-pro, Max tokens for model: 32768, Using: 32768
2025-12-14 13:02:37,974 - INFO - Using max_output_tokens: 32768
2025-12-14 13:02:37,975 - INFO - Using model: gemini-2.5-pro
2025-12-14 13:02:37,975 - INFO - Sending prompt (length: 7390 characters)
2025-12-14 13:02:37,975 - INFO - Max output tokens: 32768
2025-12-14 13:02:37,975 - INFO - Using original prompt with JSON output instruction (prompt preserved)
2025-12-14 13:02:37,975 - INFO - Generating content with streaming enabled for complete response...
2025-12-14 13:02:39,357 - WARNING - ⚠️ Quota exhausted (429) with current API key. Attempting to switch to next key...
2025-12-14 13:02:39,358 - INFO - Retrying with API key 1/3: bagher
2025-12-14 13:02:51,135 - WARNING - API key bagher also exhausted, trying next...
2025-12-14 13:02:51,135 - INFO - Retrying with API key 2/3: bagher
2025-12-14 13:03:00,808 - WARNING - API key bagher also exhausted, trying next...
2025-12-14 13:03:00,809 - INFO - Retrying with API key 3/3: bagher
2025-12-14 13:03:03,413 - WARNING - API key bagher also exhausted, trying next...
2025-12-14 13:03:03,414 - ERROR - ======================================================================
2025-12-14 13:03:03,414 - ERROR - ❌ All 3 API keys failed. Cannot process request.
2025-12-14 13:03:03,415 - ERROR - ======================================================================
2025-12-14 13:03:03,416 - ERROR - 
2025-12-14 13:03:03,416 - ERROR - Possible reasons:
2025-12-14 13:03:03,417 - ERROR -   • All keys LEAKED (403) → Remove leaked keys, add new ones
2025-12-14 13:03:03,417 - ERROR -   • All keys QUOTA EXHAUSTED (429) → Wait for reset or add more keys
2025-12-14 13:03:03,417 - ERROR -   • Keys INVALID/EXPIRED → Generate new keys from Google AI Studio
2025-12-14 13:03:03,418 - ERROR - 
2025-12-14 13:03:03,418 - ERROR - Quick fix:
2025-12-14 13:03:03,419 - ERROR -   1. Open API keys CSV file
2025-12-14 13:03:03,419 - ERROR -   2. Remove leaked/invalid keys
2025-12-14 13:03:03,420 - ERROR -   3. Add new keys from: https://aistudio.google.com/apikey
2025-12-14 13:03:03,420 - ERROR -   4. Save CSV and reload in application
2025-12-14 13:03:03,420 - ERROR -   5. Try again
2025-12-14 13:03:03,421 - ERROR - 
2025-12-14 13:03:03,421 - ERROR - ======================================================================
2025-12-14 13:06:52,100 - INFO - Loaded 6 predefined prompts
2025-12-14 13:07:15,040 - INFO - Loaded 3 API keys
2025-12-14 13:07:46,149 - INFO - === Starting PDF Processing ===
2025-12-14 13:07:46,149 - INFO - Model: gemini-2.5-pro
2025-12-14 13:07:46,149 - INFO - PDF: /home/mohammadbagher/Downloads/PDFs/Bolognia 5th Edition 2024 (1)-7-26-46.pdf
2025-12-14 13:07:46,150 - INFO - Full prompt being sent (7390 chars): You are a meticulous medical OCR & structuring assistant. Your job is to extract **only** what is present on each provided textbook page image/PDF and convert it into clean, AI-ready text with structured sections. You MUST avoid hallucinations and preserve original medical meaning precisely. Follow these global rules:

GLOBAL PRINCIPLES
- NO HALLUCINATIONS: Output only content visible on the page(s). If unreadable/unclear, write: "[UNREADABLE]" or add an "uncertain" flag with brief reason.
- LANGUAGE & SPELLING: Preserve original English spelling and medical terminology; do not normalize British↔American spelling.
- CLEAN OCR: 
  - Remove page headers/footers, running titles, folios, and footers like “©Publisher 2023”.
  - Fix broken words at line breaks (e.g., "thera-\npy" → "therapy").
  - Replace ligatures (ﬁ, ﬂ) with normal letters.
  - Preserve meaningful capitalization, italics markers (use *italic*), bold (**bold**), and inline sub/superscripts as LaTeX if clearly indicated (e.g., CO$_2$).
- CITATIONS: Keep in-text citations literally (e.g., “[12]”, “(Smith 2021)”).
- MATH/CHEM: For formulae, use inline LaTeX: e.g., `pH = -\log_{10} [H^+]`.
- NO IMAGES: Describe figures/diagrams/charts in text form—succinct but complete. Do not invent unseen labels.

STRUCTURED OUTPUT FORMAT (Markdown with embedded JSON blocks)
Always produce in this exact order:

1) `# Page Metadata`
   - Book title (if visible), chapter title (if visible), page number (if visible or inferable), section headings found.
   - Confidence notes: short bullets where uncertainty exists.

2) `# Body`
   - Clean, continuous paragraph text. Keep section/subsection headings as `##` and `###`.

3) `# Tables`
   - For each table found, output a JSON block per table with:
   ```json
   {
     "type": "table",
     "title": "Table 3.2 Disease-modifying agents",
     "note": "footnotes or legends if present",
     "columns": ["Column A", "Column B", "Column C"],
     "rows": [
       ["cell(1,1)", "cell(1,2)", "cell(1,3)"],
       ["cell(2,1)", "cell(2,2)", "cell(2,3)"]
     ],
     "uncertain_cells": [{"row":2,"col":3,"reason":"blurry"}]
   }
If a table is complex (merged cells), normalize by repeating header labels; if impossible, add "structure_note".

# Algorithms / Clinical Approaches

Convert any flowchart, algorithm box, or approach diagram into BOTH:
a) Bulleted steps (plain text):

Step 1: …

If lab X > Y → do …

Else → …
b) Machine-readable pseudo-logic JSON:

json
Copy code
{
  "type": "algorithm",
  "title": "Approach to suspected DKA",
  "nodes": [
    {"id":"start","text":"Patient with hyperglycemia"},
    {"id":"n1","text":"Check ketones"},
    {"id":"n2","text":"If ketones positive → start insulin infusion"}
  ],
  "edges": [
    {"from":"start","to":"n1"},
    {"from":"n1","to":"n2","condition":"ketones positive"}
  ]
}
Use simple IDs; preserve clinical thresholds verbatim.

# Figures / Diagrams / Charts

For each figure, write a compact textual description capturing labels, axes, and key relationships.

If a chart encodes data values, extract the visible numbers as a small table. If not given, describe trends only.

Example JSON:

json
Copy code
{
  "type": "figure",
  "title": "Figure 5.1 Cardiac cycle",
  "description": "Schematic phases (isovolumetric contraction, ejection, …); labels: LV pressure, aortic pressure… Trend: LV pressure rises during …",
  "visible_labels": ["LV", "Aorta", "Mitral"],
  "data_points": null
}
# Lists & Key Points

Convert bullet lists and numbered lists cleanly.

For “pearls”, “high-yield” callouts, prefix with **HIGH-YIELD:**.

# References / Footnotes on Page

Transcribe verbatim; if footnote markers map to table/figure, cross-reference.

# Uncertain / OCR Issues

JSON array, where each item has: location (body/table/figure), snippet (if any), reason (e.g., “scan blur”), and confidence score 0–1.

ADDITIONAL RULES FOR DIFFICULT LAYOUTS

Multi-column pages: Respect reading order left→right, top→bottom per row.

Sidebars/callouts: Place them after the paragraph they visually relate to; prefix with > Note: or > Caution:; also mirror inside # Lists & Key Points if “pearls”.

Units & thresholds: Keep exact units (mg/kg, mmol/L). Do not convert units.

Drug names: Preserve capitalization of brand/generic as shown.

Abbreviations: On first obvious occurrence, if expansion is shown on page, include (abbr: expansion).

OUTPUT VALIDATION

Ensure valid JSON blocks (UTF-8, double quotes).

No trailing commas.

Do not wrap JSON in code fences other than the ones I asked above.

Final Output structure: your output must be sent is as a JSON in a code block with the delimiter of three consecutive semicolons like “;;;”. Each row is representative of a “page text” or “figure” or “Table”. So each “page text” and “figure” and “Table”  will have a row. The columns Headers are:
    1. Type
    2. Extraction
    3. Number
    4. Part
The “Type” column is for mentioning the type of the cell row data. The acceptable types are “page text” or “figure” or “Table”. If you are writing the page’s text in the extraction column, then the type will be “page text”. If the row in for figures, write “Figure”. And ”. If the row in for Tables, write “Table”.
The “Extraction” column is the main column for each row. If you are extracting a page’s text, write the complete text here. The JSONs of tables and figures must be written here as well.
The References in the end of the chapter must not be extracted. Ignore it.
The ”Number” column must show the page it is extracted from like 1 or 2 and more.
The “Part” column shows that the row’s content is included in which part. Use numbers like 1 or 2 and more.
How to define the parts for each row: in the beginning of the first page of the file there is a “Chapter contents” which demonstrates the parts of the chapter recommended by the author, which we call them “author parts”. I want you to make your own suggestion for dividing the parts, which we call them “Our parts”. The rules of dividing are as follows: an “our part” is consisted of as many as consecutive “author parts” without being the final “our part” more than 10 pages. For example if the “author part”s of the chapter are 2,4,5,3,1,7,5 pages respectively, the first “our part” will be consisted of the first two “author parts”. The second “our part” will be consisted of the third and fourth and fifth “author parts”. the third “our part” will be consisted of the sixth “author part”. the fourth “our part” will be consisted of the seventh “author part”.
If an “our part” ends in the middle of a page, some of the page text will be for the previous “our part” and some of the page will be for the next “our part”. The text of such pages must be written in two separate rows. One of them is related to the previous “our part” and one of them is related to next “our part”. Your goal should be avoiding a row’s content to be consisted of the data from two different “our part”s.
And for example if you decided to divide the chapter into 2 parts, you should write “1” for the contents of the first part and write “2” for the contents of the second part. 

VERY IMPORTANT: your output must be single line (minified). DO NOT EVER use the “ENTER” button inside the cells. It shouldn’t be html rich. Do not separate texts with ENTER.

You will now receive a PDF, respond in the exact structure described above.
2025-12-14 13:07:56,128 - INFO - PDF uploaded successfully with API key: bagher
2025-12-14 13:07:56,129 - INFO - Uploaded PDF file: Bolognia 5th Edition 2024 (1)-7-26-46.pdf
2025-12-14 13:07:56,130 - INFO - Model: gemini-2.5-pro, Max tokens for model: 32768, Using: 32768
2025-12-14 13:07:56,131 - INFO - Using max_output_tokens: 32768
2025-12-14 13:07:56,131 - INFO - Using model: gemini-2.5-pro
2025-12-14 13:07:56,132 - INFO - Sending prompt (length: 7390 characters)
2025-12-14 13:07:56,132 - INFO - Max output tokens: 32768
2025-12-14 13:07:56,133 - INFO - Using original prompt with JSON output instruction (prompt preserved)
2025-12-14 13:07:56,133 - INFO - Generating content with streaming enabled for complete response...
2025-12-14 13:07:57,420 - WARNING - ⚠️ Rate limit hit (429). Waiting 5.0s before retry 1/3...
2025-12-14 13:07:57,420 - WARNING -    Error: 429 Resource has been exhausted (e.g. check quota).
2025-12-14 13:08:02,738 - WARNING - ⚠️ Rate limit hit (429). Waiting 10.0s before retry 2/3...
2025-12-14 13:08:02,739 - WARNING -    Error: 429 Resource has been exhausted (e.g. check quota).
2025-12-14 13:08:13,057 - WARNING - ⚠️ Quota exhausted (429) with current API key. Attempting to switch to next key...
2025-12-14 13:08:13,058 - INFO - Retrying with API key 1/3: bagher
2025-12-14 13:08:22,889 - WARNING - ⚠️ Rate limit hit (429). Waiting 3.0s before retry 1/2...
2025-12-14 13:08:22,890 - WARNING -    Error: 429 Resource has been exhausted (e.g. check quota).
2025-12-14 13:08:26,192 - WARNING - API key bagher hit rate limit (429), trying next...
2025-12-14 13:08:26,195 - INFO - Retrying with API key 2/3: bagher
2025-12-14 13:08:37,997 - WARNING - ⚠️ Rate limit hit (429). Waiting 3.0s before retry 1/2...
2025-12-14 13:08:37,997 - WARNING -    Error: 429 Resource has been exhausted (e.g. check quota).
2025-12-14 13:08:41,321 - WARNING - API key bagher hit rate limit (429), trying next...
2025-12-14 13:08:41,321 - INFO - Retrying with API key 3/3: bagher
2025-12-14 13:08:44,029 - WARNING - ⚠️ Rate limit hit (429). Waiting 3.0s before retry 1/2...
2025-12-14 13:08:44,029 - WARNING -    Error: 429 Resource has been exhausted (e.g. check quota).
2025-12-14 13:08:47,339 - WARNING - API key bagher hit rate limit (429), trying next...
2025-12-14 13:08:47,339 - ERROR - ======================================================================
2025-12-14 13:08:47,339 - ERROR - ❌ All 3 API keys failed. Cannot process request.
2025-12-14 13:08:47,340 - ERROR - ======================================================================
2025-12-14 13:08:47,340 - ERROR - 
2025-12-14 13:08:47,340 - ERROR - Possible reasons:
2025-12-14 13:08:47,340 - ERROR -   • All keys LEAKED (403) → Remove leaked keys, add new ones
2025-12-14 13:08:47,340 - ERROR -   • All keys QUOTA EXHAUSTED (429) → Wait for reset or add more keys
2025-12-14 13:08:47,340 - ERROR -   • Keys INVALID/EXPIRED → Generate new keys from Google AI Studio
2025-12-14 13:08:47,340 - ERROR - 
2025-12-14 13:08:47,340 - ERROR - Quick fix:
2025-12-14 13:08:47,340 - ERROR -   1. Open API keys CSV file
2025-12-14 13:08:47,340 - ERROR -   2. Remove leaked/invalid keys
2025-12-14 13:08:47,341 - ERROR -   3. Add new keys from: https://aistudio.google.com/apikey
2025-12-14 13:08:47,341 - ERROR -   4. Save CSV and reload in application
2025-12-14 13:08:47,341 - ERROR -   5. Try again
2025-12-14 13:08:47,341 - ERROR - 
2025-12-14 13:08:47,341 - ERROR - ======================================================================
2025-12-14 13:18:03,826 - INFO - Loaded 6 predefined prompts
2025-12-14 13:18:38,341 - INFO - Loaded 3 API keys
2025-12-14 13:21:20,607 - INFO - === Starting PDF Processing ===
2025-12-14 13:21:20,607 - INFO - Model: gemini-2.5-flash
2025-12-14 13:21:20,607 - INFO - PDF: /home/mohammadbagher/Downloads/PDFs/Bolognia 5th Edition 2024 (1)-7-26-46.pdf
2025-12-14 13:21:20,608 - INFO - Full prompt being sent (7390 chars): You are a meticulous medical OCR & structuring assistant. Your job is to extract **only** what is present on each provided textbook page image/PDF and convert it into clean, AI-ready text with structured sections. You MUST avoid hallucinations and preserve original medical meaning precisely. Follow these global rules:

GLOBAL PRINCIPLES
- NO HALLUCINATIONS: Output only content visible on the page(s). If unreadable/unclear, write: "[UNREADABLE]" or add an "uncertain" flag with brief reason.
- LANGUAGE & SPELLING: Preserve original English spelling and medical terminology; do not normalize British↔American spelling.
- CLEAN OCR: 
  - Remove page headers/footers, running titles, folios, and footers like “©Publisher 2023”.
  - Fix broken words at line breaks (e.g., "thera-\npy" → "therapy").
  - Replace ligatures (ﬁ, ﬂ) with normal letters.
  - Preserve meaningful capitalization, italics markers (use *italic*), bold (**bold**), and inline sub/superscripts as LaTeX if clearly indicated (e.g., CO$_2$).
- CITATIONS: Keep in-text citations literally (e.g., “[12]”, “(Smith 2021)”).
- MATH/CHEM: For formulae, use inline LaTeX: e.g., `pH = -\log_{10} [H^+]`.
- NO IMAGES: Describe figures/diagrams/charts in text form—succinct but complete. Do not invent unseen labels.

STRUCTURED OUTPUT FORMAT (Markdown with embedded JSON blocks)
Always produce in this exact order:

1) `# Page Metadata`
   - Book title (if visible), chapter title (if visible), page number (if visible or inferable), section headings found.
   - Confidence notes: short bullets where uncertainty exists.

2) `# Body`
   - Clean, continuous paragraph text. Keep section/subsection headings as `##` and `###`.

3) `# Tables`
   - For each table found, output a JSON block per table with:
   ```json
   {
     "type": "table",
     "title": "Table 3.2 Disease-modifying agents",
     "note": "footnotes or legends if present",
     "columns": ["Column A", "Column B", "Column C"],
     "rows": [
       ["cell(1,1)", "cell(1,2)", "cell(1,3)"],
       ["cell(2,1)", "cell(2,2)", "cell(2,3)"]
     ],
     "uncertain_cells": [{"row":2,"col":3,"reason":"blurry"}]
   }
If a table is complex (merged cells), normalize by repeating header labels; if impossible, add "structure_note".

# Algorithms / Clinical Approaches

Convert any flowchart, algorithm box, or approach diagram into BOTH:
a) Bulleted steps (plain text):

Step 1: …

If lab X > Y → do …

Else → …
b) Machine-readable pseudo-logic JSON:

json
Copy code
{
  "type": "algorithm",
  "title": "Approach to suspected DKA",
  "nodes": [
    {"id":"start","text":"Patient with hyperglycemia"},
    {"id":"n1","text":"Check ketones"},
    {"id":"n2","text":"If ketones positive → start insulin infusion"}
  ],
  "edges": [
    {"from":"start","to":"n1"},
    {"from":"n1","to":"n2","condition":"ketones positive"}
  ]
}
Use simple IDs; preserve clinical thresholds verbatim.

# Figures / Diagrams / Charts

For each figure, write a compact textual description capturing labels, axes, and key relationships.

If a chart encodes data values, extract the visible numbers as a small table. If not given, describe trends only.

Example JSON:

json
Copy code
{
  "type": "figure",
  "title": "Figure 5.1 Cardiac cycle",
  "description": "Schematic phases (isovolumetric contraction, ejection, …); labels: LV pressure, aortic pressure… Trend: LV pressure rises during …",
  "visible_labels": ["LV", "Aorta", "Mitral"],
  "data_points": null
}
# Lists & Key Points

Convert bullet lists and numbered lists cleanly.

For “pearls”, “high-yield” callouts, prefix with **HIGH-YIELD:**.

# References / Footnotes on Page

Transcribe verbatim; if footnote markers map to table/figure, cross-reference.

# Uncertain / OCR Issues

JSON array, where each item has: location (body/table/figure), snippet (if any), reason (e.g., “scan blur”), and confidence score 0–1.

ADDITIONAL RULES FOR DIFFICULT LAYOUTS

Multi-column pages: Respect reading order left→right, top→bottom per row.

Sidebars/callouts: Place them after the paragraph they visually relate to; prefix with > Note: or > Caution:; also mirror inside # Lists & Key Points if “pearls”.

Units & thresholds: Keep exact units (mg/kg, mmol/L). Do not convert units.

Drug names: Preserve capitalization of brand/generic as shown.

Abbreviations: On first obvious occurrence, if expansion is shown on page, include (abbr: expansion).

OUTPUT VALIDATION

Ensure valid JSON blocks (UTF-8, double quotes).

No trailing commas.

Do not wrap JSON in code fences other than the ones I asked above.

Final Output structure: your output must be sent is as a JSON in a code block with the delimiter of three consecutive semicolons like “;;;”. Each row is representative of a “page text” or “figure” or “Table”. So each “page text” and “figure” and “Table”  will have a row. The columns Headers are:
    1. Type
    2. Extraction
    3. Number
    4. Part
The “Type” column is for mentioning the type of the cell row data. The acceptable types are “page text” or “figure” or “Table”. If you are writing the page’s text in the extraction column, then the type will be “page text”. If the row in for figures, write “Figure”. And ”. If the row in for Tables, write “Table”.
The “Extraction” column is the main column for each row. If you are extracting a page’s text, write the complete text here. The JSONs of tables and figures must be written here as well.
The References in the end of the chapter must not be extracted. Ignore it.
The ”Number” column must show the page it is extracted from like 1 or 2 and more.
The “Part” column shows that the row’s content is included in which part. Use numbers like 1 or 2 and more.
How to define the parts for each row: in the beginning of the first page of the file there is a “Chapter contents” which demonstrates the parts of the chapter recommended by the author, which we call them “author parts”. I want you to make your own suggestion for dividing the parts, which we call them “Our parts”. The rules of dividing are as follows: an “our part” is consisted of as many as consecutive “author parts” without being the final “our part” more than 10 pages. For example if the “author part”s of the chapter are 2,4,5,3,1,7,5 pages respectively, the first “our part” will be consisted of the first two “author parts”. The second “our part” will be consisted of the third and fourth and fifth “author parts”. the third “our part” will be consisted of the sixth “author part”. the fourth “our part” will be consisted of the seventh “author part”.
If an “our part” ends in the middle of a page, some of the page text will be for the previous “our part” and some of the page will be for the next “our part”. The text of such pages must be written in two separate rows. One of them is related to the previous “our part” and one of them is related to next “our part”. Your goal should be avoiding a row’s content to be consisted of the data from two different “our part”s.
And for example if you decided to divide the chapter into 2 parts, you should write “1” for the contents of the first part and write “2” for the contents of the second part. 

VERY IMPORTANT: your output must be single line (minified). DO NOT EVER use the “ENTER” button inside the cells. It shouldn’t be html rich. Do not separate texts with ENTER.

You will now receive a PDF, respond in the exact structure described above.
2025-12-14 13:21:32,507 - INFO - PDF uploaded successfully with API key: bagher
2025-12-14 13:21:32,508 - INFO - Uploaded PDF file: Bolognia 5th Edition 2024 (1)-7-26-46.pdf
2025-12-14 13:21:32,510 - INFO - Model: gemini-2.5-flash, Max tokens for model: 32768, Using: 32768
2025-12-14 13:21:32,512 - INFO - Using max_output_tokens: 32768
2025-12-14 13:21:32,513 - INFO - Using model: gemini-2.5-flash
2025-12-14 13:21:32,513 - INFO - Sending prompt (length: 7390 characters)
2025-12-14 13:21:32,514 - INFO - Max output tokens: 32768
2025-12-14 13:21:32,514 - INFO - Using original prompt with JSON output instruction (prompt preserved)
2025-12-14 13:21:32,515 - INFO - Generating content with streaming enabled for complete response...
2025-12-14 13:23:40,228 - INFO - Streaming completed: 115473 characters received
2025-12-14 13:23:40,229 - INFO - Streaming finish reason: MAX_TOKENS (truncated!)
2025-12-14 13:23:40,229 - WARNING - ⚠️ Response may be truncated (finish_reason: MAX_TOKENS (truncated!))
2025-12-14 13:23:40,230 - INFO - Response received (length: 115473 characters)
2025-12-14 13:23:40,231 - WARNING - Response might be truncated - checking for finish reason
2025-12-14 13:23:40,967 - INFO - Extracted response from response.text (115473 chars)
2025-12-14 13:23:40,968 - INFO - Extracted content from generic code block
2025-12-14 13:23:40,968 - INFO - PDF processed successfully with gemini-2.5-flash
2025-12-14 13:23:40,969 - INFO - Full response length: 115473 characters
2025-12-14 13:23:40,969 - INFO - Extracted from code block: 8369 characters
2025-12-14 13:23:40,970 - INFO - Response preview (first 500 chars): [
  {
    "Type": "page text",
    "Extraction": "# Page Metadata\n- Book title: VESICULOBULLOUS DISEASES SECTION 5\n- Chapter title: Pemphigoid Group\n- Page number: 517\n- Section headings: Chapter Contents, BULLOUS PEMPHIGOID, Synonym: Pemphigoid, Key features, Introduction, History, Epidemiology, Pathogenesis, Humoral and cellular responses\n# Body\nVESICULOBULLOUS DISEASES SECTION 5\nPemphigoid Group 30\nLuca Borradori and Michael Hertl\n## Chapter Contents\nBullous Pemphigoid.................
2025-12-14 13:23:40,971 - INFO - Response preview (last 500 chars): ... The latter serve to further amplify the inflammatory response$^{5,11-16}$ while the proteinases, together with reactive oxygen species, degrade various extracellular matrix proteins as well as BP180$^{11-16}$. IgG anti-BP180 autoantibodies can also boost the inflammatory response by stimulating keratinocytes to express inflammatory cytokines (Fig. 30.1)$^{11}$. Furthermore, IgG autoantibodies are able to directly impair dermal-epidermal adhesion without complement activation$^{11}$.\n# Tables\n
2025-12-14 13:23:40,971 - INFO - Returning raw response from model (no JSON extraction)
2025-12-14 13:23:40,972 - INFO - ✓ CSV response appears complete (last row has delimiter)
2025-12-14 13:24:06,379 - INFO - === Response Received ===
2025-12-14 13:24:06,381 - INFO - Response length: 8369 characters
2025-12-14 13:24:06,382 - INFO - Truncated: True
2025-12-14 13:24:06,383 - INFO - Response preview (first 500 chars): [
  {
    "Type": "page text",
    "Extraction": "# Page Metadata\n- Book title: VESICULOBULLOUS DISEASES SECTION 5\n- Chapter title: Pemphigoid Group\n- Page number: 517\n- Section headings: Chapter Contents, BULLOUS PEMPHIGOID, Synonym: Pemphigoid, Key features, Introduction, History, Epidemiology, Pathogenesis, Humoral and cellular responses\n# Body\nVESICULOBULLOUS DISEASES SECTION 5\nPemphigoid Group 30\nLuca Borradori and Michael Hertl\n## Chapter Contents\nBullous Pemphigoid.................
2025-12-14 13:24:06,383 - INFO - Response preview (last 500 chars): ... The latter serve to further amplify the inflammatory response$^{5,11-16}$ while the proteinases, together with reactive oxygen species, degrade various extracellular matrix proteins as well as BP180$^{11-16}$. IgG anti-BP180 autoantibodies can also boost the inflammatory response by stimulating keratinocytes to express inflammatory cytokines (Fig. 30.1)$^{11}$. Furthermore, IgG autoantibodies are able to directly impair dermal-epidermal adhesion without complement activation$^{11}$.\n# Tables\n
2025-12-14 13:24:06,902 - WARNING - python-docx not available, saving as text file
2025-12-14 13:24:06,909 - INFO - Response displayed and saved to: /home/mohammadbagher/Downloads/PDFs/Bolognia 5th Edition 2024 (1)-7-26-46_response_20251214_132406.txt
2025-12-14 13:25:14,369 - INFO - === Starting PDF Processing ===
2025-12-14 13:25:14,369 - INFO - Model: gemini-1.5-pro
2025-12-14 13:25:14,369 - INFO - PDF: /home/mohammadbagher/Downloads/PDFs/Bolognia 5th Edition 2024 (1)-7-26-46.pdf
2025-12-14 13:25:14,369 - INFO - Full prompt being sent (7390 chars): You are a meticulous medical OCR & structuring assistant. Your job is to extract **only** what is present on each provided textbook page image/PDF and convert it into clean, AI-ready text with structured sections. You MUST avoid hallucinations and preserve original medical meaning precisely. Follow these global rules:

GLOBAL PRINCIPLES
- NO HALLUCINATIONS: Output only content visible on the page(s). If unreadable/unclear, write: "[UNREADABLE]" or add an "uncertain" flag with brief reason.
- LANGUAGE & SPELLING: Preserve original English spelling and medical terminology; do not normalize British↔American spelling.
- CLEAN OCR: 
  - Remove page headers/footers, running titles, folios, and footers like “©Publisher 2023”.
  - Fix broken words at line breaks (e.g., "thera-\npy" → "therapy").
  - Replace ligatures (ﬁ, ﬂ) with normal letters.
  - Preserve meaningful capitalization, italics markers (use *italic*), bold (**bold**), and inline sub/superscripts as LaTeX if clearly indicated (e.g., CO$_2$).
- CITATIONS: Keep in-text citations literally (e.g., “[12]”, “(Smith 2021)”).
- MATH/CHEM: For formulae, use inline LaTeX: e.g., `pH = -\log_{10} [H^+]`.
- NO IMAGES: Describe figures/diagrams/charts in text form—succinct but complete. Do not invent unseen labels.

STRUCTURED OUTPUT FORMAT (Markdown with embedded JSON blocks)
Always produce in this exact order:

1) `# Page Metadata`
   - Book title (if visible), chapter title (if visible), page number (if visible or inferable), section headings found.
   - Confidence notes: short bullets where uncertainty exists.

2) `# Body`
   - Clean, continuous paragraph text. Keep section/subsection headings as `##` and `###`.

3) `# Tables`
   - For each table found, output a JSON block per table with:
   ```json
   {
     "type": "table",
     "title": "Table 3.2 Disease-modifying agents",
     "note": "footnotes or legends if present",
     "columns": ["Column A", "Column B", "Column C"],
     "rows": [
       ["cell(1,1)", "cell(1,2)", "cell(1,3)"],
       ["cell(2,1)", "cell(2,2)", "cell(2,3)"]
     ],
     "uncertain_cells": [{"row":2,"col":3,"reason":"blurry"}]
   }
If a table is complex (merged cells), normalize by repeating header labels; if impossible, add "structure_note".

# Algorithms / Clinical Approaches

Convert any flowchart, algorithm box, or approach diagram into BOTH:
a) Bulleted steps (plain text):

Step 1: …

If lab X > Y → do …

Else → …
b) Machine-readable pseudo-logic JSON:

json
Copy code
{
  "type": "algorithm",
  "title": "Approach to suspected DKA",
  "nodes": [
    {"id":"start","text":"Patient with hyperglycemia"},
    {"id":"n1","text":"Check ketones"},
    {"id":"n2","text":"If ketones positive → start insulin infusion"}
  ],
  "edges": [
    {"from":"start","to":"n1"},
    {"from":"n1","to":"n2","condition":"ketones positive"}
  ]
}
Use simple IDs; preserve clinical thresholds verbatim.

# Figures / Diagrams / Charts

For each figure, write a compact textual description capturing labels, axes, and key relationships.

If a chart encodes data values, extract the visible numbers as a small table. If not given, describe trends only.

Example JSON:

json
Copy code
{
  "type": "figure",
  "title": "Figure 5.1 Cardiac cycle",
  "description": "Schematic phases (isovolumetric contraction, ejection, …); labels: LV pressure, aortic pressure… Trend: LV pressure rises during …",
  "visible_labels": ["LV", "Aorta", "Mitral"],
  "data_points": null
}
# Lists & Key Points

Convert bullet lists and numbered lists cleanly.

For “pearls”, “high-yield” callouts, prefix with **HIGH-YIELD:**.

# References / Footnotes on Page

Transcribe verbatim; if footnote markers map to table/figure, cross-reference.

# Uncertain / OCR Issues

JSON array, where each item has: location (body/table/figure), snippet (if any), reason (e.g., “scan blur”), and confidence score 0–1.

ADDITIONAL RULES FOR DIFFICULT LAYOUTS

Multi-column pages: Respect reading order left→right, top→bottom per row.

Sidebars/callouts: Place them after the paragraph they visually relate to; prefix with > Note: or > Caution:; also mirror inside # Lists & Key Points if “pearls”.

Units & thresholds: Keep exact units (mg/kg, mmol/L). Do not convert units.

Drug names: Preserve capitalization of brand/generic as shown.

Abbreviations: On first obvious occurrence, if expansion is shown on page, include (abbr: expansion).

OUTPUT VALIDATION

Ensure valid JSON blocks (UTF-8, double quotes).

No trailing commas.

Do not wrap JSON in code fences other than the ones I asked above.

Final Output structure: your output must be sent is as a JSON in a code block with the delimiter of three consecutive semicolons like “;;;”. Each row is representative of a “page text” or “figure” or “Table”. So each “page text” and “figure” and “Table”  will have a row. The columns Headers are:
    1. Type
    2. Extraction
    3. Number
    4. Part
The “Type” column is for mentioning the type of the cell row data. The acceptable types are “page text” or “figure” or “Table”. If you are writing the page’s text in the extraction column, then the type will be “page text”. If the row in for figures, write “Figure”. And ”. If the row in for Tables, write “Table”.
The “Extraction” column is the main column for each row. If you are extracting a page’s text, write the complete text here. The JSONs of tables and figures must be written here as well.
The References in the end of the chapter must not be extracted. Ignore it.
The ”Number” column must show the page it is extracted from like 1 or 2 and more.
The “Part” column shows that the row’s content is included in which part. Use numbers like 1 or 2 and more.
How to define the parts for each row: in the beginning of the first page of the file there is a “Chapter contents” which demonstrates the parts of the chapter recommended by the author, which we call them “author parts”. I want you to make your own suggestion for dividing the parts, which we call them “Our parts”. The rules of dividing are as follows: an “our part” is consisted of as many as consecutive “author parts” without being the final “our part” more than 10 pages. For example if the “author part”s of the chapter are 2,4,5,3,1,7,5 pages respectively, the first “our part” will be consisted of the first two “author parts”. The second “our part” will be consisted of the third and fourth and fifth “author parts”. the third “our part” will be consisted of the sixth “author part”. the fourth “our part” will be consisted of the seventh “author part”.
If an “our part” ends in the middle of a page, some of the page text will be for the previous “our part” and some of the page will be for the next “our part”. The text of such pages must be written in two separate rows. One of them is related to the previous “our part” and one of them is related to next “our part”. Your goal should be avoiding a row’s content to be consisted of the data from two different “our part”s.
And for example if you decided to divide the chapter into 2 parts, you should write “1” for the contents of the first part and write “2” for the contents of the second part. 

VERY IMPORTANT: your output must be single line (minified). DO NOT EVER use the “ENTER” button inside the cells. It shouldn’t be html rich. Do not separate texts with ENTER.

You will now receive a PDF, respond in the exact structure described above.
2025-12-14 13:25:25,662 - INFO - PDF uploaded successfully with API key: bagher
2025-12-14 13:25:25,662 - INFO - Uploaded PDF file: Bolognia 5th Edition 2024 (1)-7-26-46.pdf
2025-12-14 13:25:25,663 - INFO - Model: gemini-1.5-pro, Max tokens for model: 8192, Using: 8192
2025-12-14 13:25:25,664 - INFO - Using max_output_tokens: 8192
2025-12-14 13:25:25,664 - INFO - Using model: gemini-1.5-pro
2025-12-14 13:25:25,664 - INFO - Sending prompt (length: 7390 characters)
2025-12-14 13:25:25,665 - INFO - Max output tokens: 8192
2025-12-14 13:25:25,665 - INFO - Using original prompt with JSON output instruction (prompt preserved)
2025-12-14 13:25:25,666 - INFO - Generating content with streaming enabled for complete response...
2025-12-14 13:25:27,020 - WARNING - Streaming not available or failed: 404 models/gemini-1.5-pro is not found for API version v1beta, or is not supported for generateContent. Call ListModels to see the list of available models and their supported methods., using non-streaming
2025-12-14 13:25:27,308 - ERROR - PDF processing failed: 404 models/gemini-1.5-pro is not found for API version v1beta, or is not supported for generateContent. Call ListModels to see the list of available models and their supported methods.
2025-12-14 13:25:34,808 - INFO - === Starting PDF Processing ===
2025-12-14 13:25:34,809 - INFO - Model: gemini-2.5-pro
2025-12-14 13:25:34,810 - INFO - PDF: /home/mohammadbagher/Downloads/PDFs/Bolognia 5th Edition 2024 (1)-7-26-46.pdf
2025-12-14 13:25:34,810 - INFO - Full prompt being sent (7390 chars): You are a meticulous medical OCR & structuring assistant. Your job is to extract **only** what is present on each provided textbook page image/PDF and convert it into clean, AI-ready text with structured sections. You MUST avoid hallucinations and preserve original medical meaning precisely. Follow these global rules:

GLOBAL PRINCIPLES
- NO HALLUCINATIONS: Output only content visible on the page(s). If unreadable/unclear, write: "[UNREADABLE]" or add an "uncertain" flag with brief reason.
- LANGUAGE & SPELLING: Preserve original English spelling and medical terminology; do not normalize British↔American spelling.
- CLEAN OCR: 
  - Remove page headers/footers, running titles, folios, and footers like “©Publisher 2023”.
  - Fix broken words at line breaks (e.g., "thera-\npy" → "therapy").
  - Replace ligatures (ﬁ, ﬂ) with normal letters.
  - Preserve meaningful capitalization, italics markers (use *italic*), bold (**bold**), and inline sub/superscripts as LaTeX if clearly indicated (e.g., CO$_2$).
- CITATIONS: Keep in-text citations literally (e.g., “[12]”, “(Smith 2021)”).
- MATH/CHEM: For formulae, use inline LaTeX: e.g., `pH = -\log_{10} [H^+]`.
- NO IMAGES: Describe figures/diagrams/charts in text form—succinct but complete. Do not invent unseen labels.

STRUCTURED OUTPUT FORMAT (Markdown with embedded JSON blocks)
Always produce in this exact order:

1) `# Page Metadata`
   - Book title (if visible), chapter title (if visible), page number (if visible or inferable), section headings found.
   - Confidence notes: short bullets where uncertainty exists.

2) `# Body`
   - Clean, continuous paragraph text. Keep section/subsection headings as `##` and `###`.

3) `# Tables`
   - For each table found, output a JSON block per table with:
   ```json
   {
     "type": "table",
     "title": "Table 3.2 Disease-modifying agents",
     "note": "footnotes or legends if present",
     "columns": ["Column A", "Column B", "Column C"],
     "rows": [
       ["cell(1,1)", "cell(1,2)", "cell(1,3)"],
       ["cell(2,1)", "cell(2,2)", "cell(2,3)"]
     ],
     "uncertain_cells": [{"row":2,"col":3,"reason":"blurry"}]
   }
If a table is complex (merged cells), normalize by repeating header labels; if impossible, add "structure_note".

# Algorithms / Clinical Approaches

Convert any flowchart, algorithm box, or approach diagram into BOTH:
a) Bulleted steps (plain text):

Step 1: …

If lab X > Y → do …

Else → …
b) Machine-readable pseudo-logic JSON:

json
Copy code
{
  "type": "algorithm",
  "title": "Approach to suspected DKA",
  "nodes": [
    {"id":"start","text":"Patient with hyperglycemia"},
    {"id":"n1","text":"Check ketones"},
    {"id":"n2","text":"If ketones positive → start insulin infusion"}
  ],
  "edges": [
    {"from":"start","to":"n1"},
    {"from":"n1","to":"n2","condition":"ketones positive"}
  ]
}
Use simple IDs; preserve clinical thresholds verbatim.

# Figures / Diagrams / Charts

For each figure, write a compact textual description capturing labels, axes, and key relationships.

If a chart encodes data values, extract the visible numbers as a small table. If not given, describe trends only.

Example JSON:

json
Copy code
{
  "type": "figure",
  "title": "Figure 5.1 Cardiac cycle",
  "description": "Schematic phases (isovolumetric contraction, ejection, …); labels: LV pressure, aortic pressure… Trend: LV pressure rises during …",
  "visible_labels": ["LV", "Aorta", "Mitral"],
  "data_points": null
}
# Lists & Key Points

Convert bullet lists and numbered lists cleanly.

For “pearls”, “high-yield” callouts, prefix with **HIGH-YIELD:**.

# References / Footnotes on Page

Transcribe verbatim; if footnote markers map to table/figure, cross-reference.

# Uncertain / OCR Issues

JSON array, where each item has: location (body/table/figure), snippet (if any), reason (e.g., “scan blur”), and confidence score 0–1.

ADDITIONAL RULES FOR DIFFICULT LAYOUTS

Multi-column pages: Respect reading order left→right, top→bottom per row.

Sidebars/callouts: Place them after the paragraph they visually relate to; prefix with > Note: or > Caution:; also mirror inside # Lists & Key Points if “pearls”.

Units & thresholds: Keep exact units (mg/kg, mmol/L). Do not convert units.

Drug names: Preserve capitalization of brand/generic as shown.

Abbreviations: On first obvious occurrence, if expansion is shown on page, include (abbr: expansion).

OUTPUT VALIDATION

Ensure valid JSON blocks (UTF-8, double quotes).

No trailing commas.

Do not wrap JSON in code fences other than the ones I asked above.

Final Output structure: your output must be sent is as a JSON in a code block with the delimiter of three consecutive semicolons like “;;;”. Each row is representative of a “page text” or “figure” or “Table”. So each “page text” and “figure” and “Table”  will have a row. The columns Headers are:
    1. Type
    2. Extraction
    3. Number
    4. Part
The “Type” column is for mentioning the type of the cell row data. The acceptable types are “page text” or “figure” or “Table”. If you are writing the page’s text in the extraction column, then the type will be “page text”. If the row in for figures, write “Figure”. And ”. If the row in for Tables, write “Table”.
The “Extraction” column is the main column for each row. If you are extracting a page’s text, write the complete text here. The JSONs of tables and figures must be written here as well.
The References in the end of the chapter must not be extracted. Ignore it.
The ”Number” column must show the page it is extracted from like 1 or 2 and more.
The “Part” column shows that the row’s content is included in which part. Use numbers like 1 or 2 and more.
How to define the parts for each row: in the beginning of the first page of the file there is a “Chapter contents” which demonstrates the parts of the chapter recommended by the author, which we call them “author parts”. I want you to make your own suggestion for dividing the parts, which we call them “Our parts”. The rules of dividing are as follows: an “our part” is consisted of as many as consecutive “author parts” without being the final “our part” more than 10 pages. For example if the “author part”s of the chapter are 2,4,5,3,1,7,5 pages respectively, the first “our part” will be consisted of the first two “author parts”. The second “our part” will be consisted of the third and fourth and fifth “author parts”. the third “our part” will be consisted of the sixth “author part”. the fourth “our part” will be consisted of the seventh “author part”.
If an “our part” ends in the middle of a page, some of the page text will be for the previous “our part” and some of the page will be for the next “our part”. The text of such pages must be written in two separate rows. One of them is related to the previous “our part” and one of them is related to next “our part”. Your goal should be avoiding a row’s content to be consisted of the data from two different “our part”s.
And for example if you decided to divide the chapter into 2 parts, you should write “1” for the contents of the first part and write “2” for the contents of the second part. 

VERY IMPORTANT: your output must be single line (minified). DO NOT EVER use the “ENTER” button inside the cells. It shouldn’t be html rich. Do not separate texts with ENTER.

You will now receive a PDF, respond in the exact structure described above.
2025-12-14 13:25:45,222 - INFO - PDF uploaded successfully with API key: bagher
2025-12-14 13:25:45,222 - INFO - Uploaded PDF file: Bolognia 5th Edition 2024 (1)-7-26-46.pdf
2025-12-14 13:25:45,227 - INFO - Model: gemini-2.5-pro, Max tokens for model: 32768, Using: 32768
2025-12-14 13:25:45,228 - INFO - Using max_output_tokens: 32768
2025-12-14 13:25:45,228 - INFO - Using model: gemini-2.5-pro
2025-12-14 13:25:45,229 - INFO - Sending prompt (length: 7390 characters)
2025-12-14 13:25:45,230 - INFO - Max output tokens: 32768
2025-12-14 13:25:45,230 - INFO - Using original prompt with JSON output instruction (prompt preserved)
2025-12-14 13:25:45,231 - INFO - Generating content with streaming enabled for complete response...
2025-12-14 13:25:46,582 - WARNING - ⚠️ Rate limit hit (429). Waiting 5.0s before retry 1/3...
2025-12-14 13:25:46,583 - WARNING -    Error: 429 Resource has been exhausted (e.g. check quota).
2025-12-14 13:25:51,894 - WARNING - ⚠️ Rate limit hit (429). Waiting 10.0s before retry 2/3...
2025-12-14 13:25:51,894 - WARNING -    Error: 429 Resource has been exhausted (e.g. check quota).
2025-12-14 13:26:02,232 - WARNING - ⚠️ Quota exhausted (429) with current API key. Attempting to switch to next key...
2025-12-14 13:26:02,233 - INFO - Retrying with API key 1/3: bagher
2025-12-14 13:26:11,484 - WARNING - ⚠️ Rate limit hit (429). Waiting 3.0s before retry 1/2...
2025-12-14 13:26:11,484 - WARNING -    Error: 429 Resource has been exhausted (e.g. check quota).
2025-12-14 13:26:14,799 - WARNING - API key bagher hit rate limit (429), trying next...
2025-12-14 13:26:14,800 - INFO - Retrying with API key 2/3: bagher
2025-12-14 13:26:28,245 - WARNING - ⚠️ Rate limit hit (429). Waiting 3.0s before retry 1/2...
2025-12-14 13:26:28,245 - WARNING -    Error: 429 Resource has been exhausted (e.g. check quota).
2025-12-14 13:26:31,555 - WARNING - API key bagher hit rate limit (429), trying next...
2025-12-14 13:26:31,556 - INFO - Retrying with API key 3/3: bagher
2025-12-14 13:26:34,424 - WARNING - ⚠️ Rate limit hit (429). Waiting 3.0s before retry 1/2...
2025-12-14 13:26:34,424 - WARNING -    Error: 429 Resource has been exhausted (e.g. check quota).
2025-12-14 13:26:37,723 - WARNING - API key bagher hit rate limit (429), trying next...
2025-12-14 13:26:37,724 - ERROR - ======================================================================
2025-12-14 13:26:37,725 - ERROR - ❌ All 3 API keys failed. Cannot process request.
2025-12-14 13:26:37,725 - ERROR - ======================================================================
2025-12-14 13:26:37,726 - ERROR - 
2025-12-14 13:26:37,726 - ERROR - Possible reasons:
2025-12-14 13:26:37,726 - ERROR -   • All keys LEAKED (403) → Remove leaked keys, add new ones
2025-12-14 13:26:37,727 - ERROR -   • All keys QUOTA EXHAUSTED (429) → Wait for reset or add more keys
2025-12-14 13:26:37,727 - ERROR -   • Keys INVALID/EXPIRED → Generate new keys from Google AI Studio
2025-12-14 13:26:37,728 - ERROR - 
2025-12-14 13:26:37,728 - ERROR - Quick fix:
2025-12-14 13:26:37,729 - ERROR -   1. Open API keys CSV file
2025-12-14 13:26:37,729 - ERROR -   2. Remove leaked/invalid keys
2025-12-14 13:26:37,730 - ERROR -   3. Add new keys from: https://aistudio.google.com/apikey
2025-12-14 13:26:37,730 - ERROR -   4. Save CSV and reload in application
2025-12-14 13:26:37,731 - ERROR -   5. Try again
2025-12-14 13:26:37,731 - ERROR - 
2025-12-14 13:26:37,732 - ERROR - ======================================================================
2025-12-14 13:38:14,394 - INFO - Loaded 6 predefined prompts
2025-12-14 13:38:35,037 - INFO - Loaded 3 API keys
2025-12-14 13:39:15,040 - INFO - === Starting PDF Processing ===
2025-12-14 13:39:15,040 - INFO - Model: gemini-2.5-pro
2025-12-14 13:39:15,040 - INFO - PDF: /home/mohammadbagher/Downloads/PDFs/Bolognia 5th Edition 2024 (1)-7-26-46.pdf
2025-12-14 13:39:15,040 - INFO - Full prompt being sent (7390 chars): You are a meticulous medical OCR & structuring assistant. Your job is to extract **only** what is present on each provided textbook page image/PDF and convert it into clean, AI-ready text with structured sections. You MUST avoid hallucinations and preserve original medical meaning precisely. Follow these global rules:

GLOBAL PRINCIPLES
- NO HALLUCINATIONS: Output only content visible on the page(s). If unreadable/unclear, write: "[UNREADABLE]" or add an "uncertain" flag with brief reason.
- LANGUAGE & SPELLING: Preserve original English spelling and medical terminology; do not normalize British↔American spelling.
- CLEAN OCR: 
  - Remove page headers/footers, running titles, folios, and footers like “©Publisher 2023”.
  - Fix broken words at line breaks (e.g., "thera-\npy" → "therapy").
  - Replace ligatures (ﬁ, ﬂ) with normal letters.
  - Preserve meaningful capitalization, italics markers (use *italic*), bold (**bold**), and inline sub/superscripts as LaTeX if clearly indicated (e.g., CO$_2$).
- CITATIONS: Keep in-text citations literally (e.g., “[12]”, “(Smith 2021)”).
- MATH/CHEM: For formulae, use inline LaTeX: e.g., `pH = -\log_{10} [H^+]`.
- NO IMAGES: Describe figures/diagrams/charts in text form—succinct but complete. Do not invent unseen labels.

STRUCTURED OUTPUT FORMAT (Markdown with embedded JSON blocks)
Always produce in this exact order:

1) `# Page Metadata`
   - Book title (if visible), chapter title (if visible), page number (if visible or inferable), section headings found.
   - Confidence notes: short bullets where uncertainty exists.

2) `# Body`
   - Clean, continuous paragraph text. Keep section/subsection headings as `##` and `###`.

3) `# Tables`
   - For each table found, output a JSON block per table with:
   ```json
   {
     "type": "table",
     "title": "Table 3.2 Disease-modifying agents",
     "note": "footnotes or legends if present",
     "columns": ["Column A", "Column B", "Column C"],
     "rows": [
       ["cell(1,1)", "cell(1,2)", "cell(1,3)"],
       ["cell(2,1)", "cell(2,2)", "cell(2,3)"]
     ],
     "uncertain_cells": [{"row":2,"col":3,"reason":"blurry"}]
   }
If a table is complex (merged cells), normalize by repeating header labels; if impossible, add "structure_note".

# Algorithms / Clinical Approaches

Convert any flowchart, algorithm box, or approach diagram into BOTH:
a) Bulleted steps (plain text):

Step 1: …

If lab X > Y → do …

Else → …
b) Machine-readable pseudo-logic JSON:

json
Copy code
{
  "type": "algorithm",
  "title": "Approach to suspected DKA",
  "nodes": [
    {"id":"start","text":"Patient with hyperglycemia"},
    {"id":"n1","text":"Check ketones"},
    {"id":"n2","text":"If ketones positive → start insulin infusion"}
  ],
  "edges": [
    {"from":"start","to":"n1"},
    {"from":"n1","to":"n2","condition":"ketones positive"}
  ]
}
Use simple IDs; preserve clinical thresholds verbatim.

# Figures / Diagrams / Charts

For each figure, write a compact textual description capturing labels, axes, and key relationships.

If a chart encodes data values, extract the visible numbers as a small table. If not given, describe trends only.

Example JSON:

json
Copy code
{
  "type": "figure",
  "title": "Figure 5.1 Cardiac cycle",
  "description": "Schematic phases (isovolumetric contraction, ejection, …); labels: LV pressure, aortic pressure… Trend: LV pressure rises during …",
  "visible_labels": ["LV", "Aorta", "Mitral"],
  "data_points": null
}
# Lists & Key Points

Convert bullet lists and numbered lists cleanly.

For “pearls”, “high-yield” callouts, prefix with **HIGH-YIELD:**.

# References / Footnotes on Page

Transcribe verbatim; if footnote markers map to table/figure, cross-reference.

# Uncertain / OCR Issues

JSON array, where each item has: location (body/table/figure), snippet (if any), reason (e.g., “scan blur”), and confidence score 0–1.

ADDITIONAL RULES FOR DIFFICULT LAYOUTS

Multi-column pages: Respect reading order left→right, top→bottom per row.

Sidebars/callouts: Place them after the paragraph they visually relate to; prefix with > Note: or > Caution:; also mirror inside # Lists & Key Points if “pearls”.

Units & thresholds: Keep exact units (mg/kg, mmol/L). Do not convert units.

Drug names: Preserve capitalization of brand/generic as shown.

Abbreviations: On first obvious occurrence, if expansion is shown on page, include (abbr: expansion).

OUTPUT VALIDATION

Ensure valid JSON blocks (UTF-8, double quotes).

No trailing commas.

Do not wrap JSON in code fences other than the ones I asked above.

Final Output structure: your output must be sent is as a JSON in a code block with the delimiter of three consecutive semicolons like “;;;”. Each row is representative of a “page text” or “figure” or “Table”. So each “page text” and “figure” and “Table”  will have a row. The columns Headers are:
    1. Type
    2. Extraction
    3. Number
    4. Part
The “Type” column is for mentioning the type of the cell row data. The acceptable types are “page text” or “figure” or “Table”. If you are writing the page’s text in the extraction column, then the type will be “page text”. If the row in for figures, write “Figure”. And ”. If the row in for Tables, write “Table”.
The “Extraction” column is the main column for each row. If you are extracting a page’s text, write the complete text here. The JSONs of tables and figures must be written here as well.
The References in the end of the chapter must not be extracted. Ignore it.
The ”Number” column must show the page it is extracted from like 1 or 2 and more.
The “Part” column shows that the row’s content is included in which part. Use numbers like 1 or 2 and more.
How to define the parts for each row: in the beginning of the first page of the file there is a “Chapter contents” which demonstrates the parts of the chapter recommended by the author, which we call them “author parts”. I want you to make your own suggestion for dividing the parts, which we call them “Our parts”. The rules of dividing are as follows: an “our part” is consisted of as many as consecutive “author parts” without being the final “our part” more than 10 pages. For example if the “author part”s of the chapter are 2,4,5,3,1,7,5 pages respectively, the first “our part” will be consisted of the first two “author parts”. The second “our part” will be consisted of the third and fourth and fifth “author parts”. the third “our part” will be consisted of the sixth “author part”. the fourth “our part” will be consisted of the seventh “author part”.
If an “our part” ends in the middle of a page, some of the page text will be for the previous “our part” and some of the page will be for the next “our part”. The text of such pages must be written in two separate rows. One of them is related to the previous “our part” and one of them is related to next “our part”. Your goal should be avoiding a row’s content to be consisted of the data from two different “our part”s.
And for example if you decided to divide the chapter into 2 parts, you should write “1” for the contents of the first part and write “2” for the contents of the second part. 

VERY IMPORTANT: your output must be single line (minified). DO NOT EVER use the “ENTER” button inside the cells. It shouldn’t be html rich. Do not separate texts with ENTER.

You will now receive a PDF, respond in the exact structure described above.
2025-12-14 13:39:24,835 - INFO - PDF uploaded successfully with API key: bagher
2025-12-14 13:39:24,836 - INFO - Uploaded PDF file: Bolognia 5th Edition 2024 (1)-7-26-46.pdf
2025-12-14 13:39:24,837 - INFO - Model: gemini-2.5-pro, Max tokens for model: 32768, Using: 32768
2025-12-14 13:39:24,838 - INFO - Using max_output_tokens: 32768
2025-12-14 13:39:24,840 - INFO - Using model: gemini-2.5-pro
2025-12-14 13:39:24,841 - INFO - Sending prompt (length: 7390 characters)
2025-12-14 13:39:24,842 - INFO - Max output tokens: 32768
2025-12-14 13:39:24,843 - INFO - Using original prompt with JSON output instruction (prompt preserved)
2025-12-14 13:39:24,844 - INFO - Streaming disabled for large request (prompt: 7731 chars, max_tokens: 32768)
2025-12-14 13:39:24,846 - INFO - Generating content with NON-STREAMING (large request detected to avoid rate limits)...
2025-12-14 13:39:31,150 - WARNING - ⚠️ Rate limit hit (429) - Attempt 1/3
2025-12-14 13:39:31,150 - WARNING -    Waiting 60.0s before retry... (Error count: 1/5)
2025-12-14 13:39:31,150 - WARNING -    Error: 429 Resource has been exhausted (e.g. check quota).
2025-12-14 13:40:31,523 - WARNING - ⚠️ Rate limit hit (429) - Attempt 2/3
2025-12-14 13:40:31,523 - WARNING -    Waiting 90.0s before retry... (Error count: 2/5)
2025-12-14 13:40:31,523 - WARNING -    Error: 429 Resource has been exhausted (e.g. check quota).
2025-12-14 13:42:01,875 - ERROR - ⚠️ Rate limit (429) persisted after all backoff retries. Attempting to switch to next key...
2025-12-14 13:42:31,876 - INFO - Retrying with API key 1/3: bagher
2025-12-14 13:42:42,230 - INFO - Streaming disabled for large request (prompt: 7731 chars, max_tokens: 32768)
2025-12-14 13:42:43,468 - WARNING - API key bagher hit rate limit (429), trying next...
2025-12-14 13:42:43,468 - INFO - Retrying with API key 2/3: bagher
2025-12-14 13:42:52,224 - INFO - Streaming disabled for large request (prompt: 7731 chars, max_tokens: 32768)
2025-12-14 13:42:52,224 - INFO - Waiting 30s before trying key 2...
2025-12-14 13:43:23,465 - WARNING - API key bagher hit rate limit (429), trying next...
2025-12-14 13:43:23,466 - INFO - Retrying with API key 3/3: bagher
2025-12-14 13:43:24,630 - INFO - Streaming disabled for large request (prompt: 7731 chars, max_tokens: 32768)
2025-12-14 13:43:24,630 - INFO - Waiting 45s before trying key 3...
2025-12-14 13:44:10,912 - WARNING - API key bagher hit rate limit (429), trying next...
2025-12-14 13:44:10,912 - ERROR - ======================================================================
2025-12-14 13:44:10,913 - ERROR - ❌ All 3 API keys failed. Cannot process request.
2025-12-14 13:44:10,914 - ERROR - ======================================================================
2025-12-14 13:44:10,914 - ERROR - 
2025-12-14 13:44:10,915 - ERROR - Possible reasons:
2025-12-14 13:44:10,915 - ERROR -   • All keys LEAKED (403) → Remove leaked keys, add new ones
2025-12-14 13:44:10,916 - ERROR -   • All keys QUOTA EXHAUSTED (429) → Wait for reset or add more keys
2025-12-14 13:44:10,917 - ERROR -   • Keys INVALID/EXPIRED → Generate new keys from Google AI Studio
2025-12-14 13:44:10,917 - ERROR - 
2025-12-14 13:44:10,918 - ERROR - Quick fix:
2025-12-14 13:44:10,918 - ERROR -   1. Open API keys CSV file
2025-12-14 13:44:10,919 - ERROR -   2. Remove leaked/invalid keys
2025-12-14 13:44:10,919 - ERROR -   3. Add new keys from: https://aistudio.google.com/apikey
2025-12-14 13:44:10,920 - ERROR -   4. Save CSV and reload in application
2025-12-14 13:44:10,920 - ERROR -   5. Try again
2025-12-14 13:44:10,921 - ERROR - 
2025-12-14 13:44:10,921 - ERROR - ======================================================================
2025-12-14 13:53:26,832 - INFO - Loaded 6 predefined prompts
2025-12-14 13:53:50,402 - INFO - Loaded 3 API keys
2025-12-14 13:55:00,824 - INFO - === Starting PDF Processing ===
2025-12-14 13:55:00,824 - INFO - Model: gemini-2.5-pro
2025-12-14 13:55:00,824 - INFO - PDF: /home/mohammadbagher/Downloads/PDFs/Bolognia 5th Edition 2024 (1)-7-26-46.pdf
2025-12-14 13:55:00,825 - INFO - Full prompt being sent (7390 chars): You are a meticulous medical OCR & structuring assistant. Your job is to extract **only** what is present on each provided textbook page image/PDF and convert it into clean, AI-ready text with structured sections. You MUST avoid hallucinations and preserve original medical meaning precisely. Follow these global rules:

GLOBAL PRINCIPLES
- NO HALLUCINATIONS: Output only content visible on the page(s). If unreadable/unclear, write: "[UNREADABLE]" or add an "uncertain" flag with brief reason.
- LANGUAGE & SPELLING: Preserve original English spelling and medical terminology; do not normalize British↔American spelling.
- CLEAN OCR: 
  - Remove page headers/footers, running titles, folios, and footers like “©Publisher 2023”.
  - Fix broken words at line breaks (e.g., "thera-\npy" → "therapy").
  - Replace ligatures (ﬁ, ﬂ) with normal letters.
  - Preserve meaningful capitalization, italics markers (use *italic*), bold (**bold**), and inline sub/superscripts as LaTeX if clearly indicated (e.g., CO$_2$).
- CITATIONS: Keep in-text citations literally (e.g., “[12]”, “(Smith 2021)”).
- MATH/CHEM: For formulae, use inline LaTeX: e.g., `pH = -\log_{10} [H^+]`.
- NO IMAGES: Describe figures/diagrams/charts in text form—succinct but complete. Do not invent unseen labels.

STRUCTURED OUTPUT FORMAT (Markdown with embedded JSON blocks)
Always produce in this exact order:

1) `# Page Metadata`
   - Book title (if visible), chapter title (if visible), page number (if visible or inferable), section headings found.
   - Confidence notes: short bullets where uncertainty exists.

2) `# Body`
   - Clean, continuous paragraph text. Keep section/subsection headings as `##` and `###`.

3) `# Tables`
   - For each table found, output a JSON block per table with:
   ```json
   {
     "type": "table",
     "title": "Table 3.2 Disease-modifying agents",
     "note": "footnotes or legends if present",
     "columns": ["Column A", "Column B", "Column C"],
     "rows": [
       ["cell(1,1)", "cell(1,2)", "cell(1,3)"],
       ["cell(2,1)", "cell(2,2)", "cell(2,3)"]
     ],
     "uncertain_cells": [{"row":2,"col":3,"reason":"blurry"}]
   }
If a table is complex (merged cells), normalize by repeating header labels; if impossible, add "structure_note".

# Algorithms / Clinical Approaches

Convert any flowchart, algorithm box, or approach diagram into BOTH:
a) Bulleted steps (plain text):

Step 1: …

If lab X > Y → do …

Else → …
b) Machine-readable pseudo-logic JSON:

json
Copy code
{
  "type": "algorithm",
  "title": "Approach to suspected DKA",
  "nodes": [
    {"id":"start","text":"Patient with hyperglycemia"},
    {"id":"n1","text":"Check ketones"},
    {"id":"n2","text":"If ketones positive → start insulin infusion"}
  ],
  "edges": [
    {"from":"start","to":"n1"},
    {"from":"n1","to":"n2","condition":"ketones positive"}
  ]
}
Use simple IDs; preserve clinical thresholds verbatim.

# Figures / Diagrams / Charts

For each figure, write a compact textual description capturing labels, axes, and key relationships.

If a chart encodes data values, extract the visible numbers as a small table. If not given, describe trends only.

Example JSON:

json
Copy code
{
  "type": "figure",
  "title": "Figure 5.1 Cardiac cycle",
  "description": "Schematic phases (isovolumetric contraction, ejection, …); labels: LV pressure, aortic pressure… Trend: LV pressure rises during …",
  "visible_labels": ["LV", "Aorta", "Mitral"],
  "data_points": null
}
# Lists & Key Points

Convert bullet lists and numbered lists cleanly.

For “pearls”, “high-yield” callouts, prefix with **HIGH-YIELD:**.

# References / Footnotes on Page

Transcribe verbatim; if footnote markers map to table/figure, cross-reference.

# Uncertain / OCR Issues

JSON array, where each item has: location (body/table/figure), snippet (if any), reason (e.g., “scan blur”), and confidence score 0–1.

ADDITIONAL RULES FOR DIFFICULT LAYOUTS

Multi-column pages: Respect reading order left→right, top→bottom per row.

Sidebars/callouts: Place them after the paragraph they visually relate to; prefix with > Note: or > Caution:; also mirror inside # Lists & Key Points if “pearls”.

Units & thresholds: Keep exact units (mg/kg, mmol/L). Do not convert units.

Drug names: Preserve capitalization of brand/generic as shown.

Abbreviations: On first obvious occurrence, if expansion is shown on page, include (abbr: expansion).

OUTPUT VALIDATION

Ensure valid JSON blocks (UTF-8, double quotes).

No trailing commas.

Do not wrap JSON in code fences other than the ones I asked above.

Final Output structure: your output must be sent is as a JSON in a code block with the delimiter of three consecutive semicolons like “;;;”. Each row is representative of a “page text” or “figure” or “Table”. So each “page text” and “figure” and “Table”  will have a row. The columns Headers are:
    1. Type
    2. Extraction
    3. Number
    4. Part
The “Type” column is for mentioning the type of the cell row data. The acceptable types are “page text” or “figure” or “Table”. If you are writing the page’s text in the extraction column, then the type will be “page text”. If the row in for figures, write “Figure”. And ”. If the row in for Tables, write “Table”.
The “Extraction” column is the main column for each row. If you are extracting a page’s text, write the complete text here. The JSONs of tables and figures must be written here as well.
The References in the end of the chapter must not be extracted. Ignore it.
The ”Number” column must show the page it is extracted from like 1 or 2 and more.
The “Part” column shows that the row’s content is included in which part. Use numbers like 1 or 2 and more.
How to define the parts for each row: in the beginning of the first page of the file there is a “Chapter contents” which demonstrates the parts of the chapter recommended by the author, which we call them “author parts”. I want you to make your own suggestion for dividing the parts, which we call them “Our parts”. The rules of dividing are as follows: an “our part” is consisted of as many as consecutive “author parts” without being the final “our part” more than 10 pages. For example if the “author part”s of the chapter are 2,4,5,3,1,7,5 pages respectively, the first “our part” will be consisted of the first two “author parts”. The second “our part” will be consisted of the third and fourth and fifth “author parts”. the third “our part” will be consisted of the sixth “author part”. the fourth “our part” will be consisted of the seventh “author part”.
If an “our part” ends in the middle of a page, some of the page text will be for the previous “our part” and some of the page will be for the next “our part”. The text of such pages must be written in two separate rows. One of them is related to the previous “our part” and one of them is related to next “our part”. Your goal should be avoiding a row’s content to be consisted of the data from two different “our part”s.
And for example if you decided to divide the chapter into 2 parts, you should write “1” for the contents of the first part and write “2” for the contents of the second part. 

VERY IMPORTANT: your output must be single line (minified). DO NOT EVER use the “ENTER” button inside the cells. It shouldn’t be html rich. Do not separate texts with ENTER.

You will now receive a PDF, respond in the exact structure described above.
2025-12-14 13:55:22,835 - INFO - PDF uploaded successfully with API key: bagher
2025-12-14 13:55:22,836 - INFO - Uploaded PDF file: Bolognia 5th Edition 2024 (1)-7-26-46.pdf
2025-12-14 13:55:22,837 - INFO - Model: gemini-2.5-pro, Max tokens for model: 32768, Using: 32768
2025-12-14 13:55:22,839 - INFO - Using max_output_tokens: 32768
2025-12-14 13:55:22,840 - INFO - Using model: gemini-2.5-pro
2025-12-14 13:55:22,841 - INFO - Sending prompt (length: 7390 characters)
2025-12-14 13:55:22,841 - INFO - Max output tokens: 32768
2025-12-14 13:55:22,842 - INFO - Using original prompt with JSON output instruction (prompt preserved)
2025-12-14 13:55:22,842 - INFO - Streaming disabled for large request (prompt: 7731 chars, max_tokens: 32768)
2025-12-14 13:55:22,843 - INFO - Generating content with NON-STREAMING (large request detected to avoid rate limits)...
2025-12-14 13:55:26,837 - ERROR - ================================================================================
2025-12-14 13:55:26,837 - ERROR - 🔴 RATE LIMIT ERROR (429) - COMPLETE DETAILS
2025-12-14 13:55:26,837 - ERROR - ================================================================================
2025-12-14 13:55:26,837 - ERROR - Error Type: ResourceExhausted
2025-12-14 13:55:26,837 - ERROR - Status Code: 429
2025-12-14 13:55:26,837 - ERROR - Error Message: 429 Resource has been exhausted (e.g. check quota).
2025-12-14 13:55:26,837 - ERROR - 
2025-12-14 13:55:26,838 - ERROR - 📊 CONCURRENCY INFORMATION:
2025-12-14 13:55:26,838 - ERROR -   Process ID (PID): 84566
2025-12-14 13:55:26,838 - ERROR -   Process Name: run.py
2025-12-14 13:55:26,838 - ERROR -   Thread ID: 124824265094720
2025-12-14 13:55:26,838 - ERROR -   Thread Name: Thread-1 (worker)
2025-12-14 13:55:26,838 - ERROR -   Worker ID: 124824413722432
2025-12-14 13:55:26,839 - ERROR - 
2025-12-14 13:55:26,839 - ERROR - 🔍 FULL ERROR REPRESENTATION:
2025-12-14 13:55:26,839 - ERROR -   ResourceExhausted('Resource has been exhausted (e.g. check quota).')
2025-12-14 13:55:26,839 - ERROR - ================================================================================
2025-12-14 13:55:26,840 - WARNING - ⚠️ Rate limit hit (429) - Attempt 1/3
2025-12-14 13:55:26,840 - WARNING -    Waiting 60.0s before retry... (Error count: 1/5)
2025-12-14 13:56:28,736 - ERROR - ================================================================================
2025-12-14 13:56:28,737 - ERROR - 🔴 RATE LIMIT ERROR (429) - COMPLETE DETAILS
2025-12-14 13:56:28,741 - ERROR - ================================================================================
2025-12-14 13:56:28,741 - ERROR - Error Type: ResourceExhausted
2025-12-14 13:56:28,742 - ERROR - Status Code: 429
2025-12-14 13:56:28,742 - ERROR - Error Message: 429 Resource has been exhausted (e.g. check quota).
2025-12-14 13:56:28,743 - ERROR - 
2025-12-14 13:56:28,743 - ERROR - 📊 CONCURRENCY INFORMATION:
2025-12-14 13:56:28,744 - ERROR -   Process ID (PID): 84566
2025-12-14 13:56:28,744 - ERROR -   Process Name: run.py
2025-12-14 13:56:28,745 - ERROR -   Thread ID: 124824265094720
2025-12-14 13:56:28,746 - ERROR -   Thread Name: Thread-1 (worker)
2025-12-14 13:56:28,746 - ERROR -   Worker ID: 124824413722432
2025-12-14 13:56:28,747 - ERROR - 
2025-12-14 13:56:28,748 - ERROR - 🔍 FULL ERROR REPRESENTATION:
2025-12-14 13:56:28,749 - ERROR -   ResourceExhausted('Resource has been exhausted (e.g. check quota).')
2025-12-14 13:56:28,749 - ERROR - ================================================================================
2025-12-14 13:56:28,750 - WARNING - ⚠️ Rate limit hit (429) - Attempt 2/3
2025-12-14 13:56:28,751 - WARNING -    Waiting 90.0s before retry... (Error count: 2/5)
2025-12-14 13:57:59,104 - ERROR - ================================================================================
2025-12-14 13:57:59,104 - ERROR - 🔴 RATE LIMIT ERROR (429) - COMPLETE DETAILS
2025-12-14 13:57:59,104 - ERROR - ================================================================================
2025-12-14 13:57:59,105 - ERROR - Error Type: ResourceExhausted
2025-12-14 13:57:59,105 - ERROR - Status Code: 429
2025-12-14 13:57:59,105 - ERROR - Error Message: 429 Resource has been exhausted (e.g. check quota).
2025-12-14 13:57:59,105 - ERROR - 
2025-12-14 13:57:59,105 - ERROR - 📊 CONCURRENCY INFORMATION:
2025-12-14 13:57:59,105 - ERROR -   Process ID (PID): 84566
2025-12-14 13:57:59,105 - ERROR -   Process Name: run.py
2025-12-14 13:57:59,105 - ERROR -   Thread ID: 124824265094720
2025-12-14 13:57:59,105 - ERROR -   Thread Name: Thread-1 (worker)
2025-12-14 13:57:59,105 - ERROR -   Worker ID: 124824413722432
2025-12-14 13:57:59,105 - ERROR - 
2025-12-14 13:57:59,105 - ERROR - 🔍 FULL ERROR REPRESENTATION:
2025-12-14 13:57:59,105 - ERROR -   ResourceExhausted('Resource has been exhausted (e.g. check quota).')
2025-12-14 13:57:59,106 - ERROR - ================================================================================
2025-12-14 13:57:59,106 - ERROR - ================================================================================
2025-12-14 13:57:59,106 - ERROR - 🔴 API ERROR - COMPLETE DETAILS
2025-12-14 13:57:59,106 - ERROR - ================================================================================
2025-12-14 13:57:59,106 - ERROR - Error Type: ResourceExhausted
2025-12-14 13:57:59,109 - ERROR - Status Code: 429
2025-12-14 13:57:59,111 - ERROR - Error Message: 429 Resource has been exhausted (e.g. check quota).
2025-12-14 13:57:59,111 - ERROR - 
2025-12-14 13:57:59,111 - ERROR - 📊 CONCURRENCY INFORMATION:
2025-12-14 13:57:59,111 - ERROR -   Process ID (PID): 84566
2025-12-14 13:57:59,111 - ERROR -   Process Name: run.py
2025-12-14 13:57:59,113 - ERROR -   Thread ID: 124824265094720
2025-12-14 13:57:59,114 - ERROR -   Thread Name: Thread-1 (worker)
2025-12-14 13:57:59,114 - ERROR -   Worker ID: 124824413722432
2025-12-14 13:57:59,114 - ERROR - ================================================================================
2025-12-14 13:57:59,115 - ERROR - ⚠️ Rate limit (429) persisted after all backoff retries. Attempting to switch to next key...
2025-12-14 13:58:29,115 - INFO - Retrying with API key 1/3: bagher
2025-12-14 13:58:40,349 - INFO - Streaming disabled for large request (prompt: 7731 chars, max_tokens: 32768)
2025-12-14 13:58:41,632 - WARNING - API key bagher hit rate limit (429), trying next...
2025-12-14 13:58:41,633 - INFO - Retrying with API key 2/3: bagher
2025-12-14 13:58:51,440 - INFO - Streaming disabled for large request (prompt: 7731 chars, max_tokens: 32768)
2025-12-14 13:58:51,440 - INFO - Waiting 30s before trying key 2...
2025-12-14 13:59:22,857 - WARNING - API key bagher hit rate limit (429), trying next...
2025-12-14 13:59:22,858 - INFO - Retrying with API key 3/3: bagher
2025-12-14 13:59:24,287 - INFO - Streaming disabled for large request (prompt: 7731 chars, max_tokens: 32768)
2025-12-14 13:59:24,287 - INFO - Waiting 45s before trying key 3...
2025-12-14 14:00:10,804 - WARNING - API key bagher hit rate limit (429), trying next...
2025-12-14 14:00:10,805 - ERROR - ======================================================================
2025-12-14 14:00:10,805 - ERROR - ❌ All 3 API keys failed. Cannot process request.
2025-12-14 14:00:10,806 - ERROR - ======================================================================
2025-12-14 14:00:10,806 - ERROR - 
2025-12-14 14:00:10,807 - ERROR - Possible reasons:
2025-12-14 14:00:10,807 - ERROR -   • All keys LEAKED (403) → Remove leaked keys, add new ones
2025-12-14 14:00:10,808 - ERROR -   • All keys QUOTA EXHAUSTED (429) → Wait for reset or add more keys
2025-12-14 14:00:10,808 - ERROR -   • Keys INVALID/EXPIRED → Generate new keys from Google AI Studio
2025-12-14 14:00:10,809 - ERROR - 
2025-12-14 14:00:10,809 - ERROR - Quick fix:
2025-12-14 14:00:10,809 - ERROR -   1. Open API keys CSV file
2025-12-14 14:00:10,810 - ERROR -   2. Remove leaked/invalid keys
2025-12-14 14:00:10,810 - ERROR -   3. Add new keys from: https://aistudio.google.com/apikey
2025-12-14 14:00:10,811 - ERROR -   4. Save CSV and reload in application
2025-12-14 14:00:10,811 - ERROR -   5. Try again
2025-12-14 14:00:10,812 - ERROR - 
2025-12-14 14:00:10,812 - ERROR - ======================================================================
2025-12-14 14:09:11,376 - INFO - Loaded 6 predefined prompts
2025-12-14 14:11:04,525 - ERROR - No valid API keys found in the file
2025-12-14 14:11:14,759 - INFO - Loaded 3 API keys
2025-12-14 14:12:07,140 - INFO - === Starting PDF Processing ===
2025-12-14 14:12:07,141 - INFO - Model: gemini-2.5-pro
2025-12-14 14:12:07,141 - INFO - PDF: /home/mohammadbagher/Downloads/PDFs/Bolognia 5th Edition 2024 (1)-7-26-46.pdf
2025-12-14 14:12:07,143 - INFO - Full prompt being sent (7390 chars): You are a meticulous medical OCR & structuring assistant. Your job is to extract **only** what is present on each provided textbook page image/PDF and convert it into clean, AI-ready text with structured sections. You MUST avoid hallucinations and preserve original medical meaning precisely. Follow these global rules:

GLOBAL PRINCIPLES
- NO HALLUCINATIONS: Output only content visible on the page(s). If unreadable/unclear, write: "[UNREADABLE]" or add an "uncertain" flag with brief reason.
- LANGUAGE & SPELLING: Preserve original English spelling and medical terminology; do not normalize British↔American spelling.
- CLEAN OCR: 
  - Remove page headers/footers, running titles, folios, and footers like “©Publisher 2023”.
  - Fix broken words at line breaks (e.g., "thera-\npy" → "therapy").
  - Replace ligatures (ﬁ, ﬂ) with normal letters.
  - Preserve meaningful capitalization, italics markers (use *italic*), bold (**bold**), and inline sub/superscripts as LaTeX if clearly indicated (e.g., CO$_2$).
- CITATIONS: Keep in-text citations literally (e.g., “[12]”, “(Smith 2021)”).
- MATH/CHEM: For formulae, use inline LaTeX: e.g., `pH = -\log_{10} [H^+]`.
- NO IMAGES: Describe figures/diagrams/charts in text form—succinct but complete. Do not invent unseen labels.

STRUCTURED OUTPUT FORMAT (Markdown with embedded JSON blocks)
Always produce in this exact order:

1) `# Page Metadata`
   - Book title (if visible), chapter title (if visible), page number (if visible or inferable), section headings found.
   - Confidence notes: short bullets where uncertainty exists.

2) `# Body`
   - Clean, continuous paragraph text. Keep section/subsection headings as `##` and `###`.

3) `# Tables`
   - For each table found, output a JSON block per table with:
   ```json
   {
     "type": "table",
     "title": "Table 3.2 Disease-modifying agents",
     "note": "footnotes or legends if present",
     "columns": ["Column A", "Column B", "Column C"],
     "rows": [
       ["cell(1,1)", "cell(1,2)", "cell(1,3)"],
       ["cell(2,1)", "cell(2,2)", "cell(2,3)"]
     ],
     "uncertain_cells": [{"row":2,"col":3,"reason":"blurry"}]
   }
If a table is complex (merged cells), normalize by repeating header labels; if impossible, add "structure_note".

# Algorithms / Clinical Approaches

Convert any flowchart, algorithm box, or approach diagram into BOTH:
a) Bulleted steps (plain text):

Step 1: …

If lab X > Y → do …

Else → …
b) Machine-readable pseudo-logic JSON:

json
Copy code
{
  "type": "algorithm",
  "title": "Approach to suspected DKA",
  "nodes": [
    {"id":"start","text":"Patient with hyperglycemia"},
    {"id":"n1","text":"Check ketones"},
    {"id":"n2","text":"If ketones positive → start insulin infusion"}
  ],
  "edges": [
    {"from":"start","to":"n1"},
    {"from":"n1","to":"n2","condition":"ketones positive"}
  ]
}
Use simple IDs; preserve clinical thresholds verbatim.

# Figures / Diagrams / Charts

For each figure, write a compact textual description capturing labels, axes, and key relationships.

If a chart encodes data values, extract the visible numbers as a small table. If not given, describe trends only.

Example JSON:

json
Copy code
{
  "type": "figure",
  "title": "Figure 5.1 Cardiac cycle",
  "description": "Schematic phases (isovolumetric contraction, ejection, …); labels: LV pressure, aortic pressure… Trend: LV pressure rises during …",
  "visible_labels": ["LV", "Aorta", "Mitral"],
  "data_points": null
}
# Lists & Key Points

Convert bullet lists and numbered lists cleanly.

For “pearls”, “high-yield” callouts, prefix with **HIGH-YIELD:**.

# References / Footnotes on Page

Transcribe verbatim; if footnote markers map to table/figure, cross-reference.

# Uncertain / OCR Issues

JSON array, where each item has: location (body/table/figure), snippet (if any), reason (e.g., “scan blur”), and confidence score 0–1.

ADDITIONAL RULES FOR DIFFICULT LAYOUTS

Multi-column pages: Respect reading order left→right, top→bottom per row.

Sidebars/callouts: Place them after the paragraph they visually relate to; prefix with > Note: or > Caution:; also mirror inside # Lists & Key Points if “pearls”.

Units & thresholds: Keep exact units (mg/kg, mmol/L). Do not convert units.

Drug names: Preserve capitalization of brand/generic as shown.

Abbreviations: On first obvious occurrence, if expansion is shown on page, include (abbr: expansion).

OUTPUT VALIDATION

Ensure valid JSON blocks (UTF-8, double quotes).

No trailing commas.

Do not wrap JSON in code fences other than the ones I asked above.

Final Output structure: your output must be sent is as a JSON in a code block with the delimiter of three consecutive semicolons like “;;;”. Each row is representative of a “page text” or “figure” or “Table”. So each “page text” and “figure” and “Table”  will have a row. The columns Headers are:
    1. Type
    2. Extraction
    3. Number
    4. Part
The “Type” column is for mentioning the type of the cell row data. The acceptable types are “page text” or “figure” or “Table”. If you are writing the page’s text in the extraction column, then the type will be “page text”. If the row in for figures, write “Figure”. And ”. If the row in for Tables, write “Table”.
The “Extraction” column is the main column for each row. If you are extracting a page’s text, write the complete text here. The JSONs of tables and figures must be written here as well.
The References in the end of the chapter must not be extracted. Ignore it.
The ”Number” column must show the page it is extracted from like 1 or 2 and more.
The “Part” column shows that the row’s content is included in which part. Use numbers like 1 or 2 and more.
How to define the parts for each row: in the beginning of the first page of the file there is a “Chapter contents” which demonstrates the parts of the chapter recommended by the author, which we call them “author parts”. I want you to make your own suggestion for dividing the parts, which we call them “Our parts”. The rules of dividing are as follows: an “our part” is consisted of as many as consecutive “author parts” without being the final “our part” more than 10 pages. For example if the “author part”s of the chapter are 2,4,5,3,1,7,5 pages respectively, the first “our part” will be consisted of the first two “author parts”. The second “our part” will be consisted of the third and fourth and fifth “author parts”. the third “our part” will be consisted of the sixth “author part”. the fourth “our part” will be consisted of the seventh “author part”.
If an “our part” ends in the middle of a page, some of the page text will be for the previous “our part” and some of the page will be for the next “our part”. The text of such pages must be written in two separate rows. One of them is related to the previous “our part” and one of them is related to next “our part”. Your goal should be avoiding a row’s content to be consisted of the data from two different “our part”s.
And for example if you decided to divide the chapter into 2 parts, you should write “1” for the contents of the first part and write “2” for the contents of the second part. 

VERY IMPORTANT: your output must be single line (minified). DO NOT EVER use the “ENTER” button inside the cells. It shouldn’t be html rich. Do not separate texts with ENTER.

You will now receive a PDF, respond in the exact structure described above.
2025-12-14 14:12:15,442 - INFO - PDF uploaded successfully with API key: bagher
2025-12-14 14:12:15,444 - INFO - Uploaded PDF file: Bolognia 5th Edition 2024 (1)-7-26-46.pdf
2025-12-14 14:12:15,444 - INFO - Model: gemini-2.5-pro, Max tokens for model: 32768, Using: 32768
2025-12-14 14:12:15,444 - INFO - Using max_output_tokens: 32768
2025-12-14 14:12:15,444 - INFO - Using model: gemini-2.5-pro
2025-12-14 14:12:15,445 - INFO - Sending prompt (length: 7390 characters)
2025-12-14 14:12:15,445 - INFO - Max output tokens: 32768
2025-12-14 14:12:15,446 - INFO - Using original prompt with JSON output instruction (prompt preserved)
2025-12-14 14:12:15,446 - INFO - Streaming disabled for large request (prompt: 7731 chars, max_tokens: 32768)
2025-12-14 14:12:15,446 - INFO - Generating content with NON-STREAMING (large request detected to avoid rate limits)...
2025-12-14 14:12:16,706 - ERROR - ================================================================================
2025-12-14 14:12:16,707 - ERROR - 🔴 RATE LIMIT ERROR (429) - COMPLETE DETAILS
2025-12-14 14:12:16,708 - ERROR - ================================================================================
2025-12-14 14:12:16,708 - ERROR - Error Type: ResourceExhausted
2025-12-14 14:12:16,709 - ERROR - Status Code: 429
2025-12-14 14:12:16,709 - ERROR - Error Message: 429 Resource has been exhausted (e.g. check quota).
2025-12-14 14:12:16,710 - ERROR - 
2025-12-14 14:12:16,710 - ERROR - 📊 CONCURRENCY INFORMATION:
2025-12-14 14:12:16,711 - ERROR -   Process ID (PID): 85453
2025-12-14 14:12:16,711 - ERROR -   Process Name: run.py
2025-12-14 14:12:16,712 - ERROR -   Thread ID: 125214235752000
2025-12-14 14:12:16,712 - ERROR -   Thread Name: Thread-1 (worker)
2025-12-14 14:12:16,713 - ERROR -   Worker ID: 125214384912192
2025-12-14 14:12:16,713 - ERROR - 
2025-12-14 14:12:16,714 - ERROR - 🔍 FULL ERROR REPRESENTATION:
2025-12-14 14:12:16,716 - ERROR -   ResourceExhausted('Resource has been exhausted (e.g. check quota).')
2025-12-14 14:12:16,717 - ERROR - ================================================================================
2025-12-14 14:12:16,718 - WARNING - ⚠️ Rate limit hit (429) - Attempt 1/3
2025-12-14 14:12:16,719 - WARNING -    Waiting 60.0s before retry... (Error count: 1/5)
2025-12-14 14:13:17,052 - ERROR - ================================================================================
2025-12-14 14:13:17,053 - ERROR - 🔴 RATE LIMIT ERROR (429) - COMPLETE DETAILS
2025-12-14 14:13:17,054 - ERROR - ================================================================================
2025-12-14 14:13:17,054 - ERROR - Error Type: ResourceExhausted
2025-12-14 14:13:17,055 - ERROR - Status Code: 429
2025-12-14 14:13:17,055 - ERROR - Error Message: 429 Resource has been exhausted (e.g. check quota).
2025-12-14 14:13:17,056 - ERROR - 
2025-12-14 14:13:17,056 - ERROR - 📊 CONCURRENCY INFORMATION:
2025-12-14 14:13:17,057 - ERROR -   Process ID (PID): 85453
2025-12-14 14:13:17,057 - ERROR -   Process Name: run.py
2025-12-14 14:13:17,058 - ERROR -   Thread ID: 125214235752000
2025-12-14 14:13:17,058 - ERROR -   Thread Name: Thread-1 (worker)
2025-12-14 14:13:17,059 - ERROR -   Worker ID: 125214384912192
2025-12-14 14:13:17,059 - ERROR - 
2025-12-14 14:13:17,060 - ERROR - 🔍 FULL ERROR REPRESENTATION:
2025-12-14 14:13:17,060 - ERROR -   ResourceExhausted('Resource has been exhausted (e.g. check quota).')
2025-12-14 14:13:17,061 - ERROR - ================================================================================
2025-12-14 14:13:17,061 - WARNING - ⚠️ Rate limit hit (429) - Attempt 2/3
2025-12-14 14:13:17,062 - WARNING -    Waiting 90.0s before retry... (Error count: 2/5)
2025-12-14 14:14:47,389 - ERROR - ================================================================================
2025-12-14 14:14:47,390 - ERROR - 🔴 RATE LIMIT ERROR (429) - COMPLETE DETAILS
2025-12-14 14:14:47,390 - ERROR - ================================================================================
2025-12-14 14:14:47,390 - ERROR - Error Type: ResourceExhausted
2025-12-14 14:14:47,390 - ERROR - Status Code: 429
2025-12-14 14:14:47,390 - ERROR - Error Message: 429 Resource has been exhausted (e.g. check quota).
2025-12-14 14:14:47,390 - ERROR - 
2025-12-14 14:14:47,390 - ERROR - 📊 CONCURRENCY INFORMATION:
2025-12-14 14:14:47,390 - ERROR -   Process ID (PID): 85453
2025-12-14 14:14:47,390 - ERROR -   Process Name: run.py
2025-12-14 14:14:47,390 - ERROR -   Thread ID: 125214235752000
2025-12-14 14:14:47,390 - ERROR -   Thread Name: Thread-1 (worker)
2025-12-14 14:14:47,390 - ERROR -   Worker ID: 125214384912192
2025-12-14 14:14:47,390 - ERROR - 
2025-12-14 14:14:47,391 - ERROR - 🔍 FULL ERROR REPRESENTATION:
2025-12-14 14:14:47,391 - ERROR -   ResourceExhausted('Resource has been exhausted (e.g. check quota).')
2025-12-14 14:14:47,391 - ERROR - ================================================================================
2025-12-14 14:14:47,391 - ERROR - ================================================================================
2025-12-14 14:14:47,391 - ERROR - 🔴 API ERROR - COMPLETE DETAILS
2025-12-14 14:14:47,391 - ERROR - ================================================================================
2025-12-14 14:14:47,391 - ERROR - Error Type: ResourceExhausted
2025-12-14 14:14:47,391 - ERROR - Status Code: 429
2025-12-14 14:14:47,391 - ERROR - Error Message: 429 Resource has been exhausted (e.g. check quota).
2025-12-14 14:14:47,391 - ERROR - 
2025-12-14 14:14:47,391 - ERROR - 📊 CONCURRENCY INFORMATION:
2025-12-14 14:14:47,392 - ERROR -   Process ID (PID): 85453
2025-12-14 14:14:47,392 - ERROR -   Process Name: run.py
2025-12-14 14:14:47,392 - ERROR -   Thread ID: 125214235752000
2025-12-14 14:14:47,392 - ERROR -   Thread Name: Thread-1 (worker)
2025-12-14 14:14:47,392 - ERROR -   Worker ID: 125214384912192
2025-12-14 14:14:47,392 - ERROR - ================================================================================
2025-12-14 14:14:47,392 - ERROR - ⚠️ Rate limit (429) persisted after all backoff retries. Attempting to switch to next key...
2025-12-14 14:15:17,392 - INFO - Retrying with API key 1/3: bagher
2025-12-14 14:15:29,650 - INFO - Streaming disabled for large request (prompt: 7731 chars, max_tokens: 32768)
2025-12-14 14:15:30,957 - WARNING - API key bagher hit rate limit (429), trying next...
2025-12-14 14:15:30,957 - INFO - Retrying with API key 2/3: bagher
2025-12-14 14:15:46,613 - INFO - Streaming disabled for large request (prompt: 7731 chars, max_tokens: 32768)
2025-12-14 14:15:46,613 - INFO - Waiting 30s before trying key 2...
2025-12-14 14:16:17,927 - WARNING - API key bagher hit rate limit (429), trying next...
2025-12-14 14:16:17,927 - INFO - Retrying with API key 3/3: bagher
2025-12-14 14:16:19,101 - INFO - Streaming disabled for large request (prompt: 7731 chars, max_tokens: 32768)
2025-12-14 14:16:19,102 - INFO - Waiting 45s before trying key 3...
2025-12-14 14:17:05,577 - WARNING - API key bagher hit rate limit (429), trying next...
2025-12-14 14:17:05,577 - ERROR - ======================================================================
2025-12-14 14:17:05,577 - ERROR - ❌ All 3 API keys failed. Cannot process request.
2025-12-14 14:17:05,577 - ERROR - ======================================================================
2025-12-14 14:17:05,578 - ERROR - 
2025-12-14 14:17:05,578 - ERROR - Possible reasons:
2025-12-14 14:17:05,578 - ERROR -   • All keys LEAKED (403) → Remove leaked keys, add new ones
2025-12-14 14:17:05,578 - ERROR -   • All keys QUOTA EXHAUSTED (429) → Wait for reset or add more keys
2025-12-14 14:17:05,578 - ERROR -   • Keys INVALID/EXPIRED → Generate new keys from Google AI Studio
2025-12-14 14:17:05,578 - ERROR - 
2025-12-14 14:17:05,578 - ERROR - Quick fix:
2025-12-14 14:17:05,578 - ERROR -   1. Open API keys CSV file
2025-12-14 14:17:05,578 - ERROR -   2. Remove leaked/invalid keys
2025-12-14 14:17:05,578 - ERROR -   3. Add new keys from: https://aistudio.google.com/apikey
2025-12-14 14:17:05,578 - ERROR -   4. Save CSV and reload in application
2025-12-14 14:17:05,578 - ERROR -   5. Try again
2025-12-14 14:17:05,578 - ERROR - 
2025-12-14 14:17:05,578 - ERROR - ======================================================================
2025-12-14 14:30:16,617 - INFO - Loaded 6 predefined prompts
2025-12-14 14:31:43,155 - INFO - Loaded 3 API keys
2025-12-14 14:32:52,510 - INFO - === Starting PDF Processing ===
2025-12-14 14:32:52,510 - INFO - Model: gemini-2.5-flash
2025-12-14 14:32:52,510 - INFO - PDF: /home/mohammadbagher/Downloads/PDFs/Bolognia 5th Edition 2024 (1)-7-26-46.pdf
2025-12-14 14:32:52,510 - INFO - Full prompt being sent (2527 chars): You are a meticulous medical OCR & structuring assistant.

Your job is to extract ONLY what is present on each provided textbook page image/PDF
and convert it into clean, AI-ready text with structured sections.

You MUST avoid hallucinations and preserve original medical meaning precisely.

====================
GLOBAL PRINCIPLES
====================
- NO HALLUCINATIONS: Output only content visible on the page(s). If unreadable/unclear, write "[UNREADABLE]" or add an "uncertain" flag with brief reason.
- LANGUAGE & SPELLING: Preserve original English spelling and medical terminology.
- CLEAN OCR:
  - Remove headers/footers and running titles.
  - Fix broken words at line breaks.
  - Replace ligatures (ﬁ, ﬂ).
  - Preserve italics (*italic*), bold (**bold**), and subscripts/superscripts via LaTeX.
- CITATIONS: Keep in-text citations verbatim.
- MATH/CHEM: Use inline LaTeX.
- NO IMAGES: Describe figures textually only; do not invent labels.

====================
CRITICAL OUTPUT CONTRACT (MULTI-PART)
====================
The full output is TOO LARGE to fit in one response.

You MUST split the final output into multiple PARTS.

Each response MUST:
- Output ONLY valid JSON
- Contain ONLY ONE PART of the final output
- NOT repeat rows from previous parts
- Preserve the exact order of rows across parts

====================
OUTPUT FORMAT (EXACT)
====================
{
  "part_index": <integer starting from 1>,
  "is_last": <true | false>,
  "rows": [
    {
      "Type": "page text | Figure | Table",
      "Extraction": "<single-line text or JSON>",
      "Number": <page number>,
      "Part": <our part number>
    }
  ]
}

Rules for rows:
- Each row represents exactly ONE of:
  - page text
  - figure
  - table
- Extraction MUST be single-line (no ENTER).
- JSON inside Extraction MUST be minified and valid.
- References section at end of chapter MUST be ignored.

====================
PART INSTRUCTIONS
====================
This is PART {part_index} of the output.

Generate ONLY the rows that belong to this part.
Stop when you reach a safe size limit.
If more content remains after this part, set:
  "is_last": false
Otherwise set:
  "is_last": true

====================
AUTHOR PARTS → OUR PARTS RULES
====================
[keep your full original rules here verbatim — unchanged]

====================
FINAL RULES
====================
- DO NOT summarize.
- DO NOT explain.
- DO NOT add commentary.
- Output ONLY the JSON object described above.

You will now receive a PDF.
Generate PART {part_index}.
2025-12-14 14:33:07,723 - INFO - PDF uploaded successfully with API key: bagher
2025-12-14 14:33:07,724 - INFO - Uploaded PDF file: Bolognia 5th Edition 2024 (1)-7-26-46.pdf
2025-12-14 14:33:07,725 - INFO - Model: gemini-2.5-flash, Max tokens for model: 32768, Using: 32768
2025-12-14 14:33:07,725 - INFO - Using max_output_tokens: 32768
2025-12-14 14:33:07,726 - INFO - Using model: gemini-2.5-flash
2025-12-14 14:33:07,726 - INFO - Sending prompt (length: 2527 characters)
2025-12-14 14:33:07,727 - INFO - Max output tokens: 32768
2025-12-14 14:33:07,727 - INFO - Using original prompt with JSON output instruction (prompt preserved)
2025-12-14 14:33:07,727 - INFO - Streaming disabled for large request (prompt: 2868 chars, max_tokens: 32768)
2025-12-14 14:33:07,728 - INFO - Generating content with NON-STREAMING (large request detected to avoid rate limits)...
2025-12-14 14:35:05,694 - INFO - ✓ Request completed: 2618 characters received
2025-12-14 14:35:05,695 - INFO - Finish reason: MAX_TOKENS (truncated!)
2025-12-14 14:35:05,696 - WARNING - ⚠️ Response may be truncated (finish_reason: MAX_TOKENS (truncated!))
2025-12-14 14:35:12,157 - INFO - === Response Received ===
2025-12-14 14:35:12,159 - INFO - Response length: 2618 characters
2025-12-14 14:35:12,161 - INFO - Truncated: True
2025-12-14 14:35:12,162 - INFO - Response preview (first 500 chars):  * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *...
2025-12-14 14:35:12,163 - INFO - Response preview (last 500 chars): ... * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
2025-12-14 14:35:12,458 - WARNING - python-docx not available, saving as text file
2025-12-14 14:35:12,460 - INFO - Response displayed and saved to: /home/mohammadbagher/Downloads/PDFs/Bolognia 5th Edition 2024 (1)-7-26-46_response_20251214_143512.txt
2025-12-14 14:35:21,274 - INFO - === Starting PDF Processing ===
2025-12-14 14:35:21,274 - INFO - Model: gemini-2.5-pro
2025-12-14 14:35:21,275 - INFO - PDF: /home/mohammadbagher/Downloads/PDFs/Bolognia 5th Edition 2024 (1)-7-26-46.pdf
2025-12-14 14:35:21,275 - INFO - Full prompt being sent (2527 chars): You are a meticulous medical OCR & structuring assistant.

Your job is to extract ONLY what is present on each provided textbook page image/PDF
and convert it into clean, AI-ready text with structured sections.

You MUST avoid hallucinations and preserve original medical meaning precisely.

====================
GLOBAL PRINCIPLES
====================
- NO HALLUCINATIONS: Output only content visible on the page(s). If unreadable/unclear, write "[UNREADABLE]" or add an "uncertain" flag with brief reason.
- LANGUAGE & SPELLING: Preserve original English spelling and medical terminology.
- CLEAN OCR:
  - Remove headers/footers and running titles.
  - Fix broken words at line breaks.
  - Replace ligatures (ﬁ, ﬂ).
  - Preserve italics (*italic*), bold (**bold**), and subscripts/superscripts via LaTeX.
- CITATIONS: Keep in-text citations verbatim.
- MATH/CHEM: Use inline LaTeX.
- NO IMAGES: Describe figures textually only; do not invent labels.

====================
CRITICAL OUTPUT CONTRACT (MULTI-PART)
====================
The full output is TOO LARGE to fit in one response.

You MUST split the final output into multiple PARTS.

Each response MUST:
- Output ONLY valid JSON
- Contain ONLY ONE PART of the final output
- NOT repeat rows from previous parts
- Preserve the exact order of rows across parts

====================
OUTPUT FORMAT (EXACT)
====================
{
  "part_index": <integer starting from 1>,
  "is_last": <true | false>,
  "rows": [
    {
      "Type": "page text | Figure | Table",
      "Extraction": "<single-line text or JSON>",
      "Number": <page number>,
      "Part": <our part number>
    }
  ]
}

Rules for rows:
- Each row represents exactly ONE of:
  - page text
  - figure
  - table
- Extraction MUST be single-line (no ENTER).
- JSON inside Extraction MUST be minified and valid.
- References section at end of chapter MUST be ignored.

====================
PART INSTRUCTIONS
====================
This is PART {part_index} of the output.

Generate ONLY the rows that belong to this part.
Stop when you reach a safe size limit.
If more content remains after this part, set:
  "is_last": false
Otherwise set:
  "is_last": true

====================
AUTHOR PARTS → OUR PARTS RULES
====================
[keep your full original rules here verbatim — unchanged]

====================
FINAL RULES
====================
- DO NOT summarize.
- DO NOT explain.
- DO NOT add commentary.
- Output ONLY the JSON object described above.

You will now receive a PDF.
Generate PART {part_index}.
2025-12-14 14:35:48,465 - INFO - PDF uploaded successfully with API key: bagher
2025-12-14 14:35:48,466 - INFO - Uploaded PDF file: Bolognia 5th Edition 2024 (1)-7-26-46.pdf
2025-12-14 14:35:48,467 - INFO - Model: gemini-2.5-pro, Max tokens for model: 32768, Using: 32768
2025-12-14 14:35:48,468 - INFO - Using max_output_tokens: 32768
2025-12-14 14:35:48,469 - INFO - Using model: gemini-2.5-pro
2025-12-14 14:35:48,470 - INFO - Sending prompt (length: 2527 characters)
2025-12-14 14:35:48,471 - INFO - Max output tokens: 32768
2025-12-14 14:35:48,472 - INFO - Using original prompt with JSON output instruction (prompt preserved)
2025-12-14 14:35:48,473 - INFO - Streaming disabled for large request (prompt: 2868 chars, max_tokens: 32768)
2025-12-14 14:35:48,473 - INFO - Generating content with NON-STREAMING (large request detected to avoid rate limits)...
2025-12-14 14:37:17,611 - INFO - ✓ Request completed: 13248 characters received
2025-12-14 14:37:17,612 - INFO - Finish reason: STOP (normal completion)
2025-12-14 14:37:17,614 - INFO - ✓ Response completed normally
2025-12-14 14:37:17,617 - INFO - === Response Received ===
2025-12-14 14:37:17,619 - INFO - Response length: 13248 characters
2025-12-14 14:37:17,620 - INFO - Truncated: False
2025-12-14 14:37:17,621 - INFO - Response preview (first 500 chars): ```json
{
  "part_index": 1,
  "is_last": false,
  "rows": [
    {
      "Type": "page text",
      "Extraction": "Pemphigoid Group 30",
      "Number": 517,
      "Part": 1
    },
    {
      "Type": "page text",
      "Extraction": "Luca Borradori and Michael Hertl",
      "Number": 517,
      "Part": 1
    },
    {
      "Type": "page text",
      "Extraction": "Chapter Contents\nBullous Pemphigoid. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . ...
2025-12-14 14:37:17,622 - INFO - Response preview (last 500 chars): ...rther amplify the inflammatory response⁵,¹¹⁻¹⁶ while the proteinases, together with reactive oxygen species, degrade various extracellular matrix proteins as well as BP180.¹¹⁻¹⁶ IgG anti-BP180 autoantibodies can also boost the inflammatory response by stimulating keratinocytes to express inflammatory cytokines (Fig. 30.1)¹¹. Furthermore, IgG autoantibodies are able to directly impair dermal-epidermal adhesion without complement activation¹¹.",
      "Number": 518,
      "Part": 1
    }
  ]
}
```
2025-12-15 08:39:00,034 - INFO - Loaded 6 predefined prompts
2025-12-15 08:39:21,054 - ERROR - No valid API keys found in the file
2025-12-15 08:39:34,042 - INFO - Loaded 3 API keys
2025-12-15 08:41:01,105 - INFO - === Starting PDF Processing ===
2025-12-15 08:41:01,106 - INFO - Model: gemini-2.5-pro
2025-12-15 08:41:01,106 - INFO - PDF: /home/mohammadbagher/Downloads/PDFs/Bolognia 5th Edition 2024 (1)-7-26-46.pdf
2025-12-15 08:41:01,106 - INFO - Full prompt being sent (2527 chars): You are a meticulous medical OCR & structuring assistant.

Your job is to extract ONLY what is present on each provided textbook page image/PDF
and convert it into clean, AI-ready text with structured sections.

You MUST avoid hallucinations and preserve original medical meaning precisely.

====================
GLOBAL PRINCIPLES
====================
- NO HALLUCINATIONS: Output only content visible on the page(s). If unreadable/unclear, write "[UNREADABLE]" or add an "uncertain" flag with brief reason.
- LANGUAGE & SPELLING: Preserve original English spelling and medical terminology.
- CLEAN OCR:
  - Remove headers/footers and running titles.
  - Fix broken words at line breaks.
  - Replace ligatures (ﬁ, ﬂ).
  - Preserve italics (*italic*), bold (**bold**), and subscripts/superscripts via LaTeX.
- CITATIONS: Keep in-text citations verbatim.
- MATH/CHEM: Use inline LaTeX.
- NO IMAGES: Describe figures textually only; do not invent labels.

====================
CRITICAL OUTPUT CONTRACT (MULTI-PART)
====================
The full output is TOO LARGE to fit in one response.

You MUST split the final output into multiple PARTS.

Each response MUST:
- Output ONLY valid JSON
- Contain ONLY ONE PART of the final output
- NOT repeat rows from previous parts
- Preserve the exact order of rows across parts

====================
OUTPUT FORMAT (EXACT)
====================
{
  "part_index": <integer starting from 1>,
  "is_last": <true | false>,
  "rows": [
    {
      "Type": "page text | Figure | Table",
      "Extraction": "<single-line text or JSON>",
      "Number": <page number>,
      "Part": <our part number>
    }
  ]
}

Rules for rows:
- Each row represents exactly ONE of:
  - page text
  - figure
  - table
- Extraction MUST be single-line (no ENTER).
- JSON inside Extraction MUST be minified and valid.
- References section at end of chapter MUST be ignored.

====================
PART INSTRUCTIONS
====================
This is PART {part_index} of the output.

Generate ONLY the rows that belong to this part.
Stop when you reach a safe size limit.
If more content remains after this part, set:
  "is_last": false
Otherwise set:
  "is_last": true

====================
AUTHOR PARTS → OUR PARTS RULES
====================
[keep your full original rules here verbatim — unchanged]

====================
FINAL RULES
====================
- DO NOT summarize.
- DO NOT explain.
- DO NOT add commentary.
- Output ONLY the JSON object described above.

You will now receive a PDF.
Generate PART {part_index}.
2025-12-15 08:41:12,929 - INFO - PDF uploaded successfully with API key: bagher
2025-12-15 08:41:12,931 - INFO - Uploaded PDF file: Bolognia 5th Edition 2024 (1)-7-26-46.pdf
2025-12-15 08:41:12,931 - INFO - Model: gemini-2.5-pro, Max tokens for model: 32768, Using: 32768
2025-12-15 08:41:12,932 - INFO - Using max_output_tokens: 32768
2025-12-15 08:41:12,932 - INFO - Using model: gemini-2.5-pro
2025-12-15 08:41:12,932 - INFO - Sending prompt (length: 2527 characters)
2025-12-15 08:41:12,932 - INFO - Max output tokens: 32768
2025-12-15 08:41:12,933 - INFO - Using user's prompt as-is (no modifications)
2025-12-15 08:41:12,933 - INFO - Streaming disabled for large request (prompt: 2527 chars, max_tokens: 32768)
2025-12-15 08:41:12,933 - INFO - Generating content with NON-STREAMING (large request detected to avoid rate limits)...
2025-12-15 08:41:55,659 - INFO - ✓ Request completed: 13951 characters received
2025-12-15 08:41:55,660 - INFO - Finish reason: STOP (normal completion)
2025-12-15 08:41:55,661 - INFO - ✓ Response completed normally
2025-12-15 08:41:55,664 - INFO - === Response Received ===
2025-12-15 08:41:55,665 - INFO - Response length: 13951 characters
2025-12-15 08:41:55,666 - INFO - Truncated: False
2025-12-15 08:41:55,666 - INFO - Response preview (first 500 chars): ```json
{
  "part_index": 1,
  "is_last": false,
  "rows": [
    {
      "Type": "page text",
      "Extraction": "Pemphigoid Group 30",
      "Number": 517,
      "Part": 1
    },
    {
      "Type": "page text",
      "Extraction": "Luca Borradori and Michael Hertl",
      "Number": 517,
      "Part": 1
    },
    {
      "Type": "Table",
      "Extraction": "{\"Title\": \"Chapter Contents\", \"Data\": [{\"Content\": \"Bullous Pemphigoid\", \"Page\": \"517\"}, {\"Content\": \"Mucous Membrane P...
2025-12-15 08:41:55,669 - INFO - Response preview (last 500 chars): ...rther amplify the inflammatory response⁵,¹¹⁻¹⁶ while the proteinases, together with reactive oxygen species, degrade various extracellular matrix proteins as well as BP180.¹¹⁻¹⁶ IgG anti-BP180 autoantibodies can also boost the inflammatory response by stimulating keratinocytes to express inflammatory cytokines (Fig. 30.1)¹¹. Furthermore, IgG autoantibodies are able to directly impair dermal-epidermal adhesion without complement activation¹¹.",
      "Number": 518,
      "Part": 1
    }
  ]
}
```
2025-12-15 08:48:39,388 - INFO - Loaded 6 predefined prompts
2025-12-15 08:49:07,455 - INFO - Loaded 3 API keys
2025-12-15 08:49:38,701 - INFO - === Starting PDF Processing ===
2025-12-15 08:49:38,702 - INFO - Model: gemini-2.5-flash
2025-12-15 08:49:38,703 - INFO - PDF: /home/mohammadbagher/Downloads/PDFs/Bolognia 5th Edition 2024 (1)-7-26-46.pdf
2025-12-15 08:49:38,703 - INFO - Full prompt being sent (2527 chars): You are a meticulous medical OCR & structuring assistant.

Your job is to extract ONLY what is present on each provided textbook page image/PDF
and convert it into clean, AI-ready text with structured sections.

You MUST avoid hallucinations and preserve original medical meaning precisely.

====================
GLOBAL PRINCIPLES
====================
- NO HALLUCINATIONS: Output only content visible on the page(s). If unreadable/unclear, write "[UNREADABLE]" or add an "uncertain" flag with brief reason.
- LANGUAGE & SPELLING: Preserve original English spelling and medical terminology.
- CLEAN OCR:
  - Remove headers/footers and running titles.
  - Fix broken words at line breaks.
  - Replace ligatures (ﬁ, ﬂ).
  - Preserve italics (*italic*), bold (**bold**), and subscripts/superscripts via LaTeX.
- CITATIONS: Keep in-text citations verbatim.
- MATH/CHEM: Use inline LaTeX.
- NO IMAGES: Describe figures textually only; do not invent labels.

====================
CRITICAL OUTPUT CONTRACT (MULTI-PART)
====================
The full output is TOO LARGE to fit in one response.

You MUST split the final output into multiple PARTS.

Each response MUST:
- Output ONLY valid JSON
- Contain ONLY ONE PART of the final output
- NOT repeat rows from previous parts
- Preserve the exact order of rows across parts

====================
OUTPUT FORMAT (EXACT)
====================
{
  "part_index": <integer starting from 1>,
  "is_last": <true | false>,
  "rows": [
    {
      "Type": "page text | Figure | Table",
      "Extraction": "<single-line text or JSON>",
      "Number": <page number>,
      "Part": <our part number>
    }
  ]
}

Rules for rows:
- Each row represents exactly ONE of:
  - page text
  - figure
  - table
- Extraction MUST be single-line (no ENTER).
- JSON inside Extraction MUST be minified and valid.
- References section at end of chapter MUST be ignored.

====================
PART INSTRUCTIONS
====================
This is PART {part_index} of the output.

Generate ONLY the rows that belong to this part.
Stop when you reach a safe size limit.
If more content remains after this part, set:
  "is_last": false
Otherwise set:
  "is_last": true

====================
AUTHOR PARTS → OUR PARTS RULES
====================
[keep your full original rules here verbatim — unchanged]

====================
FINAL RULES
====================
- DO NOT summarize.
- DO NOT explain.
- DO NOT add commentary.
- Output ONLY the JSON object described above.

You will now receive a PDF.
Generate PART {part_index}.
2025-12-15 08:49:38,706 - INFO - Parts directory: /home/mohammadbagher/Desktop/tts app bagher/content_automation_project/parts_Bolognia 5th Edition 2024 (1)-7-26-46.pdf_bd8375b7
2025-12-15 08:49:38,707 - INFO - No previous parts found, starting from part 1
2025-12-15 08:49:38,707 - INFO - === Processing Part 1 ===
2025-12-15 08:49:48,467 - INFO - PDF uploaded successfully with API key: bagher
2025-12-15 08:49:48,468 - INFO - Uploaded PDF file: Bolognia 5th Edition 2024 (1)-7-26-46.pdf
2025-12-15 08:49:48,469 - INFO - Model: gemini-2.5-flash, Max tokens for model: 32768, Using: 32768
2025-12-15 08:49:48,469 - INFO - Using max_output_tokens: 32768
2025-12-15 08:49:48,469 - INFO - Using model: gemini-2.5-flash
2025-12-15 08:49:48,470 - INFO - Sending prompt (length: 2558 characters)
2025-12-15 08:49:48,470 - INFO - Max output tokens: 32768
2025-12-15 08:49:48,471 - INFO - Multi-part mode: Using user's prompt as-is
2025-12-15 08:49:48,471 - INFO - Streaming disabled (force_no_streaming=True for multi-part processing)
2025-12-15 08:49:48,472 - INFO - Generating content with NON-STREAMING (large request detected to avoid rate limits)...
2025-12-15 08:50:11,383 - INFO - ✓ Request completed: 9518 characters received
2025-12-15 08:50:11,384 - INFO - Finish reason: STOP (normal completion)
2025-12-15 08:50:11,384 - INFO - ✓ Response completed normally
2025-12-15 08:50:11,386 - ERROR - Part 1: JSON parse error: Invalid \escape: line 157 column 574 (char 8959)
2025-12-15 08:50:11,387 - ERROR - Part 1: Response text (first 1000 chars): {
  "part_index": 1,
  "is_last": false,
  "rows": [
    {
      "Type": "page text",
      "Extraction": "Pemphigoid Group 30",
      "Number": 1,
      "Part": 1
    },
    {
      "Type": "page text",
      "Extraction": "Luca Borradori and Michael Hertl",
      "Number": 1,
      "Part": 1
    },
    {
      "Type": "page text",
      "Extraction": "Chapter Contents",
      "Number": 1,
      "Part": 1
    },
    {
      "Type": "page text",
      "Extraction": "Bullous Pemphigoid. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .517",
      "Number": 1,
      "Part": 1
    },
    {
      "Type": "page text",
      "Extraction": "Mucous Membrane Pemphigoid. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .526",
      "Number": 1,
      "Part": 1
    },
    {
      "Type": "page text",
      "Extraction": "Epidermolysis Bullosa Acquisita . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .530",
      "Numbe
2025-12-15 08:50:11,389 - ERROR - Part 1: Response text (last 500 chars): L]-4, IL-5, IL-13; see Ch. 4)\textsuperscript{10,11}. Th2 and Th17 cytokines, which are particularly relevant to the pathophysiology of BP, predominate within lesional tissue and in patients' sera\textsuperscript{10-13}.",
      "Number": 1,
      "Part": 1
    },
    {
      "Type": "page text",
      "Extraction": "Upon binding of autoantibodies to their target antigens, subepidermal blister formation results from a cascade of events in which Fc",
      "Number": 1,
      "Part": 1
    }
  ]
}
2025-12-15 08:50:11,389 - ERROR - Part 1: Failed to parse response
2025-12-15 08:50:11,390 - ERROR - Part 1: Response text (first 1000 chars): ```json
{
  "part_index": 1,
  "is_last": false,
  "rows": [
    {
      "Type": "page text",
      "Extraction": "Pemphigoid Group 30",
      "Number": 1,
      "Part": 1
    },
    {
      "Type": "page text",
      "Extraction": "Luca Borradori and Michael Hertl",
      "Number": 1,
      "Part": 1
    },
    {
      "Type": "page text",
      "Extraction": "Chapter Contents",
      "Number": 1,
      "Part": 1
    },
    {
      "Type": "page text",
      "Extraction": "Bullous Pemphigoid. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .517",
      "Number": 1,
      "Part": 1
    },
    {
      "Type": "page text",
      "Extraction": "Mucous Membrane Pemphigoid. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .526",
      "Number": 1,
      "Part": 1
    },
    {
      "Type": "page text",
      "Extraction": "Epidermolysis Bullosa Acquisita . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .530",
    
2025-12-15 08:50:11,390 - ERROR - Part 1: Retrying same part...
2025-12-15 08:50:16,390 - INFO - === Processing Part 1 ===
2025-12-15 08:50:28,090 - INFO - PDF uploaded successfully with API key: bagher
2025-12-15 08:50:28,090 - INFO - Uploaded PDF file: Bolognia 5th Edition 2024 (1)-7-26-46.pdf
2025-12-15 08:50:28,090 - INFO - Model: gemini-2.5-flash, Max tokens for model: 32768, Using: 32768
2025-12-15 08:50:28,090 - INFO - Using max_output_tokens: 32768
2025-12-15 08:50:28,090 - INFO - Using model: gemini-2.5-flash
2025-12-15 08:50:28,091 - INFO - Sending prompt (length: 2558 characters)
2025-12-15 08:50:28,091 - INFO - Max output tokens: 32768
2025-12-15 08:50:28,091 - INFO - Multi-part mode: Using user's prompt as-is
2025-12-15 08:50:28,091 - INFO - Streaming disabled (force_no_streaming=True for multi-part processing)
2025-12-15 08:50:28,091 - INFO - Generating content with NON-STREAMING (large request detected to avoid rate limits)...
2025-12-15 08:51:19,343 - INFO - Loaded 6 predefined prompts
2025-12-15 08:51:43,705 - INFO - Loaded 3 API keys
2025-12-15 08:52:21,576 - INFO - === Starting PDF Processing ===
2025-12-15 08:52:21,577 - INFO - Model: gemini-2.5-pro
2025-12-15 08:52:21,577 - INFO - PDF: /home/mohammadbagher/Downloads/PDFs/Bolognia 5th Edition 2024 (1)-7-26-46.pdf
2025-12-15 08:52:21,577 - INFO - Full prompt being sent (2527 chars): You are a meticulous medical OCR & structuring assistant.

Your job is to extract ONLY what is present on each provided textbook page image/PDF
and convert it into clean, AI-ready text with structured sections.

You MUST avoid hallucinations and preserve original medical meaning precisely.

====================
GLOBAL PRINCIPLES
====================
- NO HALLUCINATIONS: Output only content visible on the page(s). If unreadable/unclear, write "[UNREADABLE]" or add an "uncertain" flag with brief reason.
- LANGUAGE & SPELLING: Preserve original English spelling and medical terminology.
- CLEAN OCR:
  - Remove headers/footers and running titles.
  - Fix broken words at line breaks.
  - Replace ligatures (ﬁ, ﬂ).
  - Preserve italics (*italic*), bold (**bold**), and subscripts/superscripts via LaTeX.
- CITATIONS: Keep in-text citations verbatim.
- MATH/CHEM: Use inline LaTeX.
- NO IMAGES: Describe figures textually only; do not invent labels.

====================
CRITICAL OUTPUT CONTRACT (MULTI-PART)
====================
The full output is TOO LARGE to fit in one response.

You MUST split the final output into multiple PARTS.

Each response MUST:
- Output ONLY valid JSON
- Contain ONLY ONE PART of the final output
- NOT repeat rows from previous parts
- Preserve the exact order of rows across parts

====================
OUTPUT FORMAT (EXACT)
====================
{
  "part_index": <integer starting from 1>,
  "is_last": <true | false>,
  "rows": [
    {
      "Type": "page text | Figure | Table",
      "Extraction": "<single-line text or JSON>",
      "Number": <page number>,
      "Part": <our part number>
    }
  ]
}

Rules for rows:
- Each row represents exactly ONE of:
  - page text
  - figure
  - table
- Extraction MUST be single-line (no ENTER).
- JSON inside Extraction MUST be minified and valid.
- References section at end of chapter MUST be ignored.

====================
PART INSTRUCTIONS
====================
This is PART {part_index} of the output.

Generate ONLY the rows that belong to this part.
Stop when you reach a safe size limit.
If more content remains after this part, set:
  "is_last": false
Otherwise set:
  "is_last": true

====================
AUTHOR PARTS → OUR PARTS RULES
====================
[keep your full original rules here verbatim — unchanged]

====================
FINAL RULES
====================
- DO NOT summarize.
- DO NOT explain.
- DO NOT add commentary.
- Output ONLY the JSON object described above.

You will now receive a PDF.
Generate PART {part_index}.
2025-12-15 08:52:21,578 - INFO - Parts directory: /home/mohammadbagher/Desktop/tts app bagher/content_automation_project/parts_Bolognia 5th Edition 2024 (1)-7-26-46.pdf_bd8375b7
2025-12-15 08:52:21,579 - INFO - No previous parts found, starting from part 1
2025-12-15 08:52:21,579 - INFO - === Processing Part 1 ===
2025-12-15 08:52:31,278 - INFO - PDF uploaded successfully with API key: bagher
2025-12-15 08:52:31,279 - INFO - Uploaded PDF file: Bolognia 5th Edition 2024 (1)-7-26-46.pdf
2025-12-15 08:52:31,280 - INFO - Model: gemini-2.5-pro, Max tokens for model: 32768, Using: 32768
2025-12-15 08:52:31,281 - INFO - Using max_output_tokens: 32768
2025-12-15 08:52:31,281 - INFO - Using model: gemini-2.5-pro
2025-12-15 08:52:31,282 - INFO - Sending prompt (length: 2558 characters)
2025-12-15 08:52:31,282 - INFO - Max output tokens: 32768
2025-12-15 08:52:31,283 - INFO - Multi-part mode: Using user's prompt as-is
2025-12-15 08:52:31,283 - INFO - Streaming disabled (force_no_streaming=True for multi-part processing)
2025-12-15 08:52:31,284 - INFO - Generating content with NON-STREAMING (large request detected to avoid rate limits)...
2025-12-15 08:53:43,280 - INFO - ✓ Request completed: 13469 characters received
2025-12-15 08:53:43,281 - INFO - Finish reason: STOP (normal completion)
2025-12-15 08:53:43,282 - INFO - ✓ Response completed normally
2025-12-15 08:53:43,285 - WARNING - Part 1, row 2: Extraction contains newlines (should use \n)
2025-12-15 08:53:43,285 - WARNING - Part 1, row 5: Extraction contains newlines (should use \n)
2025-12-15 08:53:43,286 - WARNING - Part 1, row 6: Extraction contains newlines (should use \n)
2025-12-15 08:53:43,286 - WARNING - Part 1, row 7: Extraction contains newlines (should use \n)
2025-12-15 08:53:43,287 - WARNING - Part 1, row 8: Extraction contains newlines (should use \n)
2025-12-15 08:53:43,287 - WARNING - Part 1, row 9: Extraction contains newlines (should use \n)
2025-12-15 08:53:43,287 - WARNING - Part 1, row 10: Extraction contains newlines (should use \n)
2025-12-15 08:53:43,288 - WARNING - Part 1, row 2: Extraction contains newlines (should use \n)
2025-12-15 08:53:43,288 - WARNING - Part 1, row 5: Extraction contains newlines (should use \n)
2025-12-15 08:53:43,289 - WARNING - Part 1, row 6: Extraction contains newlines (should use \n)
2025-12-15 08:53:43,289 - WARNING - Part 1, row 7: Extraction contains newlines (should use \n)
2025-12-15 08:53:43,290 - WARNING - Part 1, row 8: Extraction contains newlines (should use \n)
2025-12-15 08:53:43,290 - WARNING - Part 1, row 9: Extraction contains newlines (should use \n)
2025-12-15 08:53:43,290 - WARNING - Part 1, row 10: Extraction contains newlines (should use \n)
2025-12-15 08:53:43,291 - INFO - Part 1: Parsed successfully - is_last=False, rows=14
2025-12-15 08:53:43,295 - INFO - ✓ Saved part 1 to /home/mohammadbagher/Desktop/tts app bagher/content_automation_project/parts_Bolognia 5th Edition 2024 (1)-7-26-46.pdf_bd8375b7/part_1.json
2025-12-15 08:53:43,296 - INFO - Part 1: Saved to /home/mohammadbagher/Desktop/tts app bagher/content_automation_project/parts_Bolognia 5th Edition 2024 (1)-7-26-46.pdf_bd8375b7/part_1.json (not displayed to user)
2025-12-15 08:53:43,296 - INFO - Part 1: Added 14 rows (total: 14)
2025-12-15 08:53:43,297 - INFO - Part 1: is_last=false, continuing to next part...
2025-12-15 08:53:43,300 - INFO - Waiting 13.1s before next part...
2025-12-15 08:53:56,448 - INFO - === Processing Part 2 ===
2025-12-15 08:54:07,096 - INFO - PDF uploaded successfully with API key: bagher
2025-12-15 08:54:07,097 - INFO - Uploaded PDF file: Bolognia 5th Edition 2024 (1)-7-26-46.pdf
2025-12-15 08:54:07,098 - INFO - Model: gemini-2.5-pro, Max tokens for model: 32768, Using: 32768
2025-12-15 08:54:07,098 - INFO - Using max_output_tokens: 32768
2025-12-15 08:54:07,099 - INFO - Using model: gemini-2.5-pro
2025-12-15 08:54:07,099 - INFO - Sending prompt (length: 2592 characters)
2025-12-15 08:54:07,099 - INFO - Max output tokens: 32768
2025-12-15 08:54:07,100 - INFO - Multi-part mode: Using user's prompt as-is
2025-12-15 08:54:07,100 - INFO - Streaming disabled (force_no_streaming=True for multi-part processing)
2025-12-15 08:54:07,101 - INFO - Generating content with NON-STREAMING (large request detected to avoid rate limits)...
2025-12-15 08:55:43,968 - INFO - ✓ Request completed: 24433 characters received
2025-12-15 08:55:43,969 - INFO - Finish reason: STOP (normal completion)
2025-12-15 08:55:43,970 - INFO - ✓ Response completed normally
2025-12-15 08:55:43,974 - INFO - Part 2: Parsed successfully - is_last=False, rows=17
2025-12-15 08:55:43,978 - INFO - ✓ Saved part 2 to /home/mohammadbagher/Desktop/tts app bagher/content_automation_project/parts_Bolognia 5th Edition 2024 (1)-7-26-46.pdf_bd8375b7/part_2.json
2025-12-15 08:55:43,979 - INFO - Part 2: Saved to /home/mohammadbagher/Desktop/tts app bagher/content_automation_project/parts_Bolognia 5th Edition 2024 (1)-7-26-46.pdf_bd8375b7/part_2.json (not displayed to user)
2025-12-15 08:55:43,980 - INFO - Part 2: Added 17 rows (total: 31)
2025-12-15 08:55:43,980 - INFO - Part 2: is_last=false, continuing to next part...
2025-12-15 08:55:43,982 - INFO - Waiting 11.2s before next part...
2025-12-15 08:55:55,215 - INFO - === Processing Part 3 ===
2025-12-15 08:56:05,154 - INFO - PDF uploaded successfully with API key: bagher
2025-12-15 08:56:05,155 - INFO - Uploaded PDF file: Bolognia 5th Edition 2024 (1)-7-26-46.pdf
2025-12-15 08:56:05,156 - INFO - Model: gemini-2.5-pro, Max tokens for model: 32768, Using: 32768
2025-12-15 08:56:05,156 - INFO - Using max_output_tokens: 32768
2025-12-15 08:56:05,156 - INFO - Using model: gemini-2.5-pro
2025-12-15 08:56:05,157 - INFO - Sending prompt (length: 2592 characters)
2025-12-15 08:56:05,157 - INFO - Max output tokens: 32768
2025-12-15 08:56:05,158 - INFO - Multi-part mode: Using user's prompt as-is
2025-12-15 08:56:05,159 - INFO - Streaming disabled (force_no_streaming=True for multi-part processing)
2025-12-15 08:56:05,160 - INFO - Generating content with NON-STREAMING (large request detected to avoid rate limits)...
2025-12-15 08:57:23,213 - INFO - ✓ Request completed: 18994 characters received
2025-12-15 08:57:23,214 - INFO - Finish reason: STOP (normal completion)
2025-12-15 08:57:23,215 - INFO - ✓ Response completed normally
2025-12-15 08:57:23,218 - INFO - Part 3: Parsed successfully - is_last=False, rows=12
2025-12-15 08:57:23,223 - INFO - ✓ Saved part 3 to /home/mohammadbagher/Desktop/tts app bagher/content_automation_project/parts_Bolognia 5th Edition 2024 (1)-7-26-46.pdf_bd8375b7/part_3.json
2025-12-15 08:57:23,224 - INFO - Part 3: Saved to /home/mohammadbagher/Desktop/tts app bagher/content_automation_project/parts_Bolognia 5th Edition 2024 (1)-7-26-46.pdf_bd8375b7/part_3.json (not displayed to user)
2025-12-15 08:57:23,225 - INFO - Part 3: Added 12 rows (total: 43)
2025-12-15 08:57:23,227 - INFO - Part 3: is_last=false, continuing to next part...
2025-12-15 08:57:23,229 - INFO - Waiting 13.3s before next part...
2025-12-15 08:57:36,566 - INFO - === Processing Part 4 ===
2025-12-15 08:57:46,017 - INFO - PDF uploaded successfully with API key: bagher
2025-12-15 08:57:46,017 - INFO - Uploaded PDF file: Bolognia 5th Edition 2024 (1)-7-26-46.pdf
2025-12-15 08:57:46,018 - INFO - Model: gemini-2.5-pro, Max tokens for model: 32768, Using: 32768
2025-12-15 08:57:46,019 - INFO - Using max_output_tokens: 32768
2025-12-15 08:57:46,019 - INFO - Using model: gemini-2.5-pro
2025-12-15 08:57:46,020 - INFO - Sending prompt (length: 2592 characters)
2025-12-15 08:57:46,020 - INFO - Max output tokens: 32768
2025-12-15 08:57:46,021 - INFO - Multi-part mode: Using user's prompt as-is
2025-12-15 08:57:46,022 - INFO - Streaming disabled (force_no_streaming=True for multi-part processing)
2025-12-15 08:57:46,022 - INFO - Generating content with NON-STREAMING (large request detected to avoid rate limits)...
2025-12-15 08:58:53,119 - INFO - ✓ Request completed: 13088 characters received
2025-12-15 08:58:53,121 - INFO - Finish reason: STOP (normal completion)
2025-12-15 08:58:53,121 - INFO - ✓ Response completed normally
2025-12-15 08:58:53,124 - WARNING - Part 4, row 3: Extraction contains newlines (should use \n)
2025-12-15 08:58:53,125 - WARNING - Part 4, row 4: Extraction contains newlines (should use \n)
2025-12-15 08:58:53,126 - WARNING - Part 4, row 8: Extraction contains newlines (should use \n)
2025-12-15 08:58:53,126 - WARNING - Part 4, row 9: Extraction contains newlines (should use \n)
2025-12-15 08:58:53,127 - WARNING - Part 4, row 10: Extraction contains newlines (should use \n)
2025-12-15 08:58:53,127 - WARNING - Part 4, row 13: Extraction contains newlines (should use \n)
2025-12-15 08:58:53,127 - WARNING - Part 4, row 14: Extraction contains newlines (should use \n)
2025-12-15 08:58:53,128 - WARNING - Part 4, row 3: Extraction contains newlines (should use \n)
2025-12-15 08:58:53,129 - WARNING - Part 4, row 4: Extraction contains newlines (should use \n)
2025-12-15 08:58:53,130 - WARNING - Part 4, row 8: Extraction contains newlines (should use \n)
2025-12-15 08:58:53,130 - WARNING - Part 4, row 9: Extraction contains newlines (should use \n)
2025-12-15 08:58:53,130 - WARNING - Part 4, row 10: Extraction contains newlines (should use \n)
2025-12-15 08:58:53,131 - WARNING - Part 4, row 13: Extraction contains newlines (should use \n)
2025-12-15 08:58:53,131 - WARNING - Part 4, row 14: Extraction contains newlines (should use \n)
2025-12-15 08:58:53,131 - INFO - Part 4: Parsed successfully - is_last=False, rows=15
2025-12-15 08:58:53,134 - INFO - ✓ Saved part 4 to /home/mohammadbagher/Desktop/tts app bagher/content_automation_project/parts_Bolognia 5th Edition 2024 (1)-7-26-46.pdf_bd8375b7/part_4.json
2025-12-15 08:58:53,134 - INFO - Part 4: Saved to /home/mohammadbagher/Desktop/tts app bagher/content_automation_project/parts_Bolognia 5th Edition 2024 (1)-7-26-46.pdf_bd8375b7/part_4.json (not displayed to user)
2025-12-15 08:58:53,135 - INFO - Part 4: Added 15 rows (total: 58)
2025-12-15 08:58:53,135 - INFO - Part 4: is_last=false, continuing to next part...
2025-12-15 08:58:53,136 - INFO - Waiting 10.2s before next part...
2025-12-15 08:59:03,370 - INFO - === Processing Part 5 ===
2025-12-15 08:59:12,449 - INFO - PDF uploaded successfully with API key: bagher
2025-12-15 08:59:12,450 - INFO - Uploaded PDF file: Bolognia 5th Edition 2024 (1)-7-26-46.pdf
2025-12-15 08:59:12,451 - INFO - Model: gemini-2.5-pro, Max tokens for model: 32768, Using: 32768
2025-12-15 08:59:12,451 - INFO - Using max_output_tokens: 32768
2025-12-15 08:59:12,452 - INFO - Using model: gemini-2.5-pro
2025-12-15 08:59:12,453 - INFO - Sending prompt (length: 2592 characters)
2025-12-15 08:59:12,453 - INFO - Max output tokens: 32768
2025-12-15 08:59:12,454 - INFO - Multi-part mode: Using user's prompt as-is
2025-12-15 08:59:12,454 - INFO - Streaming disabled (force_no_streaming=True for multi-part processing)
2025-12-15 08:59:12,455 - INFO - Generating content with NON-STREAMING (large request detected to avoid rate limits)...
2025-12-15 09:00:37,669 - INFO - ✓ Request completed: 30743 characters received
2025-12-15 09:00:37,670 - INFO - Finish reason: STOP (normal completion)
2025-12-15 09:00:37,670 - INFO - ✓ Response completed normally
2025-12-15 09:00:37,674 - WARNING - Part 5, row 1: Extraction contains newlines (should use \n)
2025-12-15 09:00:37,677 - WARNING - Part 5, row 2: Extraction contains newlines (should use \n)
2025-12-15 09:00:37,677 - WARNING - Part 5, row 3: Extraction contains newlines (should use \n)
2025-12-15 09:00:37,677 - WARNING - Part 5, row 7: Extraction contains newlines (should use \n)
2025-12-15 09:00:37,678 - WARNING - Part 5, row 8: Extraction contains newlines (should use \n)
2025-12-15 09:00:37,678 - WARNING - Part 5, row 12: Extraction contains newlines (should use \n)
2025-12-15 09:00:37,678 - WARNING - Part 5, row 13: Extraction contains newlines (should use \n)
2025-12-15 09:00:37,679 - WARNING - Part 5, row 14: Extraction contains newlines (should use \n)
2025-12-15 09:00:37,679 - WARNING - Part 5, row 17: Extraction contains newlines (should use \n)
2025-12-15 09:00:37,680 - WARNING - Part 5, row 26: Extraction contains newlines (should use \n)
2025-12-15 09:00:37,680 - WARNING - Part 5, row 27: Extraction contains newlines (should use \n)
2025-12-15 09:00:37,680 - WARNING - Part 5, row 28: Extraction contains newlines (should use \n)
2025-12-15 09:00:37,680 - WARNING - Part 5, row 29: Extraction contains newlines (should use \n)
2025-12-15 09:00:37,682 - WARNING - Part 5, row 1: Extraction contains newlines (should use \n)
2025-12-15 09:00:37,682 - WARNING - Part 5, row 2: Extraction contains newlines (should use \n)
2025-12-15 09:00:37,683 - WARNING - Part 5, row 3: Extraction contains newlines (should use \n)
2025-12-15 09:00:37,683 - WARNING - Part 5, row 7: Extraction contains newlines (should use \n)
2025-12-15 09:00:37,683 - WARNING - Part 5, row 8: Extraction contains newlines (should use \n)
2025-12-15 09:00:37,683 - WARNING - Part 5, row 12: Extraction contains newlines (should use \n)
2025-12-15 09:00:37,683 - WARNING - Part 5, row 13: Extraction contains newlines (should use \n)
2025-12-15 09:00:37,684 - WARNING - Part 5, row 14: Extraction contains newlines (should use \n)
2025-12-15 09:00:37,684 - WARNING - Part 5, row 17: Extraction contains newlines (should use \n)
2025-12-15 09:00:37,685 - WARNING - Part 5, row 26: Extraction contains newlines (should use \n)
2025-12-15 09:00:37,687 - WARNING - Part 5, row 27: Extraction contains newlines (should use \n)
2025-12-15 09:00:37,687 - WARNING - Part 5, row 28: Extraction contains newlines (should use \n)
2025-12-15 09:00:37,688 - WARNING - Part 5, row 29: Extraction contains newlines (should use \n)
2025-12-15 09:00:37,688 - INFO - Part 5: Parsed successfully - is_last=False, rows=30
2025-12-15 09:00:37,691 - INFO - ✓ Saved part 5 to /home/mohammadbagher/Desktop/tts app bagher/content_automation_project/parts_Bolognia 5th Edition 2024 (1)-7-26-46.pdf_bd8375b7/part_5.json
2025-12-15 09:00:37,691 - INFO - Part 5: Saved to /home/mohammadbagher/Desktop/tts app bagher/content_automation_project/parts_Bolognia 5th Edition 2024 (1)-7-26-46.pdf_bd8375b7/part_5.json (not displayed to user)
2025-12-15 09:00:37,691 - INFO - Part 5: Added 30 rows (total: 88)
2025-12-15 09:00:37,691 - INFO - Part 5: is_last=false, continuing to next part...
2025-12-15 09:00:37,692 - INFO - Waiting 12.8s before next part...
2025-12-15 09:00:50,507 - INFO - === Processing Part 6 ===
2025-12-15 09:00:59,877 - INFO - PDF uploaded successfully with API key: bagher
2025-12-15 09:00:59,878 - INFO - Uploaded PDF file: Bolognia 5th Edition 2024 (1)-7-26-46.pdf
2025-12-15 09:00:59,878 - INFO - Model: gemini-2.5-pro, Max tokens for model: 32768, Using: 32768
2025-12-15 09:00:59,879 - INFO - Using max_output_tokens: 32768
2025-12-15 09:00:59,880 - INFO - Using model: gemini-2.5-pro
2025-12-15 09:00:59,881 - INFO - Sending prompt (length: 2592 characters)
2025-12-15 09:00:59,881 - INFO - Max output tokens: 32768
2025-12-15 09:00:59,881 - INFO - Multi-part mode: Using user's prompt as-is
2025-12-15 09:00:59,881 - INFO - Streaming disabled (force_no_streaming=True for multi-part processing)
2025-12-15 09:00:59,881 - INFO - Generating content with NON-STREAMING (large request detected to avoid rate limits)...
2025-12-15 09:02:00,614 - INFO - ✓ Request completed: 14519 characters received
2025-12-15 09:02:00,615 - INFO - Finish reason: STOP (normal completion)
2025-12-15 09:02:00,616 - INFO - ✓ Response completed normally
2025-12-15 09:02:00,617 - INFO - Part 6: Parsed successfully - is_last=False, rows=10
2025-12-15 09:02:00,618 - INFO - ✓ Saved part 6 to /home/mohammadbagher/Desktop/tts app bagher/content_automation_project/parts_Bolognia 5th Edition 2024 (1)-7-26-46.pdf_bd8375b7/part_6.json
2025-12-15 09:02:00,618 - INFO - Part 6: Saved to /home/mohammadbagher/Desktop/tts app bagher/content_automation_project/parts_Bolognia 5th Edition 2024 (1)-7-26-46.pdf_bd8375b7/part_6.json (not displayed to user)
2025-12-15 09:02:00,618 - INFO - Part 6: Added 10 rows (total: 98)
2025-12-15 09:02:00,619 - INFO - Part 6: is_last=false, continuing to next part...
2025-12-15 09:02:00,619 - INFO - Waiting 10.0s before next part...
2025-12-15 09:02:10,574 - INFO - === Processing Part 7 ===
2025-12-15 09:02:22,351 - INFO - PDF uploaded successfully with API key: bagher
2025-12-15 09:02:22,351 - INFO - Uploaded PDF file: Bolognia 5th Edition 2024 (1)-7-26-46.pdf
2025-12-15 09:02:22,352 - INFO - Model: gemini-2.5-pro, Max tokens for model: 32768, Using: 32768
2025-12-15 09:02:22,352 - INFO - Using max_output_tokens: 32768
2025-12-15 09:02:22,352 - INFO - Using model: gemini-2.5-pro
2025-12-15 09:02:22,352 - INFO - Sending prompt (length: 2592 characters)
2025-12-15 09:02:22,352 - INFO - Max output tokens: 32768
2025-12-15 09:02:22,354 - INFO - Multi-part mode: Using user's prompt as-is
2025-12-15 09:02:22,354 - INFO - Streaming disabled (force_no_streaming=True for multi-part processing)
2025-12-15 09:02:22,354 - INFO - Generating content with NON-STREAMING (large request detected to avoid rate limits)...
2025-12-15 09:03:45,028 - INFO - ✓ Request completed: 23134 characters received
2025-12-15 09:03:45,029 - INFO - Finish reason: STOP (normal completion)
2025-12-15 09:03:45,031 - INFO - ✓ Response completed normally
2025-12-15 09:03:45,034 - WARNING - Part 7, row 1: Extraction contains newlines (should use \n)
2025-12-15 09:03:45,035 - WARNING - Part 7, row 2: Extraction contains newlines (should use \n)
2025-12-15 09:03:45,035 - WARNING - Part 7, row 3: Extraction contains newlines (should use \n)
2025-12-15 09:03:45,036 - WARNING - Part 7, row 7: Extraction contains newlines (should use \n)
2025-12-15 09:03:45,036 - WARNING - Part 7, row 8: Extraction contains newlines (should use \n)
2025-12-15 09:03:45,037 - WARNING - Part 7, row 18: Extraction contains newlines (should use \n)
2025-12-15 09:03:45,037 - WARNING - Part 7, row 19: Extraction contains newlines (should use \n)
2025-12-15 09:03:45,038 - WARNING - Part 7, row 22: Extraction contains newlines (should use \n)
2025-12-15 09:03:45,039 - WARNING - Part 7, row 23: Extraction contains newlines (should use \n)
2025-12-15 09:03:45,040 - WARNING - Part 7, row 1: Extraction contains newlines (should use \n)
2025-12-15 09:03:45,040 - WARNING - Part 7, row 2: Extraction contains newlines (should use \n)
2025-12-15 09:03:45,041 - WARNING - Part 7, row 3: Extraction contains newlines (should use \n)
2025-12-15 09:03:45,041 - WARNING - Part 7, row 7: Extraction contains newlines (should use \n)
2025-12-15 09:03:45,042 - WARNING - Part 7, row 8: Extraction contains newlines (should use \n)
2025-12-15 09:03:45,042 - WARNING - Part 7, row 18: Extraction contains newlines (should use \n)
2025-12-15 09:03:45,043 - WARNING - Part 7, row 19: Extraction contains newlines (should use \n)
2025-12-15 09:03:45,043 - WARNING - Part 7, row 22: Extraction contains newlines (should use \n)
2025-12-15 09:03:45,044 - WARNING - Part 7, row 23: Extraction contains newlines (should use \n)
2025-12-15 09:03:45,044 - INFO - Part 7: Parsed successfully - is_last=False, rows=25
2025-12-15 09:03:45,050 - INFO - ✓ Saved part 7 to /home/mohammadbagher/Desktop/tts app bagher/content_automation_project/parts_Bolognia 5th Edition 2024 (1)-7-26-46.pdf_bd8375b7/part_7.json
2025-12-15 09:03:45,051 - INFO - Part 7: Saved to /home/mohammadbagher/Desktop/tts app bagher/content_automation_project/parts_Bolognia 5th Edition 2024 (1)-7-26-46.pdf_bd8375b7/part_7.json (not displayed to user)
2025-12-15 09:03:45,051 - INFO - Part 7: Added 25 rows (total: 123)
2025-12-15 09:03:45,052 - INFO - Part 7: is_last=false, continuing to next part...
2025-12-15 09:03:45,054 - INFO - Waiting 14.6s before next part...
2025-12-15 09:03:59,647 - INFO - === Processing Part 8 ===
2025-12-15 09:04:08,735 - INFO - PDF uploaded successfully with API key: bagher
2025-12-15 09:04:08,736 - INFO - Uploaded PDF file: Bolognia 5th Edition 2024 (1)-7-26-46.pdf
2025-12-15 09:04:08,737 - INFO - Model: gemini-2.5-pro, Max tokens for model: 32768, Using: 32768
2025-12-15 09:04:08,738 - INFO - Using max_output_tokens: 32768
2025-12-15 09:04:08,739 - INFO - Using model: gemini-2.5-pro
2025-12-15 09:04:08,739 - INFO - Sending prompt (length: 2592 characters)
2025-12-15 09:04:08,740 - INFO - Max output tokens: 32768
2025-12-15 09:04:08,740 - INFO - Multi-part mode: Using user's prompt as-is
2025-12-15 09:04:08,741 - INFO - Streaming disabled (force_no_streaming=True for multi-part processing)
2025-12-15 09:04:08,741 - INFO - Generating content with NON-STREAMING (large request detected to avoid rate limits)...
2025-12-15 09:04:55,440 - INFO - ✓ Request completed: 16241 characters received
2025-12-15 09:04:55,441 - INFO - Finish reason: STOP (normal completion)
2025-12-15 09:04:55,441 - INFO - ✓ Response completed normally
2025-12-15 09:04:55,444 - WARNING - Part 8, row 1: Extraction contains newlines (should use \n)
2025-12-15 09:04:55,445 - WARNING - Part 8, row 2: Extraction contains newlines (should use \n)
2025-12-15 09:04:55,445 - WARNING - Part 8, row 3: Extraction contains newlines (should use \n)
2025-12-15 09:04:55,446 - WARNING - Part 8, row 7: Extraction contains newlines (should use \n)
2025-12-15 09:04:55,447 - WARNING - Part 8, row 8: Extraction contains newlines (should use \n)
2025-12-15 09:04:55,447 - WARNING - Part 8, row 12: Extraction contains newlines (should use \n)
2025-12-15 09:04:55,449 - WARNING - Part 8, row 13: Extraction contains newlines (should use \n)
2025-12-15 09:04:55,449 - WARNING - Part 8, row 14: Extraction contains newlines (should use \n)
2025-12-15 09:04:55,450 - WARNING - Part 8, row 17: Extraction contains newlines (should use \n)
2025-12-15 09:04:55,450 - WARNING - Part 8, row 18: Extraction contains newlines (should use \n)
2025-12-15 09:04:55,451 - WARNING - Part 8, row 1: Extraction contains newlines (should use \n)
2025-12-15 09:04:55,452 - WARNING - Part 8, row 2: Extraction contains newlines (should use \n)
2025-12-15 09:04:55,452 - WARNING - Part 8, row 3: Extraction contains newlines (should use \n)
2025-12-15 09:04:55,453 - WARNING - Part 8, row 7: Extraction contains newlines (should use \n)
2025-12-15 09:04:55,453 - WARNING - Part 8, row 8: Extraction contains newlines (should use \n)
2025-12-15 09:04:55,453 - WARNING - Part 8, row 12: Extraction contains newlines (should use \n)
2025-12-15 09:04:55,454 - WARNING - Part 8, row 13: Extraction contains newlines (should use \n)
2025-12-15 09:04:55,454 - WARNING - Part 8, row 14: Extraction contains newlines (should use \n)
2025-12-15 09:04:55,455 - WARNING - Part 8, row 17: Extraction contains newlines (should use \n)
2025-12-15 09:04:55,455 - WARNING - Part 8, row 18: Extraction contains newlines (should use \n)
2025-12-15 09:04:55,456 - INFO - Part 8: Parsed successfully - is_last=False, rows=19
2025-12-15 09:04:55,459 - INFO - ✓ Saved part 8 to /home/mohammadbagher/Desktop/tts app bagher/content_automation_project/parts_Bolognia 5th Edition 2024 (1)-7-26-46.pdf_bd8375b7/part_8.json
2025-12-15 09:04:55,460 - INFO - Part 8: Saved to /home/mohammadbagher/Desktop/tts app bagher/content_automation_project/parts_Bolognia 5th Edition 2024 (1)-7-26-46.pdf_bd8375b7/part_8.json (not displayed to user)
2025-12-15 09:04:55,460 - INFO - Part 8: Added 19 rows (total: 142)
2025-12-15 09:04:55,461 - INFO - Part 8: is_last=false, continuing to next part...
2025-12-15 09:04:55,463 - INFO - Waiting 11.6s before next part...
2025-12-15 09:05:07,028 - INFO - === Processing Part 9 ===
2025-12-15 09:05:15,797 - INFO - PDF uploaded successfully with API key: bagher
2025-12-15 09:05:15,797 - INFO - Uploaded PDF file: Bolognia 5th Edition 2024 (1)-7-26-46.pdf
2025-12-15 09:05:15,797 - INFO - Model: gemini-2.5-pro, Max tokens for model: 32768, Using: 32768
2025-12-15 09:05:15,797 - INFO - Using max_output_tokens: 32768
2025-12-15 09:05:15,798 - INFO - Using model: gemini-2.5-pro
2025-12-15 09:05:15,798 - INFO - Sending prompt (length: 2592 characters)
2025-12-15 09:05:15,798 - INFO - Max output tokens: 32768
2025-12-15 09:05:15,798 - INFO - Multi-part mode: Using user's prompt as-is
2025-12-15 09:05:15,798 - INFO - Streaming disabled (force_no_streaming=True for multi-part processing)
2025-12-15 09:05:15,799 - INFO - Generating content with NON-STREAMING (large request detected to avoid rate limits)...
2025-12-15 09:06:42,862 - INFO - ✓ Request completed: 23091 characters received
2025-12-15 09:06:42,867 - INFO - Finish reason: STOP (normal completion)
2025-12-15 09:06:42,867 - INFO - ✓ Response completed normally
2025-12-15 09:06:42,875 - WARNING - Part 9, row 1: Extraction contains newlines (should use \n)
2025-12-15 09:06:42,878 - WARNING - Part 9, row 2: Extraction contains newlines (should use \n)
2025-12-15 09:06:42,878 - WARNING - Part 9, row 3: Extraction contains newlines (should use \n)
2025-12-15 09:06:42,880 - WARNING - Part 9, row 7: Extraction contains newlines (should use \n)
2025-12-15 09:06:42,880 - WARNING - Part 9, row 8: Extraction contains newlines (should use \n)
2025-12-15 09:06:42,881 - WARNING - Part 9, row 9: Extraction contains newlines (should use \n)
2025-12-15 09:06:42,881 - WARNING - Part 9, row 13: Extraction contains newlines (should use \n)
2025-12-15 09:06:42,882 - WARNING - Part 9, row 14: Extraction contains newlines (should use \n)
2025-12-15 09:06:42,884 - WARNING - Part 9, row 15: Extraction contains newlines (should use \n)
2025-12-15 09:06:42,885 - WARNING - Part 9, row 18: Extraction contains newlines (should use \n)
2025-12-15 09:06:42,885 - WARNING - Part 9, row 19: Extraction contains newlines (should use \n)
2025-12-15 09:06:42,886 - WARNING - Part 9, row 21: Extraction contains newlines (should use \n)
2025-12-15 09:06:42,886 - WARNING - Part 9, row 1: Extraction contains newlines (should use \n)
2025-12-15 09:06:42,891 - WARNING - Part 9, row 2: Extraction contains newlines (should use \n)
2025-12-15 09:06:42,891 - WARNING - Part 9, row 3: Extraction contains newlines (should use \n)
2025-12-15 09:06:42,892 - WARNING - Part 9, row 7: Extraction contains newlines (should use \n)
2025-12-15 09:06:42,892 - WARNING - Part 9, row 8: Extraction contains newlines (should use \n)
2025-12-15 09:06:42,893 - WARNING - Part 9, row 9: Extraction contains newlines (should use \n)
2025-12-15 09:06:42,893 - WARNING - Part 9, row 13: Extraction contains newlines (should use \n)
2025-12-15 09:06:42,894 - WARNING - Part 9, row 14: Extraction contains newlines (should use \n)
2025-12-15 09:06:42,894 - WARNING - Part 9, row 15: Extraction contains newlines (should use \n)
2025-12-15 09:06:42,894 - WARNING - Part 9, row 18: Extraction contains newlines (should use \n)
2025-12-15 09:06:42,895 - WARNING - Part 9, row 19: Extraction contains newlines (should use \n)
2025-12-15 09:06:42,895 - WARNING - Part 9, row 21: Extraction contains newlines (should use \n)
2025-12-15 09:06:42,896 - INFO - Part 9: Parsed successfully - is_last=False, rows=22
2025-12-15 09:06:42,904 - INFO - ✓ Saved part 9 to /home/mohammadbagher/Desktop/tts app bagher/content_automation_project/parts_Bolognia 5th Edition 2024 (1)-7-26-46.pdf_bd8375b7/part_9.json
2025-12-15 09:06:42,905 - INFO - Part 9: Saved to /home/mohammadbagher/Desktop/tts app bagher/content_automation_project/parts_Bolognia 5th Edition 2024 (1)-7-26-46.pdf_bd8375b7/part_9.json (not displayed to user)
2025-12-15 09:06:42,906 - INFO - Part 9: Added 22 rows (total: 164)
2025-12-15 09:06:42,907 - INFO - Part 9: is_last=false, continuing to next part...
2025-12-15 09:06:42,911 - INFO - Waiting 13.1s before next part...
2025-12-15 09:06:55,987 - INFO - === Processing Part 10 ===
2025-12-15 09:07:07,218 - INFO - PDF uploaded successfully with API key: bagher
2025-12-15 09:07:07,219 - INFO - Uploaded PDF file: Bolognia 5th Edition 2024 (1)-7-26-46.pdf
2025-12-15 09:07:07,219 - INFO - Model: gemini-2.5-pro, Max tokens for model: 32768, Using: 32768
2025-12-15 09:07:07,219 - INFO - Using max_output_tokens: 32768
2025-12-15 09:07:07,219 - INFO - Using model: gemini-2.5-pro
2025-12-15 09:07:07,219 - INFO - Sending prompt (length: 2593 characters)
2025-12-15 09:07:07,219 - INFO - Max output tokens: 32768
2025-12-15 09:07:07,219 - INFO - Multi-part mode: Using user's prompt as-is
2025-12-15 09:07:07,220 - INFO - Streaming disabled (force_no_streaming=True for multi-part processing)
2025-12-15 09:07:07,220 - INFO - Generating content with NON-STREAMING (large request detected to avoid rate limits)...
2025-12-15 09:08:40,862 - INFO - ✓ Request completed: 25516 characters received
2025-12-15 09:08:40,864 - INFO - Finish reason: STOP (normal completion)
2025-12-15 09:08:40,864 - INFO - ✓ Response completed normally
2025-12-15 09:08:40,869 - INFO - Part 10: Parsed successfully - is_last=False, rows=33
2025-12-15 09:08:40,875 - INFO - ✓ Saved part 10 to /home/mohammadbagher/Desktop/tts app bagher/content_automation_project/parts_Bolognia 5th Edition 2024 (1)-7-26-46.pdf_bd8375b7/part_10.json
2025-12-15 09:08:40,876 - INFO - Part 10: Saved to /home/mohammadbagher/Desktop/tts app bagher/content_automation_project/parts_Bolognia 5th Edition 2024 (1)-7-26-46.pdf_bd8375b7/part_10.json (not displayed to user)
2025-12-15 09:08:40,876 - INFO - Part 10: Added 33 rows (total: 197)
2025-12-15 09:08:40,877 - INFO - Part 10: is_last=false, continuing to next part...
2025-12-15 09:08:40,878 - INFO - Waiting 10.3s before next part...
2025-12-15 09:08:51,134 - INFO - === Processing Part 11 ===
2025-12-15 09:09:03,081 - INFO - PDF uploaded successfully with API key: bagher
2025-12-15 09:09:03,082 - INFO - Uploaded PDF file: Bolognia 5th Edition 2024 (1)-7-26-46.pdf
2025-12-15 09:09:03,086 - INFO - Model: gemini-2.5-pro, Max tokens for model: 32768, Using: 32768
2025-12-15 09:09:03,087 - INFO - Using max_output_tokens: 32768
2025-12-15 09:09:03,087 - INFO - Using model: gemini-2.5-pro
2025-12-15 09:09:03,088 - INFO - Sending prompt (length: 2594 characters)
2025-12-15 09:09:03,088 - INFO - Max output tokens: 32768
2025-12-15 09:09:03,089 - INFO - Multi-part mode: Using user's prompt as-is
2025-12-15 09:09:03,089 - INFO - Streaming disabled (force_no_streaming=True for multi-part processing)
2025-12-15 09:09:03,090 - INFO - Generating content with NON-STREAMING (large request detected to avoid rate limits)...
2025-12-15 09:09:55,466 - INFO - ✓ Request completed: 11730 characters received
2025-12-15 09:09:55,467 - INFO - Finish reason: STOP (normal completion)
2025-12-15 09:09:55,468 - INFO - ✓ Response completed normally
2025-12-15 09:09:55,471 - INFO - Part 11: Parsed successfully - is_last=False, rows=15
2025-12-15 09:09:55,475 - INFO - ✓ Saved part 11 to /home/mohammadbagher/Desktop/tts app bagher/content_automation_project/parts_Bolognia 5th Edition 2024 (1)-7-26-46.pdf_bd8375b7/part_11.json
2025-12-15 09:09:55,476 - INFO - Part 11: Saved to /home/mohammadbagher/Desktop/tts app bagher/content_automation_project/parts_Bolognia 5th Edition 2024 (1)-7-26-46.pdf_bd8375b7/part_11.json (not displayed to user)
2025-12-15 09:09:55,477 - INFO - Part 11: Added 15 rows (total: 212)
2025-12-15 09:09:55,478 - INFO - Part 11: is_last=false, continuing to next part...
2025-12-15 09:09:55,480 - INFO - Waiting 8.1s before next part...
2025-12-15 09:10:03,543 - INFO - === Processing Part 12 ===
2025-12-15 09:10:12,827 - INFO - PDF uploaded successfully with API key: bagher
2025-12-15 09:10:12,828 - INFO - Uploaded PDF file: Bolognia 5th Edition 2024 (1)-7-26-46.pdf
2025-12-15 09:10:12,828 - INFO - Model: gemini-2.5-pro, Max tokens for model: 32768, Using: 32768
2025-12-15 09:10:12,829 - INFO - Using max_output_tokens: 32768
2025-12-15 09:10:12,829 - INFO - Using model: gemini-2.5-pro
2025-12-15 09:10:12,830 - INFO - Sending prompt (length: 2594 characters)
2025-12-15 09:10:12,830 - INFO - Max output tokens: 32768
2025-12-15 09:10:12,831 - INFO - Multi-part mode: Using user's prompt as-is
2025-12-15 09:10:12,831 - INFO - Streaming disabled (force_no_streaming=True for multi-part processing)
2025-12-15 09:10:12,831 - INFO - Generating content with NON-STREAMING (large request detected to avoid rate limits)...
2025-12-15 09:11:32,446 - INFO - ✓ Request completed: 31367 characters received
2025-12-15 09:11:32,447 - INFO - Finish reason: STOP (normal completion)
2025-12-15 09:11:32,447 - INFO - ✓ Response completed normally
2025-12-15 09:11:32,452 - WARNING - Part 12, row 1: Extraction contains newlines (should use \n)
2025-12-15 09:11:32,453 - WARNING - Part 12, row 2: Extraction contains newlines (should use \n)
2025-12-15 09:11:32,454 - WARNING - Part 12, row 3: Extraction contains newlines (should use \n)
2025-12-15 09:11:32,455 - WARNING - Part 12, row 7: Extraction contains newlines (should use \n)
2025-12-15 09:11:32,455 - WARNING - Part 12, row 8: Extraction contains newlines (should use \n)
2025-12-15 09:11:32,456 - WARNING - Part 12, row 12: Extraction contains newlines (should use \n)
2025-12-15 09:11:32,456 - WARNING - Part 12, row 13: Extraction contains newlines (should use \n)
2025-12-15 09:11:32,457 - WARNING - Part 12, row 14: Extraction contains newlines (should use \n)
2025-12-15 09:11:32,458 - WARNING - Part 12, row 17: Extraction contains newlines (should use \n)
2025-12-15 09:11:32,458 - WARNING - Part 12, row 18: Extraction contains newlines (should use \n)
2025-12-15 09:11:32,459 - WARNING - Part 12, row 20: Extraction contains newlines (should use \n)
2025-12-15 09:11:32,460 - WARNING - Part 12, row 22: Extraction contains newlines (should use \n)
2025-12-15 09:11:32,460 - WARNING - Part 12, row 23: Extraction contains newlines (should use \n)
2025-12-15 09:11:32,460 - WARNING - Part 12, row 24: Extraction contains newlines (should use \n)
2025-12-15 09:11:32,461 - WARNING - Part 12, row 25: Extraction contains newlines (should use \n)
2025-12-15 09:11:32,461 - WARNING - Part 12, row 26: Extraction contains newlines (should use \n)
2025-12-15 09:11:32,462 - WARNING - Part 12, row 27: Extraction contains newlines (should use \n)
2025-12-15 09:11:32,463 - WARNING - Part 12, row 1: Extraction contains newlines (should use \n)
2025-12-15 09:11:32,463 - WARNING - Part 12, row 2: Extraction contains newlines (should use \n)
2025-12-15 09:11:32,464 - WARNING - Part 12, row 3: Extraction contains newlines (should use \n)
2025-12-15 09:11:32,465 - WARNING - Part 12, row 7: Extraction contains newlines (should use \n)
2025-12-15 09:11:32,465 - WARNING - Part 12, row 8: Extraction contains newlines (should use \n)
2025-12-15 09:11:32,465 - WARNING - Part 12, row 12: Extraction contains newlines (should use \n)
2025-12-15 09:11:32,466 - WARNING - Part 12, row 13: Extraction contains newlines (should use \n)
2025-12-15 09:11:32,466 - WARNING - Part 12, row 14: Extraction contains newlines (should use \n)
2025-12-15 09:11:32,466 - WARNING - Part 12, row 17: Extraction contains newlines (should use \n)
2025-12-15 09:11:32,467 - WARNING - Part 12, row 18: Extraction contains newlines (should use \n)
2025-12-15 09:11:32,467 - WARNING - Part 12, row 20: Extraction contains newlines (should use \n)
2025-12-15 09:11:32,467 - WARNING - Part 12, row 22: Extraction contains newlines (should use \n)
2025-12-15 09:11:32,467 - WARNING - Part 12, row 23: Extraction contains newlines (should use \n)
2025-12-15 09:11:32,468 - WARNING - Part 12, row 24: Extraction contains newlines (should use \n)
2025-12-15 09:11:32,468 - WARNING - Part 12, row 25: Extraction contains newlines (should use \n)
2025-12-15 09:11:32,468 - WARNING - Part 12, row 26: Extraction contains newlines (should use \n)
2025-12-15 09:11:32,468 - WARNING - Part 12, row 27: Extraction contains newlines (should use \n)
2025-12-15 09:11:32,469 - INFO - Part 12: Parsed successfully - is_last=False, rows=28
2025-12-15 09:11:32,472 - INFO - ✓ Saved part 12 to /home/mohammadbagher/Desktop/tts app bagher/content_automation_project/parts_Bolognia 5th Edition 2024 (1)-7-26-46.pdf_bd8375b7/part_12.json
2025-12-15 09:11:32,472 - INFO - Part 12: Saved to /home/mohammadbagher/Desktop/tts app bagher/content_automation_project/parts_Bolognia 5th Edition 2024 (1)-7-26-46.pdf_bd8375b7/part_12.json (not displayed to user)
2025-12-15 09:11:32,472 - INFO - Part 12: Added 28 rows (total: 240)
2025-12-15 09:11:32,472 - INFO - Part 12: is_last=false, continuing to next part...
2025-12-15 09:11:32,473 - INFO - Waiting 10.6s before next part...
2025-12-15 09:11:43,091 - INFO - === Processing Part 13 ===
2025-12-15 09:11:51,700 - INFO - PDF uploaded successfully with API key: bagher
2025-12-15 09:11:51,701 - INFO - Uploaded PDF file: Bolognia 5th Edition 2024 (1)-7-26-46.pdf
2025-12-15 09:11:51,702 - INFO - Model: gemini-2.5-pro, Max tokens for model: 32768, Using: 32768
2025-12-15 09:11:51,703 - INFO - Using max_output_tokens: 32768
2025-12-15 09:11:51,703 - INFO - Using model: gemini-2.5-pro
2025-12-15 09:11:51,704 - INFO - Sending prompt (length: 2594 characters)
2025-12-15 09:11:51,706 - INFO - Max output tokens: 32768
2025-12-15 09:11:51,707 - INFO - Multi-part mode: Using user's prompt as-is
2025-12-15 09:11:51,707 - INFO - Streaming disabled (force_no_streaming=True for multi-part processing)
2025-12-15 09:11:51,708 - INFO - Generating content with NON-STREAMING (large request detected to avoid rate limits)...
2025-12-15 09:12:53,963 - INFO - ✓ Request completed: 16347 characters received
2025-12-15 09:12:53,965 - INFO - Finish reason: STOP (normal completion)
2025-12-15 09:12:53,966 - INFO - ✓ Response completed normally
2025-12-15 09:12:53,969 - INFO - Part 13: Parsed successfully - is_last=False, rows=17
2025-12-15 09:12:53,974 - INFO - ✓ Saved part 13 to /home/mohammadbagher/Desktop/tts app bagher/content_automation_project/parts_Bolognia 5th Edition 2024 (1)-7-26-46.pdf_bd8375b7/part_13.json
2025-12-15 09:12:53,974 - INFO - Part 13: Saved to /home/mohammadbagher/Desktop/tts app bagher/content_automation_project/parts_Bolognia 5th Edition 2024 (1)-7-26-46.pdf_bd8375b7/part_13.json (not displayed to user)
2025-12-15 09:12:53,975 - INFO - Part 13: Added 17 rows (total: 257)
2025-12-15 09:12:53,976 - INFO - Part 13: is_last=false, continuing to next part...
2025-12-15 09:12:53,979 - INFO - Waiting 8.5s before next part...
2025-12-15 09:13:02,460 - INFO - === Processing Part 14 ===
2025-12-15 09:13:11,716 - INFO - PDF uploaded successfully with API key: bagher
2025-12-15 09:13:11,717 - INFO - Uploaded PDF file: Bolognia 5th Edition 2024 (1)-7-26-46.pdf
2025-12-15 09:13:11,718 - INFO - Model: gemini-2.5-pro, Max tokens for model: 32768, Using: 32768
2025-12-15 09:13:11,718 - INFO - Using max_output_tokens: 32768
2025-12-15 09:13:11,718 - INFO - Using model: gemini-2.5-pro
2025-12-15 09:13:11,719 - INFO - Sending prompt (length: 2594 characters)
2025-12-15 09:13:11,719 - INFO - Max output tokens: 32768
2025-12-15 09:13:11,719 - INFO - Multi-part mode: Using user's prompt as-is
2025-12-15 09:13:11,719 - INFO - Streaming disabled (force_no_streaming=True for multi-part processing)
2025-12-15 09:13:11,719 - INFO - Generating content with NON-STREAMING (large request detected to avoid rate limits)...
2025-12-15 09:14:10,249 - INFO - ✓ Request completed: 18286 characters received
2025-12-15 09:14:10,250 - INFO - Finish reason: STOP (normal completion)
2025-12-15 09:14:10,251 - INFO - ✓ Response completed normally
2025-12-15 09:14:10,254 - INFO - Part 14: Parsed successfully - is_last=False, rows=14
2025-12-15 09:14:10,258 - INFO - ✓ Saved part 14 to /home/mohammadbagher/Desktop/tts app bagher/content_automation_project/parts_Bolognia 5th Edition 2024 (1)-7-26-46.pdf_bd8375b7/part_14.json
2025-12-15 09:14:10,259 - INFO - Part 14: Saved to /home/mohammadbagher/Desktop/tts app bagher/content_automation_project/parts_Bolognia 5th Edition 2024 (1)-7-26-46.pdf_bd8375b7/part_14.json (not displayed to user)
2025-12-15 09:14:10,259 - INFO - Part 14: Added 14 rows (total: 271)
2025-12-15 09:14:10,260 - INFO - Part 14: is_last=false, continuing to next part...
2025-12-15 09:14:10,262 - INFO - Waiting 8.1s before next part...
2025-12-15 09:14:18,347 - INFO - === Processing Part 15 ===
2025-12-15 09:14:27,728 - INFO - PDF uploaded successfully with API key: bagher
2025-12-15 09:14:27,729 - INFO - Uploaded PDF file: Bolognia 5th Edition 2024 (1)-7-26-46.pdf
2025-12-15 09:14:27,730 - INFO - Model: gemini-2.5-pro, Max tokens for model: 32768, Using: 32768
2025-12-15 09:14:27,731 - INFO - Using max_output_tokens: 32768
2025-12-15 09:14:27,731 - INFO - Using model: gemini-2.5-pro
2025-12-15 09:14:27,732 - INFO - Sending prompt (length: 2594 characters)
2025-12-15 09:14:27,733 - INFO - Max output tokens: 32768
2025-12-15 09:14:27,733 - INFO - Multi-part mode: Using user's prompt as-is
2025-12-15 09:14:27,734 - INFO - Streaming disabled (force_no_streaming=True for multi-part processing)
2025-12-15 09:14:27,735 - INFO - Generating content with NON-STREAMING (large request detected to avoid rate limits)...
2025-12-15 09:16:00,544 - INFO - ✓ Request completed: 26543 characters received
2025-12-15 09:16:00,544 - INFO - Finish reason: STOP (normal completion)
2025-12-15 09:16:00,544 - INFO - ✓ Response completed normally
2025-12-15 09:16:00,545 - WARNING - Part 15, row 11: Extraction contains newlines (should use \n)
2025-12-15 09:16:00,545 - WARNING - Part 15, row 12: Extraction contains newlines (should use \n)
2025-12-15 09:16:00,545 - WARNING - Part 15, row 13: Extraction contains newlines (should use \n)
2025-12-15 09:16:00,545 - WARNING - Part 15, row 14: Extraction contains newlines (should use \n)
2025-12-15 09:16:00,545 - WARNING - Part 15, row 15: Extraction contains newlines (should use \n)
2025-12-15 09:16:00,545 - WARNING - Part 15, row 17: Extraction contains newlines (should use \n)
2025-12-15 09:16:00,545 - WARNING - Part 15, row 11: Extraction contains newlines (should use \n)
2025-12-15 09:16:00,546 - WARNING - Part 15, row 12: Extraction contains newlines (should use \n)
2025-12-15 09:16:00,546 - WARNING - Part 15, row 13: Extraction contains newlines (should use \n)
2025-12-15 09:16:00,546 - WARNING - Part 15, row 14: Extraction contains newlines (should use \n)
2025-12-15 09:16:00,546 - WARNING - Part 15, row 15: Extraction contains newlines (should use \n)
2025-12-15 09:16:00,546 - WARNING - Part 15, row 17: Extraction contains newlines (should use \n)
2025-12-15 09:16:00,546 - INFO - Part 15: Parsed successfully - is_last=False, rows=18
2025-12-15 09:16:00,547 - INFO - ✓ Saved part 15 to /home/mohammadbagher/Desktop/tts app bagher/content_automation_project/parts_Bolognia 5th Edition 2024 (1)-7-26-46.pdf_bd8375b7/part_15.json
2025-12-15 09:16:00,547 - INFO - Part 15: Saved to /home/mohammadbagher/Desktop/tts app bagher/content_automation_project/parts_Bolognia 5th Edition 2024 (1)-7-26-46.pdf_bd8375b7/part_15.json (not displayed to user)
2025-12-15 09:16:00,548 - INFO - Part 15: Added 18 rows (total: 289)
2025-12-15 09:16:00,548 - INFO - Part 15: is_last=false, continuing to next part...
2025-12-15 09:16:00,548 - INFO - Waiting 8.4s before next part...
2025-12-15 09:16:08,935 - INFO - === Processing Part 16 ===
2025-12-15 09:16:21,413 - INFO - PDF uploaded successfully with API key: bagher
2025-12-15 09:16:21,414 - INFO - Uploaded PDF file: Bolognia 5th Edition 2024 (1)-7-26-46.pdf
2025-12-15 09:16:21,414 - INFO - Model: gemini-2.5-pro, Max tokens for model: 32768, Using: 32768
2025-12-15 09:16:21,415 - INFO - Using max_output_tokens: 32768
2025-12-15 09:16:21,415 - INFO - Using model: gemini-2.5-pro
2025-12-15 09:16:21,415 - INFO - Sending prompt (length: 2594 characters)
2025-12-15 09:16:21,416 - INFO - Max output tokens: 32768
2025-12-15 09:16:21,416 - INFO - Multi-part mode: Using user's prompt as-is
2025-12-15 09:16:21,417 - INFO - Streaming disabled (force_no_streaming=True for multi-part processing)
2025-12-15 09:16:21,417 - INFO - Generating content with NON-STREAMING (large request detected to avoid rate limits)...
2025-12-15 09:17:30,649 - INFO - ✓ Request completed: 11954 characters received
2025-12-15 09:17:30,650 - INFO - Finish reason: STOP (normal completion)
2025-12-15 09:17:30,650 - INFO - ✓ Response completed normally
2025-12-15 09:17:30,652 - INFO - Part 16: Parsed successfully - is_last=True, rows=19
2025-12-15 09:17:30,654 - INFO - ✓ Saved part 16 to /home/mohammadbagher/Desktop/tts app bagher/content_automation_project/parts_Bolognia 5th Edition 2024 (1)-7-26-46.pdf_bd8375b7/part_16.json
2025-12-15 09:17:30,655 - INFO - Part 16: Saved to /home/mohammadbagher/Desktop/tts app bagher/content_automation_project/parts_Bolognia 5th Edition 2024 (1)-7-26-46.pdf_bd8375b7/part_16.json (not displayed to user)
2025-12-15 09:17:30,656 - INFO - Part 16: Added 19 rows (total: 308)
2025-12-15 09:17:30,656 - INFO - Part 16: is_last=true, processing complete!
2025-12-15 09:17:30,658 - INFO - === Processing Summary ===
2025-12-15 09:17:30,659 - INFO - Total parts processed: 15
2025-12-15 09:17:30,660 - INFO - Total rows collected: 308
2025-12-15 09:17:30,660 - INFO - Deduplicating 308 rows...
2025-12-15 09:17:30,672 - WARNING - Removed 47 duplicate rows
2025-12-15 09:17:30,672 - INFO - Final row count after deduplication: 261
2025-12-15 09:17:30,685 - INFO - ✓ Final output saved to /home/mohammadbagher/Desktop/tts app bagher/content_automation_project/final_output.json
2025-12-15 09:17:30,685 - INFO -   - Total parts: 15
2025-12-15 09:17:30,685 - INFO -   - Total rows: 261
2025-12-15 09:23:53,974 - INFO - Loaded 6 predefined prompts
2025-12-15 09:24:12,484 - INFO - Loaded 3 API keys
2025-12-15 09:24:47,699 - INFO - === Starting PDF Processing ===
2025-12-15 09:24:47,701 - INFO - Model: gemini-2.5-pro
2025-12-15 09:24:47,702 - INFO - PDF: /home/mohammadbagher/Downloads/PDFs/Bolognia 5th Edition 2024 (1)-7-26-46.pdf
2025-12-15 09:24:47,703 - INFO - Full prompt being sent (2527 chars): You are a meticulous medical OCR & structuring assistant.

Your job is to extract ONLY what is present on each provided textbook page image/PDF
and convert it into clean, AI-ready text with structured sections.

You MUST avoid hallucinations and preserve original medical meaning precisely.

====================
GLOBAL PRINCIPLES
====================
- NO HALLUCINATIONS: Output only content visible on the page(s). If unreadable/unclear, write "[UNREADABLE]" or add an "uncertain" flag with brief reason.
- LANGUAGE & SPELLING: Preserve original English spelling and medical terminology.
- CLEAN OCR:
  - Remove headers/footers and running titles.
  - Fix broken words at line breaks.
  - Replace ligatures (ﬁ, ﬂ).
  - Preserve italics (*italic*), bold (**bold**), and subscripts/superscripts via LaTeX.
- CITATIONS: Keep in-text citations verbatim.
- MATH/CHEM: Use inline LaTeX.
- NO IMAGES: Describe figures textually only; do not invent labels.

====================
CRITICAL OUTPUT CONTRACT (MULTI-PART)
====================
The full output is TOO LARGE to fit in one response.

You MUST split the final output into multiple PARTS.

Each response MUST:
- Output ONLY valid JSON
- Contain ONLY ONE PART of the final output
- NOT repeat rows from previous parts
- Preserve the exact order of rows across parts

====================
OUTPUT FORMAT (EXACT)
====================
{
  "part_index": <integer starting from 1>,
  "is_last": <true | false>,
  "rows": [
    {
      "Type": "page text | Figure | Table",
      "Extraction": "<single-line text or JSON>",
      "Number": <page number>,
      "Part": <our part number>
    }
  ]
}

Rules for rows:
- Each row represents exactly ONE of:
  - page text
  - figure
  - table
- Extraction MUST be single-line (no ENTER).
- JSON inside Extraction MUST be minified and valid.
- References section at end of chapter MUST be ignored.

====================
PART INSTRUCTIONS
====================
This is PART {part_index} of the output.

Generate ONLY the rows that belong to this part.
Stop when you reach a safe size limit.
If more content remains after this part, set:
  "is_last": false
Otherwise set:
  "is_last": true

====================
AUTHOR PARTS → OUR PARTS RULES
====================
[keep your full original rules here verbatim — unchanged]

====================
FINAL RULES
====================
- DO NOT summarize.
- DO NOT explain.
- DO NOT add commentary.
- Output ONLY the JSON object described above.

You will now receive a PDF.
Generate PART {part_index}.
2025-12-15 09:24:47,708 - INFO - Parts directory: /home/mohammadbagher/Desktop/tts app bagher/content_automation_project/parts_Bolognia 5th Edition 2024 (1)-7-26-46.pdf_bd8375b7
2025-12-15 09:24:47,709 - INFO - Final output will be saved to PDF directory: /home/mohammadbagher/Downloads/PDFs
2025-12-15 09:24:47,715 - WARNING - Part 1, row 2: Extraction contains newlines (should use \n)
2025-12-15 09:24:47,716 - WARNING - Part 1, row 5: Extraction contains newlines (should use \n)
2025-12-15 09:24:47,716 - WARNING - Part 1, row 6: Extraction contains newlines (should use \n)
2025-12-15 09:24:47,717 - WARNING - Part 1, row 7: Extraction contains newlines (should use \n)
2025-12-15 09:24:47,717 - WARNING - Part 1, row 8: Extraction contains newlines (should use \n)
2025-12-15 09:24:47,718 - WARNING - Part 1, row 9: Extraction contains newlines (should use \n)
2025-12-15 09:24:47,718 - WARNING - Part 1, row 10: Extraction contains newlines (should use \n)
2025-12-15 09:24:47,727 - WARNING - Part 12, row 1: Extraction contains newlines (should use \n)
2025-12-15 09:24:47,728 - WARNING - Part 12, row 2: Extraction contains newlines (should use \n)
2025-12-15 09:24:47,728 - WARNING - Part 12, row 3: Extraction contains newlines (should use \n)
2025-12-15 09:24:47,729 - WARNING - Part 12, row 7: Extraction contains newlines (should use \n)
2025-12-15 09:24:47,729 - WARNING - Part 12, row 8: Extraction contains newlines (should use \n)
2025-12-15 09:24:47,730 - WARNING - Part 12, row 12: Extraction contains newlines (should use \n)
2025-12-15 09:24:47,731 - WARNING - Part 12, row 13: Extraction contains newlines (should use \n)
2025-12-15 09:24:47,732 - WARNING - Part 12, row 14: Extraction contains newlines (should use \n)
2025-12-15 09:24:47,732 - WARNING - Part 12, row 17: Extraction contains newlines (should use \n)
2025-12-15 09:24:47,733 - WARNING - Part 12, row 18: Extraction contains newlines (should use \n)
2025-12-15 09:24:47,733 - WARNING - Part 12, row 20: Extraction contains newlines (should use \n)
2025-12-15 09:24:47,734 - WARNING - Part 12, row 22: Extraction contains newlines (should use \n)
2025-12-15 09:24:47,735 - WARNING - Part 12, row 23: Extraction contains newlines (should use \n)
2025-12-15 09:24:47,736 - WARNING - Part 12, row 24: Extraction contains newlines (should use \n)
2025-12-15 09:24:47,736 - WARNING - Part 12, row 25: Extraction contains newlines (should use \n)
2025-12-15 09:24:47,737 - WARNING - Part 12, row 26: Extraction contains newlines (should use \n)
2025-12-15 09:24:47,737 - WARNING - Part 12, row 27: Extraction contains newlines (should use \n)
2025-12-15 09:24:47,742 - WARNING - Part 15, row 11: Extraction contains newlines (should use \n)
2025-12-15 09:24:47,743 - WARNING - Part 15, row 12: Extraction contains newlines (should use \n)
2025-12-15 09:24:47,743 - WARNING - Part 15, row 13: Extraction contains newlines (should use \n)
2025-12-15 09:24:47,743 - WARNING - Part 15, row 14: Extraction contains newlines (should use \n)
2025-12-15 09:24:47,745 - WARNING - Part 15, row 15: Extraction contains newlines (should use \n)
2025-12-15 09:24:47,745 - WARNING - Part 15, row 17: Extraction contains newlines (should use \n)
2025-12-15 09:24:47,749 - WARNING - Part 4, row 3: Extraction contains newlines (should use \n)
2025-12-15 09:24:47,750 - WARNING - Part 4, row 4: Extraction contains newlines (should use \n)
2025-12-15 09:24:47,750 - WARNING - Part 4, row 8: Extraction contains newlines (should use \n)
2025-12-15 09:24:47,750 - WARNING - Part 4, row 9: Extraction contains newlines (should use \n)
2025-12-15 09:24:47,750 - WARNING - Part 4, row 10: Extraction contains newlines (should use \n)
2025-12-15 09:24:47,751 - WARNING - Part 4, row 13: Extraction contains newlines (should use \n)
2025-12-15 09:24:47,751 - WARNING - Part 4, row 14: Extraction contains newlines (should use \n)
2025-12-15 09:24:47,752 - WARNING - Part 5, row 1: Extraction contains newlines (should use \n)
2025-12-15 09:24:47,752 - WARNING - Part 5, row 2: Extraction contains newlines (should use \n)
2025-12-15 09:24:47,753 - WARNING - Part 5, row 3: Extraction contains newlines (should use \n)
2025-12-15 09:24:47,753 - WARNING - Part 5, row 7: Extraction contains newlines (should use \n)
2025-12-15 09:24:47,753 - WARNING - Part 5, row 8: Extraction contains newlines (should use \n)
2025-12-15 09:24:47,753 - WARNING - Part 5, row 12: Extraction contains newlines (should use \n)
2025-12-15 09:24:47,753 - WARNING - Part 5, row 13: Extraction contains newlines (should use \n)
2025-12-15 09:24:47,753 - WARNING - Part 5, row 14: Extraction contains newlines (should use \n)
2025-12-15 09:24:47,753 - WARNING - Part 5, row 17: Extraction contains newlines (should use \n)
2025-12-15 09:24:47,754 - WARNING - Part 5, row 26: Extraction contains newlines (should use \n)
2025-12-15 09:24:47,754 - WARNING - Part 5, row 27: Extraction contains newlines (should use \n)
2025-12-15 09:24:47,754 - WARNING - Part 5, row 28: Extraction contains newlines (should use \n)
2025-12-15 09:24:47,754 - WARNING - Part 5, row 29: Extraction contains newlines (should use \n)
2025-12-15 09:24:47,755 - WARNING - Part 7, row 1: Extraction contains newlines (should use \n)
2025-12-15 09:24:47,756 - WARNING - Part 7, row 2: Extraction contains newlines (should use \n)
2025-12-15 09:24:47,756 - WARNING - Part 7, row 3: Extraction contains newlines (should use \n)
2025-12-15 09:24:47,756 - WARNING - Part 7, row 7: Extraction contains newlines (should use \n)
2025-12-15 09:24:47,756 - WARNING - Part 7, row 8: Extraction contains newlines (should use \n)
2025-12-15 09:24:47,756 - WARNING - Part 7, row 18: Extraction contains newlines (should use \n)
2025-12-15 09:24:47,756 - WARNING - Part 7, row 19: Extraction contains newlines (should use \n)
2025-12-15 09:24:47,757 - WARNING - Part 7, row 22: Extraction contains newlines (should use \n)
2025-12-15 09:24:47,757 - WARNING - Part 7, row 23: Extraction contains newlines (should use \n)
2025-12-15 09:24:47,758 - WARNING - Part 8, row 1: Extraction contains newlines (should use \n)
2025-12-15 09:24:47,758 - WARNING - Part 8, row 2: Extraction contains newlines (should use \n)
2025-12-15 09:24:47,758 - WARNING - Part 8, row 3: Extraction contains newlines (should use \n)
2025-12-15 09:24:47,758 - WARNING - Part 8, row 7: Extraction contains newlines (should use \n)
2025-12-15 09:24:47,758 - WARNING - Part 8, row 8: Extraction contains newlines (should use \n)
2025-12-15 09:24:47,758 - WARNING - Part 8, row 12: Extraction contains newlines (should use \n)
2025-12-15 09:24:47,758 - WARNING - Part 8, row 13: Extraction contains newlines (should use \n)
2025-12-15 09:24:47,758 - WARNING - Part 8, row 14: Extraction contains newlines (should use \n)
2025-12-15 09:24:47,759 - WARNING - Part 8, row 17: Extraction contains newlines (should use \n)
2025-12-15 09:24:47,759 - WARNING - Part 8, row 18: Extraction contains newlines (should use \n)
2025-12-15 09:24:47,759 - WARNING - Part 9, row 1: Extraction contains newlines (should use \n)
2025-12-15 09:24:47,760 - WARNING - Part 9, row 2: Extraction contains newlines (should use \n)
2025-12-15 09:24:47,760 - WARNING - Part 9, row 3: Extraction contains newlines (should use \n)
2025-12-15 09:24:47,760 - WARNING - Part 9, row 7: Extraction contains newlines (should use \n)
2025-12-15 09:24:47,760 - WARNING - Part 9, row 8: Extraction contains newlines (should use \n)
2025-12-15 09:24:47,760 - WARNING - Part 9, row 9: Extraction contains newlines (should use \n)
2025-12-15 09:24:47,760 - WARNING - Part 9, row 13: Extraction contains newlines (should use \n)
2025-12-15 09:24:47,761 - WARNING - Part 9, row 14: Extraction contains newlines (should use \n)
2025-12-15 09:24:47,762 - WARNING - Part 9, row 15: Extraction contains newlines (should use \n)
2025-12-15 09:24:47,763 - WARNING - Part 9, row 18: Extraction contains newlines (should use \n)
2025-12-15 09:24:47,763 - WARNING - Part 9, row 19: Extraction contains newlines (should use \n)
2025-12-15 09:24:47,763 - WARNING - Part 9, row 21: Extraction contains newlines (should use \n)
2025-12-15 09:24:47,763 - INFO - Resuming from part 17 (found 16 completed parts)
2025-12-15 09:24:47,765 - INFO - Loaded part 1: 14 rows
2025-12-15 09:24:47,766 - INFO - Loaded part 2: 17 rows
2025-12-15 09:24:47,767 - INFO - Loaded part 3: 12 rows
2025-12-15 09:24:47,768 - INFO - Loaded part 4: 15 rows
2025-12-15 09:24:47,770 - INFO - Loaded part 5: 30 rows
2025-12-15 09:24:47,771 - INFO - Loaded part 6: 10 rows
2025-12-15 09:24:47,771 - INFO - Loaded part 7: 25 rows
2025-12-15 09:24:47,772 - INFO - Loaded part 8: 19 rows
2025-12-15 09:24:47,772 - INFO - Loaded part 9: 22 rows
2025-12-15 09:24:47,773 - INFO - Loaded part 10: 33 rows
2025-12-15 09:24:47,774 - INFO - Loaded part 11: 15 rows
2025-12-15 09:24:47,775 - INFO - Loaded part 12: 28 rows
2025-12-15 09:24:47,776 - INFO - Loaded part 13: 17 rows
2025-12-15 09:24:47,777 - INFO - Loaded part 14: 14 rows
2025-12-15 09:24:47,778 - INFO - Loaded part 15: 18 rows
2025-12-15 09:24:47,778 - INFO - Loaded part 16: 19 rows
2025-12-15 09:24:47,778 - INFO - === Processing Part 17 ===
2025-12-15 09:24:59,477 - INFO - PDF uploaded successfully with API key: bagher
2025-12-15 09:24:59,478 - INFO - Uploaded PDF file: Bolognia 5th Edition 2024 (1)-7-26-46.pdf
2025-12-15 09:24:59,478 - INFO - Model: gemini-2.5-pro, Max tokens for model: 32768, Using: 32768
2025-12-15 09:24:59,479 - INFO - Using max_output_tokens: 32768
2025-12-15 09:24:59,479 - INFO - Using model: gemini-2.5-pro
2025-12-15 09:24:59,480 - INFO - Sending prompt (length: 2676 characters)
2025-12-15 09:24:59,480 - INFO - Max output tokens: 32768
2025-12-15 09:24:59,481 - INFO - Multi-part mode: Using user's prompt as-is
2025-12-15 09:24:59,481 - INFO - Streaming disabled (force_no_streaming=True for multi-part processing)
2025-12-15 09:24:59,482 - INFO - Generating content with NON-STREAMING (large request detected to avoid rate limits)...
2025-12-15 09:26:33,681 - INFO - ✓ Request completed: 24472 characters received
2025-12-15 09:26:33,681 - INFO - Finish reason: STOP (normal completion)
2025-12-15 09:26:33,682 - INFO - ✓ Response completed normally
2025-12-15 09:26:33,683 - INFO - Part 17: Parsed successfully - is_last=False, rows=15
2025-12-15 09:26:33,683 - WARNING - Part 17: Reached maximum part limit (4). Forcing is_last=true.
2025-12-15 09:26:33,685 - INFO - ✓ Saved part 17 to /home/mohammadbagher/Desktop/tts app bagher/content_automation_project/parts_Bolognia 5th Edition 2024 (1)-7-26-46.pdf_bd8375b7/part_17.json
2025-12-15 09:26:33,685 - INFO - Part 17: Saved to /home/mohammadbagher/Desktop/tts app bagher/content_automation_project/parts_Bolognia 5th Edition 2024 (1)-7-26-46.pdf_bd8375b7/part_17.json (not displayed to user)
2025-12-15 09:26:33,685 - INFO - Part 17: Added 15 rows (total: 323)
2025-12-15 09:26:33,685 - INFO - Part 17: is_last=true, processing complete!
2025-12-15 09:26:33,686 - ERROR - ERROR: No parts were processed! Started at 17, ended at 17
2025-12-15 09:26:33,686 - ERROR - Multi-part processing returned no final output file
2025-12-15 09:30:34,110 - INFO - Loaded 6 predefined prompts
2025-12-15 09:31:03,488 - INFO - Loaded 3 API keys
2025-12-15 09:31:39,655 - INFO - === Starting PDF Processing ===
2025-12-15 09:31:39,656 - INFO - Model: gemini-2.5-pro
2025-12-15 09:31:39,657 - INFO - PDF: /home/mohammadbagher/Downloads/PDFs/Bolognia 5th Edition 2024 (1)-7-26-46.pdf
2025-12-15 09:31:39,658 - INFO - Full prompt being sent (2527 chars): You are a meticulous medical OCR & structuring assistant.

Your job is to extract ONLY what is present on each provided textbook page image/PDF
and convert it into clean, AI-ready text with structured sections.

You MUST avoid hallucinations and preserve original medical meaning precisely.

====================
GLOBAL PRINCIPLES
====================
- NO HALLUCINATIONS: Output only content visible on the page(s). If unreadable/unclear, write "[UNREADABLE]" or add an "uncertain" flag with brief reason.
- LANGUAGE & SPELLING: Preserve original English spelling and medical terminology.
- CLEAN OCR:
  - Remove headers/footers and running titles.
  - Fix broken words at line breaks.
  - Replace ligatures (ﬁ, ﬂ).
  - Preserve italics (*italic*), bold (**bold**), and subscripts/superscripts via LaTeX.
- CITATIONS: Keep in-text citations verbatim.
- MATH/CHEM: Use inline LaTeX.
- NO IMAGES: Describe figures textually only; do not invent labels.

====================
CRITICAL OUTPUT CONTRACT (MULTI-PART)
====================
The full output is TOO LARGE to fit in one response.

You MUST split the final output into multiple PARTS.

Each response MUST:
- Output ONLY valid JSON
- Contain ONLY ONE PART of the final output
- NOT repeat rows from previous parts
- Preserve the exact order of rows across parts

====================
OUTPUT FORMAT (EXACT)
====================
{
  "part_index": <integer starting from 1>,
  "is_last": <true | false>,
  "rows": [
    {
      "Type": "page text | Figure | Table",
      "Extraction": "<single-line text or JSON>",
      "Number": <page number>,
      "Part": <our part number>
    }
  ]
}

Rules for rows:
- Each row represents exactly ONE of:
  - page text
  - figure
  - table
- Extraction MUST be single-line (no ENTER).
- JSON inside Extraction MUST be minified and valid.
- References section at end of chapter MUST be ignored.

====================
PART INSTRUCTIONS
====================
This is PART {part_index} of the output.

Generate ONLY the rows that belong to this part.
Stop when you reach a safe size limit.
If more content remains after this part, set:
  "is_last": false
Otherwise set:
  "is_last": true

====================
AUTHOR PARTS → OUR PARTS RULES
====================
[keep your full original rules here verbatim — unchanged]

====================
FINAL RULES
====================
- DO NOT summarize.
- DO NOT explain.
- DO NOT add commentary.
- Output ONLY the JSON object described above.

You will now receive a PDF.
Generate PART {part_index}.
2025-12-15 09:31:39,663 - INFO - Parts directory: /home/mohammadbagher/Desktop/tts app bagher/content_automation_project/parts_Bolognia 5th Edition 2024 (1)-7-26-46.pdf_bd8375b7
2025-12-15 09:31:39,665 - INFO - Final output will be saved to PDF directory: /home/mohammadbagher/Downloads/PDFs
2025-12-15 09:31:39,668 - INFO - No previous parts found, starting from part 1
2025-12-15 09:31:39,669 - INFO - === Processing Part 1 ===
2025-12-15 09:31:51,288 - INFO - PDF uploaded successfully with API key: bagher
2025-12-15 09:31:51,289 - INFO - Uploaded PDF file: Bolognia 5th Edition 2024 (1)-7-26-46.pdf
2025-12-15 09:31:51,290 - INFO - Model: gemini-2.5-pro, Max tokens for model: 32768, Using: 32768
2025-12-15 09:31:51,290 - INFO - Using max_output_tokens: 32768
2025-12-15 09:31:51,291 - INFO - Using model: gemini-2.5-pro
2025-12-15 09:31:51,291 - INFO - Sending prompt (length: 2647 characters)
2025-12-15 09:31:51,292 - INFO - Max output tokens: 32768
2025-12-15 09:31:51,293 - INFO - Multi-part mode: Using user's prompt as-is
2025-12-15 09:31:51,294 - INFO - Streaming disabled (force_no_streaming=True for multi-part processing)
2025-12-15 09:31:51,294 - INFO - Generating content with NON-STREAMING (large request detected to avoid rate limits)...
2025-12-15 09:33:13,836 - INFO - ✓ Request completed: 30153 characters received
2025-12-15 09:33:13,837 - INFO - Finish reason: STOP (normal completion)
2025-12-15 09:33:13,838 - INFO - ✓ Response completed normally
2025-12-15 09:33:13,842 - WARNING - Part 1, row 2: Extraction contains newlines (should use \n)
2025-12-15 09:33:13,843 - WARNING - Part 1, row 5: Extraction contains newlines (should use \n)
2025-12-15 09:33:13,843 - WARNING - Part 1, row 6: Extraction contains newlines (should use \n)
2025-12-15 09:33:13,844 - WARNING - Part 1, row 7: Extraction contains newlines (should use \n)
2025-12-15 09:33:13,844 - WARNING - Part 1, row 8: Extraction contains newlines (should use \n)
2025-12-15 09:33:13,845 - WARNING - Part 1, row 9: Extraction contains newlines (should use \n)
2025-12-15 09:33:13,845 - WARNING - Part 1, row 10: Extraction contains newlines (should use \n)
2025-12-15 09:33:13,846 - WARNING - Part 1, row 14: Extraction contains newlines (should use \n)
2025-12-15 09:33:13,846 - WARNING - Part 1, row 16: Extraction contains newlines (should use \n)
2025-12-15 09:33:13,847 - WARNING - Part 1, row 17: Extraction contains newlines (should use \n)
2025-12-15 09:33:13,847 - WARNING - Part 1, row 19: Extraction contains newlines (should use \n)
2025-12-15 09:33:13,848 - WARNING - Part 1, row 20: Extraction contains newlines (should use \n)
2025-12-15 09:33:13,848 - WARNING - Part 1, row 23: Extraction contains newlines (should use \n)
2025-12-15 09:33:13,849 - WARNING - Part 1, row 25: Extraction contains newlines (should use \n)
2025-12-15 09:33:13,849 - WARNING - Part 1, row 26: Extraction contains newlines (should use \n)
2025-12-15 09:33:13,849 - WARNING - Part 1, row 27: Extraction contains newlines (should use \n)
2025-12-15 09:33:13,850 - WARNING - Part 1, row 31: Extraction contains newlines (should use \n)
2025-12-15 09:33:13,850 - WARNING - Part 1, row 32: Extraction contains newlines (should use \n)
2025-12-15 09:33:13,851 - WARNING - Part 1, row 33: Extraction contains newlines (should use \n)
2025-12-15 09:33:13,851 - WARNING - Part 1, row 2: Extraction contains newlines (should use \n)
2025-12-15 09:33:13,852 - WARNING - Part 1, row 5: Extraction contains newlines (should use \n)
2025-12-15 09:33:13,852 - WARNING - Part 1, row 6: Extraction contains newlines (should use \n)
2025-12-15 09:33:13,854 - WARNING - Part 1, row 7: Extraction contains newlines (should use \n)
2025-12-15 09:33:13,854 - WARNING - Part 1, row 8: Extraction contains newlines (should use \n)
2025-12-15 09:33:13,855 - WARNING - Part 1, row 9: Extraction contains newlines (should use \n)
2025-12-15 09:33:13,855 - WARNING - Part 1, row 10: Extraction contains newlines (should use \n)
2025-12-15 09:33:13,856 - WARNING - Part 1, row 14: Extraction contains newlines (should use \n)
2025-12-15 09:33:13,857 - WARNING - Part 1, row 16: Extraction contains newlines (should use \n)
2025-12-15 09:33:13,857 - WARNING - Part 1, row 17: Extraction contains newlines (should use \n)
2025-12-15 09:33:13,858 - WARNING - Part 1, row 19: Extraction contains newlines (should use \n)
2025-12-15 09:33:13,858 - WARNING - Part 1, row 20: Extraction contains newlines (should use \n)
2025-12-15 09:33:13,859 - WARNING - Part 1, row 23: Extraction contains newlines (should use \n)
2025-12-15 09:33:13,859 - WARNING - Part 1, row 25: Extraction contains newlines (should use \n)
2025-12-15 09:33:13,860 - WARNING - Part 1, row 26: Extraction contains newlines (should use \n)
2025-12-15 09:33:13,861 - WARNING - Part 1, row 27: Extraction contains newlines (should use \n)
2025-12-15 09:33:13,861 - WARNING - Part 1, row 31: Extraction contains newlines (should use \n)
2025-12-15 09:33:13,862 - WARNING - Part 1, row 32: Extraction contains newlines (should use \n)
2025-12-15 09:33:13,862 - WARNING - Part 1, row 33: Extraction contains newlines (should use \n)
2025-12-15 09:33:13,863 - INFO - Part 1: Parsed successfully - is_last=False, rows=34
2025-12-15 09:33:13,870 - INFO - ✓ Saved part 1 to /home/mohammadbagher/Desktop/tts app bagher/content_automation_project/parts_Bolognia 5th Edition 2024 (1)-7-26-46.pdf_bd8375b7/part_1.json
2025-12-15 09:33:13,871 - INFO - Part 1: Saved to /home/mohammadbagher/Desktop/tts app bagher/content_automation_project/parts_Bolognia 5th Edition 2024 (1)-7-26-46.pdf_bd8375b7/part_1.json (not displayed to user)
2025-12-15 09:33:13,871 - INFO - Part 1: Added 34 rows (total: 34)
2025-12-15 09:33:13,872 - INFO - Part 1: is_last=false, continuing to next part...
2025-12-15 09:33:13,874 - INFO - Waiting 8.6s before next part...
2025-12-15 09:33:22,523 - INFO - === Processing Part 2 ===
2025-12-15 09:33:33,721 - INFO - PDF uploaded successfully with API key: bagher
2025-12-15 09:33:33,722 - INFO - Uploaded PDF file: Bolognia 5th Edition 2024 (1)-7-26-46.pdf
2025-12-15 09:33:33,723 - INFO - Model: gemini-2.5-pro, Max tokens for model: 32768, Using: 32768
2025-12-15 09:33:33,723 - INFO - Using max_output_tokens: 32768
2025-12-15 09:33:33,724 - INFO - Using model: gemini-2.5-pro
2025-12-15 09:33:33,724 - INFO - Sending prompt (length: 2674 characters)
2025-12-15 09:33:33,725 - INFO - Max output tokens: 32768
2025-12-15 09:33:33,725 - INFO - Multi-part mode: Using user's prompt as-is
2025-12-15 09:33:33,726 - INFO - Streaming disabled (force_no_streaming=True for multi-part processing)
2025-12-15 09:33:33,726 - INFO - Generating content with NON-STREAMING (large request detected to avoid rate limits)...
2025-12-15 09:34:43,832 - INFO - ✓ Request completed: 23554 characters received
2025-12-15 09:34:43,835 - INFO - Finish reason: STOP (normal completion)
2025-12-15 09:34:43,837 - INFO - ✓ Response completed normally
2025-12-15 09:34:43,843 - INFO - Part 2: Parsed successfully - is_last=False, rows=15
2025-12-15 09:34:43,851 - INFO - ✓ Saved part 2 to /home/mohammadbagher/Desktop/tts app bagher/content_automation_project/parts_Bolognia 5th Edition 2024 (1)-7-26-46.pdf_bd8375b7/part_2.json
2025-12-15 09:34:43,852 - INFO - Part 2: Saved to /home/mohammadbagher/Desktop/tts app bagher/content_automation_project/parts_Bolognia 5th Edition 2024 (1)-7-26-46.pdf_bd8375b7/part_2.json (not displayed to user)
2025-12-15 09:34:43,852 - INFO - Part 2: Added 15 rows (total: 49)
2025-12-15 09:34:43,853 - INFO - Part 2: is_last=false, continuing to next part...
2025-12-15 09:34:43,855 - INFO - Waiting 12.3s before next part...
2025-12-15 09:34:56,195 - INFO - === Processing Part 3 ===
2025-12-15 09:35:07,371 - INFO - PDF uploaded successfully with API key: bagher
2025-12-15 09:35:07,372 - INFO - Uploaded PDF file: Bolognia 5th Edition 2024 (1)-7-26-46.pdf
2025-12-15 09:35:07,372 - INFO - Model: gemini-2.5-pro, Max tokens for model: 32768, Using: 32768
2025-12-15 09:35:07,373 - INFO - Using max_output_tokens: 32768
2025-12-15 09:35:07,373 - INFO - Using model: gemini-2.5-pro
2025-12-15 09:35:07,373 - INFO - Sending prompt (length: 2674 characters)
2025-12-15 09:35:07,373 - INFO - Max output tokens: 32768
2025-12-15 09:35:07,373 - INFO - Multi-part mode: Using user's prompt as-is
2025-12-15 09:35:07,374 - INFO - Streaming disabled (force_no_streaming=True for multi-part processing)
2025-12-15 09:35:07,374 - INFO - Generating content with NON-STREAMING (large request detected to avoid rate limits)...
2025-12-15 09:36:24,504 - INFO - ✓ Request completed: 26083 characters received
2025-12-15 09:36:24,505 - INFO - Finish reason: STOP (normal completion)
2025-12-15 09:36:24,506 - INFO - ✓ Response completed normally
2025-12-15 09:36:24,509 - INFO - Part 3: Parsed successfully - is_last=False, rows=14
2025-12-15 09:36:24,514 - INFO - ✓ Saved part 3 to /home/mohammadbagher/Desktop/tts app bagher/content_automation_project/parts_Bolognia 5th Edition 2024 (1)-7-26-46.pdf_bd8375b7/part_3.json
2025-12-15 09:36:24,515 - INFO - Part 3: Saved to /home/mohammadbagher/Desktop/tts app bagher/content_automation_project/parts_Bolognia 5th Edition 2024 (1)-7-26-46.pdf_bd8375b7/part_3.json (not displayed to user)
2025-12-15 09:36:24,515 - INFO - Part 3: Added 14 rows (total: 63)
2025-12-15 09:36:24,516 - INFO - Part 3: is_last=false, continuing to next part...
2025-12-15 09:36:24,517 - INFO - Waiting 12.8s before next part...
2025-12-15 09:36:37,334 - INFO - === Processing Part 4 ===
2025-12-15 09:36:49,784 - INFO - PDF uploaded successfully with API key: bagher
2025-12-15 09:36:49,784 - INFO - Uploaded PDF file: Bolognia 5th Edition 2024 (1)-7-26-46.pdf
2025-12-15 09:36:49,784 - INFO - Model: gemini-2.5-pro, Max tokens for model: 32768, Using: 32768
2025-12-15 09:36:49,784 - INFO - Using max_output_tokens: 32768
2025-12-15 09:36:49,784 - INFO - Using model: gemini-2.5-pro
2025-12-15 09:36:49,784 - INFO - Sending prompt (length: 2674 characters)
2025-12-15 09:36:49,784 - INFO - Max output tokens: 32768
2025-12-15 09:36:49,784 - INFO - Multi-part mode: Using user's prompt as-is
2025-12-15 09:36:49,785 - INFO - Streaming disabled (force_no_streaming=True for multi-part processing)
2025-12-15 09:36:49,785 - INFO - Generating content with NON-STREAMING (large request detected to avoid rate limits)...
2025-12-15 09:40:32,165 - INFO - ✓ Request completed: 71872 characters received
2025-12-15 09:40:32,166 - INFO - Finish reason: STOP (normal completion)
2025-12-15 09:40:32,166 - INFO - ✓ Response completed normally
2025-12-15 09:40:32,170 - INFO - Part 4: Parsed successfully - is_last=True, rows=81
2025-12-15 09:40:32,174 - INFO - ✓ Saved part 4 to /home/mohammadbagher/Desktop/tts app bagher/content_automation_project/parts_Bolognia 5th Edition 2024 (1)-7-26-46.pdf_bd8375b7/part_4.json
2025-12-15 09:40:32,175 - INFO - Part 4: Saved to /home/mohammadbagher/Desktop/tts app bagher/content_automation_project/parts_Bolognia 5th Edition 2024 (1)-7-26-46.pdf_bd8375b7/part_4.json (not displayed to user)
2025-12-15 09:40:32,175 - INFO - Part 4: Added 81 rows (total: 144)
2025-12-15 09:40:32,175 - INFO - Part 4: is_last=true, processing complete!
2025-12-15 09:40:32,176 - INFO - === Processing Summary ===
2025-12-15 09:40:32,176 - INFO - New parts processed in this run: 3
2025-12-15 09:40:32,176 - INFO - Previous parts loaded (resume): 0
2025-12-15 09:40:32,176 - INFO - Total rows collected: 144
2025-12-15 09:40:32,176 - INFO - Deduplicating 144 rows...
2025-12-15 09:40:32,182 - WARNING - Removed 15 duplicate rows using enhanced deduplication
2025-12-15 09:40:32,182 - INFO - Final row count after deduplication: 129
2025-12-15 09:40:32,188 - INFO - ✓ Final output saved to /home/mohammadbagher/Downloads/PDFs/Bolognia 5th Edition 2024 1-7-26-46_final_output.json
2025-12-15 09:40:32,188 - INFO -   - File path: /home/mohammadbagher/Downloads/PDFs/Bolognia 5th Edition 2024 1-7-26-46_final_output.json
2025-12-15 09:40:32,188 - ERROR - Failed to save final output: name 'total_parts_count' is not defined
Traceback (most recent call last):
  File "/home/mohammadbagher/Desktop/tts app bagher/content_automation_project/multi_part_processor.py", line 716, in process_multi_part
    self.logger.info(f"  - Total parts: {total_parts_count} ({total_parts_in_final} previous + {total_parts_processed} new)")
                                         ^^^^^^^^^^^^^^^^^
NameError: name 'total_parts_count' is not defined
2025-12-15 09:40:32,190 - ERROR - Multi-part processing returned no final output file
2025-12-15 09:43:07,969 - INFO - Loaded 6 predefined prompts
2025-12-15 09:43:44,911 - INFO - Loaded 3 API keys
2025-12-15 09:44:54,564 - INFO - === Starting PDF Processing ===
2025-12-15 09:44:54,564 - INFO - Model: gemini-2.5-pro
2025-12-15 09:44:54,564 - INFO - PDF: /home/mohammadbagher/Downloads/PDFs/Bolognia 5th Edition 2024 (1)-7-26-46.pdf
2025-12-15 09:44:54,565 - INFO - Full prompt being sent (2527 chars): You are a meticulous medical OCR & structuring assistant.

Your job is to extract ONLY what is present on each provided textbook page image/PDF
and convert it into clean, AI-ready text with structured sections.

You MUST avoid hallucinations and preserve original medical meaning precisely.

====================
GLOBAL PRINCIPLES
====================
- NO HALLUCINATIONS: Output only content visible on the page(s). If unreadable/unclear, write "[UNREADABLE]" or add an "uncertain" flag with brief reason.
- LANGUAGE & SPELLING: Preserve original English spelling and medical terminology.
- CLEAN OCR:
  - Remove headers/footers and running titles.
  - Fix broken words at line breaks.
  - Replace ligatures (ﬁ, ﬂ).
  - Preserve italics (*italic*), bold (**bold**), and subscripts/superscripts via LaTeX.
- CITATIONS: Keep in-text citations verbatim.
- MATH/CHEM: Use inline LaTeX.
- NO IMAGES: Describe figures textually only; do not invent labels.

====================
CRITICAL OUTPUT CONTRACT (MULTI-PART)
====================
The full output is TOO LARGE to fit in one response.

You MUST split the final output into multiple PARTS.

Each response MUST:
- Output ONLY valid JSON
- Contain ONLY ONE PART of the final output
- NOT repeat rows from previous parts
- Preserve the exact order of rows across parts

====================
OUTPUT FORMAT (EXACT)
====================
{
  "part_index": <integer starting from 1>,
  "is_last": <true | false>,
  "rows": [
    {
      "Type": "page text | Figure | Table",
      "Extraction": "<single-line text or JSON>",
      "Number": <page number>,
      "Part": <our part number>
    }
  ]
}

Rules for rows:
- Each row represents exactly ONE of:
  - page text
  - figure
  - table
- Extraction MUST be single-line (no ENTER).
- JSON inside Extraction MUST be minified and valid.
- References section at end of chapter MUST be ignored.

====================
PART INSTRUCTIONS
====================
This is PART {part_index} of the output.

Generate ONLY the rows that belong to this part.
Stop when you reach a safe size limit.
If more content remains after this part, set:
  "is_last": false
Otherwise set:
  "is_last": true

====================
AUTHOR PARTS → OUR PARTS RULES
====================
[keep your full original rules here verbatim — unchanged]

====================
FINAL RULES
====================
- DO NOT summarize.
- DO NOT explain.
- DO NOT add commentary.
- Output ONLY the JSON object described above.

You will now receive a PDF.
Generate PART {part_index}.
2025-12-15 09:44:54,566 - INFO - Parts directory: /home/mohammadbagher/Desktop/tts app bagher/content_automation_project/parts_Bolognia 5th Edition 2024 (1)-7-26-46.pdf_bd8375b7
2025-12-15 09:44:54,567 - INFO - Final output will be saved to PDF directory: /home/mohammadbagher/Downloads/PDFs
2025-12-15 09:44:54,567 - INFO - No previous parts found, starting from part 1
2025-12-15 09:44:54,567 - INFO - === Processing Part 1 ===
2025-12-15 09:45:06,022 - INFO - PDF uploaded successfully with API key: bagher
2025-12-15 09:45:06,024 - INFO - Uploaded PDF file: Bolognia 5th Edition 2024 (1)-7-26-46.pdf
2025-12-15 09:45:06,025 - INFO - Model: gemini-2.5-pro, Max tokens for model: 32768, Using: 32768
2025-12-15 09:45:06,026 - INFO - Using max_output_tokens: 32768
2025-12-15 09:45:06,027 - INFO - Using model: gemini-2.5-pro
2025-12-15 09:45:06,029 - INFO - Sending prompt (length: 2647 characters)
2025-12-15 09:45:06,030 - INFO - Max output tokens: 32768
2025-12-15 09:45:06,030 - INFO - Multi-part mode: Using user's prompt as-is
2025-12-15 09:45:06,031 - INFO - Streaming disabled (force_no_streaming=True for multi-part processing)
2025-12-15 09:45:06,032 - INFO - Generating content with NON-STREAMING (large request detected to avoid rate limits)...
2025-12-15 09:46:50,692 - INFO - ✓ Request completed: 36139 characters received
2025-12-15 09:46:50,694 - INFO - Finish reason: STOP (normal completion)
2025-12-15 09:46:50,695 - INFO - ✓ Response completed normally
2025-12-15 09:46:50,699 - WARNING - Part 1, row 0: Extraction contains newlines (should use \n)
2025-12-15 09:46:50,700 - WARNING - Part 1, row 1: Extraction contains newlines (should use \n)
2025-12-15 09:46:50,700 - WARNING - Part 1, row 2: Extraction contains newlines (should use \n)
2025-12-15 09:46:50,701 - WARNING - Part 1, row 3: Extraction contains newlines (should use \n)
2025-12-15 09:46:50,701 - WARNING - Part 1, row 4: Extraction contains newlines (should use \n)
2025-12-15 09:46:50,701 - WARNING - Part 1, row 5: Extraction contains newlines (should use \n)
2025-12-15 09:46:50,702 - WARNING - Part 1, row 6: Extraction contains newlines (should use \n)
2025-12-15 09:46:50,702 - WARNING - Part 1, row 7: Extraction contains newlines (should use \n)
2025-12-15 09:46:50,703 - WARNING - Part 1, row 8: Extraction contains newlines (should use \n)
2025-12-15 09:46:50,703 - WARNING - Part 1, row 12: Extraction contains newlines (should use \n)
2025-12-15 09:46:50,703 - WARNING - Part 1, row 14: Extraction contains newlines (should use \n)
2025-12-15 09:46:50,704 - WARNING - Part 1, row 15: Extraction contains newlines (should use \n)
2025-12-15 09:46:50,704 - WARNING - Part 1, row 17: Extraction contains newlines (should use \n)
2025-12-15 09:46:50,705 - WARNING - Part 1, row 18: Extraction contains newlines (should use \n)
2025-12-15 09:46:50,705 - WARNING - Part 1, row 21: Extraction contains newlines (should use \n)
2025-12-15 09:46:50,705 - WARNING - Part 1, row 23: Extraction contains newlines (should use \n)
2025-12-15 09:46:50,706 - WARNING - Part 1, row 24: Extraction contains newlines (should use \n)
2025-12-15 09:46:50,706 - WARNING - Part 1, row 25: Extraction contains newlines (should use \n)
2025-12-15 09:46:50,707 - WARNING - Part 1, row 29: Extraction contains newlines (should use \n)
2025-12-15 09:46:50,707 - WARNING - Part 1, row 30: Extraction contains newlines (should use \n)
2025-12-15 09:46:50,707 - WARNING - Part 1, row 31: Extraction contains newlines (should use \n)
2025-12-15 09:46:50,708 - WARNING - Part 1, row 35: Extraction contains newlines (should use \n)
2025-12-15 09:46:50,708 - WARNING - Part 1, row 36: Extraction contains newlines (should use \n)
2025-12-15 09:46:50,709 - WARNING - Part 1, row 0: Extraction contains newlines (should use \n)
2025-12-15 09:46:50,709 - WARNING - Part 1, row 1: Extraction contains newlines (should use \n)
2025-12-15 09:46:50,709 - WARNING - Part 1, row 2: Extraction contains newlines (should use \n)
2025-12-15 09:46:50,710 - WARNING - Part 1, row 3: Extraction contains newlines (should use \n)
2025-12-15 09:46:50,710 - WARNING - Part 1, row 4: Extraction contains newlines (should use \n)
2025-12-15 09:46:50,711 - WARNING - Part 1, row 5: Extraction contains newlines (should use \n)
2025-12-15 09:46:50,711 - WARNING - Part 1, row 6: Extraction contains newlines (should use \n)
2025-12-15 09:46:50,711 - WARNING - Part 1, row 7: Extraction contains newlines (should use \n)
2025-12-15 09:46:50,712 - WARNING - Part 1, row 8: Extraction contains newlines (should use \n)
2025-12-15 09:46:50,712 - WARNING - Part 1, row 12: Extraction contains newlines (should use \n)
2025-12-15 09:46:50,712 - WARNING - Part 1, row 14: Extraction contains newlines (should use \n)
2025-12-15 09:46:50,713 - WARNING - Part 1, row 15: Extraction contains newlines (should use \n)
2025-12-15 09:46:50,713 - WARNING - Part 1, row 17: Extraction contains newlines (should use \n)
2025-12-15 09:46:50,714 - WARNING - Part 1, row 18: Extraction contains newlines (should use \n)
2025-12-15 09:46:50,714 - WARNING - Part 1, row 21: Extraction contains newlines (should use \n)
2025-12-15 09:46:50,715 - WARNING - Part 1, row 23: Extraction contains newlines (should use \n)
2025-12-15 09:46:50,715 - WARNING - Part 1, row 24: Extraction contains newlines (should use \n)
2025-12-15 09:46:50,715 - WARNING - Part 1, row 25: Extraction contains newlines (should use \n)
2025-12-15 09:46:50,716 - WARNING - Part 1, row 29: Extraction contains newlines (should use \n)
2025-12-15 09:46:50,716 - WARNING - Part 1, row 30: Extraction contains newlines (should use \n)
2025-12-15 09:46:50,717 - WARNING - Part 1, row 31: Extraction contains newlines (should use \n)
2025-12-15 09:46:50,717 - WARNING - Part 1, row 35: Extraction contains newlines (should use \n)
2025-12-15 09:46:50,717 - WARNING - Part 1, row 36: Extraction contains newlines (should use \n)
2025-12-15 09:46:50,718 - INFO - Part 1: Parsed successfully - is_last=False, rows=37
2025-12-15 09:46:50,725 - INFO - ✓ Saved part 1 to /home/mohammadbagher/Desktop/tts app bagher/content_automation_project/parts_Bolognia 5th Edition 2024 (1)-7-26-46.pdf_bd8375b7/part_1.json
2025-12-15 09:46:50,726 - INFO - Part 1: Saved to /home/mohammadbagher/Desktop/tts app bagher/content_automation_project/parts_Bolognia 5th Edition 2024 (1)-7-26-46.pdf_bd8375b7/part_1.json (not displayed to user)
2025-12-15 09:46:50,727 - INFO - Part 1: Added 37 rows (total: 37)
2025-12-15 09:46:50,727 - INFO - Part 1: is_last=false, continuing to next part...
2025-12-15 09:46:50,729 - INFO - Waiting 13.9s before next part...
2025-12-15 09:47:04,598 - INFO - === Processing Part 2 ===
2025-12-15 09:47:15,018 - INFO - PDF uploaded successfully with API key: bagher
2025-12-15 09:47:15,019 - INFO - Uploaded PDF file: Bolognia 5th Edition 2024 (1)-7-26-46.pdf
2025-12-15 09:47:15,020 - INFO - Model: gemini-2.5-pro, Max tokens for model: 32768, Using: 32768
2025-12-15 09:47:15,020 - INFO - Using max_output_tokens: 32768
2025-12-15 09:47:15,021 - INFO - Using model: gemini-2.5-pro
2025-12-15 09:47:15,022 - INFO - Sending prompt (length: 2674 characters)
2025-12-15 09:47:15,022 - INFO - Max output tokens: 32768
2025-12-15 09:47:15,024 - INFO - Multi-part mode: Using user's prompt as-is
2025-12-15 09:47:15,025 - INFO - Streaming disabled (force_no_streaming=True for multi-part processing)
2025-12-15 09:47:15,025 - INFO - Generating content with NON-STREAMING (large request detected to avoid rate limits)...
2025-12-15 09:48:26,362 - INFO - ✓ Request completed: 24485 characters received
2025-12-15 09:48:26,363 - INFO - Finish reason: STOP (normal completion)
2025-12-15 09:48:26,364 - INFO - ✓ Response completed normally
2025-12-15 09:48:26,367 - INFO - Part 2: Parsed successfully - is_last=False, rows=15
2025-12-15 09:48:26,372 - INFO - ✓ Saved part 2 to /home/mohammadbagher/Desktop/tts app bagher/content_automation_project/parts_Bolognia 5th Edition 2024 (1)-7-26-46.pdf_bd8375b7/part_2.json
2025-12-15 09:48:26,373 - INFO - Part 2: Saved to /home/mohammadbagher/Desktop/tts app bagher/content_automation_project/parts_Bolognia 5th Edition 2024 (1)-7-26-46.pdf_bd8375b7/part_2.json (not displayed to user)
2025-12-15 09:48:26,374 - INFO - Part 2: Added 15 rows (total: 52)
2025-12-15 09:48:26,374 - INFO - Part 2: is_last=false, continuing to next part...
2025-12-15 09:48:26,376 - INFO - Waiting 12.3s before next part...
2025-12-15 09:48:38,717 - INFO - === Processing Part 3 ===
2025-12-15 09:48:48,815 - INFO - PDF uploaded successfully with API key: bagher
2025-12-15 09:48:48,815 - INFO - Uploaded PDF file: Bolognia 5th Edition 2024 (1)-7-26-46.pdf
2025-12-15 09:48:48,815 - INFO - Model: gemini-2.5-pro, Max tokens for model: 32768, Using: 32768
2025-12-15 09:48:48,815 - INFO - Using max_output_tokens: 32768
2025-12-15 09:48:48,815 - INFO - Using model: gemini-2.5-pro
2025-12-15 09:48:48,816 - INFO - Sending prompt (length: 2674 characters)
2025-12-15 09:48:48,816 - INFO - Max output tokens: 32768
2025-12-15 09:48:48,816 - INFO - Multi-part mode: Using user's prompt as-is
2025-12-15 09:48:48,816 - INFO - Streaming disabled (force_no_streaming=True for multi-part processing)
2025-12-15 09:48:48,817 - INFO - Generating content with NON-STREAMING (large request detected to avoid rate limits)...
2025-12-15 09:50:10,236 - INFO - ✓ Request completed: 18347 characters received
2025-12-15 09:50:10,237 - INFO - Finish reason: STOP (normal completion)
2025-12-15 09:50:10,238 - INFO - ✓ Response completed normally
2025-12-15 09:50:10,241 - WARNING - Part 3, row 0: Extraction contains newlines (should use \n)
2025-12-15 09:50:10,241 - WARNING - Part 3, row 2: Extraction contains newlines (should use \n)
2025-12-15 09:50:10,242 - WARNING - Part 3, row 5: Extraction contains newlines (should use \n)
2025-12-15 09:50:10,242 - WARNING - Part 3, row 0: Extraction contains newlines (should use \n)
2025-12-15 09:50:10,243 - WARNING - Part 3, row 2: Extraction contains newlines (should use \n)
2025-12-15 09:50:10,243 - WARNING - Part 3, row 5: Extraction contains newlines (should use \n)
2025-12-15 09:50:10,244 - INFO - Part 3: Parsed successfully - is_last=False, rows=7
2025-12-15 09:50:10,247 - INFO - ✓ Saved part 3 to /home/mohammadbagher/Desktop/tts app bagher/content_automation_project/parts_Bolognia 5th Edition 2024 (1)-7-26-46.pdf_bd8375b7/part_3.json
2025-12-15 09:50:10,248 - INFO - Part 3: Saved to /home/mohammadbagher/Desktop/tts app bagher/content_automation_project/parts_Bolognia 5th Edition 2024 (1)-7-26-46.pdf_bd8375b7/part_3.json (not displayed to user)
2025-12-15 09:50:10,248 - INFO - Part 3: Added 7 rows (total: 59)
2025-12-15 09:50:10,250 - INFO - Part 3: is_last=false, continuing to next part...
2025-12-15 09:50:10,254 - INFO - Waiting 10.4s before next part...
2025-12-15 09:50:20,673 - INFO - === Processing Part 4 ===
2025-12-15 09:50:30,685 - INFO - PDF uploaded successfully with API key: bagher
2025-12-15 09:50:30,686 - INFO - Uploaded PDF file: Bolognia 5th Edition 2024 (1)-7-26-46.pdf
2025-12-15 09:50:30,686 - INFO - Model: gemini-2.5-pro, Max tokens for model: 32768, Using: 32768
2025-12-15 09:50:30,687 - INFO - Using max_output_tokens: 32768
2025-12-15 09:50:30,688 - INFO - Using model: gemini-2.5-pro
2025-12-15 09:50:30,688 - INFO - Sending prompt (length: 2674 characters)
2025-12-15 09:50:30,689 - INFO - Max output tokens: 32768
2025-12-15 09:50:30,689 - INFO - Multi-part mode: Using user's prompt as-is
2025-12-15 09:50:30,690 - INFO - Streaming disabled (force_no_streaming=True for multi-part processing)
2025-12-15 09:50:30,690 - INFO - Generating content with NON-STREAMING (large request detected to avoid rate limits)...
2025-12-15 09:53:24,026 - INFO - ✓ Request completed: 70075 characters received
2025-12-15 09:53:24,026 - INFO - Finish reason: STOP (normal completion)
2025-12-15 09:53:24,026 - INFO - ✓ Response completed normally
2025-12-15 09:53:24,028 - INFO - Part 4: Parsed successfully - is_last=True, rows=104
2025-12-15 09:53:24,031 - INFO - ✓ Saved part 4 to /home/mohammadbagher/Desktop/tts app bagher/content_automation_project/parts_Bolognia 5th Edition 2024 (1)-7-26-46.pdf_bd8375b7/part_4.json
2025-12-15 09:53:24,031 - INFO - Part 4: Saved to /home/mohammadbagher/Desktop/tts app bagher/content_automation_project/parts_Bolognia 5th Edition 2024 (1)-7-26-46.pdf_bd8375b7/part_4.json (not displayed to user)
2025-12-15 09:53:24,032 - INFO - Part 4: Added 104 rows (total: 163)
2025-12-15 09:53:24,032 - INFO - Part 4: is_last=true, processing complete!
2025-12-15 09:53:24,032 - INFO - === Processing Summary ===
2025-12-15 09:53:24,033 - INFO - New parts processed in this run: 3
2025-12-15 09:53:24,033 - INFO - Previous parts loaded (resume): 0
2025-12-15 09:53:24,034 - INFO - Total parts in final output: 3
2025-12-15 09:53:24,034 - INFO - Total rows collected: 163
2025-12-15 09:53:24,034 - INFO - Deduplicating 163 rows...
2025-12-15 09:53:24,041 - WARNING - Removed 1 duplicate rows using enhanced deduplication
2025-12-15 09:53:24,041 - INFO - Final row count after deduplication: 162
2025-12-15 09:53:24,049 - INFO - ✓ Final output saved to /home/mohammadbagher/Downloads/PDFs/Bolognia 5th Edition 2024 1-7-26-46_final_output.json
2025-12-15 09:53:24,049 - INFO -   - File path: /home/mohammadbagher/Downloads/PDFs/Bolognia 5th Edition 2024 1-7-26-46_final_output.json
2025-12-15 09:53:24,050 - INFO -   - Total parts: 3 (0 previous + 3 new)
2025-12-15 09:53:24,050 - INFO -   - Total rows: 162
2025-12-15 09:53:24,050 - INFO -   - File size: 146.70 KB
2025-12-15 10:17:13,767 - INFO - Loaded 6 predefined prompts
2025-12-15 10:21:42,996 - INFO - Loaded 6 predefined prompts
2025-12-15 10:28:32,225 - INFO - Loaded 6 predefined prompts
2025-12-15 10:28:51,815 - INFO - Loaded 3 API keys
2025-12-15 10:29:33,771 - INFO - === Starting PDF Processing ===
2025-12-15 10:29:33,771 - INFO - Model: gemini-2.5-pro
2025-12-15 10:29:33,772 - INFO - PDF: /home/mohammadbagher/Downloads/PDFs/Bolognia 5th Edition 2024 (1)-7-26-46.pdf
2025-12-15 10:29:33,772 - INFO - Full prompt being sent (4078 chars): You are a meticulous medical OCR & structuring assistant.

Your job is to extract ONLY what is present on each provided textbook page image/PDF
and convert it into clean, AI-ready text with structured sections.

You MUST avoid hallucinations and preserve original medical meaning precisely.

====================
GLOBAL PRINCIPLES
====================
- NO HALLUCINATIONS: Output only content visible on the page(s). If unreadable/unclear, write "[UNREADABLE]" or add an "uncertain" flag with brief reason.
- LANGUAGE & SPELLING: Preserve original English spelling and medical terminology.
- CLEAN OCR:
  - Remove headers/footers and running titles.
  - Fix broken words at line breaks.
  - Replace ligatures (ﬁ, ﬂ).
  - Preserve italics (*italic*), bold (**bold**), and subscripts/superscripts via LaTeX.
- CITATIONS: Keep in-text citations verbatim.
- MATH/CHEM: Use inline LaTeX.
- NO IMAGES: Describe figures textually only; do not invent labels.

====================
CRITICAL OUTPUT CONTRACT (MULTI-PART)
====================
The full output is TOO LARGE to fit in one response.

You MUST split the final output into multiple PARTS.

Each response MUST:
- Output ONLY valid JSON
- Contain ONLY ONE PART of the final output
- NOT repeat rows from previous parts
- Preserve the exact order of rows across parts

====================
OUTPUT FORMAT (EXACT)
====================
{
  "part_index": <integer starting from 1>,
  "is_last": <true | false>,
  "rows": [
    {
      "Type": "page text | Figure | Table",
      "Extraction": "<single-line text or JSON>",
      "Number": <page number>,
      "Part": <The “Part” column shows that the row’s content is included in which part. Use numbers like 1 or 2 and more.
How to define the parts for each row: in the beginning of the first page of the file there is a “Chapter contents” which demonstrates the parts of the chapter recommended by the author, which we call them “author parts”. I want you to make your own suggestion for dividing the parts, which we call them “Our parts”. The rules of dividing are as follows: an “our part” is consisted of as many as consecutive “author parts” without being the final “our part” more than 10 pages. For example if the “author part”s of the chapter are 2,4,5,3,1,7,5 pages respectively, the first “our part” will be consisted of the first two “author parts”. The second “our part” will be consisted of the third and fourth and fifth “author parts”. the third “our part” will be consisted of the sixth “author part”. the fourth “our part” will be consisted of the seventh “author part”.
If an “our part” ends in the middle of a page, some of the page text will be for the previous “our part” and some of the page will be for the next “our part”. The text of such pages must be written in two separate rows. One of them is related to the previous “our part” and one of them is related to next “our part”. Your goal should be avoiding a row’s content to be consisted of the data from two different “our part”s.
And for example if you decided to divide the chapter into 2 parts, you should write “1” for the contents of the first part and write “2” for the contents of the second part.>
    }
  ]
}

Rules for rows:
- Each row represents exactly ONE of:
  - page text
  - figure
  - table
- Extraction MUST be single-line (no ENTER).
- JSON inside Extraction MUST be minified and valid.
- References section at end of chapter MUST be ignored.

====================
PART INSTRUCTIONS
====================
This is PART {part_index} of the output.

Generate ONLY the rows that belong to this part.
Stop when you reach a safe size limit.
If more content remains after this part, set:
  "is_last": false
Otherwise set:
  "is_last": true

====================
AUTHOR PARTS → OUR PARTS RULES
====================
[keep your full original rules here verbatim — unchanged]

====================
FINAL RULES
====================
- DO NOT summarize.
- DO NOT explain.
- DO NOT add commentary.
- Output ONLY the JSON object described above.

You will now receive a PDF.
Generate PART {part_index}.
2025-12-15 10:29:33,774 - INFO - Parts directory: /home/mohammadbagher/Desktop/tts app bagher/content_automation_project/parts_Bolognia 5th Edition 2024 (1)-7-26-46.pdf_6fe593aa
2025-12-15 10:29:33,774 - INFO - Final output will be saved to PDF directory: /home/mohammadbagher/Downloads/PDFs
2025-12-15 10:29:33,775 - INFO - No previous parts found, starting from part 1
2025-12-15 10:29:33,775 - INFO - === Processing Part 1 ===
2025-12-15 10:29:43,097 - INFO - PDF uploaded successfully with API key: bagher
2025-12-15 10:29:43,097 - INFO - Uploaded PDF file: Bolognia 5th Edition 2024 (1)-7-26-46.pdf
2025-12-15 10:29:43,097 - INFO - Model: gemini-2.5-pro, Max tokens for model: 32768, Using: 32768
2025-12-15 10:29:43,097 - INFO - Using max_output_tokens: 32768
2025-12-15 10:29:43,097 - INFO - Using model: gemini-2.5-pro
2025-12-15 10:29:43,098 - INFO - Sending prompt (length: 4109 characters)
2025-12-15 10:29:43,098 - INFO - Max output tokens: 32768
2025-12-15 10:29:43,098 - INFO - Multi-part mode: Using user's prompt as-is
2025-12-15 10:29:43,098 - INFO - Streaming disabled (force_no_streaming=True for multi-part processing)
2025-12-15 10:29:43,098 - INFO - Generating content with NON-STREAMING (large request detected to avoid rate limits)...
2025-12-15 10:30:41,171 - INFO - ✓ Request completed: 13702 characters received
2025-12-15 10:30:41,173 - INFO - Finish reason: STOP (normal completion)
2025-12-15 10:30:41,174 - INFO - ✓ Response completed normally
2025-12-15 10:30:41,177 - WARNING - Part 1, row 6: Extraction contains newlines (should use \n)
2025-12-15 10:30:41,177 - WARNING - Part 1, row 7: Extraction contains newlines (should use \n)
2025-12-15 10:30:41,178 - WARNING - Part 1, row 6: Extraction contains newlines (should use \n)
2025-12-15 10:30:41,178 - WARNING - Part 1, row 7: Extraction contains newlines (should use \n)
2025-12-15 10:30:41,179 - INFO - Part 1: Parsed successfully - is_last=False, rows=11
2025-12-15 10:30:41,182 - INFO - ✓ Saved part 1 to /home/mohammadbagher/Desktop/tts app bagher/content_automation_project/parts_Bolognia 5th Edition 2024 (1)-7-26-46.pdf_6fe593aa/part_1.json
2025-12-15 10:30:41,183 - INFO - Part 1: Saved to /home/mohammadbagher/Desktop/tts app bagher/content_automation_project/parts_Bolognia 5th Edition 2024 (1)-7-26-46.pdf_6fe593aa/part_1.json (not displayed to user)
2025-12-15 10:30:41,183 - INFO - Part 1: Added 11 rows (total: 11)
2025-12-15 10:30:41,184 - INFO - Part 1: is_last=false, continuing to next part...
2025-12-15 10:30:41,185 - INFO - Waiting 11.2s before next part...
2025-12-15 10:30:52,422 - INFO - === Processing Part 2 ===
2025-12-15 10:31:01,474 - INFO - PDF uploaded successfully with API key: bagher
2025-12-15 10:31:01,474 - INFO - Uploaded PDF file: Bolognia 5th Edition 2024 (1)-7-26-46.pdf
2025-12-15 10:31:01,479 - INFO - Model: gemini-2.5-pro, Max tokens for model: 32768, Using: 32768
2025-12-15 10:31:01,479 - INFO - Using max_output_tokens: 32768
2025-12-15 10:31:01,480 - INFO - Using model: gemini-2.5-pro
2025-12-15 10:31:01,480 - INFO - Sending prompt (length: 4143 characters)
2025-12-15 10:31:01,481 - INFO - Max output tokens: 32768
2025-12-15 10:31:01,481 - INFO - Multi-part mode: Using user's prompt as-is
2025-12-15 10:31:01,483 - INFO - Streaming disabled (force_no_streaming=True for multi-part processing)
2025-12-15 10:31:01,485 - INFO - Generating content with NON-STREAMING (large request detected to avoid rate limits)...
2025-12-15 10:32:33,557 - INFO - ✓ Request completed: 22351 characters received
2025-12-15 10:32:33,559 - INFO - Finish reason: STOP (normal completion)
2025-12-15 10:32:33,559 - INFO - ✓ Response completed normally
2025-12-15 10:32:33,562 - INFO - Part 2: Parsed successfully - is_last=False, rows=14
2025-12-15 10:32:33,567 - INFO - ✓ Saved part 2 to /home/mohammadbagher/Desktop/tts app bagher/content_automation_project/parts_Bolognia 5th Edition 2024 (1)-7-26-46.pdf_6fe593aa/part_2.json
2025-12-15 10:32:33,568 - INFO - Part 2: Saved to /home/mohammadbagher/Desktop/tts app bagher/content_automation_project/parts_Bolognia 5th Edition 2024 (1)-7-26-46.pdf_6fe593aa/part_2.json (not displayed to user)
2025-12-15 10:32:33,568 - INFO - Part 2: Added 14 rows (total: 25)
2025-12-15 10:32:33,569 - INFO - Part 2: is_last=false, continuing to next part...
2025-12-15 10:32:33,571 - INFO - Waiting 8.8s before next part...
2025-12-15 10:32:42,404 - INFO - === Processing Part 3 ===
2025-12-15 10:32:50,951 - INFO - PDF uploaded successfully with API key: bagher
2025-12-15 10:32:50,951 - INFO - Uploaded PDF file: Bolognia 5th Edition 2024 (1)-7-26-46.pdf
2025-12-15 10:32:50,952 - INFO - Model: gemini-2.5-pro, Max tokens for model: 32768, Using: 32768
2025-12-15 10:32:50,953 - INFO - Using max_output_tokens: 32768
2025-12-15 10:32:50,953 - INFO - Using model: gemini-2.5-pro
2025-12-15 10:32:50,954 - INFO - Sending prompt (length: 4143 characters)
2025-12-15 10:32:50,954 - INFO - Max output tokens: 32768
2025-12-15 10:32:50,954 - INFO - Multi-part mode: Using user's prompt as-is
2025-12-15 10:32:50,955 - INFO - Streaming disabled (force_no_streaming=True for multi-part processing)
2025-12-15 10:32:50,955 - INFO - Generating content with NON-STREAMING (large request detected to avoid rate limits)...
2025-12-15 10:34:30,100 - INFO - ✓ Request completed: 26706 characters received
2025-12-15 10:34:30,100 - INFO - Finish reason: STOP (normal completion)
2025-12-15 10:34:30,104 - INFO - ✓ Response completed normally
2025-12-15 10:34:30,106 - INFO - Part 3: Parsed successfully - is_last=False, rows=10
2025-12-15 10:34:30,109 - INFO - ✓ Saved part 3 to /home/mohammadbagher/Desktop/tts app bagher/content_automation_project/parts_Bolognia 5th Edition 2024 (1)-7-26-46.pdf_6fe593aa/part_3.json
2025-12-15 10:34:30,110 - INFO - Part 3: Saved to /home/mohammadbagher/Desktop/tts app bagher/content_automation_project/parts_Bolognia 5th Edition 2024 (1)-7-26-46.pdf_6fe593aa/part_3.json (not displayed to user)
2025-12-15 10:34:30,110 - INFO - Part 3: Added 10 rows (total: 35)
2025-12-15 10:34:30,110 - INFO - Part 3: is_last=false, continuing to next part...
2025-12-15 10:34:30,111 - INFO - Waiting 14.8s before next part...
2025-12-15 10:34:44,958 - INFO - === Processing Part 4 ===
2025-12-15 10:34:57,647 - INFO - PDF uploaded successfully with API key: bagher
2025-12-15 10:34:57,648 - INFO - Uploaded PDF file: Bolognia 5th Edition 2024 (1)-7-26-46.pdf
2025-12-15 10:34:57,649 - INFO - Model: gemini-2.5-pro, Max tokens for model: 32768, Using: 32768
2025-12-15 10:34:57,649 - INFO - Using max_output_tokens: 32768
2025-12-15 10:34:57,650 - INFO - Using model: gemini-2.5-pro
2025-12-15 10:34:57,650 - INFO - Sending prompt (length: 4143 characters)
2025-12-15 10:34:57,651 - INFO - Max output tokens: 32768
2025-12-15 10:34:57,651 - INFO - Multi-part mode: Using user's prompt as-is
2025-12-15 10:34:57,652 - INFO - Streaming disabled (force_no_streaming=True for multi-part processing)
2025-12-15 10:34:57,652 - INFO - Generating content with NON-STREAMING (large request detected to avoid rate limits)...
2025-12-15 10:37:01,774 - INFO - ✓ Request completed: 18263 characters received
2025-12-15 10:37:01,774 - INFO - Finish reason: STOP (normal completion)
2025-12-15 10:37:01,774 - INFO - ✓ Response completed normally
2025-12-15 10:37:01,775 - INFO - Part 4: Parsed successfully - is_last=False, rows=7
2025-12-15 10:37:01,776 - INFO - ✓ Saved part 4 to /home/mohammadbagher/Desktop/tts app bagher/content_automation_project/parts_Bolognia 5th Edition 2024 (1)-7-26-46.pdf_6fe593aa/part_4.json
2025-12-15 10:37:01,776 - INFO - Part 4: Saved to /home/mohammadbagher/Desktop/tts app bagher/content_automation_project/parts_Bolognia 5th Edition 2024 (1)-7-26-46.pdf_6fe593aa/part_4.json (not displayed to user)
2025-12-15 10:37:01,776 - INFO - Part 4: Added 7 rows (total: 42)
2025-12-15 10:37:01,776 - INFO - Part 4: is_last=false, continuing to next part...
2025-12-15 10:37:01,776 - INFO - Waiting 14.5s before next part...
2025-12-15 10:37:16,230 - INFO - === Processing Part 5 ===
2025-12-15 10:37:25,290 - INFO - PDF uploaded successfully with API key: bagher
2025-12-15 10:37:25,290 - INFO - Uploaded PDF file: Bolognia 5th Edition 2024 (1)-7-26-46.pdf
2025-12-15 10:37:25,290 - INFO - Model: gemini-2.5-pro, Max tokens for model: 32768, Using: 32768
2025-12-15 10:37:25,290 - INFO - Using max_output_tokens: 32768
2025-12-15 10:37:25,290 - INFO - Using model: gemini-2.5-pro
2025-12-15 10:37:25,291 - INFO - Sending prompt (length: 4143 characters)
2025-12-15 10:37:25,291 - INFO - Max output tokens: 32768
2025-12-15 10:37:25,291 - INFO - Multi-part mode: Using user's prompt as-is
2025-12-15 10:37:25,291 - INFO - Streaming disabled (force_no_streaming=True for multi-part processing)
2025-12-15 10:37:25,291 - INFO - Generating content with NON-STREAMING (large request detected to avoid rate limits)...
2025-12-15 10:38:54,315 - INFO - ✓ Request completed: 19104 characters received
2025-12-15 10:38:54,315 - INFO - Finish reason: STOP (normal completion)
2025-12-15 10:38:54,316 - INFO - ✓ Response completed normally
2025-12-15 10:38:54,317 - WARNING - Part 5, row 2: Extraction contains newlines (should use \n)
2025-12-15 10:38:54,317 - WARNING - Part 5, row 3: Extraction contains newlines (should use \n)
2025-12-15 10:38:54,318 - WARNING - Part 5, row 4: Extraction contains newlines (should use \n)
2025-12-15 10:38:54,318 - WARNING - Part 5, row 6: Extraction contains newlines (should use \n)
2025-12-15 10:38:54,318 - WARNING - Part 5, row 2: Extraction contains newlines (should use \n)
2025-12-15 10:38:54,318 - WARNING - Part 5, row 3: Extraction contains newlines (should use \n)
2025-12-15 10:38:54,319 - WARNING - Part 5, row 4: Extraction contains newlines (should use \n)
2025-12-15 10:38:54,319 - WARNING - Part 5, row 6: Extraction contains newlines (should use \n)
2025-12-15 10:38:54,319 - INFO - Part 5: Parsed successfully - is_last=False, rows=9
2025-12-15 10:38:54,321 - INFO - ✓ Saved part 5 to /home/mohammadbagher/Desktop/tts app bagher/content_automation_project/parts_Bolognia 5th Edition 2024 (1)-7-26-46.pdf_6fe593aa/part_5.json
2025-12-15 10:38:54,321 - INFO - Part 5: Saved to /home/mohammadbagher/Desktop/tts app bagher/content_automation_project/parts_Bolognia 5th Edition 2024 (1)-7-26-46.pdf_6fe593aa/part_5.json (not displayed to user)
2025-12-15 10:38:54,322 - INFO - Part 5: Added 9 rows (total: 51)
2025-12-15 10:38:54,322 - INFO - Part 5: is_last=false, continuing to next part...
2025-12-15 10:38:54,323 - INFO - Waiting 11.2s before next part...
2025-12-15 10:39:05,527 - INFO - === Processing Part 6 ===
2025-12-15 10:39:14,960 - INFO - PDF uploaded successfully with API key: bagher
2025-12-15 10:39:14,960 - INFO - Uploaded PDF file: Bolognia 5th Edition 2024 (1)-7-26-46.pdf
2025-12-15 10:39:14,961 - INFO - Model: gemini-2.5-pro, Max tokens for model: 32768, Using: 32768
2025-12-15 10:39:14,961 - INFO - Using max_output_tokens: 32768
2025-12-15 10:39:14,962 - INFO - Using model: gemini-2.5-pro
2025-12-15 10:39:14,962 - INFO - Sending prompt (length: 4143 characters)
2025-12-15 10:39:14,963 - INFO - Max output tokens: 32768
2025-12-15 10:39:14,964 - INFO - Multi-part mode: Using user's prompt as-is
2025-12-15 10:39:14,965 - INFO - Streaming disabled (force_no_streaming=True for multi-part processing)
2025-12-15 10:39:14,965 - INFO - Generating content with NON-STREAMING (large request detected to avoid rate limits)...
2025-12-15 10:40:19,006 - INFO - ✓ Request completed: 11567 characters received
2025-12-15 10:40:19,007 - INFO - Finish reason: STOP (normal completion)
2025-12-15 10:40:19,007 - INFO - ✓ Response completed normally
2025-12-15 10:40:19,008 - WARNING - Part 6, row 0: Extraction contains newlines (should use \n)
2025-12-15 10:40:19,008 - WARNING - Part 6, row 1: Extraction contains newlines (should use \n)
2025-12-15 10:40:19,008 - WARNING - Part 6, row 2: Extraction contains newlines (should use \n)
2025-12-15 10:40:19,009 - WARNING - Part 6, row 4: Extraction contains newlines (should use \n)
2025-12-15 10:40:19,009 - WARNING - Part 6, row 5: Extraction contains newlines (should use \n)
2025-12-15 10:40:19,009 - WARNING - Part 6, row 8: Extraction contains newlines (should use \n)
2025-12-15 10:40:19,009 - WARNING - Part 6, row 9: Extraction contains newlines (should use \n)
2025-12-15 10:40:19,009 - WARNING - Part 6, row 10: Extraction contains newlines (should use \n)
2025-12-15 10:40:19,010 - WARNING - Part 6, row 0: Extraction contains newlines (should use \n)
2025-12-15 10:40:19,010 - WARNING - Part 6, row 1: Extraction contains newlines (should use \n)
2025-12-15 10:40:19,010 - WARNING - Part 6, row 2: Extraction contains newlines (should use \n)
2025-12-15 10:40:19,010 - WARNING - Part 6, row 4: Extraction contains newlines (should use \n)
2025-12-15 10:40:19,011 - WARNING - Part 6, row 5: Extraction contains newlines (should use \n)
2025-12-15 10:40:19,011 - WARNING - Part 6, row 8: Extraction contains newlines (should use \n)
2025-12-15 10:40:19,011 - WARNING - Part 6, row 9: Extraction contains newlines (should use \n)
2025-12-15 10:40:19,011 - WARNING - Part 6, row 10: Extraction contains newlines (should use \n)
2025-12-15 10:40:19,011 - INFO - Part 6: Parsed successfully - is_last=False, rows=14
2025-12-15 10:40:19,013 - INFO - ✓ Saved part 6 to /home/mohammadbagher/Desktop/tts app bagher/content_automation_project/parts_Bolognia 5th Edition 2024 (1)-7-26-46.pdf_6fe593aa/part_6.json
2025-12-15 10:40:19,013 - INFO - Part 6: Saved to /home/mohammadbagher/Desktop/tts app bagher/content_automation_project/parts_Bolognia 5th Edition 2024 (1)-7-26-46.pdf_6fe593aa/part_6.json (not displayed to user)
2025-12-15 10:40:19,013 - INFO - Part 6: Added 14 rows (total: 65)
2025-12-15 10:40:19,013 - INFO - Part 6: is_last=false, continuing to next part...
2025-12-15 10:40:19,014 - INFO - Waiting 10.7s before next part...
2025-12-15 10:40:29,724 - INFO - === Processing Part 7 ===
2025-12-15 10:40:38,749 - INFO - PDF uploaded successfully with API key: bagher
2025-12-15 10:40:38,749 - INFO - Uploaded PDF file: Bolognia 5th Edition 2024 (1)-7-26-46.pdf
2025-12-15 10:40:38,750 - INFO - Model: gemini-2.5-pro, Max tokens for model: 32768, Using: 32768
2025-12-15 10:40:38,750 - INFO - Using max_output_tokens: 32768
2025-12-15 10:40:38,750 - INFO - Using model: gemini-2.5-pro
2025-12-15 10:40:38,750 - INFO - Sending prompt (length: 4143 characters)
2025-12-15 10:40:38,750 - INFO - Max output tokens: 32768
2025-12-15 10:40:38,750 - INFO - Multi-part mode: Using user's prompt as-is
2025-12-15 10:40:38,750 - INFO - Streaming disabled (force_no_streaming=True for multi-part processing)
2025-12-15 10:40:38,751 - INFO - Generating content with NON-STREAMING (large request detected to avoid rate limits)...
2025-12-15 10:41:49,355 - INFO - ✓ Request completed: 14046 characters received
2025-12-15 10:41:49,355 - INFO - Finish reason: STOP (normal completion)
2025-12-15 10:41:49,355 - INFO - ✓ Response completed normally
2025-12-15 10:41:49,356 - INFO - Part 7: Parsed successfully - is_last=False, rows=2
2025-12-15 10:41:49,358 - INFO - ✓ Saved part 7 to /home/mohammadbagher/Desktop/tts app bagher/content_automation_project/parts_Bolognia 5th Edition 2024 (1)-7-26-46.pdf_6fe593aa/part_7.json
2025-12-15 10:41:49,358 - INFO - Part 7: Saved to /home/mohammadbagher/Desktop/tts app bagher/content_automation_project/parts_Bolognia 5th Edition 2024 (1)-7-26-46.pdf_6fe593aa/part_7.json (not displayed to user)
2025-12-15 10:41:49,359 - INFO - Part 7: Added 2 rows (total: 67)
2025-12-15 10:41:49,359 - INFO - Part 7: is_last=false, continuing to next part...
2025-12-15 10:41:49,360 - INFO - Waiting 9.7s before next part...
2025-12-15 10:41:59,073 - INFO - === Processing Part 8 ===
2025-12-15 10:42:08,454 - INFO - PDF uploaded successfully with API key: bagher
2025-12-15 10:42:08,454 - INFO - Uploaded PDF file: Bolognia 5th Edition 2024 (1)-7-26-46.pdf
2025-12-15 10:42:08,454 - INFO - Model: gemini-2.5-pro, Max tokens for model: 32768, Using: 32768
2025-12-15 10:42:08,455 - INFO - Using max_output_tokens: 32768
2025-12-15 10:42:08,455 - INFO - Using model: gemini-2.5-pro
2025-12-15 10:42:08,455 - INFO - Sending prompt (length: 4143 characters)
2025-12-15 10:42:08,455 - INFO - Max output tokens: 32768
2025-12-15 10:42:08,455 - INFO - Multi-part mode: Using user's prompt as-is
2025-12-15 10:42:08,455 - INFO - Streaming disabled (force_no_streaming=True for multi-part processing)
2025-12-15 10:42:08,455 - INFO - Generating content with NON-STREAMING (large request detected to avoid rate limits)...
2025-12-15 10:43:43,196 - INFO - ✓ Request completed: 19800 characters received
2025-12-15 10:43:43,197 - INFO - Finish reason: STOP (normal completion)
2025-12-15 10:43:43,197 - INFO - ✓ Response completed normally
2025-12-15 10:43:43,200 - ERROR - Part 8: JSON parse error: Expecting ',' delimiter: line 44 column 20 (char 18462)
2025-12-15 10:43:43,200 - ERROR - Part 8: Response text (first 1000 chars): {
  "part_index": 8,
  "is_last": false,
  "rows": [
    {
      "Type": "page text",
      "Extraction": "be used for mild ocular disease without rapid worsening. Dapsone can be particularly beneficial in patients with linear deposits of IgA at the BMZ. Cyclophosphamide (1-2mg/kg/day) is considered the treatment of choice for rapidly progressive or severe ocular disease 60 – alone, in combination with oral corticosteroids, or as pulse therapy. Such regimens are effective in resolving severe conjunctival inflammation and preventing recurrences and secondary scarring. Azathioprine (2 mg/kg/day) and mycophenolate mofetil (2 g/day) have also been reported to be helpful in reducing the dose of corticosteroids required for control of ocular involvement and cutaneous lesions. Systemic corticosteroids alone are generally insufficient therapy for patients with significant disease, and they are less effective for mucosal than for cutaneous disease. Patients with significant esophageal or laryng
2025-12-15 10:43:43,201 - ERROR - Part 8: Response text (last 500 chars): ,
      "Number": 533.e1,
      "Part": 1
    },
    {
      "Type": "Figure",
      "Extraction": "{\"Caption\": \"eFig. 30.5 Bullous pemphigoid - progression of disease. A Urticarial, infiltrated and annular erythematous plaques on the trunk and upper extremity. B Generalized eruption with blisters as well as numerous erosions and hemorrhagic crusts in the same patient later in the course of the disease.\", \"Panel Labels\": [\"A\", \"B\"]}",
      "Number": 533.e1,
      "Part": 1
    }
  ]
}
2025-12-15 10:43:43,201 - ERROR - Part 8: Failed to parse response
2025-12-15 10:43:43,201 - ERROR - Part 8: Response text (first 1000 chars): ```json
{
  "part_index": 8,
  "is_last": false,
  "rows": [
    {
      "Type": "page text",
      "Extraction": "be used for mild ocular disease without rapid worsening. Dapsone can be particularly beneficial in patients with linear deposits of IgA at the BMZ. Cyclophosphamide (1-2mg/kg/day) is considered the treatment of choice for rapidly progressive or severe ocular disease 60 – alone, in combination with oral corticosteroids, or as pulse therapy. Such regimens are effective in resolving severe conjunctival inflammation and preventing recurrences and secondary scarring. Azathioprine (2 mg/kg/day) and mycophenolate mofetil (2 g/day) have also been reported to be helpful in reducing the dose of corticosteroids required for control of ocular involvement and cutaneous lesions. Systemic corticosteroids alone are generally insufficient therapy for patients with significant disease, and they are less effective for mucosal than for cutaneous disease. Patients with significant esophageal o
2025-12-15 10:43:43,202 - ERROR - Part 8: Retrying same part...
2025-12-15 10:43:48,202 - INFO - === Processing Part 8 ===
2025-12-15 10:43:57,318 - INFO - PDF uploaded successfully with API key: bagher
2025-12-15 10:43:57,319 - INFO - Uploaded PDF file: Bolognia 5th Edition 2024 (1)-7-26-46.pdf
2025-12-15 10:43:57,320 - INFO - Model: gemini-2.5-pro, Max tokens for model: 32768, Using: 32768
2025-12-15 10:43:57,320 - INFO - Using max_output_tokens: 32768
2025-12-15 10:43:57,321 - INFO - Using model: gemini-2.5-pro
2025-12-15 10:43:57,321 - INFO - Sending prompt (length: 4143 characters)
2025-12-15 10:43:57,322 - INFO - Max output tokens: 32768
2025-12-15 10:43:57,322 - INFO - Multi-part mode: Using user's prompt as-is
2025-12-15 10:43:57,323 - INFO - Streaming disabled (force_no_streaming=True for multi-part processing)
2025-12-15 10:43:57,323 - INFO - Generating content with NON-STREAMING (large request detected to avoid rate limits)...
2025-12-15 10:45:45,757 - INFO - ✓ Request completed: 17855 characters received
2025-12-15 10:45:45,758 - INFO - Finish reason: STOP (normal completion)
2025-12-15 10:45:45,758 - INFO - ✓ Response completed normally
2025-12-15 10:45:45,761 - INFO - Part 8: Parsed successfully - is_last=False, rows=6
2025-12-15 10:45:45,763 - INFO - ✓ Saved part 8 to /home/mohammadbagher/Desktop/tts app bagher/content_automation_project/parts_Bolognia 5th Edition 2024 (1)-7-26-46.pdf_6fe593aa/part_8.json
2025-12-15 10:45:45,763 - INFO - Part 8: Saved to /home/mohammadbagher/Desktop/tts app bagher/content_automation_project/parts_Bolognia 5th Edition 2024 (1)-7-26-46.pdf_6fe593aa/part_8.json (not displayed to user)
2025-12-15 10:45:45,763 - INFO - Part 8: Added 6 rows (total: 73)
2025-12-15 10:45:45,764 - INFO - Part 8: is_last=false, continuing to next part...
2025-12-15 10:45:45,766 - INFO - Waiting 14.3s before next part...
2025-12-15 10:46:00,095 - INFO - === Processing Part 9 ===
2025-12-15 10:46:08,322 - INFO - PDF uploaded successfully with API key: bagher
2025-12-15 10:46:08,323 - INFO - Uploaded PDF file: Bolognia 5th Edition 2024 (1)-7-26-46.pdf
2025-12-15 10:46:08,323 - INFO - Model: gemini-2.5-pro, Max tokens for model: 32768, Using: 32768
2025-12-15 10:46:08,324 - INFO - Using max_output_tokens: 32768
2025-12-15 10:46:08,324 - INFO - Using model: gemini-2.5-pro
2025-12-15 10:46:08,325 - INFO - Sending prompt (length: 4143 characters)
2025-12-15 10:46:08,325 - INFO - Max output tokens: 32768
2025-12-15 10:46:08,325 - INFO - Multi-part mode: Using user's prompt as-is
2025-12-15 10:46:08,326 - INFO - Streaming disabled (force_no_streaming=True for multi-part processing)
2025-12-15 10:46:08,326 - INFO - Generating content with NON-STREAMING (large request detected to avoid rate limits)...
2025-12-15 10:47:34,277 - INFO - ✓ Request completed: 15740 characters received
2025-12-15 10:47:34,278 - INFO - Finish reason: STOP (normal completion)
2025-12-15 10:47:34,279 - INFO - ✓ Response completed normally
2025-12-15 10:47:34,282 - INFO - Part 9: Parsed successfully - is_last=False, rows=8
2025-12-15 10:47:34,285 - INFO - ✓ Saved part 9 to /home/mohammadbagher/Desktop/tts app bagher/content_automation_project/parts_Bolognia 5th Edition 2024 (1)-7-26-46.pdf_6fe593aa/part_9.json
2025-12-15 10:47:34,286 - INFO - Part 9: Saved to /home/mohammadbagher/Desktop/tts app bagher/content_automation_project/parts_Bolognia 5th Edition 2024 (1)-7-26-46.pdf_6fe593aa/part_9.json (not displayed to user)
2025-12-15 10:47:34,286 - INFO - Part 9: Added 8 rows (total: 81)
2025-12-15 10:47:34,287 - INFO - Part 9: is_last=false, continuing to next part...
2025-12-15 10:47:34,288 - INFO - Waiting 13.0s before next part...
2025-12-15 10:47:47,335 - INFO - === Processing Part 10 ===
2025-12-15 10:47:58,458 - INFO - PDF uploaded successfully with API key: bagher
2025-12-15 10:47:58,458 - INFO - Uploaded PDF file: Bolognia 5th Edition 2024 (1)-7-26-46.pdf
2025-12-15 10:47:58,458 - INFO - Model: gemini-2.5-pro, Max tokens for model: 32768, Using: 32768
2025-12-15 10:47:58,459 - INFO - Using max_output_tokens: 32768
2025-12-15 10:47:58,459 - INFO - Using model: gemini-2.5-pro
2025-12-15 10:47:58,459 - INFO - Sending prompt (length: 4144 characters)
2025-12-15 10:47:58,459 - INFO - Max output tokens: 32768
2025-12-15 10:47:58,459 - INFO - Multi-part mode: Using user's prompt as-is
2025-12-15 10:47:58,459 - INFO - Streaming disabled (force_no_streaming=True for multi-part processing)
2025-12-15 10:47:58,459 - INFO - Generating content with NON-STREAMING (large request detected to avoid rate limits)...
2025-12-15 10:49:40,398 - INFO - ✓ Request completed: 29706 characters received
2025-12-15 10:49:40,398 - INFO - Finish reason: STOP (normal completion)
2025-12-15 10:49:40,398 - INFO - ✓ Response completed normally
2025-12-15 10:49:40,400 - WARNING - Part 10, row 1: Extraction contains newlines (should use \n)
2025-12-15 10:49:40,400 - WARNING - Part 10, row 2: Extraction contains newlines (should use \n)
2025-12-15 10:49:40,400 - WARNING - Part 10, row 4: Extraction contains newlines (should use \n)
2025-12-15 10:49:40,400 - WARNING - Part 10, row 7: Extraction contains newlines (should use \n)
2025-12-15 10:49:40,401 - WARNING - Part 10, row 9: Extraction contains newlines (should use \n)
2025-12-15 10:49:40,401 - WARNING - Part 10, row 10: Extraction contains newlines (should use \n)
2025-12-15 10:49:40,401 - WARNING - Part 10, row 1: Extraction contains newlines (should use \n)
2025-12-15 10:49:40,401 - WARNING - Part 10, row 2: Extraction contains newlines (should use \n)
2025-12-15 10:49:40,401 - WARNING - Part 10, row 4: Extraction contains newlines (should use \n)
2025-12-15 10:49:40,401 - WARNING - Part 10, row 7: Extraction contains newlines (should use \n)
2025-12-15 10:49:40,401 - WARNING - Part 10, row 9: Extraction contains newlines (should use \n)
2025-12-15 10:49:40,401 - WARNING - Part 10, row 10: Extraction contains newlines (should use \n)
2025-12-15 10:49:40,402 - INFO - Part 10: Parsed successfully - is_last=False, rows=17
2025-12-15 10:49:40,403 - INFO - ✓ Saved part 10 to /home/mohammadbagher/Desktop/tts app bagher/content_automation_project/parts_Bolognia 5th Edition 2024 (1)-7-26-46.pdf_6fe593aa/part_10.json
2025-12-15 10:49:40,403 - INFO - Part 10: Saved to /home/mohammadbagher/Desktop/tts app bagher/content_automation_project/parts_Bolognia 5th Edition 2024 (1)-7-26-46.pdf_6fe593aa/part_10.json (not displayed to user)
2025-12-15 10:49:40,403 - INFO - Part 10: Added 17 rows (total: 98)
2025-12-15 10:49:40,403 - INFO - Part 10: is_last=false, continuing to next part...
2025-12-15 10:49:40,405 - INFO - Waiting 8.4s before next part...
2025-12-15 10:49:48,831 - INFO - === Processing Part 11 ===
2025-12-15 10:49:59,981 - INFO - PDF uploaded successfully with API key: bagher
2025-12-15 10:49:59,982 - INFO - Uploaded PDF file: Bolognia 5th Edition 2024 (1)-7-26-46.pdf
2025-12-15 10:49:59,982 - INFO - Model: gemini-2.5-pro, Max tokens for model: 32768, Using: 32768
2025-12-15 10:49:59,983 - INFO - Using max_output_tokens: 32768
2025-12-15 10:49:59,983 - INFO - Using model: gemini-2.5-pro
2025-12-15 10:49:59,983 - INFO - Sending prompt (length: 4145 characters)
2025-12-15 10:49:59,984 - INFO - Max output tokens: 32768
2025-12-15 10:49:59,984 - INFO - Multi-part mode: Using user's prompt as-is
2025-12-15 10:49:59,984 - INFO - Streaming disabled (force_no_streaming=True for multi-part processing)
2025-12-15 10:49:59,985 - INFO - Generating content with NON-STREAMING (large request detected to avoid rate limits)...
2025-12-15 10:50:26,951 - INFO - Loaded 6 predefined prompts
2025-12-15 10:50:51,139 - INFO - Loaded 3 API keys
2025-12-15 10:51:23,000 - INFO - === Starting PDF Processing ===
2025-12-15 10:51:23,000 - INFO - Model: gemini-2.5-pro
2025-12-15 10:51:23,000 - INFO - PDF: /home/mohammadbagher/Downloads/PDFs/Bolognia 5th Edition 2024 (1)-7-26-46.pdf
2025-12-15 10:51:23,001 - INFO - Full prompt being sent (4081 chars): You are a meticulous medical OCR & structuring assistant.

Your job is to extract ONLY what is present on each provided textbook page image/PDF
and convert it into clean, AI-ready text with structured sections.

You MUST avoid hallucinations and preserve original medical meaning precisely.

====================
GLOBAL PRINCIPLES
====================
- NO HALLUCINATIONS: Output only content visible on the page(s). If unreadable/unclear, write "[UNREADABLE]" or add an "uncertain" flag with brief reason.
- LANGUAGE & SPELLING: Preserve original English spelling and medical terminology.
- CLEAN OCR:
  - Remove headers/footers and running titles.
  - Fix broken words at line breaks.
  - Replace ligatures (ﬁ, ﬂ).
  - Preserve italics (*italic*), bold (**bold**), and subscripts/superscripts via LaTeX.
- CITATIONS: Keep in-text citations verbatim.
- MATH/CHEM: Use inline LaTeX.
- NO IMAGES: Describe figures textually only; do not invent labels.

====================
CRITICAL OUTPUT CONTRACT (MULTI-PART)
====================
The full output is TOO LARGE to fit in one response.

You MUST split the final output into multiple PARTS.

Each response MUST:
- Output ONLY valid JSON
- Contain ONLY ONE PART of the final output
- NOT repeat rows from previous parts
- Preserve the exact order of rows across parts

====================
OUTPUT FORMAT (EXACT)
====================
{
  "chunk_index": <integer starting from 1>,
  "is_last": <true | false>,
  "rows": [
    {
      "Type": "page text | Figure | Table",
      "Extraction": "<single-line text or JSON>",
      "Number": <page number>,
      "Part": <The “Part” column shows that the row’s content is included in which part. Use numbers like 1 or 2 and more.
How to define the parts for each row: in the beginning of the first page of the file there is a “Chapter contents” which demonstrates the parts of the chapter recommended by the author, which we call them “author parts”. I want you to make your own suggestion for dividing the parts, which we call them “Our parts”. The rules of dividing are as follows: an “our part” is consisted of as many as consecutive “author parts” without being the final “our part” more than 10 pages. For example if the “author part”s of the chapter are 2,4,5,3,1,7,5 pages respectively, the first “our part” will be consisted of the first two “author parts”. The second “our part” will be consisted of the third and fourth and fifth “author parts”. the third “our part” will be consisted of the sixth “author part”. the fourth “our part” will be consisted of the seventh “author part”.
If an “our part” ends in the middle of a page, some of the page text will be for the previous “our part” and some of the page will be for the next “our part”. The text of such pages must be written in two separate rows. One of them is related to the previous “our part” and one of them is related to next “our part”. Your goal should be avoiding a row’s content to be consisted of the data from two different “our part”s.
And for example if you decided to divide the chapter into 2 parts, you should write “1” for the contents of the first part and write “2” for the contents of the second part.>
    }
  ]
}

Rules for rows:
- Each row represents exactly ONE of:
  - page text
  - figure
  - table
- Extraction MUST be single-line (no ENTER).
- JSON inside Extraction MUST be minified and valid.
- References section at end of chapter MUST be ignored.

====================
PART INSTRUCTIONS
====================
This is PART {chunk_index} of the output.

Generate ONLY the rows that belong to this part.
Stop when you reach a safe size limit.
If more content remains after this part, set:
  "is_last": false
Otherwise set:
  "is_last": true

====================
AUTHOR PARTS → OUR PARTS RULES
====================
[keep your full original rules here verbatim — unchanged]

====================
FINAL RULES
====================
- DO NOT summarize.
- DO NOT explain.
- DO NOT add commentary.
- Output ONLY the JSON object described above.

You will now receive a PDF.
Generate PART {chunk_index}.
2025-12-15 10:51:23,002 - INFO - Parts directory: /home/mohammadbagher/Desktop/tts app bagher/content_automation_project/parts_Bolognia 5th Edition 2024 (1)-7-26-46.pdf_972e1f47
2025-12-15 10:51:23,002 - INFO - Final output will be saved to PDF directory: /home/mohammadbagher/Downloads/PDFs
2025-12-15 10:51:23,002 - INFO - No previous parts found, starting from part 1
2025-12-15 10:51:23,003 - INFO - === Processing Part 1 ===
2025-12-15 10:51:33,999 - INFO - PDF uploaded successfully with API key: bagher
2025-12-15 10:51:34,000 - INFO - Uploaded PDF file: Bolognia 5th Edition 2024 (1)-7-26-46.pdf
2025-12-15 10:51:34,001 - INFO - Model: gemini-2.5-pro, Max tokens for model: 32768, Using: 32768
2025-12-15 10:51:34,001 - INFO - Using max_output_tokens: 32768
2025-12-15 10:51:34,002 - INFO - Using model: gemini-2.5-pro
2025-12-15 10:51:34,002 - INFO - Sending prompt (length: 4191 characters)
2025-12-15 10:51:34,003 - INFO - Max output tokens: 32768
2025-12-15 10:51:34,004 - INFO - Multi-part mode: Using user's prompt as-is
2025-12-15 10:51:34,004 - INFO - Streaming disabled (force_no_streaming=True for multi-part processing)
2025-12-15 10:51:34,005 - INFO - Generating content with NON-STREAMING (large request detected to avoid rate limits)...
2025-12-15 10:53:33,749 - INFO - ✓ Request completed: 32040 characters received
2025-12-15 10:53:33,751 - INFO - Finish reason: STOP (normal completion)
2025-12-15 10:53:33,752 - INFO - ✓ Response completed normally
2025-12-15 10:53:33,758 - ERROR - Part 1: Missing 'part_index' field
2025-12-15 10:53:33,759 - ERROR - Part 1: Validation failed
2025-12-15 10:53:33,763 - ERROR - Part 1: Part data structure: {
  "chunk_index": 1,
  "is_last": false,
  "rows": [
    {
      "Type": "page text",
      "Extraction": "Pemphigoid Group 30 Luca Borradori and Michael Hertl",
      "Number": 517,
      "Part": 1
    },
    {
      "Type": "page text",
      "Extraction": "**Chapter Contents**\nBullous Pemphigoid. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 517\nMucous Membrane Pemphigoid. . . . . . . . . . . . . . . . . . . . . . . . 526\nEpidermolysis Bullosa Acquisita . . . . . . . . . . . . . . . . . . . . . . . 530",
      "Number": 517,
      "Part": 1
    },
    {
      "Type": "page text",
      "Extraction": "**BULLOUS PEMPHIGOID**\n**Synonym:** Pemphigoid",
      "Number": 517,
      "Part": 1
    },
    {
      "Type": "page text",
      "Extraction": "**Key features**\n\u25a0 Bullous pemphigoid (BP) is the most common autoimmune subepidermal blistering disease, and its onset is often after 60 years of age\n\u25a0 It is usually a chronic disease, with spontaneou
2025-12-15 10:53:33,763 - ERROR - Part 1: Failed to parse response
2025-12-15 10:53:33,764 - ERROR - Part 1: Response text (first 1000 chars): ```json
{
  "chunk_index": 1,
  "is_last": false,
  "rows": [
    {
      "Type": "page text",
      "Extraction": "Pemphigoid Group 30 Luca Borradori and Michael Hertl",
      "Number": 517,
      "Part": 1
    },
    {
      "Type": "page text",
      "Extraction": "**Chapter Contents**\nBullous Pemphigoid. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 517\nMucous Membrane Pemphigoid. . . . . . . . . . . . . . . . . . . . . . . . 526\nEpidermolysis Bullosa Acquisita . . . . . . . . . . . . . . . . . . . . . . . 530",
      "Number": 517,
      "Part": 1
    },
    {
      "Type": "page text",
      "Extraction": "**BULLOUS PEMPHIGOID**\n**Synonym:** Pemphigoid",
      "Number": 517,
      "Part": 1
    },
    {
      "Type": "page text",
      "Extraction": "**Key features**\n■ Bullous pemphigoid (BP) is the most common autoimmune subepidermal blistering disease, and its onset is often after 60 years of age\n■ It is usually a chronic disease, with spontaneous 
2025-12-15 10:53:33,764 - ERROR - Part 1: Retrying same part...
2025-12-15 10:53:38,764 - INFO - === Processing Part 1 ===
2025-12-15 10:53:48,469 - INFO - PDF uploaded successfully with API key: bagher
2025-12-15 10:53:48,469 - INFO - Uploaded PDF file: Bolognia 5th Edition 2024 (1)-7-26-46.pdf
2025-12-15 10:53:48,469 - INFO - Model: gemini-2.5-pro, Max tokens for model: 32768, Using: 32768
2025-12-15 10:53:48,469 - INFO - Using max_output_tokens: 32768
2025-12-15 10:53:48,469 - INFO - Using model: gemini-2.5-pro
2025-12-15 10:53:48,469 - INFO - Sending prompt (length: 4191 characters)
2025-12-15 10:53:48,469 - INFO - Max output tokens: 32768
2025-12-15 10:53:48,469 - INFO - Multi-part mode: Using user's prompt as-is
2025-12-15 10:53:48,469 - INFO - Streaming disabled (force_no_streaming=True for multi-part processing)
2025-12-15 10:53:48,469 - INFO - Generating content with NON-STREAMING (large request detected to avoid rate limits)...
2025-12-15 10:56:05,005 - INFO - ✓ Request completed: 52674 characters received
2025-12-15 10:56:05,006 - INFO - Finish reason: STOP (normal completion)
2025-12-15 10:56:05,007 - INFO - ✓ Response completed normally
2025-12-15 10:56:05,013 - ERROR - Part 1: Missing 'part_index' field
2025-12-15 10:56:05,014 - ERROR - Part 1: Validation failed
2025-12-15 10:56:05,017 - ERROR - Part 1: Part data structure: {
  "chunk_index": 1,
  "is_last": false,
  "rows": [
    {
      "Type": "page text",
      "Extraction": "Chapter Contents\nBullous Pemphigoid. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 517\nMucous Membrane Pemphigoid. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 526\nEpidermolysis Bullosa Acquisita . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 530",
      "Number": 517,
      "Part": 1
    },
    {
      "Type": "page text",
      "Extraction": "BULLOUS PEMPHIGOID\nSynonym: * Pemphigoid",
      "Number": 517,
      "Part": 1
    },
    {
      "Type": "page text",
      "Extraction": "Key features\n\u25a0 Bullous pemphigoid (BP) is the most common autoimmune subepidermal blistering disease, and its onset is often after 60 years of age\n\u25a0 It is usually a chronic disease, with spontaneous exacerbations and remissions, which m
2025-12-15 10:56:05,018 - ERROR - Part 1: Failed to parse response
2025-12-15 10:56:05,019 - ERROR - Part 1: Response text (first 1000 chars): ```json
{
  "chunk_index": 1,
  "is_last": false,
  "rows": [
    {
      "Type": "page text",
      "Extraction": "Chapter Contents\nBullous Pemphigoid. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 517\nMucous Membrane Pemphigoid. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 526\nEpidermolysis Bullosa Acquisita . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 530",
      "Number": 517,
      "Part": 1
    },
    {
      "Type": "page text",
      "Extraction": "BULLOUS PEMPHIGOID\nSynonym: * Pemphigoid",
      "Number": 517,
      "Part": 1
    },
    {
      "Type": "page text",
      "Extraction": "Key features\n■ Bullous pemphigoid (BP) is the most common autoimmune subepidermal blistering disease, and its onset is often after 60 years of age\n■ It is usually a chronic disease, with spontaneous exacerbations and remissions, which may
2025-12-15 10:56:05,019 - ERROR - Part 1: Retrying same part...
2025-12-15 10:56:10,020 - INFO - === Processing Part 1 ===
2025-12-15 11:03:20,245 - INFO - Loaded 6 predefined prompts
2025-12-15 11:03:40,825 - INFO - Loaded 3 API keys
2025-12-15 11:04:11,222 - INFO - === Starting PDF Processing ===
2025-12-15 11:04:11,222 - INFO - Model: gemini-2.5-pro
2025-12-15 11:04:11,222 - INFO - PDF: /home/mohammadbagher/Downloads/PDFs/Bolognia 5th Edition 2024 (1)-7-26-46.pdf
2025-12-15 11:04:11,223 - INFO - Full prompt being sent (4081 chars): You are a meticulous medical OCR & structuring assistant.

Your job is to extract ONLY what is present on each provided textbook page image/PDF
and convert it into clean, AI-ready text with structured sections.

You MUST avoid hallucinations and preserve original medical meaning precisely.

====================
GLOBAL PRINCIPLES
====================
- NO HALLUCINATIONS: Output only content visible on the page(s). If unreadable/unclear, write "[UNREADABLE]" or add an "uncertain" flag with brief reason.
- LANGUAGE & SPELLING: Preserve original English spelling and medical terminology.
- CLEAN OCR:
  - Remove headers/footers and running titles.
  - Fix broken words at line breaks.
  - Replace ligatures (ﬁ, ﬂ).
  - Preserve italics (*italic*), bold (**bold**), and subscripts/superscripts via LaTeX.
- CITATIONS: Keep in-text citations verbatim.
- MATH/CHEM: Use inline LaTeX.
- NO IMAGES: Describe figures textually only; do not invent labels.

====================
CRITICAL OUTPUT CONTRACT (MULTI-PART)
====================
The full output is TOO LARGE to fit in one response.

You MUST split the final output into multiple PARTS.

Each response MUST:
- Output ONLY valid JSON
- Contain ONLY ONE PART of the final output
- NOT repeat rows from previous parts
- Preserve the exact order of rows across parts

====================
OUTPUT FORMAT (EXACT)
====================
{
  "chunk_index": <integer starting from 1>,
  "is_last": <true | false>,
  "rows": [
    {
      "Type": "page text | Figure | Table",
      "Extraction": "<single-line text or JSON>",
      "Number": <page number>,
      "Part": <The “Part” column shows that the row’s content is included in which part. Use numbers like 1 or 2 and more.
How to define the parts for each row: in the beginning of the first page of the file there is a “Chapter contents” which demonstrates the parts of the chapter recommended by the author, which we call them “author parts”. I want you to make your own suggestion for dividing the parts, which we call them “Our parts”. The rules of dividing are as follows: an “our part” is consisted of as many as consecutive “author parts” without being the final “our part” more than 10 pages. For example if the “author part”s of the chapter are 2,4,5,3,1,7,5 pages respectively, the first “our part” will be consisted of the first two “author parts”. The second “our part” will be consisted of the third and fourth and fifth “author parts”. the third “our part” will be consisted of the sixth “author part”. the fourth “our part” will be consisted of the seventh “author part”.
If an “our part” ends in the middle of a page, some of the page text will be for the previous “our part” and some of the page will be for the next “our part”. The text of such pages must be written in two separate rows. One of them is related to the previous “our part” and one of them is related to next “our part”. Your goal should be avoiding a row’s content to be consisted of the data from two different “our part”s.
And for example if you decided to divide the chapter into 2 parts, you should write “1” for the contents of the first part and write “2” for the contents of the second part.>
    }
  ]
}

Rules for rows:
- Each row represents exactly ONE of:
  - page text
  - figure
  - table
- Extraction MUST be single-line (no ENTER).
- JSON inside Extraction MUST be minified and valid.
- References section at end of chapter MUST be ignored.

====================
PART INSTRUCTIONS
====================
This is PART {chunk_index} of the output.

Generate ONLY the rows that belong to this part.
Stop when you reach a safe size limit.
If more content remains after this part, set:
  "is_last": false
Otherwise set:
  "is_last": true

====================
AUTHOR PARTS → OUR PARTS RULES
====================
[keep your full original rules here verbatim — unchanged]

====================
FINAL RULES
====================
- DO NOT summarize.
- DO NOT explain.
- DO NOT add commentary.
- Output ONLY the JSON object described above.

You will now receive a PDF.
Generate PART {chunk_index}.
2025-12-15 11:04:11,225 - INFO - Parts directory: /home/mohammadbagher/Desktop/tts app bagher/content_automation_project/parts_Bolognia 5th Edition 2024 (1)-7-26-46.pdf_972e1f47
2025-12-15 11:04:11,225 - INFO - Final output will be saved to PDF directory: /home/mohammadbagher/Downloads/PDFs
2025-12-15 11:04:11,226 - INFO - No previous parts found, starting from part 1
2025-12-15 11:04:11,226 - INFO - === Processing Part 1 ===
2025-12-15 11:04:21,323 - INFO - PDF uploaded successfully with API key: bagher
2025-12-15 11:04:21,324 - INFO - Uploaded PDF file: Bolognia 5th Edition 2024 (1)-7-26-46.pdf
2025-12-15 11:04:21,325 - INFO - Model: gemini-2.5-pro, Max tokens for model: 32768, Using: 32768
2025-12-15 11:04:21,326 - INFO - Using max_output_tokens: 32768
2025-12-15 11:04:21,326 - INFO - Using model: gemini-2.5-pro
2025-12-15 11:04:21,327 - INFO - Sending prompt (length: 4194 characters)
2025-12-15 11:04:21,327 - INFO - Max output tokens: 32768
2025-12-15 11:04:21,328 - INFO - Multi-part mode: Using user's prompt as-is
2025-12-15 11:04:21,328 - INFO - Streaming disabled (force_no_streaming=True for multi-part processing)
2025-12-15 11:04:21,329 - INFO - Generating content with NON-STREAMING (large request detected to avoid rate limits)...
2025-12-15 11:06:51,848 - INFO - ✓ Request completed: 34631 characters received
2025-12-15 11:06:51,849 - INFO - Finish reason: STOP (normal completion)
2025-12-15 11:06:51,849 - INFO - ✓ Response completed normally
2025-12-15 11:06:51,853 - WARNING - Part 1, row 3: Extraction contains newlines (should use \n)
2025-12-15 11:06:51,854 - WARNING - Part 1, row 4: Extraction contains newlines (should use \n)
2025-12-15 11:06:51,854 - WARNING - Part 1, row 5: Extraction contains newlines (should use \n)
2025-12-15 11:06:51,855 - WARNING - Part 1, row 6: Extraction contains newlines (should use \n)
2025-12-15 11:06:51,855 - WARNING - Part 1, row 7: Extraction contains newlines (should use \n)
2025-12-15 11:06:51,855 - WARNING - Part 1, row 8: Extraction contains newlines (should use \n)
2025-12-15 11:06:51,856 - WARNING - Part 1, row 9: Extraction contains newlines (should use \n)
2025-12-15 11:06:51,856 - WARNING - Part 1, row 13: Extraction contains newlines (should use \n)
2025-12-15 11:06:51,857 - WARNING - Part 1, row 15: Extraction contains newlines (should use \n)
2025-12-15 11:06:51,857 - WARNING - Part 1, row 16: Extraction contains newlines (should use \n)
2025-12-15 11:06:51,857 - WARNING - Part 1, row 17: Extraction contains newlines (should use \n)
2025-12-15 11:06:51,858 - WARNING - Part 1, row 18: Extraction contains newlines (should use \n)
2025-12-15 11:06:51,858 - WARNING - Part 1, row 22: Extraction contains newlines (should use \n)
2025-12-15 11:06:51,859 - WARNING - Part 1, row 24: Extraction contains newlines (should use \n)
2025-12-15 11:06:51,859 - WARNING - Part 1, row 25: Extraction contains newlines (should use \n)
2025-12-15 11:06:51,860 - WARNING - Part 1, row 29: Extraction contains newlines (should use \n)
2025-12-15 11:06:51,860 - WARNING - Part 1, row 30: Extraction contains newlines (should use \n)
2025-12-15 11:06:51,860 - WARNING - Part 1, row 31: Extraction contains newlines (should use \n)
2025-12-15 11:06:51,861 - WARNING - Part 1, row 35: Extraction contains newlines (should use \n)
2025-12-15 11:06:51,861 - WARNING - Part 1, row 36: Extraction contains newlines (should use \n)
2025-12-15 11:06:51,862 - WARNING - Part 1, row 37: Extraction contains newlines (should use \n)
2025-12-15 11:06:51,862 - WARNING - Part 1, row 3: Extraction contains newlines (should use \n)
2025-12-15 11:06:51,862 - WARNING - Part 1, row 4: Extraction contains newlines (should use \n)
2025-12-15 11:06:51,863 - WARNING - Part 1, row 5: Extraction contains newlines (should use \n)
2025-12-15 11:06:51,863 - WARNING - Part 1, row 6: Extraction contains newlines (should use \n)
2025-12-15 11:06:51,864 - WARNING - Part 1, row 7: Extraction contains newlines (should use \n)
2025-12-15 11:06:51,864 - WARNING - Part 1, row 8: Extraction contains newlines (should use \n)
2025-12-15 11:06:51,864 - WARNING - Part 1, row 9: Extraction contains newlines (should use \n)
2025-12-15 11:06:51,865 - WARNING - Part 1, row 13: Extraction contains newlines (should use \n)
2025-12-15 11:06:51,865 - WARNING - Part 1, row 15: Extraction contains newlines (should use \n)
2025-12-15 11:06:51,866 - WARNING - Part 1, row 16: Extraction contains newlines (should use \n)
2025-12-15 11:06:51,866 - WARNING - Part 1, row 17: Extraction contains newlines (should use \n)
2025-12-15 11:06:51,866 - WARNING - Part 1, row 18: Extraction contains newlines (should use \n)
2025-12-15 11:06:51,867 - WARNING - Part 1, row 22: Extraction contains newlines (should use \n)
2025-12-15 11:06:51,867 - WARNING - Part 1, row 24: Extraction contains newlines (should use \n)
2025-12-15 11:06:51,868 - WARNING - Part 1, row 25: Extraction contains newlines (should use \n)
2025-12-15 11:06:51,869 - WARNING - Part 1, row 29: Extraction contains newlines (should use \n)
2025-12-15 11:06:51,869 - WARNING - Part 1, row 30: Extraction contains newlines (should use \n)
2025-12-15 11:06:51,869 - WARNING - Part 1, row 31: Extraction contains newlines (should use \n)
2025-12-15 11:06:51,870 - WARNING - Part 1, row 35: Extraction contains newlines (should use \n)
2025-12-15 11:06:51,870 - WARNING - Part 1, row 36: Extraction contains newlines (should use \n)
2025-12-15 11:06:51,870 - WARNING - Part 1, row 37: Extraction contains newlines (should use \n)
2025-12-15 11:06:51,871 - INFO - Part 1: Parsed successfully - is_last=False, rows=38
2025-12-15 11:06:51,878 - INFO - ✓ Saved part 1 to /home/mohammadbagher/Desktop/tts app bagher/content_automation_project/parts_Bolognia 5th Edition 2024 (1)-7-26-46.pdf_972e1f47/part_1.json
2025-12-15 11:06:51,878 - INFO - Part 1: Saved to /home/mohammadbagher/Desktop/tts app bagher/content_automation_project/parts_Bolognia 5th Edition 2024 (1)-7-26-46.pdf_972e1f47/part_1.json (not displayed to user)
2025-12-15 11:06:51,878 - INFO - Part 1: Added 38 rows (total: 38)
2025-12-15 11:06:51,878 - INFO - Part 1: is_last=false, continuing to next part...
2025-12-15 11:06:51,879 - INFO - Waiting 8.3s before next part...
2025-12-15 11:07:00,132 - INFO - === Processing Part 2 ===
2025-12-15 11:07:11,808 - INFO - PDF uploaded successfully with API key: bagher
2025-12-15 11:07:11,808 - INFO - Uploaded PDF file: Bolognia 5th Edition 2024 (1)-7-26-46.pdf
2025-12-15 11:07:11,813 - INFO - Model: gemini-2.5-pro, Max tokens for model: 32768, Using: 32768
2025-12-15 11:07:11,813 - INFO - Using max_output_tokens: 32768
2025-12-15 11:07:11,814 - INFO - Using model: gemini-2.5-pro
2025-12-15 11:07:11,814 - INFO - Sending prompt (length: 4277 characters)
2025-12-15 11:07:11,815 - INFO - Max output tokens: 32768
2025-12-15 11:07:11,816 - INFO - Multi-part mode: Using user's prompt as-is
2025-12-15 11:07:11,816 - INFO - Streaming disabled (force_no_streaming=True for multi-part processing)
2025-12-15 11:07:11,817 - INFO - Generating content with NON-STREAMING (large request detected to avoid rate limits)...
2025-12-15 11:09:30,011 - INFO - ✓ Request completed: 37834 characters received
2025-12-15 11:09:30,012 - INFO - Finish reason: STOP (normal completion)
2025-12-15 11:09:30,013 - INFO - ✓ Response completed normally
2025-12-15 11:09:30,017 - WARNING - Part 2, row 0: Extraction contains newlines (should use \n)
2025-12-15 11:09:30,017 - WARNING - Part 2, row 5: Extraction contains newlines (should use \n)
2025-12-15 11:09:30,018 - WARNING - Part 2, row 8: Extraction contains newlines (should use \n)
2025-12-15 11:09:30,018 - WARNING - Part 2, row 11: Extraction contains newlines (should use \n)
2025-12-15 11:09:30,018 - WARNING - Part 2, row 15: Extraction contains newlines (should use \n)
2025-12-15 11:09:30,019 - WARNING - Part 2, row 18: Extraction contains newlines (should use \n)
2025-12-15 11:09:30,019 - WARNING - Part 2, row 20: Extraction contains newlines (should use \n)
2025-12-15 11:09:30,020 - WARNING - Part 2, row 22: Extraction contains newlines (should use \n)
2025-12-15 11:09:30,020 - WARNING - Part 2, row 0: Extraction contains newlines (should use \n)
2025-12-15 11:09:30,021 - WARNING - Part 2, row 5: Extraction contains newlines (should use \n)
2025-12-15 11:09:30,022 - WARNING - Part 2, row 8: Extraction contains newlines (should use \n)
2025-12-15 11:09:30,022 - WARNING - Part 2, row 11: Extraction contains newlines (should use \n)
2025-12-15 11:09:30,023 - WARNING - Part 2, row 15: Extraction contains newlines (should use \n)
2025-12-15 11:09:30,023 - WARNING - Part 2, row 18: Extraction contains newlines (should use \n)
2025-12-15 11:09:30,024 - WARNING - Part 2, row 20: Extraction contains newlines (should use \n)
2025-12-15 11:09:30,025 - WARNING - Part 2, row 22: Extraction contains newlines (should use \n)
2025-12-15 11:09:30,026 - INFO - Part 2: Parsed successfully - is_last=False, rows=23
2025-12-15 11:09:30,034 - INFO - ✓ Saved part 2 to /home/mohammadbagher/Desktop/tts app bagher/content_automation_project/parts_Bolognia 5th Edition 2024 (1)-7-26-46.pdf_972e1f47/part_2.json
2025-12-15 11:09:30,034 - INFO - Part 2: Saved to /home/mohammadbagher/Desktop/tts app bagher/content_automation_project/parts_Bolognia 5th Edition 2024 (1)-7-26-46.pdf_972e1f47/part_2.json (not displayed to user)
2025-12-15 11:09:30,034 - INFO - Part 2: Added 23 rows (total: 61)
2025-12-15 11:09:30,035 - INFO - Part 2: is_last=false, continuing to next part...
2025-12-15 11:09:30,036 - INFO - Waiting 13.9s before next part...
2025-12-15 11:09:43,902 - INFO - === Processing Part 3 ===
2025-12-15 11:09:53,334 - INFO - PDF uploaded successfully with API key: bagher
2025-12-15 11:09:53,334 - INFO - Uploaded PDF file: Bolognia 5th Edition 2024 (1)-7-26-46.pdf
2025-12-15 11:09:53,334 - INFO - Model: gemini-2.5-pro, Max tokens for model: 32768, Using: 32768
2025-12-15 11:09:53,335 - INFO - Using max_output_tokens: 32768
2025-12-15 11:09:53,335 - INFO - Using model: gemini-2.5-pro
2025-12-15 11:09:53,335 - INFO - Sending prompt (length: 4277 characters)
2025-12-15 11:09:53,335 - INFO - Max output tokens: 32768
2025-12-15 11:09:53,335 - INFO - Multi-part mode: Using user's prompt as-is
2025-12-15 11:09:53,335 - INFO - Streaming disabled (force_no_streaming=True for multi-part processing)
2025-12-15 11:09:53,336 - INFO - Generating content with NON-STREAMING (large request detected to avoid rate limits)...
2025-12-15 11:11:11,736 - INFO - ✓ Request completed: 19544 characters received
2025-12-15 11:11:11,737 - INFO - Finish reason: STOP (normal completion)
2025-12-15 11:11:11,737 - INFO - ✓ Response completed normally
2025-12-15 11:11:11,740 - WARNING - Part 3, row 3: Extraction contains newlines (should use \n)
2025-12-15 11:11:11,741 - WARNING - Part 3, row 9: Extraction contains newlines (should use \n)
2025-12-15 11:11:11,741 - WARNING - Part 3, row 10: Extraction contains newlines (should use \n)
2025-12-15 11:11:11,742 - WARNING - Part 3, row 11: Extraction contains newlines (should use \n)
2025-12-15 11:11:11,742 - WARNING - Part 3, row 12: Extraction contains newlines (should use \n)
2025-12-15 11:11:11,742 - WARNING - Part 3, row 13: Extraction contains newlines (should use \n)
2025-12-15 11:11:11,743 - WARNING - Part 3, row 3: Extraction contains newlines (should use \n)
2025-12-15 11:11:11,744 - WARNING - Part 3, row 9: Extraction contains newlines (should use \n)
2025-12-15 11:11:11,744 - WARNING - Part 3, row 10: Extraction contains newlines (should use \n)
2025-12-15 11:11:11,745 - WARNING - Part 3, row 11: Extraction contains newlines (should use \n)
2025-12-15 11:11:11,745 - WARNING - Part 3, row 12: Extraction contains newlines (should use \n)
2025-12-15 11:11:11,746 - WARNING - Part 3, row 13: Extraction contains newlines (should use \n)
2025-12-15 11:11:11,746 - INFO - Part 3: Parsed successfully - is_last=False, rows=14
2025-12-15 11:11:11,754 - INFO - ✓ Saved part 3 to /home/mohammadbagher/Desktop/tts app bagher/content_automation_project/parts_Bolognia 5th Edition 2024 (1)-7-26-46.pdf_972e1f47/part_3.json
2025-12-15 11:11:11,755 - INFO - Part 3: Saved to /home/mohammadbagher/Desktop/tts app bagher/content_automation_project/parts_Bolognia 5th Edition 2024 (1)-7-26-46.pdf_972e1f47/part_3.json (not displayed to user)
2025-12-15 11:11:11,755 - INFO - Part 3: Added 14 rows (total: 75)
2025-12-15 11:11:11,756 - INFO - Part 3: is_last=false, continuing to next part...
2025-12-15 11:11:11,759 - INFO - Waiting 10.5s before next part...
2025-12-15 11:11:22,285 - INFO - === Processing Part 4 ===
2025-12-15 11:11:33,595 - INFO - PDF uploaded successfully with API key: bagher
2025-12-15 11:11:33,595 - INFO - Uploaded PDF file: Bolognia 5th Edition 2024 (1)-7-26-46.pdf
2025-12-15 11:11:33,595 - INFO - Model: gemini-2.5-pro, Max tokens for model: 32768, Using: 32768
2025-12-15 11:11:33,595 - INFO - Using max_output_tokens: 32768
2025-12-15 11:11:33,596 - INFO - Using model: gemini-2.5-pro
2025-12-15 11:11:33,596 - INFO - Sending prompt (length: 4277 characters)
2025-12-15 11:11:33,596 - INFO - Max output tokens: 32768
2025-12-15 11:11:33,596 - INFO - Multi-part mode: Using user's prompt as-is
2025-12-15 11:11:33,596 - INFO - Streaming disabled (force_no_streaming=True for multi-part processing)
2025-12-15 11:11:33,596 - INFO - Generating content with NON-STREAMING (large request detected to avoid rate limits)...
2025-12-15 11:12:37,568 - INFO - ✓ Request completed: 22883 characters received
2025-12-15 11:12:37,569 - INFO - Finish reason: STOP (normal completion)
2025-12-15 11:12:37,569 - INFO - ✓ Response completed normally
2025-12-15 11:12:37,570 - WARNING - Part 4, row 0: Extraction contains newlines (should use \n)
2025-12-15 11:12:37,570 - WARNING - Part 4, row 4: Extraction contains newlines (should use \n)
2025-12-15 11:12:37,571 - WARNING - Part 4, row 6: Extraction contains newlines (should use \n)
2025-12-15 11:12:37,571 - WARNING - Part 4, row 7: Extraction contains newlines (should use \n)
2025-12-15 11:12:37,571 - WARNING - Part 4, row 8: Extraction contains newlines (should use \n)
2025-12-15 11:12:37,571 - WARNING - Part 4, row 0: Extraction contains newlines (should use \n)
2025-12-15 11:12:37,571 - WARNING - Part 4, row 4: Extraction contains newlines (should use \n)
2025-12-15 11:12:37,571 - WARNING - Part 4, row 6: Extraction contains newlines (should use \n)
2025-12-15 11:12:37,571 - WARNING - Part 4, row 7: Extraction contains newlines (should use \n)
2025-12-15 11:12:37,571 - WARNING - Part 4, row 8: Extraction contains newlines (should use \n)
2025-12-15 11:12:37,571 - INFO - Part 4: Parsed successfully - is_last=False, rows=9
2025-12-15 11:12:37,573 - INFO - ✓ Saved part 4 to /home/mohammadbagher/Desktop/tts app bagher/content_automation_project/parts_Bolognia 5th Edition 2024 (1)-7-26-46.pdf_972e1f47/part_4.json
2025-12-15 11:12:37,573 - INFO - Part 4: Saved to /home/mohammadbagher/Desktop/tts app bagher/content_automation_project/parts_Bolognia 5th Edition 2024 (1)-7-26-46.pdf_972e1f47/part_4.json (not displayed to user)
2025-12-15 11:12:37,573 - INFO - Part 4: Added 9 rows (total: 84)
2025-12-15 11:12:37,573 - INFO - Part 4: is_last=false, continuing to next part...
2025-12-15 11:12:37,574 - INFO - Waiting 14.3s before next part...
2025-12-15 11:12:51,880 - INFO - === Processing Part 5 ===
2025-12-15 11:13:01,181 - INFO - PDF uploaded successfully with API key: bagher
2025-12-15 11:13:01,181 - INFO - Uploaded PDF file: Bolognia 5th Edition 2024 (1)-7-26-46.pdf
2025-12-15 11:13:01,182 - INFO - Model: gemini-2.5-pro, Max tokens for model: 32768, Using: 32768
2025-12-15 11:13:01,182 - INFO - Using max_output_tokens: 32768
2025-12-15 11:13:01,183 - INFO - Using model: gemini-2.5-pro
2025-12-15 11:13:01,183 - INFO - Sending prompt (length: 4277 characters)
2025-12-15 11:13:01,184 - INFO - Max output tokens: 32768
2025-12-15 11:13:01,184 - INFO - Multi-part mode: Using user's prompt as-is
2025-12-15 11:13:01,185 - INFO - Streaming disabled (force_no_streaming=True for multi-part processing)
2025-12-15 11:13:01,185 - INFO - Generating content with NON-STREAMING (large request detected to avoid rate limits)...
2025-12-15 11:15:02,208 - INFO - ✓ Request completed: 24698 characters received
2025-12-15 11:15:02,210 - INFO - Finish reason: STOP (normal completion)
2025-12-15 11:15:02,210 - INFO - ✓ Response completed normally
2025-12-15 11:15:02,214 - WARNING - Part 5, row 1: Extraction contains newlines (should use \n)
2025-12-15 11:15:02,214 - WARNING - Part 5, row 1: Extraction contains newlines (should use \n)
2025-12-15 11:15:02,215 - INFO - Part 5: Parsed successfully - is_last=True, rows=25
2025-12-15 11:15:02,221 - INFO - ✓ Saved part 5 to /home/mohammadbagher/Desktop/tts app bagher/content_automation_project/parts_Bolognia 5th Edition 2024 (1)-7-26-46.pdf_972e1f47/part_5.json
2025-12-15 11:15:02,222 - INFO - Part 5: Saved to /home/mohammadbagher/Desktop/tts app bagher/content_automation_project/parts_Bolognia 5th Edition 2024 (1)-7-26-46.pdf_972e1f47/part_5.json (not displayed to user)
2025-12-15 11:15:02,222 - INFO - Part 5: Added 25 rows (total: 109)
2025-12-15 11:15:02,223 - INFO - Part 5: is_last=true, processing complete!
2025-12-15 11:15:02,223 - INFO - === Processing Summary ===
2025-12-15 11:15:02,226 - INFO - New parts processed in this run: 4
2025-12-15 11:15:02,226 - INFO - Previous parts loaded (resume): 0
2025-12-15 11:15:02,227 - INFO - Total parts in final output: 4
2025-12-15 11:15:02,227 - INFO - Total rows collected: 109
2025-12-15 11:15:02,227 - INFO - Deduplicating 109 rows...
2025-12-15 11:15:02,233 - WARNING - Removed 1 duplicate rows using enhanced deduplication
2025-12-15 11:15:02,234 - INFO - Final row count after deduplication: 108
2025-12-15 11:15:02,234 - INFO - Sorting 108 rows by Part and Number...
2025-12-15 11:15:02,234 - INFO - Rows sorted successfully
2025-12-15 11:15:02,239 - INFO - ✓ Final output saved to /home/mohammadbagher/Downloads/PDFs/Bolognia 5th Edition 2024 1-7-26-46_final_output.json
2025-12-15 11:15:02,239 - INFO -   - File path: /home/mohammadbagher/Downloads/PDFs/Bolognia 5th Edition 2024 1-7-26-46_final_output.json
2025-12-15 11:15:02,239 - INFO -   - Total parts: 4 (0 previous + 4 new)
2025-12-15 11:15:02,239 - INFO -   - Total rows: 108
2025-12-15 11:15:02,240 - INFO -   - File size: 133.28 KB
2025-12-15 11:22:29,236 - INFO - === Starting PDF Processing ===
2025-12-15 11:22:29,236 - INFO - Model: gemini-2.5-pro
2025-12-15 11:22:29,238 - INFO - PDF: /home/mohammadbagher/Downloads/PDFs/Bolognia 5th Edition 2024 (1)-7-26-46.pdf
2025-12-15 11:22:29,238 - INFO - Full prompt being sent (4530 chars): You are a meticulous medical OCR & structuring assistant.

Your job is to extract ONLY what is present on each provided textbook page image/PDF
and convert it into clean, AI-ready text with structured sections.

You MUST avoid hallucinations and preserve original medical meaning precisely.

====================
GLOBAL PRINCIPLES
====================
- NO HALLUCINATIONS: Output only content visible on the page(s). If unreadable/unclear, write "[UNREADABLE]" or add an "uncertain" flag with brief reason.
- LANGUAGE & SPELLING: Preserve original English spelling and medical terminology.
- CLEAN OCR:
  - Remove headers/footers and running titles.
  - Fix broken words at line breaks.
  - Replace ligatures (ﬁ, ﬂ).
  - Preserve italics (*italic*), bold (**bold**), and subscripts/superscripts via LaTeX.
- CITATIONS: Keep in-text citations verbatim.
- MATH/CHEM: Use inline LaTeX.
- NO IMAGES: Describe figures textually only; do not invent labels.

====================
CRITICAL OUTPUT CONTRACT (MULTI-PART)
====================
The full output is TOO LARGE to fit in one response.

You MUST split the final output into multiple CHUNKS.

IMPORTANT:
- A CHUNK is ONLY a technical split of the RESPONSE due to size limits.
- CHUNKS are identified ONLY by the field "chunk_index".
- CHUNKS have NOTHING to do with the medical or logical structure of the chapter.

Each response MUST:
- Output ONLY valid JSON
- Contain ONLY ONE CHUNK of the final output
- NOT repeat rows from previous chunks
- Preserve the exact order of rows across chunks

====================
OUTPUT FORMAT (EXACT)
====================
{
  "chunk_index": <integer starting from 1>,
  "is_last": <true | false>,
  "rows": [
    {
      "Type": "page text | Figure | Table",
      "Extraction": "<single-line text or JSON>",
      "Number": <page number>,
      "Part": <integer>
    }
  ]
}

====================
MEANING OF chunk_index
====================
- "chunk_index" indicates ONLY the sequential number of this RESPONSE CHUNK.
- chunk_index = 1 means: first technical chunk of the output.
- chunk_index = 2 means: second technical chunk of the output.
- chunk_index has NO semantic meaning about the chapter content.
- chunk_index MUST strictly increase by 1 across responses.

====================
MEANING OF Part (VERY IMPORTANT)
====================
- "Part" represents the LOGICAL CONTENT PART of the chapter.
- "Part" is NOT related to chunk_index.
- "Part" is the result of grouping AUTHOR PARTS into YOUR OWN PARTS ("Our parts").

How to define "Part":
1) At the beginning of the chapter, there is a "Chapter contents" section that lists
   the author-defined parts ("author parts") and their page ranges.
2) You MUST group consecutive author parts into larger groups called "Our parts".
3) Each "Our part" MUST:
   - consist of consecutive author parts
   - NOT exceed 10 pages total
4) Assign integer labels starting from 1:
   - Our part 1
   - Our part 2
   - Our part 3
   - etc.

Example:
If author parts have page counts:
2, 4, 5, 3, 1, 7, 5

Then:
- Our part 1 = author parts 1 + 2
- Our part 2 = author parts 3 + 4 + 5
- Our part 3 = author part 6
- Our part 4 = author part 7

Rules for assigning "Part" in rows:
- Every row MUST have exactly ONE integer "Part" value.
- A single page MAY belong to TWO different "Part" values if an Our part boundary
  occurs in the middle of the page.
- In such cases, split the page text into TWO separate rows:
  - one row with the previous Part
  - one row with the next Part
- NEVER mix content from two different Parts inside the same row.

====================
Rules for rows
====================
- Each row represents exactly ONE of:
  - page text
  - figure
  - table
- Extraction MUST be single-line (no ENTER).
- JSON inside Extraction MUST be minified and valid.
- References section at end of chapter MUST be ignored.

====================
CHUNK INSTRUCTIONS
====================
This is CHUNK {chunk_index} of the output.

Generate ONLY the rows that belong to this CHUNK.
Stop when you reach a safe size limit for a single response.
If more content remains after this CHUNK, set:
  "is_last": false
Otherwise set:
  "is_last": true

====================
AUTHOR PARTS → OUR PARTS RULES
====================
[keep your full original rules here verbatim — unchanged]

====================
FINAL RULES
====================
- DO NOT summarize.
- DO NOT explain.
- DO NOT add commentary.
- Output ONLY the JSON object described above.

You will now receive a PDF.
Generate CHUNK {chunk_index}.
2025-12-15 11:22:29,243 - INFO - Parts directory: /home/mohammadbagher/Downloads/PDFs/parts_Bolognia 5th Edition 2024 (1)-7-26-46.pdf_3513e464
2025-12-15 11:22:29,245 - INFO - Final output will be saved to PDF directory: /home/mohammadbagher/Downloads/PDFs
2025-12-15 11:22:29,246 - INFO - No previous parts found, starting from part 1
2025-12-15 11:22:29,247 - INFO - === Processing Part 1 ===
2025-12-15 11:22:40,683 - INFO - PDF uploaded successfully with API key: bagher
2025-12-15 11:22:40,684 - INFO - Uploaded PDF file: Bolognia 5th Edition 2024 (1)-7-26-46.pdf
2025-12-15 11:22:40,684 - INFO - Model: gemini-2.5-pro, Max tokens for model: 32768, Using: 32768
2025-12-15 11:22:40,685 - INFO - Using max_output_tokens: 32768
2025-12-15 11:22:40,686 - INFO - Using model: gemini-2.5-pro
2025-12-15 11:22:40,686 - INFO - Sending prompt (length: 4643 characters)
2025-12-15 11:22:40,686 - INFO - Max output tokens: 32768
2025-12-15 11:22:40,687 - INFO - Multi-part mode: Using user's prompt as-is
2025-12-15 11:22:40,688 - INFO - Streaming disabled (force_no_streaming=True for multi-part processing)
2025-12-15 11:22:40,688 - INFO - Generating content with NON-STREAMING (large request detected to avoid rate limits)...
2025-12-15 11:24:49,053 - INFO - ✓ Request completed: 33036 characters received
2025-12-15 11:24:49,054 - INFO - Finish reason: STOP (normal completion)
2025-12-15 11:24:49,055 - INFO - ✓ Response completed normally
2025-12-15 11:24:49,059 - WARNING - Part 1, row 0: Extraction contains newlines (should use \n)
2025-12-15 11:24:49,060 - WARNING - Part 1, row 1: Extraction contains newlines (should use \n)
2025-12-15 11:24:49,060 - WARNING - Part 1, row 2: Extraction contains newlines (should use \n)
2025-12-15 11:24:49,061 - WARNING - Part 1, row 3: Extraction contains newlines (should use \n)
2025-12-15 11:24:49,061 - WARNING - Part 1, row 4: Extraction contains newlines (should use \n)
2025-12-15 11:24:49,062 - WARNING - Part 1, row 5: Extraction contains newlines (should use \n)
2025-12-15 11:24:49,062 - WARNING - Part 1, row 6: Extraction contains newlines (should use \n)
2025-12-15 11:24:49,063 - WARNING - Part 1, row 7: Extraction contains newlines (should use \n)
2025-12-15 11:24:49,063 - WARNING - Part 1, row 11: Extraction contains newlines (should use \n)
2025-12-15 11:24:49,064 - WARNING - Part 1, row 16: Extraction contains newlines (should use \n)
2025-12-15 11:24:49,064 - WARNING - Part 1, row 19: Extraction contains newlines (should use \n)
2025-12-15 11:24:49,065 - WARNING - Part 1, row 22: Extraction contains newlines (should use \n)
2025-12-15 11:24:49,066 - WARNING - Part 1, row 0: Extraction contains newlines (should use \n)
2025-12-15 11:24:49,066 - WARNING - Part 1, row 1: Extraction contains newlines (should use \n)
2025-12-15 11:24:49,067 - WARNING - Part 1, row 2: Extraction contains newlines (should use \n)
2025-12-15 11:24:49,067 - WARNING - Part 1, row 3: Extraction contains newlines (should use \n)
2025-12-15 11:24:49,068 - WARNING - Part 1, row 4: Extraction contains newlines (should use \n)
2025-12-15 11:24:49,068 - WARNING - Part 1, row 5: Extraction contains newlines (should use \n)
2025-12-15 11:24:49,069 - WARNING - Part 1, row 6: Extraction contains newlines (should use \n)
2025-12-15 11:24:49,069 - WARNING - Part 1, row 7: Extraction contains newlines (should use \n)
2025-12-15 11:24:49,070 - WARNING - Part 1, row 11: Extraction contains newlines (should use \n)
2025-12-15 11:24:49,070 - WARNING - Part 1, row 16: Extraction contains newlines (should use \n)
2025-12-15 11:24:49,071 - WARNING - Part 1, row 19: Extraction contains newlines (should use \n)
2025-12-15 11:24:49,071 - WARNING - Part 1, row 22: Extraction contains newlines (should use \n)
2025-12-15 11:24:49,072 - INFO - Part 1: Parsed successfully - is_last=False, rows=23
2025-12-15 11:24:49,080 - INFO - ✓ Saved part 1 to /home/mohammadbagher/Downloads/PDFs/parts_Bolognia 5th Edition 2024 (1)-7-26-46.pdf_3513e464/part_1.json
2025-12-15 11:24:49,081 - INFO - Part 1: Saved to /home/mohammadbagher/Downloads/PDFs/parts_Bolognia 5th Edition 2024 (1)-7-26-46.pdf_3513e464/part_1.json (not displayed to user)
2025-12-15 11:24:49,081 - INFO - Part 1: Added 23 rows (total: 23)
2025-12-15 11:24:49,081 - INFO - Part 1: is_last=false, continuing to next part...
2025-12-15 11:24:49,083 - INFO - Waiting 14.4s before next part...
2025-12-15 11:25:03,455 - INFO - === Processing Part 2 ===
2025-12-15 11:25:14,238 - INFO - PDF uploaded successfully with API key: bagher
2025-12-15 11:25:14,238 - INFO - Uploaded PDF file: Bolognia 5th Edition 2024 (1)-7-26-46.pdf
2025-12-15 11:25:14,239 - INFO - Model: gemini-2.5-pro, Max tokens for model: 32768, Using: 32768
2025-12-15 11:25:14,240 - INFO - Using max_output_tokens: 32768
2025-12-15 11:25:14,240 - INFO - Using model: gemini-2.5-pro
2025-12-15 11:25:14,240 - INFO - Sending prompt (length: 4726 characters)
2025-12-15 11:25:14,241 - INFO - Max output tokens: 32768
2025-12-15 11:25:14,241 - INFO - Multi-part mode: Using user's prompt as-is
2025-12-15 11:25:14,242 - INFO - Streaming disabled (force_no_streaming=True for multi-part processing)
2025-12-15 11:25:14,242 - INFO - Generating content with NON-STREAMING (large request detected to avoid rate limits)...
2025-12-15 11:26:37,775 - INFO - ✓ Request completed: 30638 characters received
2025-12-15 11:26:37,777 - INFO - Finish reason: STOP (normal completion)
2025-12-15 11:26:37,777 - INFO - ✓ Response completed normally
2025-12-15 11:26:37,780 - WARNING - Part 2, row 0: Extraction contains newlines (should use \n)
2025-12-15 11:26:37,781 - WARNING - Part 2, row 1: Extraction contains newlines (should use \n)
2025-12-15 11:26:37,782 - WARNING - Part 2, row 2: Extraction contains newlines (should use \n)
2025-12-15 11:26:37,782 - WARNING - Part 2, row 4: Extraction contains newlines (should use \n)
2025-12-15 11:26:37,783 - WARNING - Part 2, row 5: Extraction contains newlines (should use \n)
2025-12-15 11:26:37,784 - WARNING - Part 2, row 8: Extraction contains newlines (should use \n)
2025-12-15 11:26:37,785 - WARNING - Part 2, row 10: Extraction contains newlines (should use \n)
2025-12-15 11:26:37,786 - WARNING - Part 2, row 11: Extraction contains newlines (should use \n)
2025-12-15 11:26:37,787 - WARNING - Part 2, row 12: Extraction contains newlines (should use \n)
2025-12-15 11:26:37,788 - WARNING - Part 2, row 16: Extraction contains newlines (should use \n)
2025-12-15 11:26:37,789 - WARNING - Part 2, row 17: Extraction contains newlines (should use \n)
2025-12-15 11:26:37,789 - WARNING - Part 2, row 18: Extraction contains newlines (should use \n)
2025-12-15 11:26:37,789 - WARNING - Part 2, row 22: Extraction contains newlines (should use \n)
2025-12-15 11:26:37,790 - WARNING - Part 2, row 23: Extraction contains newlines (should use \n)
2025-12-15 11:26:37,790 - WARNING - Part 2, row 27: Extraction contains newlines (should use \n)
2025-12-15 11:26:37,790 - WARNING - Part 2, row 28: Extraction contains newlines (should use \n)
2025-12-15 11:26:37,790 - WARNING - Part 2, row 29: Extraction contains newlines (should use \n)
2025-12-15 11:26:37,791 - WARNING - Part 2, row 31: Extraction contains newlines (should use \n)
2025-12-15 11:26:37,791 - WARNING - Part 2, row 32: Extraction contains newlines (should use \n)
2025-12-15 11:26:37,791 - WARNING - Part 2, row 0: Extraction contains newlines (should use \n)
2025-12-15 11:26:37,792 - WARNING - Part 2, row 1: Extraction contains newlines (should use \n)
2025-12-15 11:26:37,793 - WARNING - Part 2, row 2: Extraction contains newlines (should use \n)
2025-12-15 11:26:37,793 - WARNING - Part 2, row 4: Extraction contains newlines (should use \n)
2025-12-15 11:26:37,793 - WARNING - Part 2, row 5: Extraction contains newlines (should use \n)
2025-12-15 11:26:37,793 - WARNING - Part 2, row 8: Extraction contains newlines (should use \n)
2025-12-15 11:26:37,794 - WARNING - Part 2, row 10: Extraction contains newlines (should use \n)
2025-12-15 11:26:37,794 - WARNING - Part 2, row 11: Extraction contains newlines (should use \n)
2025-12-15 11:26:37,794 - WARNING - Part 2, row 12: Extraction contains newlines (should use \n)
2025-12-15 11:26:37,794 - WARNING - Part 2, row 16: Extraction contains newlines (should use \n)
2025-12-15 11:26:37,795 - WARNING - Part 2, row 17: Extraction contains newlines (should use \n)
2025-12-15 11:26:37,795 - WARNING - Part 2, row 18: Extraction contains newlines (should use \n)
2025-12-15 11:26:37,795 - WARNING - Part 2, row 22: Extraction contains newlines (should use \n)
2025-12-15 11:26:37,795 - WARNING - Part 2, row 23: Extraction contains newlines (should use \n)
2025-12-15 11:26:37,795 - WARNING - Part 2, row 27: Extraction contains newlines (should use \n)
2025-12-15 11:26:37,795 - WARNING - Part 2, row 28: Extraction contains newlines (should use \n)
2025-12-15 11:26:37,796 - WARNING - Part 2, row 29: Extraction contains newlines (should use \n)
2025-12-15 11:26:37,796 - WARNING - Part 2, row 31: Extraction contains newlines (should use \n)
2025-12-15 11:26:37,796 - WARNING - Part 2, row 32: Extraction contains newlines (should use \n)
2025-12-15 11:26:37,796 - INFO - Part 2: Parsed successfully - is_last=False, rows=34
2025-12-15 11:26:37,800 - INFO - ✓ Saved part 2 to /home/mohammadbagher/Downloads/PDFs/parts_Bolognia 5th Edition 2024 (1)-7-26-46.pdf_3513e464/part_2.json
2025-12-15 11:26:37,800 - INFO - Part 2: Saved to /home/mohammadbagher/Downloads/PDFs/parts_Bolognia 5th Edition 2024 (1)-7-26-46.pdf_3513e464/part_2.json (not displayed to user)
2025-12-15 11:26:37,800 - INFO - Part 2: Added 34 rows (total: 57)
2025-12-15 11:26:37,800 - INFO - Part 2: is_last=false, continuing to next part...
2025-12-15 11:26:37,801 - INFO - Waiting 11.7s before next part...
2025-12-15 11:26:49,523 - INFO - === Processing Part 3 ===
2025-12-15 11:27:02,567 - INFO - PDF uploaded successfully with API key: bagher
2025-12-15 11:27:02,567 - INFO - Uploaded PDF file: Bolognia 5th Edition 2024 (1)-7-26-46.pdf
2025-12-15 11:27:02,567 - INFO - Model: gemini-2.5-pro, Max tokens for model: 32768, Using: 32768
2025-12-15 11:27:02,568 - INFO - Using max_output_tokens: 32768
2025-12-15 11:27:02,568 - INFO - Using model: gemini-2.5-pro
2025-12-15 11:27:02,568 - INFO - Sending prompt (length: 4726 characters)
2025-12-15 11:27:02,568 - INFO - Max output tokens: 32768
2025-12-15 11:27:02,568 - INFO - Multi-part mode: Using user's prompt as-is
2025-12-15 11:27:02,569 - INFO - Streaming disabled (force_no_streaming=True for multi-part processing)
2025-12-15 11:27:02,569 - INFO - Generating content with NON-STREAMING (large request detected to avoid rate limits)...
2025-12-15 11:29:08,779 - INFO - ✓ Request completed: 28991 characters received
2025-12-15 11:29:08,780 - INFO - Finish reason: STOP (normal completion)
2025-12-15 11:29:08,781 - INFO - ✓ Response completed normally
2025-12-15 11:29:08,785 - WARNING - Part 3, row 3: Extraction contains newlines (should use \n)
2025-12-15 11:29:08,787 - WARNING - Part 3, row 7: Extraction contains newlines (should use \n)
2025-12-15 11:29:08,787 - WARNING - Part 3, row 10: Extraction contains newlines (should use \n)
2025-12-15 11:29:08,788 - WARNING - Part 3, row 14: Extraction contains newlines (should use \n)
2025-12-15 11:29:08,789 - WARNING - Part 3, row 16: Extraction contains newlines (should use \n)
2025-12-15 11:29:08,789 - WARNING - Part 3, row 19: Extraction contains newlines (should use \n)
2025-12-15 11:29:08,790 - WARNING - Part 3, row 3: Extraction contains newlines (should use \n)
2025-12-15 11:29:08,791 - WARNING - Part 3, row 7: Extraction contains newlines (should use \n)
2025-12-15 11:29:08,792 - WARNING - Part 3, row 10: Extraction contains newlines (should use \n)
2025-12-15 11:29:08,793 - WARNING - Part 3, row 14: Extraction contains newlines (should use \n)
2025-12-15 11:29:08,795 - WARNING - Part 3, row 16: Extraction contains newlines (should use \n)
2025-12-15 11:29:08,795 - WARNING - Part 3, row 19: Extraction contains newlines (should use \n)
2025-12-15 11:29:08,796 - INFO - Part 3: Parsed successfully - is_last=False, rows=20
2025-12-15 11:29:08,801 - INFO - ✓ Saved part 3 to /home/mohammadbagher/Downloads/PDFs/parts_Bolognia 5th Edition 2024 (1)-7-26-46.pdf_3513e464/part_3.json
2025-12-15 11:29:08,804 - INFO - Part 3: Saved to /home/mohammadbagher/Downloads/PDFs/parts_Bolognia 5th Edition 2024 (1)-7-26-46.pdf_3513e464/part_3.json (not displayed to user)
2025-12-15 11:29:08,805 - INFO - Part 3: Added 20 rows (total: 77)
2025-12-15 11:29:08,805 - INFO - Part 3: is_last=false, continuing to next part...
2025-12-15 11:29:08,806 - INFO - Waiting 8.5s before next part...
2025-12-15 11:29:17,286 - INFO - === Processing Part 4 ===
2025-12-15 11:29:32,580 - INFO - PDF uploaded successfully with API key: bagher
2025-12-15 11:29:32,581 - INFO - Uploaded PDF file: Bolognia 5th Edition 2024 (1)-7-26-46.pdf
2025-12-15 11:29:32,581 - INFO - Model: gemini-2.5-pro, Max tokens for model: 32768, Using: 32768
2025-12-15 11:29:32,581 - INFO - Using max_output_tokens: 32768
2025-12-15 11:29:32,581 - INFO - Using model: gemini-2.5-pro
2025-12-15 11:29:32,581 - INFO - Sending prompt (length: 4726 characters)
2025-12-15 11:29:32,581 - INFO - Max output tokens: 32768
2025-12-15 11:29:32,581 - INFO - Multi-part mode: Using user's prompt as-is
2025-12-15 11:29:32,581 - INFO - Streaming disabled (force_no_streaming=True for multi-part processing)
2025-12-15 11:29:32,581 - INFO - Generating content with NON-STREAMING (large request detected to avoid rate limits)...
2025-12-15 11:30:55,690 - INFO - ✓ Request completed: 25183 characters received
2025-12-15 11:30:55,691 - INFO - Finish reason: STOP (normal completion)
2025-12-15 11:30:55,691 - INFO - ✓ Response completed normally
2025-12-15 11:30:55,694 - INFO - Part 4: Parsed successfully - is_last=False, rows=9
2025-12-15 11:30:55,701 - INFO - ✓ Saved part 4 to /home/mohammadbagher/Downloads/PDFs/parts_Bolognia 5th Edition 2024 (1)-7-26-46.pdf_3513e464/part_4.json
2025-12-15 11:30:55,701 - INFO - Part 4: Saved to /home/mohammadbagher/Downloads/PDFs/parts_Bolognia 5th Edition 2024 (1)-7-26-46.pdf_3513e464/part_4.json (not displayed to user)
2025-12-15 11:30:55,702 - INFO - Part 4: Added 9 rows (total: 86)
2025-12-15 11:30:55,702 - INFO - Part 4: is_last=false, continuing to next part...
2025-12-15 11:30:55,704 - INFO - Waiting 14.8s before next part...
2025-12-15 11:31:10,503 - INFO - === Processing Part 5 ===
2025-12-15 11:31:21,131 - INFO - PDF uploaded successfully with API key: bagher
2025-12-15 11:31:21,131 - INFO - Uploaded PDF file: Bolognia 5th Edition 2024 (1)-7-26-46.pdf
2025-12-15 11:31:21,131 - INFO - Model: gemini-2.5-pro, Max tokens for model: 32768, Using: 32768
2025-12-15 11:31:21,131 - INFO - Using max_output_tokens: 32768
2025-12-15 11:31:21,131 - INFO - Using model: gemini-2.5-pro
2025-12-15 11:31:21,131 - INFO - Sending prompt (length: 4726 characters)
2025-12-15 11:31:21,131 - INFO - Max output tokens: 32768
2025-12-15 11:31:21,131 - INFO - Multi-part mode: Using user's prompt as-is
2025-12-15 11:31:21,131 - INFO - Streaming disabled (force_no_streaming=True for multi-part processing)
2025-12-15 11:31:21,132 - INFO - Generating content with NON-STREAMING (large request detected to avoid rate limits)...
2025-12-15 11:33:38,172 - INFO - ✓ Request completed: 34727 characters received
2025-12-15 11:33:38,173 - INFO - Finish reason: STOP (normal completion)
2025-12-15 11:33:38,174 - INFO - ✓ Response completed normally
2025-12-15 11:33:38,178 - WARNING - Part 5, row 2: Extraction contains newlines (should use \n)
2025-12-15 11:33:38,178 - WARNING - Part 5, row 4: Extraction contains newlines (should use \n)
2025-12-15 11:33:38,179 - WARNING - Part 5, row 5: Extraction contains newlines (should use \n)
2025-12-15 11:33:38,179 - WARNING - Part 5, row 9: Extraction contains newlines (should use \n)
2025-12-15 11:33:38,180 - WARNING - Part 5, row 10: Extraction contains newlines (should use \n)
2025-12-15 11:33:38,181 - WARNING - Part 5, row 2: Extraction contains newlines (should use \n)
2025-12-15 11:33:38,182 - WARNING - Part 5, row 4: Extraction contains newlines (should use \n)
2025-12-15 11:33:38,182 - WARNING - Part 5, row 5: Extraction contains newlines (should use \n)
2025-12-15 11:33:38,183 - WARNING - Part 5, row 9: Extraction contains newlines (should use \n)
2025-12-15 11:33:38,183 - WARNING - Part 5, row 10: Extraction contains newlines (should use \n)
2025-12-15 11:33:38,184 - INFO - Part 5: Parsed successfully - is_last=True, rows=29
2025-12-15 11:33:38,204 - INFO - ✓ Saved part 5 to /home/mohammadbagher/Downloads/PDFs/parts_Bolognia 5th Edition 2024 (1)-7-26-46.pdf_3513e464/part_5.json
2025-12-15 11:33:38,204 - INFO - Part 5: Saved to /home/mohammadbagher/Downloads/PDFs/parts_Bolognia 5th Edition 2024 (1)-7-26-46.pdf_3513e464/part_5.json (not displayed to user)
2025-12-15 11:33:38,205 - INFO - Part 5: Added 29 rows (total: 115)
2025-12-15 11:33:38,206 - INFO - Part 5: is_last=true, processing complete!
2025-12-15 11:33:38,208 - INFO - === Processing Summary ===
2025-12-15 11:33:38,212 - INFO - New parts processed in this run: 4
2025-12-15 11:33:38,213 - INFO - Previous parts loaded (resume): 0
2025-12-15 11:33:38,214 - INFO - Total parts in final output: 4
2025-12-15 11:33:38,215 - INFO - Total rows collected: 115
2025-12-15 11:33:38,216 - INFO - Deduplicating 115 rows...
2025-12-15 11:33:38,245 - WARNING - Removed 10 duplicate rows using enhanced deduplication
2025-12-15 11:33:38,248 - INFO - Final row count after deduplication: 105
2025-12-15 11:33:38,250 - INFO - Sorting 105 rows by Part and Number...
2025-12-15 11:33:38,251 - INFO - Rows sorted successfully
2025-12-15 11:33:38,277 - INFO - ✓ Final output saved to /home/mohammadbagher/Downloads/PDFs/Bolognia 5th Edition 2024 1-7-26-46_final_output.json
2025-12-15 11:33:38,278 - INFO -   - File path: /home/mohammadbagher/Downloads/PDFs/Bolognia 5th Edition 2024 1-7-26-46_final_output.json
2025-12-15 11:33:38,278 - INFO -   - Total parts: 4 (0 previous + 4 new)
2025-12-15 11:33:38,279 - INFO -   - Total rows: 105
2025-12-15 11:33:38,279 - INFO -   - File size: 144.29 KB
2025-12-15 11:41:04,627 - INFO - Loaded 6 predefined prompts
2025-12-15 11:47:35,095 - INFO - Loaded 6 predefined prompts
2025-12-15 11:47:57,909 - INFO - Loaded 3 API keys
2025-12-15 11:49:08,423 - INFO - === Starting PDF Processing ===
2025-12-15 11:49:08,424 - INFO - Model: gemini-2.5-pro
2025-12-15 11:49:08,425 - INFO - PDF: /home/mohammadbagher/Downloads/PDFs/Bolognia 5th Edition 2024 (1)-29-6-22.pdf
2025-12-15 11:49:08,425 - INFO - Full prompt being sent (5469 chars): You are a meticulous medical OCR & structuring assistant.

Your job is to extract ONLY what is present on each provided textbook page image/PDF
and convert it into clean, AI-ready text with structured sections.

You MUST avoid hallucinations and preserve original medical meaning precisely.

====================
GLOBAL PRINCIPLES
====================
- NO HALLUCINATIONS: Output only content visible on the page(s). If unreadable/unclear, write "[UNREADABLE]" or add an "uncertain" flag with brief reason.
- LANGUAGE & SPELLING: Preserve original English spelling and medical terminology.
- CLEAN OCR:
  - Remove headers/footers and running titles.
  - Fix broken words at line breaks.
  - Replace ligatures (ﬁ, ﬂ).
  - Preserve italics (*italic*), bold (**bold**), and subscripts/superscripts via LaTeX.
- CITATIONS: Keep in-text citations verbatim.
- MATH/CHEM: Use inline LaTeX.
- NO IMAGES: Describe figures textually only; do not invent labels.

====================
CRITICAL OUTPUT CONTRACT (MULTI-PART)
====================
The full output is TOO LARGE to fit in one response.

You MUST split the final output into multiple CHUNKS.

IMPORTANT:
- A CHUNK is ONLY a technical split of the RESPONSE due to size limits.
- CHUNKS are identified ONLY by the field "chunk_index".
- CHUNKS have NOTHING to do with the medical or logical structure of the chapter.

Each response MUST:
- Output ONLY valid JSON
- Contain ONLY ONE CHUNK of the final output
- NOT repeat rows from previous chunks
- Preserve the exact order of rows across chunks

====================
OUTPUT FORMAT (EXACT)
====================
{
  "chunk_index": <integer starting from 1>,
  "is_last": <true | false>,
  "rows": [
    {
      "Type": "page text | Figure | Table",
      "Extraction": "<single-line text or JSON>",
      "Number": <page number>,
      "Part": <integer>
    }
  ]
}

====================
MEANING OF chunk_index
====================
- "chunk_index" indicates ONLY the sequential number of this RESPONSE CHUNK.
- chunk_index = 1 means: first technical chunk of the output.
- chunk_index = 2 means: second technical chunk of the output.
- chunk_index has NO semantic meaning about the chapter content.
- chunk_index MUST strictly increase by 1 across responses.

====================
MEANING OF Part (VERY IMPORTANT)
====================
- "Part" represents the LOGICAL CONTENT PART of the chapter.
- "Part" is NOT related to chunk_index.
- "Part" is the result of grouping AUTHOR PARTS into YOUR OWN PARTS ("Our parts").

How to define "Part":
1) At the beginning of the chapter, there is a "Chapter contents" section that lists
   the author-defined parts ("author parts") and their page ranges.
2) You MUST group consecutive author parts into larger groups called "Our parts".
3) Each "Our part" MUST:
   - consist of consecutive author parts
   - NOT exceed 10 pages total
4) Assign integer labels starting from 1:
   - Our part 1
   - Our part 2
   - Our part 3
   - etc.

Example:
If author parts have page counts:
2, 4, 5, 3, 1, 7, 5

Then:
- Our part 1 = author parts 1 + 2
- Our part 2 = author parts 3 + 4 + 5
- Our part 3 = author part 6
- Our part 4 = author part 7

Rules for assigning "Part" in rows:
- Every row MUST have exactly ONE integer "Part" value.
- A single page MAY belong to TWO different "Part" values if an Our part boundary
  occurs in the middle of the page.
- In such cases, split the page text into TWO separate rows:
  - one row with the previous Part
  - one row with the next Part
- NEVER mix content from two different Parts inside the same row.
====================
PAGE-BY-PAGE FORWARD-ONLY PROCESSING (CRITICAL)
====================
You MUST process the document STRICTLY page by page, in ascending page order.

- Always start from the lowest-numbered page that has NOT yet been processed.
- NEVER go back to a previous page.
- NEVER re-extract or regenerate content from any page that has already appeared
  in earlier chunks.
- Once a page (or a portion of a page) is output in any chunk, it is considered FINAL.
- Subsequent chunks MUST continue ONLY from the next unprocessed page or page segment.

Important clarifications:
- If a page is split across two different "Part" values, you may output that page
  in TWO rows, but ONLY ONCE and ONLY in forward order.
- You MUST NOT repeat a page, a paragraph, a figure, or a table that has already
  been output in any previous chunk.
- If you are unsure whether a page has already been processed, assume it HAS
  and move forward.

====================
Rules for rows
====================
- Each row represents exactly ONE of:
  - page text
  - figure
  - table
- Extraction MUST be single-line (no ENTER).
- JSON inside Extraction MUST be minified and valid.
- References section at end of chapter MUST be ignored.

====================
CHUNK INSTRUCTIONS
====================
This is CHUNK {chunk_index} of the output.

Generate ONLY the rows that belong to this CHUNK.
Stop when you reach a safe size limit for a single response.
If more content remains after this CHUNK, set:
  "is_last": false
Otherwise set:
  "is_last": true

====================
AUTHOR PARTS → OUR PARTS RULES
====================
[keep your full original rules here verbatim — unchanged]

====================
FINAL RULES
====================
- DO NOT summarize.
- DO NOT explain.
- DO NOT add commentary.
- Output ONLY the JSON object described above.

You will now receive a PDF.
Generate CHUNK {chunk_index}.
2025-12-15 11:49:08,432 - INFO - Parts directory: /home/mohammadbagher/Desktop/tts app bagher/content_automation_project/parts_Bolognia 5th Edition 2024 (1)-29-6-22.pdf_1e3d158e
2025-12-15 11:49:08,433 - INFO - Final output will be saved to current directory: /home/mohammadbagher/Desktop/tts app bagher/content_automation_project
2025-12-15 11:49:08,439 - INFO - === Processing Part 1 ===
2025-12-15 11:49:14,919 - INFO - PDF uploaded successfully with API key: bagher
2025-12-15 11:49:14,920 - INFO - Uploaded PDF file: Bolognia 5th Edition 2024 (1)-29-6-22.pdf
2025-12-15 11:49:14,921 - INFO - Model: gemini-2.5-pro, Max tokens for model: 32768, Using: 32768
2025-12-15 11:49:14,921 - INFO - Using max_output_tokens: 32768
2025-12-15 11:49:14,922 - INFO - Using model: gemini-2.5-pro
2025-12-15 11:49:14,922 - INFO - Sending prompt (length: 5582 characters)
2025-12-15 11:49:14,923 - INFO - Max output tokens: 32768
2025-12-15 11:49:14,923 - INFO - Multi-part mode: Using user's prompt as-is
2025-12-15 11:49:14,923 - INFO - Streaming disabled (force_no_streaming=True for multi-part processing)
2025-12-15 11:49:14,924 - INFO - Generating content with NON-STREAMING (large request detected to avoid rate limits)...
2025-12-15 11:51:01,495 - INFO - ✓ Request completed: 26978 characters received
2025-12-15 11:51:01,495 - INFO - Finish reason: STOP (normal completion)
2025-12-15 11:51:01,496 - INFO - ✓ Response completed normally
2025-12-15 11:51:01,496 - WARNING - Part 1, row 0: Extraction contains newlines (should use \n)
2025-12-15 11:51:01,496 - WARNING - Part 1, row 4: Extraction contains newlines (should use \n)
2025-12-15 11:51:01,497 - WARNING - Part 1, row 7: Extraction contains newlines (should use \n)
2025-12-15 11:51:01,497 - WARNING - Part 1, row 10: Extraction contains newlines (should use \n)
2025-12-15 11:51:01,497 - WARNING - Part 1, row 0: Extraction contains newlines (should use \n)
2025-12-15 11:51:01,497 - WARNING - Part 1, row 4: Extraction contains newlines (should use \n)
2025-12-15 11:51:01,497 - WARNING - Part 1, row 7: Extraction contains newlines (should use \n)
2025-12-15 11:51:01,497 - WARNING - Part 1, row 10: Extraction contains newlines (should use \n)
2025-12-15 11:51:01,497 - INFO - Part 1: Parsed successfully - is_last=False, rows=11
2025-12-15 11:51:01,500 - INFO - Part 1: Added 11 rows (total: 11)
2025-12-15 11:51:01,500 - INFO - Part 1: is_last=false, continuing to next part...
2025-12-15 11:51:01,500 - INFO - Waiting 11.1s before next part...
2025-12-15 11:51:12,643 - INFO - === Processing Part 2 ===
2025-12-15 11:51:19,095 - INFO - PDF uploaded successfully with API key: bagher
2025-12-15 11:51:19,095 - INFO - Uploaded PDF file: Bolognia 5th Edition 2024 (1)-29-6-22.pdf
2025-12-15 11:51:19,096 - INFO - Model: gemini-2.5-pro, Max tokens for model: 32768, Using: 32768
2025-12-15 11:51:19,097 - INFO - Using max_output_tokens: 32768
2025-12-15 11:51:19,097 - INFO - Using model: gemini-2.5-pro
2025-12-15 11:51:19,098 - INFO - Sending prompt (length: 5665 characters)
2025-12-15 11:51:19,098 - INFO - Max output tokens: 32768
2025-12-15 11:51:19,099 - INFO - Multi-part mode: Using user's prompt as-is
2025-12-15 11:51:19,099 - INFO - Streaming disabled (force_no_streaming=True for multi-part processing)
2025-12-15 11:51:19,100 - INFO - Generating content with NON-STREAMING (large request detected to avoid rate limits)...
2025-12-15 11:52:41,751 - INFO - ✓ Request completed: 26253 characters received
2025-12-15 11:52:41,752 - INFO - Finish reason: STOP (normal completion)
2025-12-15 11:52:41,753 - INFO - ✓ Response completed normally
2025-12-15 11:52:41,756 - WARNING - Part 2, row 0: Extraction contains newlines (should use \n)
2025-12-15 11:52:41,757 - WARNING - Part 2, row 2: Extraction contains newlines (should use \n)
2025-12-15 11:52:41,757 - WARNING - Part 2, row 3: Extraction contains newlines (should use \n)
2025-12-15 11:52:41,758 - WARNING - Part 2, row 5: Extraction contains newlines (should use \n)
2025-12-15 11:52:41,759 - WARNING - Part 2, row 7: Extraction contains newlines (should use \n)
2025-12-15 11:52:41,760 - WARNING - Part 2, row 11: Extraction contains newlines (should use \n)
2025-12-15 11:52:41,761 - WARNING - Part 2, row 12: Extraction contains newlines (should use \n)
2025-12-15 11:52:41,762 - WARNING - Part 2, row 0: Extraction contains newlines (should use \n)
2025-12-15 11:52:41,763 - WARNING - Part 2, row 2: Extraction contains newlines (should use \n)
2025-12-15 11:52:41,763 - WARNING - Part 2, row 3: Extraction contains newlines (should use \n)
2025-12-15 11:52:41,764 - WARNING - Part 2, row 5: Extraction contains newlines (should use \n)
2025-12-15 11:52:41,765 - WARNING - Part 2, row 7: Extraction contains newlines (should use \n)
2025-12-15 11:52:41,765 - WARNING - Part 2, row 11: Extraction contains newlines (should use \n)
2025-12-15 11:52:41,766 - WARNING - Part 2, row 12: Extraction contains newlines (should use \n)
2025-12-15 11:52:41,766 - INFO - Part 2: Parsed successfully - is_last=False, rows=14
2025-12-15 11:52:41,769 - INFO - Part 2: Added 14 rows (total: 25)
2025-12-15 11:52:41,770 - INFO - Part 2: is_last=false, continuing to next part...
2025-12-15 11:52:41,771 - INFO - Waiting 13.8s before next part...
2025-12-15 11:52:55,559 - INFO - === Processing Part 3 ===
2025-12-15 11:53:02,910 - INFO - PDF uploaded successfully with API key: bagher
2025-12-15 11:53:02,911 - INFO - Uploaded PDF file: Bolognia 5th Edition 2024 (1)-29-6-22.pdf
2025-12-15 11:53:02,911 - INFO - Model: gemini-2.5-pro, Max tokens for model: 32768, Using: 32768
2025-12-15 11:53:02,912 - INFO - Using max_output_tokens: 32768
2025-12-15 11:53:02,912 - INFO - Using model: gemini-2.5-pro
2025-12-15 11:53:02,913 - INFO - Sending prompt (length: 5665 characters)
2025-12-15 11:53:02,913 - INFO - Max output tokens: 32768
2025-12-15 11:53:02,914 - INFO - Multi-part mode: Using user's prompt as-is
2025-12-15 11:53:02,914 - INFO - Streaming disabled (force_no_streaming=True for multi-part processing)
2025-12-15 11:53:02,914 - INFO - Generating content with NON-STREAMING (large request detected to avoid rate limits)...
2025-12-15 11:54:23,981 - INFO - ✓ Request completed: 28132 characters received
2025-12-15 11:54:23,985 - INFO - Finish reason: STOP (normal completion)
2025-12-15 11:54:23,988 - INFO - ✓ Response completed normally
2025-12-15 11:54:23,994 - WARNING - Part 3, row 2: Extraction contains newlines (should use \n)
2025-12-15 11:54:23,996 - WARNING - Part 3, row 3: Extraction contains newlines (should use \n)
2025-12-15 11:54:23,997 - WARNING - Part 3, row 5: Extraction contains newlines (should use \n)
2025-12-15 11:54:23,998 - WARNING - Part 3, row 7: Extraction contains newlines (should use \n)
2025-12-15 11:54:23,998 - WARNING - Part 3, row 11: Extraction contains newlines (should use \n)
2025-12-15 11:54:23,999 - WARNING - Part 3, row 12: Extraction contains newlines (should use \n)
2025-12-15 11:54:24,000 - WARNING - Part 3, row 2: Extraction contains newlines (should use \n)
2025-12-15 11:54:24,002 - WARNING - Part 3, row 3: Extraction contains newlines (should use \n)
2025-12-15 11:54:24,004 - WARNING - Part 3, row 5: Extraction contains newlines (should use \n)
2025-12-15 11:54:24,005 - WARNING - Part 3, row 7: Extraction contains newlines (should use \n)
2025-12-15 11:54:24,006 - WARNING - Part 3, row 11: Extraction contains newlines (should use \n)
2025-12-15 11:54:24,007 - WARNING - Part 3, row 12: Extraction contains newlines (should use \n)
2025-12-15 11:54:24,007 - INFO - Part 3: Parsed successfully - is_last=False, rows=14
2025-12-15 11:54:24,016 - INFO - Part 3: Added 14 rows (total: 39)
2025-12-15 11:54:24,016 - INFO - Part 3: is_last=false, continuing to next part...
2025-12-15 11:54:24,021 - INFO - Waiting 14.6s before next part...
2025-12-15 11:54:38,593 - INFO - === Processing Part 4 ===
2025-12-15 11:54:44,648 - INFO - PDF uploaded successfully with API key: bagher
2025-12-15 11:54:44,649 - INFO - Uploaded PDF file: Bolognia 5th Edition 2024 (1)-29-6-22.pdf
2025-12-15 11:54:44,649 - INFO - Model: gemini-2.5-pro, Max tokens for model: 32768, Using: 32768
2025-12-15 11:54:44,650 - INFO - Using max_output_tokens: 32768
2025-12-15 11:54:44,651 - INFO - Using model: gemini-2.5-pro
2025-12-15 11:54:44,652 - INFO - Sending prompt (length: 5665 characters)
2025-12-15 11:54:44,652 - INFO - Max output tokens: 32768
2025-12-15 11:54:44,653 - INFO - Multi-part mode: Using user's prompt as-is
2025-12-15 11:54:44,653 - INFO - Streaming disabled (force_no_streaming=True for multi-part processing)
2025-12-15 11:54:44,654 - INFO - Generating content with NON-STREAMING (large request detected to avoid rate limits)...
2025-12-15 11:56:55,761 - INFO - ✓ Request completed: 29462 characters received
2025-12-15 11:56:55,762 - INFO - Finish reason: STOP (normal completion)
2025-12-15 11:56:55,763 - INFO - ✓ Response completed normally
2025-12-15 11:56:55,767 - WARNING - Part 4, row 0: Extraction contains newlines (should use \n)
2025-12-15 11:56:55,767 - WARNING - Part 4, row 2: Extraction contains newlines (should use \n)
2025-12-15 11:56:55,768 - WARNING - Part 4, row 4: Extraction contains newlines (should use \n)
2025-12-15 11:56:55,768 - WARNING - Part 4, row 5: Extraction contains newlines (should use \n)
2025-12-15 11:56:55,769 - WARNING - Part 4, row 0: Extraction contains newlines (should use \n)
2025-12-15 11:56:55,769 - WARNING - Part 4, row 2: Extraction contains newlines (should use \n)
2025-12-15 11:56:55,769 - WARNING - Part 4, row 4: Extraction contains newlines (should use \n)
2025-12-15 11:56:55,770 - WARNING - Part 4, row 5: Extraction contains newlines (should use \n)
2025-12-15 11:56:55,770 - INFO - Part 4: Parsed successfully - is_last=False, rows=7
2025-12-15 11:56:55,773 - INFO - Part 4: Added 7 rows (total: 46)
2025-12-15 11:56:55,773 - INFO - Part 4: is_last=false, continuing to next part...
2025-12-15 11:56:55,775 - INFO - Waiting 13.1s before next part...
2025-12-15 11:57:08,919 - INFO - === Processing Part 5 ===
2025-12-15 11:57:48,936 - INFO - PDF uploaded successfully with API key: bagher
2025-12-15 11:57:48,936 - INFO - Uploaded PDF file: Bolognia 5th Edition 2024 (1)-29-6-22.pdf
2025-12-15 11:57:48,937 - INFO - Model: gemini-2.5-pro, Max tokens for model: 32768, Using: 32768
2025-12-15 11:57:48,937 - INFO - Using max_output_tokens: 32768
2025-12-15 11:57:48,938 - INFO - Using model: gemini-2.5-pro
2025-12-15 11:57:48,938 - INFO - Sending prompt (length: 5665 characters)
2025-12-15 11:57:48,939 - INFO - Max output tokens: 32768
2025-12-15 11:57:48,939 - INFO - Multi-part mode: Using user's prompt as-is
2025-12-15 11:57:48,940 - INFO - Streaming disabled (force_no_streaming=True for multi-part processing)
2025-12-15 11:57:48,940 - INFO - Generating content with NON-STREAMING (large request detected to avoid rate limits)...
2025-12-15 12:00:40,496 - INFO - ✓ Request completed: 71174 characters received
2025-12-15 12:00:40,496 - INFO - Finish reason: STOP (normal completion)
2025-12-15 12:00:40,496 - INFO - ✓ Response completed normally
2025-12-15 12:00:40,498 - WARNING - Part 5, row 0: Extraction contains newlines (should use \n)
2025-12-15 12:00:40,498 - WARNING - Part 5, row 2: Extraction contains newlines (should use \n)
2025-12-15 12:00:40,498 - WARNING - Part 5, row 7: Extraction contains newlines (should use \n)
2025-12-15 12:00:40,498 - WARNING - Part 5, row 8: Extraction contains newlines (should use \n)
2025-12-15 12:00:40,498 - WARNING - Part 5, row 10: Extraction contains newlines (should use \n)
2025-12-15 12:00:40,499 - WARNING - Part 5, row 13: Extraction contains newlines (should use \n)
2025-12-15 12:00:40,499 - WARNING - Part 5, row 15: Extraction contains newlines (should use \n)
2025-12-15 12:00:40,499 - WARNING - Part 5, row 17: Extraction contains newlines (should use \n)
2025-12-15 12:00:40,499 - WARNING - Part 5, row 19: Extraction contains newlines (should use \n)
2025-12-15 12:00:40,499 - WARNING - Part 5, row 20: Extraction contains newlines (should use \n)
2025-12-15 12:00:40,499 - WARNING - Part 5, row 22: Extraction contains newlines (should use \n)
2025-12-15 12:00:40,499 - WARNING - Part 5, row 23: Extraction contains newlines (should use \n)
2025-12-15 12:00:40,499 - WARNING - Part 5, row 0: Extraction contains newlines (should use \n)
2025-12-15 12:00:40,499 - WARNING - Part 5, row 2: Extraction contains newlines (should use \n)
2025-12-15 12:00:40,499 - WARNING - Part 5, row 7: Extraction contains newlines (should use \n)
2025-12-15 12:00:40,499 - WARNING - Part 5, row 8: Extraction contains newlines (should use \n)
2025-12-15 12:00:40,499 - WARNING - Part 5, row 10: Extraction contains newlines (should use \n)
2025-12-15 12:00:40,499 - WARNING - Part 5, row 13: Extraction contains newlines (should use \n)
2025-12-15 12:00:40,500 - WARNING - Part 5, row 15: Extraction contains newlines (should use \n)
2025-12-15 12:00:40,500 - WARNING - Part 5, row 17: Extraction contains newlines (should use \n)
2025-12-15 12:00:40,500 - WARNING - Part 5, row 19: Extraction contains newlines (should use \n)
2025-12-15 12:00:40,500 - WARNING - Part 5, row 20: Extraction contains newlines (should use \n)
2025-12-15 12:00:40,500 - WARNING - Part 5, row 22: Extraction contains newlines (should use \n)
2025-12-15 12:00:40,500 - WARNING - Part 5, row 23: Extraction contains newlines (should use \n)
2025-12-15 12:00:40,500 - INFO - Part 5: Parsed successfully - is_last=True, rows=24
2025-12-15 12:00:40,501 - INFO - Part 5: Added 24 rows (total: 70)
2025-12-15 12:00:40,501 - INFO - Part 5: is_last=true, processing complete!
2025-12-15 12:00:40,502 - INFO - === Processing Summary ===
2025-12-15 12:00:40,502 - INFO - Parts processed: 4
2025-12-15 12:00:40,502 - INFO - Total parts in final output: 4
2025-12-15 12:00:40,502 - INFO - Total rows collected: 70
2025-12-15 12:00:40,502 - INFO - Deduplicating 70 rows...
2025-12-15 12:00:40,508 - WARNING - Removed 12 duplicate rows using enhanced deduplication
2025-12-15 12:00:40,508 - INFO - Final row count after deduplication: 58
2025-12-15 12:00:40,508 - INFO - Sorting 58 rows by Number (as float)...
2025-12-15 12:00:40,508 - INFO - Rows sorted successfully
2025-12-15 12:00:40,511 - INFO - ✓ Final JSON output saved to /home/mohammadbagher/Desktop/tts app bagher/content_automation_project/Bolognia 5th Edition 2024 1-29-6-22_final_output.json
2025-12-15 12:00:40,512 - INFO -   - File path: /home/mohammadbagher/Desktop/tts app bagher/content_automation_project/Bolognia 5th Edition 2024 1-29-6-22_final_output.json
2025-12-15 12:00:40,512 - INFO -   - Total parts: 4
2025-12-15 12:00:40,512 - INFO -   - Total rows: 58
2025-12-15 12:00:40,512 - INFO -   - File size: 138.16 KB
2025-12-15 12:00:40,524 - INFO - ✓ Final CSV output saved to /home/mohammadbagher/Desktop/tts app bagher/content_automation_project/Bolognia 5th Edition 2024 1-29-6-22_final_output.csv
2025-12-15 12:00:40,524 - INFO -   - File path: /home/mohammadbagher/Desktop/tts app bagher/content_automation_project/Bolognia 5th Edition 2024 1-29-6-22_final_output.csv
2025-12-15 12:00:40,524 - INFO -   - Total rows: 58
2025-12-15 12:00:40,525 - INFO -   - File size: 133.01 KB
2025-12-15 12:21:45,352 - INFO - === Starting PDF Processing ===
2025-12-15 12:21:45,352 - INFO - Model: gemini-2.5-pro
2025-12-15 12:21:45,352 - INFO - PDF: /home/mohammadbagher/Downloads/PDFs/Bolognia 5th Edition 2024 (1)-7-26-46.pdf
2025-12-15 12:21:45,352 - INFO - Full prompt being sent (5469 chars): You are a meticulous medical OCR & structuring assistant.

Your job is to extract ONLY what is present on each provided textbook page image/PDF
and convert it into clean, AI-ready text with structured sections.

You MUST avoid hallucinations and preserve original medical meaning precisely.

====================
GLOBAL PRINCIPLES
====================
- NO HALLUCINATIONS: Output only content visible on the page(s). If unreadable/unclear, write "[UNREADABLE]" or add an "uncertain" flag with brief reason.
- LANGUAGE & SPELLING: Preserve original English spelling and medical terminology.
- CLEAN OCR:
  - Remove headers/footers and running titles.
  - Fix broken words at line breaks.
  - Replace ligatures (ﬁ, ﬂ).
  - Preserve italics (*italic*), bold (**bold**), and subscripts/superscripts via LaTeX.
- CITATIONS: Keep in-text citations verbatim.
- MATH/CHEM: Use inline LaTeX.
- NO IMAGES: Describe figures textually only; do not invent labels.

====================
CRITICAL OUTPUT CONTRACT (MULTI-PART)
====================
The full output is TOO LARGE to fit in one response.

You MUST split the final output into multiple CHUNKS.

IMPORTANT:
- A CHUNK is ONLY a technical split of the RESPONSE due to size limits.
- CHUNKS are identified ONLY by the field "chunk_index".
- CHUNKS have NOTHING to do with the medical or logical structure of the chapter.

Each response MUST:
- Output ONLY valid JSON
- Contain ONLY ONE CHUNK of the final output
- NOT repeat rows from previous chunks
- Preserve the exact order of rows across chunks

====================
OUTPUT FORMAT (EXACT)
====================
{
  "chunk_index": <integer starting from 1>,
  "is_last": <true | false>,
  "rows": [
    {
      "Type": "page text | Figure | Table",
      "Extraction": "<single-line text or JSON>",
      "Number": <page number>,
      "Part": <integer>
    }
  ]
}

====================
MEANING OF chunk_index
====================
- "chunk_index" indicates ONLY the sequential number of this RESPONSE CHUNK.
- chunk_index = 1 means: first technical chunk of the output.
- chunk_index = 2 means: second technical chunk of the output.
- chunk_index has NO semantic meaning about the chapter content.
- chunk_index MUST strictly increase by 1 across responses.

====================
MEANING OF Part (VERY IMPORTANT)
====================
- "Part" represents the LOGICAL CONTENT PART of the chapter.
- "Part" is NOT related to chunk_index.
- "Part" is the result of grouping AUTHOR PARTS into YOUR OWN PARTS ("Our parts").

How to define "Part":
1) At the beginning of the chapter, there is a "Chapter contents" section that lists
   the author-defined parts ("author parts") and their page ranges.
2) You MUST group consecutive author parts into larger groups called "Our parts".
3) Each "Our part" MUST:
   - consist of consecutive author parts
   - NOT exceed 10 pages total
4) Assign integer labels starting from 1:
   - Our part 1
   - Our part 2
   - Our part 3
   - etc.

Example:
If author parts have page counts:
2, 4, 5, 3, 1, 7, 5

Then:
- Our part 1 = author parts 1 + 2
- Our part 2 = author parts 3 + 4 + 5
- Our part 3 = author part 6
- Our part 4 = author part 7

Rules for assigning "Part" in rows:
- Every row MUST have exactly ONE integer "Part" value.
- A single page MAY belong to TWO different "Part" values if an Our part boundary
  occurs in the middle of the page.
- In such cases, split the page text into TWO separate rows:
  - one row with the previous Part
  - one row with the next Part
- NEVER mix content from two different Parts inside the same row.
====================
PAGE-BY-PAGE FORWARD-ONLY PROCESSING (CRITICAL)
====================
You MUST process the document STRICTLY page by page, in ascending page order.

- Always start from the lowest-numbered page that has NOT yet been processed.
- NEVER go back to a previous page.
- NEVER re-extract or regenerate content from any page that has already appeared
  in earlier chunks.
- Once a page (or a portion of a page) is output in any chunk, it is considered FINAL.
- Subsequent chunks MUST continue ONLY from the next unprocessed page or page segment.

Important clarifications:
- If a page is split across two different "Part" values, you may output that page
  in TWO rows, but ONLY ONCE and ONLY in forward order.
- You MUST NOT repeat a page, a paragraph, a figure, or a table that has already
  been output in any previous chunk.
- If you are unsure whether a page has already been processed, assume it HAS
  and move forward.

====================
Rules for rows
====================
- Each row represents exactly ONE of:
  - page text
  - figure
  - table
- Extraction MUST be single-line (no ENTER).
- JSON inside Extraction MUST be minified and valid.
- References section at end of chapter MUST be ignored.

====================
CHUNK INSTRUCTIONS
====================
This is CHUNK {chunk_index} of the output.

Generate ONLY the rows that belong to this CHUNK.
Stop when you reach a safe size limit for a single response.
If more content remains after this CHUNK, set:
  "is_last": false
Otherwise set:
  "is_last": true

====================
AUTHOR PARTS → OUR PARTS RULES
====================
[keep your full original rules here verbatim — unchanged]

====================
FINAL RULES
====================
- DO NOT summarize.
- DO NOT explain.
- DO NOT add commentary.
- Output ONLY the JSON object described above.

You will now receive a PDF.
Generate CHUNK {chunk_index}.
2025-12-15 12:21:45,354 - INFO - Parts directory: /home/mohammadbagher/Desktop/tts app bagher/content_automation_project/parts_Bolognia 5th Edition 2024 (1)-7-26-46.pdf_1e3d158e
2025-12-15 12:21:45,354 - INFO - Final output will be saved to current directory: /home/mohammadbagher/Desktop/tts app bagher/content_automation_project
2025-12-15 12:21:45,354 - INFO - === Processing Part 1 ===
2025-12-15 12:21:54,872 - INFO - PDF uploaded successfully with API key: bagher
2025-12-15 12:21:54,873 - INFO - Uploaded PDF file: Bolognia 5th Edition 2024 (1)-7-26-46.pdf
2025-12-15 12:21:54,875 - INFO - Model: gemini-2.5-pro, Max tokens for model: 32768, Using: 32768
2025-12-15 12:21:54,875 - INFO - Using max_output_tokens: 32768
2025-12-15 12:21:54,876 - INFO - Using model: gemini-2.5-pro
2025-12-15 12:21:54,876 - INFO - Sending prompt (length: 5582 characters)
2025-12-15 12:21:54,877 - INFO - Max output tokens: 32768
2025-12-15 12:21:54,877 - INFO - Multi-part mode: Using user's prompt as-is
2025-12-15 12:21:54,878 - INFO - Streaming disabled (force_no_streaming=True for multi-part processing)
2025-12-15 12:21:54,878 - INFO - Generating content with NON-STREAMING (large request detected to avoid rate limits)...
2025-12-15 12:23:32,129 - INFO - ✓ Request completed: 24609 characters received
2025-12-15 12:23:32,131 - INFO - Finish reason: STOP (normal completion)
2025-12-15 12:23:32,131 - INFO - ✓ Response completed normally
2025-12-15 12:23:32,134 - WARNING - Part 1, row 0: Extraction contains newlines (should use \n)
2025-12-15 12:23:32,135 - WARNING - Part 1, row 4: Extraction contains newlines (should use \n)
2025-12-15 12:23:32,135 - WARNING - Part 1, row 6: Extraction contains newlines (should use \n)
2025-12-15 12:23:32,136 - WARNING - Part 1, row 0: Extraction contains newlines (should use \n)
2025-12-15 12:23:32,137 - WARNING - Part 1, row 4: Extraction contains newlines (should use \n)
2025-12-15 12:23:32,137 - WARNING - Part 1, row 6: Extraction contains newlines (should use \n)
2025-12-15 12:23:32,137 - INFO - Part 1: Parsed successfully - is_last=False, rows=10
2025-12-15 12:23:32,140 - INFO - Part 1: Added 10 rows (total: 10)
2025-12-15 12:23:32,141 - INFO - Part 1: is_last=false, continuing to next part...
2025-12-15 12:23:32,142 - INFO - Waiting 9.1s before next part...
2025-12-15 12:23:41,246 - INFO - === Processing Part 2 ===
2025-12-15 12:23:50,605 - INFO - PDF uploaded successfully with API key: bagher
2025-12-15 12:23:50,606 - INFO - Uploaded PDF file: Bolognia 5th Edition 2024 (1)-7-26-46.pdf
2025-12-15 12:23:50,607 - INFO - Model: gemini-2.5-pro, Max tokens for model: 32768, Using: 32768
2025-12-15 12:23:50,607 - INFO - Using max_output_tokens: 32768
2025-12-15 12:23:50,608 - INFO - Using model: gemini-2.5-pro
2025-12-15 12:23:50,608 - INFO - Sending prompt (length: 5665 characters)
2025-12-15 12:23:50,609 - INFO - Max output tokens: 32768
2025-12-15 12:23:50,609 - INFO - Multi-part mode: Using user's prompt as-is
2025-12-15 12:23:50,610 - INFO - Streaming disabled (force_no_streaming=True for multi-part processing)
2025-12-15 12:23:50,610 - INFO - Generating content with NON-STREAMING (large request detected to avoid rate limits)...
2025-12-15 12:25:24,849 - INFO - ✓ Request completed: 23784 characters received
2025-12-15 12:25:24,850 - INFO - Finish reason: STOP (normal completion)
2025-12-15 12:25:24,851 - INFO - ✓ Response completed normally
2025-12-15 12:25:24,854 - WARNING - Part 2, row 2: Extraction contains newlines (should use \n)
2025-12-15 12:25:24,855 - WARNING - Part 2, row 5: Extraction contains newlines (should use \n)
2025-12-15 12:25:24,855 - WARNING - Part 2, row 9: Extraction contains newlines (should use \n)
2025-12-15 12:25:24,856 - WARNING - Part 2, row 12: Extraction contains newlines (should use \n)
2025-12-15 12:25:24,856 - WARNING - Part 2, row 14: Extraction contains newlines (should use \n)
2025-12-15 12:25:24,857 - WARNING - Part 2, row 2: Extraction contains newlines (should use \n)
2025-12-15 12:25:24,857 - WARNING - Part 2, row 5: Extraction contains newlines (should use \n)
2025-12-15 12:25:24,857 - WARNING - Part 2, row 9: Extraction contains newlines (should use \n)
2025-12-15 12:25:24,858 - WARNING - Part 2, row 12: Extraction contains newlines (should use \n)
2025-12-15 12:25:24,858 - WARNING - Part 2, row 14: Extraction contains newlines (should use \n)
2025-12-15 12:25:24,859 - INFO - Part 2: Parsed successfully - is_last=False, rows=15
2025-12-15 12:25:24,861 - INFO - Part 2: Added 15 rows (total: 25)
2025-12-15 12:25:24,862 - INFO - Part 2: is_last=false, continuing to next part...
2025-12-15 12:25:24,864 - INFO - Waiting 13.5s before next part...
2025-12-15 12:25:38,353 - INFO - === Processing Part 3 ===
2025-12-15 12:25:48,777 - INFO - PDF uploaded successfully with API key: bagher
2025-12-15 12:25:48,777 - INFO - Uploaded PDF file: Bolognia 5th Edition 2024 (1)-7-26-46.pdf
2025-12-15 12:25:48,778 - INFO - Model: gemini-2.5-pro, Max tokens for model: 32768, Using: 32768
2025-12-15 12:25:48,779 - INFO - Using max_output_tokens: 32768
2025-12-15 12:25:48,779 - INFO - Using model: gemini-2.5-pro
2025-12-15 12:25:48,781 - INFO - Sending prompt (length: 5665 characters)
2025-12-15 12:25:48,782 - INFO - Max output tokens: 32768
2025-12-15 12:25:48,783 - INFO - Multi-part mode: Using user's prompt as-is
2025-12-15 12:25:48,783 - INFO - Streaming disabled (force_no_streaming=True for multi-part processing)
2025-12-15 12:25:48,784 - INFO - Generating content with NON-STREAMING (large request detected to avoid rate limits)...
2025-12-15 12:27:40,215 - INFO - ✓ Request completed: 17510 characters received
2025-12-15 12:27:40,216 - INFO - Finish reason: STOP (normal completion)
2025-12-15 12:27:40,217 - INFO - ✓ Response completed normally
2025-12-15 12:27:40,220 - INFO - Part 3: Parsed successfully - is_last=False, rows=13
2025-12-15 12:27:40,223 - INFO - Part 3: Added 13 rows (total: 38)
2025-12-15 12:27:40,224 - INFO - Part 3: is_last=false, continuing to next part...
2025-12-15 12:27:40,225 - INFO - Waiting 10.0s before next part...
2025-12-15 12:27:50,232 - INFO - === Processing Part 4 ===
2025-12-15 12:28:00,879 - INFO - PDF uploaded successfully with API key: bagher
2025-12-15 12:28:00,880 - INFO - Uploaded PDF file: Bolognia 5th Edition 2024 (1)-7-26-46.pdf
2025-12-15 12:28:00,881 - INFO - Model: gemini-2.5-pro, Max tokens for model: 32768, Using: 32768
2025-12-15 12:28:00,882 - INFO - Using max_output_tokens: 32768
2025-12-15 12:28:00,882 - INFO - Using model: gemini-2.5-pro
2025-12-15 12:28:00,883 - INFO - Sending prompt (length: 5665 characters)
2025-12-15 12:28:00,883 - INFO - Max output tokens: 32768
2025-12-15 12:28:00,884 - INFO - Multi-part mode: Using user's prompt as-is
2025-12-15 12:28:00,884 - INFO - Streaming disabled (force_no_streaming=True for multi-part processing)
2025-12-15 12:28:00,885 - INFO - Generating content with NON-STREAMING (large request detected to avoid rate limits)...
2025-12-15 12:29:23,878 - INFO - ✓ Request completed: 20063 characters received
2025-12-15 12:29:23,879 - INFO - Finish reason: STOP (normal completion)
2025-12-15 12:29:23,880 - INFO - ✓ Response completed normally
2025-12-15 12:29:23,883 - WARNING - Part 4, row 2: Extraction contains newlines (should use \n)
2025-12-15 12:29:23,883 - WARNING - Part 4, row 3: Extraction contains newlines (should use \n)
2025-12-15 12:29:23,884 - WARNING - Part 4, row 4: Extraction contains newlines (should use \n)
2025-12-15 12:29:23,884 - WARNING - Part 4, row 5: Extraction contains newlines (should use \n)
2025-12-15 12:29:23,885 - WARNING - Part 4, row 6: Extraction contains newlines (should use \n)
2025-12-15 12:29:23,885 - WARNING - Part 4, row 7: Extraction contains newlines (should use \n)
2025-12-15 12:29:23,885 - WARNING - Part 4, row 9: Extraction contains newlines (should use \n)
2025-12-15 12:29:23,886 - WARNING - Part 4, row 10: Extraction contains newlines (should use \n)
2025-12-15 12:29:23,886 - WARNING - Part 4, row 13: Extraction contains newlines (should use \n)
2025-12-15 12:29:23,887 - WARNING - Part 4, row 14: Extraction contains newlines (should use \n)
2025-12-15 12:29:23,887 - WARNING - Part 4, row 15: Extraction contains newlines (should use \n)
2025-12-15 12:29:23,888 - WARNING - Part 4, row 16: Extraction contains newlines (should use \n)
2025-12-15 12:29:23,888 - WARNING - Part 4, row 17: Extraction contains newlines (should use \n)
2025-12-15 12:29:23,889 - WARNING - Part 4, row 2: Extraction contains newlines (should use \n)
2025-12-15 12:29:23,890 - WARNING - Part 4, row 3: Extraction contains newlines (should use \n)
2025-12-15 12:29:23,891 - WARNING - Part 4, row 4: Extraction contains newlines (should use \n)
2025-12-15 12:29:23,891 - WARNING - Part 4, row 5: Extraction contains newlines (should use \n)
2025-12-15 12:29:23,892 - WARNING - Part 4, row 6: Extraction contains newlines (should use \n)
2025-12-15 12:29:23,892 - WARNING - Part 4, row 7: Extraction contains newlines (should use \n)
2025-12-15 12:29:23,893 - WARNING - Part 4, row 9: Extraction contains newlines (should use \n)
2025-12-15 12:29:23,893 - WARNING - Part 4, row 10: Extraction contains newlines (should use \n)
2025-12-15 12:29:23,894 - WARNING - Part 4, row 13: Extraction contains newlines (should use \n)
2025-12-15 12:29:23,894 - WARNING - Part 4, row 14: Extraction contains newlines (should use \n)
2025-12-15 12:29:23,895 - WARNING - Part 4, row 15: Extraction contains newlines (should use \n)
2025-12-15 12:29:23,895 - WARNING - Part 4, row 16: Extraction contains newlines (should use \n)
2025-12-15 12:29:23,895 - WARNING - Part 4, row 17: Extraction contains newlines (should use \n)
2025-12-15 12:29:23,896 - INFO - Part 4: Parsed successfully - is_last=False, rows=18
2025-12-15 12:29:23,899 - INFO - Part 4: Added 18 rows (total: 56)
2025-12-15 12:29:23,900 - INFO - Part 4: is_last=false, continuing to next part...
2025-12-15 12:29:23,904 - INFO - Waiting 11.8s before next part...
2025-12-15 12:29:35,662 - INFO - === Processing Part 5 ===
2025-12-15 12:29:45,935 - INFO - PDF uploaded successfully with API key: bagher
2025-12-15 12:29:45,935 - INFO - Uploaded PDF file: Bolognia 5th Edition 2024 (1)-7-26-46.pdf
2025-12-15 12:29:45,936 - INFO - Model: gemini-2.5-pro, Max tokens for model: 32768, Using: 32768
2025-12-15 12:29:45,936 - INFO - Using max_output_tokens: 32768
2025-12-15 12:29:45,936 - INFO - Using model: gemini-2.5-pro
2025-12-15 12:29:45,936 - INFO - Sending prompt (length: 5665 characters)
2025-12-15 12:29:45,936 - INFO - Max output tokens: 32768
2025-12-15 12:29:45,936 - INFO - Multi-part mode: Using user's prompt as-is
2025-12-15 12:29:45,937 - INFO - Streaming disabled (force_no_streaming=True for multi-part processing)
2025-12-15 12:29:45,937 - INFO - Generating content with NON-STREAMING (large request detected to avoid rate limits)...
2025-12-15 12:30:50,771 - INFO - ✓ Request completed: 6765 characters received
2025-12-15 12:30:50,772 - INFO - Finish reason: STOP (normal completion)
2025-12-15 12:30:50,773 - INFO - ✓ Response completed normally
2025-12-15 12:30:50,775 - INFO - Part 5: Parsed successfully - is_last=True, rows=18
2025-12-15 12:30:50,777 - INFO - Part 5: Added 18 rows (total: 74)
2025-12-15 12:30:50,778 - INFO - Part 5: is_last=true, processing complete!
2025-12-15 12:30:50,780 - INFO - === Processing Summary ===
2025-12-15 12:30:50,781 - INFO - Parts processed: 4
2025-12-15 12:30:50,782 - INFO - Total parts in final output: 4
2025-12-15 12:30:50,783 - INFO - Total rows collected: 74
2025-12-15 12:30:50,783 - INFO - Deduplicating 74 rows...
2025-12-15 12:30:50,793 - INFO - Final row count after deduplication: 74
2025-12-15 12:30:50,794 - INFO - Sorting 74 rows by Number (as float)...
2025-12-15 12:30:50,795 - INFO - Rows sorted successfully
2025-12-15 12:30:50,802 - INFO - ✓ Final JSON output saved to /home/mohammadbagher/Desktop/tts app bagher/content_automation_project/Bolognia 5th Edition 2024 1-7-26-46_final_output.json
2025-12-15 12:30:50,803 - INFO -   - File path: /home/mohammadbagher/Desktop/tts app bagher/content_automation_project/Bolognia 5th Edition 2024 1-7-26-46_final_output.json
2025-12-15 12:30:50,803 - INFO -   - Total parts: 4
2025-12-15 12:30:50,803 - INFO -   - Total rows: 74
2025-12-15 12:30:50,803 - INFO -   - File size: 91.28 KB
2025-12-15 12:30:50,812 - INFO - ✓ Final CSV output saved to /home/mohammadbagher/Desktop/tts app bagher/content_automation_project/Bolognia 5th Edition 2024 1-7-26-46_final_output.csv
2025-12-15 12:30:50,813 - INFO -   - File path: /home/mohammadbagher/Desktop/tts app bagher/content_automation_project/Bolognia 5th Edition 2024 1-7-26-46_final_output.csv
2025-12-15 12:30:50,813 - INFO -   - Total rows: 74
2025-12-15 12:30:50,813 - INFO -   - File size: 85.01 KB
2025-12-15 12:39:09,132 - INFO - === Starting PDF Processing ===
2025-12-15 12:39:09,132 - INFO - Model: gemini-2.5-pro
2025-12-15 12:39:09,133 - INFO - PDF: /home/mohammadbagher/Downloads/PDFs/Bolognia 5th Edition 2024 (1)-7-26-46.pdf
2025-12-15 12:39:09,133 - INFO - Full prompt being sent (5009 chars): You are a meticulous medical OCR & structuring assistant.

Your job is to extract ONLY what is present on each provided textbook page image/PDF
and convert it into clean, AI-ready text with structured sections.

You MUST avoid hallucinations and preserve original medical meaning precisely.

====================
GLOBAL PRINCIPLES
====================
- NO HALLUCINATIONS: Output only content visible on the page(s). If unreadable/unclear, write "[UNREADABLE]" or add an "uncertain" flag with brief reason.
- LANGUAGE & SPELLING: Preserve original English spelling and medical terminology.
- CLEAN OCR:
  - Remove headers/footers and running titles.
  - Fix broken words at line breaks.
  - Replace ligatures (ﬁ, ﬂ).
  - Preserve italics (*italic*), bold (**bold**), and subscripts/superscripts via LaTeX.
- CITATIONS: Keep in-text citations verbatim.
- MATH/CHEM: Use inline LaTeX.
- NO IMAGES: Describe figures textually only; do not invent labels.

====================
CRITICAL OUTPUT CONTRACT (MULTI-PART)
====================
The full output is TOO LARGE to fit in one response.

You MUST split the final output into multiple CHUNKS.

IMPORTANT:
- A CHUNK is ONLY a technical split of the RESPONSE due to size limits.
- CHUNKS are identified ONLY by the field "chunk_index".
- CHUNKS have NOTHING to do with the medical or logical structure of the chapter.

Each response MUST:
- Output ONLY valid JSON
- Contain ONLY ONE CHUNK of the final output
- NOT repeat rows from previous chunks
- Preserve the exact order of rows across chunks

====================
OUTPUT FORMAT (EXACT)
====================
{
  "chunk_index": <integer starting from 1>,
  "is_last": <true | false>,
  "rows": [
    {
      "Type": "page text | Figure | Table",
      "Extraction": "<single-line text or JSON>",
      "Number": <page number>,
      "Part": <integer>
    }
  ]
}

====================
MEANING OF chunk_index
====================
- "chunk_index" indicates ONLY the sequential number of this RESPONSE CHUNK.
- chunk_index = 1 means: first technical chunk of the output.
- chunk_index = 2 means: second technical chunk of the output.
- chunk_index has NO semantic meaning about the chapter content.
- chunk_index MUST strictly increase by 1 across responses.

====================
MEANING OF Part (VERY IMPORTANT)
====================
- "Part" represents the LOGICAL CONTENT PART of the chapter.
- "Part" is NOT related to chunk_index.
- "Part" is the result of grouping AUTHOR PARTS into YOUR OWN PARTS ("Our parts").

How to define "Part":
1) At the beginning of the chapter, there is a "Chapter contents" section that lists
   the author-defined parts ("author parts") and their page ranges.
2) You MUST group consecutive author parts into larger groups called "Our parts".
3) Each "Our part" MUST:
   - consist of consecutive author parts
   - NOT exceed 10 pages total
4) Assign integer labels starting from 1:
   - Our part 1
   - Our part 2
   - Our part 3
   - etc.

Example:
If author parts have page counts:
2, 4, 5, 3, 1, 7, 5

Then:
- Our part 1 = author parts 1 + 2
- Our part 2 = author parts 3 + 4 + 5
- Our part 3 = author part 6
- Our part 4 = author part 7

Rules for assigning "Part" in rows:
- Every row MUST have exactly ONE integer "Part" value.
- A single page MAY belong to TWO different "Part" values if an Our part boundary
  occurs in the middle of the page.
- In such cases, split the page text into TWO separate rows:
  - one row with the previous Part
  - one row with the next Part
- NEVER mix content from two different Parts inside the same row.
====================
PAGE-BY-PAGE FORWARD-ONLY PROCESSING (CRITICAL)
====================
You MUST process the document STRICTLY page by page, in ascending page order.
- NEVER go back to a previous page.
- NEVER re-extract or regenerate content from any page that has already appeared
  in earlier chunks.
- Once a page (or a portion of a page) is output in any chunk, it is considered FINAL.
- Subsequent chunks MUST continue ONLY from the next unprocessed page or page segment.
====================
Rules for rows
====================
- Each row represents exactly ONE of:
  - page text
  - figure
  - table
- Extraction MUST be single-line (no ENTER).
- JSON inside Extraction MUST be minified and valid.
- References section at end of chapter MUST be ignored.

====================
CHUNK INSTRUCTIONS
====================
This is CHUNK {chunk_index} of the output.

Generate ONLY the rows that belong to this CHUNK.
Stop when you reach a safe size limit for a single response.
If more content remains after this CHUNK, set:
  "is_last": false
Otherwise set:
  "is_last": true

====================
AUTHOR PARTS → OUR PARTS RULES
====================
[keep your full original rules here verbatim — unchanged]

====================
FINAL RULES
====================
- DO NOT summarize.
- DO NOT explain.
- DO NOT add commentary.
- Output ONLY the JSON object described above.

You will now receive a PDF.
Generate CHUNK {chunk_index}.
2025-12-15 12:39:09,134 - INFO - Parts directory: /home/mohammadbagher/Desktop/tts app bagher/content_automation_project/parts_Bolognia 5th Edition 2024 (1)-7-26-46.pdf_012f30bc
2025-12-15 12:39:09,134 - INFO - Final output will be saved to current directory: /home/mohammadbagher/Desktop/tts app bagher/content_automation_project
2025-12-15 12:39:09,135 - INFO - === Processing Part 1 ===
2025-12-15 12:39:18,265 - INFO - PDF uploaded successfully with API key: bagher
2025-12-15 12:39:18,265 - INFO - Uploaded PDF file: Bolognia 5th Edition 2024 (1)-7-26-46.pdf
2025-12-15 12:39:18,266 - INFO - Model: gemini-2.5-pro, Max tokens for model: 32768, Using: 32768
2025-12-15 12:39:18,266 - INFO - Using max_output_tokens: 32768
2025-12-15 12:39:18,266 - INFO - Using model: gemini-2.5-pro
2025-12-15 12:39:18,266 - INFO - Sending prompt (length: 5122 characters)
2025-12-15 12:39:18,267 - INFO - Max output tokens: 32768
2025-12-15 12:39:18,267 - INFO - Multi-part mode: Using user's prompt as-is
2025-12-15 12:39:18,267 - INFO - Streaming disabled (force_no_streaming=True for multi-part processing)
2025-12-15 12:39:18,267 - INFO - Generating content with NON-STREAMING (large request detected to avoid rate limits)...
2025-12-15 12:40:43,242 - INFO - ✓ Request completed: 27722 characters received
2025-12-15 12:40:43,243 - INFO - Finish reason: STOP (normal completion)
2025-12-15 12:40:43,243 - INFO - ✓ Response completed normally
2025-12-15 12:40:43,244 - WARNING - Part 1, row 0: Extraction contains newlines (should use \n)
2025-12-15 12:40:43,244 - WARNING - Part 1, row 1: Extraction contains newlines (should use \n)
2025-12-15 12:40:43,244 - WARNING - Part 1, row 2: Extraction contains newlines (should use \n)
2025-12-15 12:40:43,244 - WARNING - Part 1, row 3: Extraction contains newlines (should use \n)
2025-12-15 12:40:43,244 - WARNING - Part 1, row 4: Extraction contains newlines (should use \n)
2025-12-15 12:40:43,244 - WARNING - Part 1, row 5: Extraction contains newlines (should use \n)
2025-12-15 12:40:43,245 - WARNING - Part 1, row 9: Extraction contains newlines (should use \n)
2025-12-15 12:40:43,245 - WARNING - Part 1, row 14: Extraction contains newlines (should use \n)
2025-12-15 12:40:43,245 - WARNING - Part 1, row 17: Extraction contains newlines (should use \n)
2025-12-15 12:40:43,245 - WARNING - Part 1, row 0: Extraction contains newlines (should use \n)
2025-12-15 12:40:43,245 - WARNING - Part 1, row 1: Extraction contains newlines (should use \n)
2025-12-15 12:40:43,245 - WARNING - Part 1, row 2: Extraction contains newlines (should use \n)
2025-12-15 12:40:43,245 - WARNING - Part 1, row 3: Extraction contains newlines (should use \n)
2025-12-15 12:40:43,245 - WARNING - Part 1, row 4: Extraction contains newlines (should use \n)
2025-12-15 12:40:43,245 - WARNING - Part 1, row 5: Extraction contains newlines (should use \n)
2025-12-15 12:40:43,245 - WARNING - Part 1, row 9: Extraction contains newlines (should use \n)
2025-12-15 12:40:43,245 - WARNING - Part 1, row 14: Extraction contains newlines (should use \n)
2025-12-15 12:40:43,245 - WARNING - Part 1, row 17: Extraction contains newlines (should use \n)
2025-12-15 12:40:43,245 - INFO - Part 1: Parsed successfully - is_last=False, rows=18
2025-12-15 12:40:43,246 - INFO - Part 1: Added 18 rows (total: 18)
2025-12-15 12:40:43,246 - INFO - Part 1: is_last=false, continuing to next part...
2025-12-15 12:40:43,247 - INFO - Waiting 8.6s before next part...
2025-12-15 12:40:51,862 - INFO - === Processing Part 2 ===
2025-12-15 12:41:01,509 - INFO - PDF uploaded successfully with API key: bagher
2025-12-15 12:41:01,509 - INFO - Uploaded PDF file: Bolognia 5th Edition 2024 (1)-7-26-46.pdf
2025-12-15 12:41:01,509 - INFO - Model: gemini-2.5-pro, Max tokens for model: 32768, Using: 32768
2025-12-15 12:41:01,510 - INFO - Using max_output_tokens: 32768
2025-12-15 12:41:01,510 - INFO - Using model: gemini-2.5-pro
2025-12-15 12:41:01,510 - INFO - Sending prompt (length: 5205 characters)
2025-12-15 12:41:01,510 - INFO - Max output tokens: 32768
2025-12-15 12:41:01,510 - INFO - Multi-part mode: Using user's prompt as-is
2025-12-15 12:41:01,510 - INFO - Streaming disabled (force_no_streaming=True for multi-part processing)
2025-12-15 12:41:01,510 - INFO - Generating content with NON-STREAMING (large request detected to avoid rate limits)...
2025-12-15 12:42:18,900 - INFO - ✓ Request completed: 22776 characters received
2025-12-15 12:42:18,903 - INFO - Finish reason: STOP (normal completion)
2025-12-15 12:42:18,905 - INFO - ✓ Response completed normally
2025-12-15 12:42:18,909 - WARNING - Part 2, row 0: Extraction contains newlines (should use \n)
2025-12-15 12:42:18,910 - WARNING - Part 2, row 2: Extraction contains newlines (should use \n)
2025-12-15 12:42:18,910 - WARNING - Part 2, row 6: Extraction contains newlines (should use \n)
2025-12-15 12:42:18,912 - WARNING - Part 2, row 9: Extraction contains newlines (should use \n)
2025-12-15 12:42:18,912 - WARNING - Part 2, row 12: Extraction contains newlines (should use \n)
2025-12-15 12:42:18,913 - WARNING - Part 2, row 0: Extraction contains newlines (should use \n)
2025-12-15 12:42:18,913 - WARNING - Part 2, row 2: Extraction contains newlines (should use \n)
2025-12-15 12:42:18,914 - WARNING - Part 2, row 6: Extraction contains newlines (should use \n)
2025-12-15 12:42:18,914 - WARNING - Part 2, row 9: Extraction contains newlines (should use \n)
2025-12-15 12:42:18,915 - WARNING - Part 2, row 12: Extraction contains newlines (should use \n)
2025-12-15 12:42:18,916 - INFO - Part 2: Parsed successfully - is_last=False, rows=16
2025-12-15 12:42:18,919 - INFO - Part 2: Added 16 rows (total: 34)
2025-12-15 12:42:18,920 - INFO - Part 2: is_last=false, continuing to next part...
2025-12-15 12:42:18,921 - INFO - Waiting 10.4s before next part...
2025-12-15 12:42:29,304 - INFO - === Processing Part 3 ===
2025-12-15 12:42:38,693 - INFO - PDF uploaded successfully with API key: bagher
2025-12-15 12:42:38,694 - INFO - Uploaded PDF file: Bolognia 5th Edition 2024 (1)-7-26-46.pdf
2025-12-15 12:42:38,695 - INFO - Model: gemini-2.5-pro, Max tokens for model: 32768, Using: 32768
2025-12-15 12:42:38,696 - INFO - Using max_output_tokens: 32768
2025-12-15 12:42:38,696 - INFO - Using model: gemini-2.5-pro
2025-12-15 12:42:38,697 - INFO - Sending prompt (length: 5205 characters)
2025-12-15 12:42:38,697 - INFO - Max output tokens: 32768
2025-12-15 12:42:38,698 - INFO - Multi-part mode: Using user's prompt as-is
2025-12-15 12:42:38,698 - INFO - Streaming disabled (force_no_streaming=True for multi-part processing)
2025-12-15 12:42:38,699 - INFO - Generating content with NON-STREAMING (large request detected to avoid rate limits)...
2025-12-15 12:43:55,980 - INFO - ✓ Request completed: 23834 characters received
2025-12-15 12:43:55,982 - INFO - Finish reason: STOP (normal completion)
2025-12-15 12:43:55,982 - INFO - ✓ Response completed normally
2025-12-15 12:43:55,986 - WARNING - Part 3, row 2: Extraction contains newlines (should use \n)
2025-12-15 12:43:55,986 - WARNING - Part 3, row 5: Extraction contains newlines (should use \n)
2025-12-15 12:43:55,987 - WARNING - Part 3, row 9: Extraction contains newlines (should use \n)
2025-12-15 12:43:55,987 - WARNING - Part 3, row 12: Extraction contains newlines (should use \n)
2025-12-15 12:43:55,988 - WARNING - Part 3, row 14: Extraction contains newlines (should use \n)
2025-12-15 12:43:55,988 - WARNING - Part 3, row 2: Extraction contains newlines (should use \n)
2025-12-15 12:43:55,989 - WARNING - Part 3, row 5: Extraction contains newlines (should use \n)
2025-12-15 12:43:55,990 - WARNING - Part 3, row 9: Extraction contains newlines (should use \n)
2025-12-15 12:43:55,990 - WARNING - Part 3, row 12: Extraction contains newlines (should use \n)
2025-12-15 12:43:55,992 - WARNING - Part 3, row 14: Extraction contains newlines (should use \n)
2025-12-15 12:43:55,992 - INFO - Part 3: Parsed successfully - is_last=False, rows=15
2025-12-15 12:43:55,995 - INFO - Part 3: Added 15 rows (total: 49)
2025-12-15 12:43:55,995 - INFO - Part 3: is_last=false, continuing to next part...
2025-12-15 12:43:55,997 - INFO - Waiting 12.9s before next part...
2025-12-15 12:44:08,849 - INFO - === Processing Part 4 ===
2025-12-15 12:44:22,609 - INFO - PDF uploaded successfully with API key: bagher
2025-12-15 12:44:22,609 - INFO - Uploaded PDF file: Bolognia 5th Edition 2024 (1)-7-26-46.pdf
2025-12-15 12:44:22,610 - INFO - Model: gemini-2.5-pro, Max tokens for model: 32768, Using: 32768
2025-12-15 12:44:22,611 - INFO - Using max_output_tokens: 32768
2025-12-15 12:44:22,612 - INFO - Using model: gemini-2.5-pro
2025-12-15 12:44:22,613 - INFO - Sending prompt (length: 5205 characters)
2025-12-15 12:44:22,613 - INFO - Max output tokens: 32768
2025-12-15 12:44:22,614 - INFO - Multi-part mode: Using user's prompt as-is
2025-12-15 12:44:22,614 - INFO - Streaming disabled (force_no_streaming=True for multi-part processing)
2025-12-15 12:44:22,615 - INFO - Generating content with NON-STREAMING (large request detected to avoid rate limits)...
2025-12-15 12:46:04,327 - INFO - ✓ Request completed: 34231 characters received
2025-12-15 12:46:04,328 - INFO - Finish reason: STOP (normal completion)
2025-12-15 12:46:04,329 - INFO - ✓ Response completed normally
2025-12-15 12:46:04,332 - WARNING - Part 4, row 2: Extraction contains newlines (should use \n)
2025-12-15 12:46:04,333 - WARNING - Part 4, row 3: Extraction contains newlines (should use \n)
2025-12-15 12:46:04,333 - WARNING - Part 4, row 4: Extraction contains newlines (should use \n)
2025-12-15 12:46:04,334 - WARNING - Part 4, row 5: Extraction contains newlines (should use \n)
2025-12-15 12:46:04,334 - WARNING - Part 4, row 7: Extraction contains newlines (should use \n)
2025-12-15 12:46:04,334 - WARNING - Part 4, row 10: Extraction contains newlines (should use \n)
2025-12-15 12:46:04,335 - WARNING - Part 4, row 12: Extraction contains newlines (should use \n)
2025-12-15 12:46:04,335 - WARNING - Part 4, row 13: Extraction contains newlines (should use \n)
2025-12-15 12:46:04,336 - WARNING - Part 4, row 14: Extraction contains newlines (should use \n)
2025-12-15 12:46:04,337 - WARNING - Part 4, row 15: Extraction contains newlines (should use \n)
2025-12-15 12:46:04,337 - WARNING - Part 4, row 16: Extraction contains newlines (should use \n)
2025-12-15 12:46:04,337 - WARNING - Part 4, row 2: Extraction contains newlines (should use \n)
2025-12-15 12:46:04,338 - WARNING - Part 4, row 3: Extraction contains newlines (should use \n)
2025-12-15 12:46:04,339 - WARNING - Part 4, row 4: Extraction contains newlines (should use \n)
2025-12-15 12:46:04,339 - WARNING - Part 4, row 5: Extraction contains newlines (should use \n)
2025-12-15 12:46:04,339 - WARNING - Part 4, row 7: Extraction contains newlines (should use \n)
2025-12-15 12:46:04,340 - WARNING - Part 4, row 10: Extraction contains newlines (should use \n)
2025-12-15 12:46:04,340 - WARNING - Part 4, row 12: Extraction contains newlines (should use \n)
2025-12-15 12:46:04,341 - WARNING - Part 4, row 13: Extraction contains newlines (should use \n)
2025-12-15 12:46:04,341 - WARNING - Part 4, row 14: Extraction contains newlines (should use \n)
2025-12-15 12:46:04,341 - WARNING - Part 4, row 15: Extraction contains newlines (should use \n)
2025-12-15 12:46:04,342 - WARNING - Part 4, row 16: Extraction contains newlines (should use \n)
2025-12-15 12:46:04,342 - INFO - Part 4: Parsed successfully - is_last=False, rows=17
2025-12-15 12:46:04,344 - INFO - Part 4: Added 17 rows (total: 66)
2025-12-15 12:46:04,345 - INFO - Part 4: is_last=false, continuing to next part...
2025-12-15 12:46:04,346 - INFO - Waiting 8.6s before next part...
2025-12-15 12:46:12,985 - INFO - === Processing Part 5 ===
2025-12-15 12:46:21,478 - INFO - PDF uploaded successfully with API key: bagher
2025-12-15 12:46:21,478 - INFO - Uploaded PDF file: Bolognia 5th Edition 2024 (1)-7-26-46.pdf
2025-12-15 12:46:21,479 - INFO - Model: gemini-2.5-pro, Max tokens for model: 32768, Using: 32768
2025-12-15 12:46:21,480 - INFO - Using max_output_tokens: 32768
2025-12-15 12:46:21,480 - INFO - Using model: gemini-2.5-pro
2025-12-15 12:46:21,481 - INFO - Sending prompt (length: 5205 characters)
2025-12-15 12:46:21,481 - INFO - Max output tokens: 32768
2025-12-15 12:46:21,482 - INFO - Multi-part mode: Using user's prompt as-is
2025-12-15 12:46:21,482 - INFO - Streaming disabled (force_no_streaming=True for multi-part processing)
2025-12-15 12:46:21,483 - INFO - Generating content with NON-STREAMING (large request detected to avoid rate limits)...
2025-12-15 12:47:36,031 - INFO - ✓ Request completed: 15729 characters received
2025-12-15 12:47:36,032 - INFO - Finish reason: STOP (normal completion)
2025-12-15 12:47:36,033 - INFO - ✓ Response completed normally
2025-12-15 12:47:36,037 - WARNING - Part 5, row 3: Extraction contains newlines (should use \n)
2025-12-15 12:47:36,038 - WARNING - Part 5, row 4: Extraction contains newlines (should use \n)
2025-12-15 12:47:36,038 - WARNING - Part 5, row 5: Extraction contains newlines (should use \n)
2025-12-15 12:47:36,039 - WARNING - Part 5, row 3: Extraction contains newlines (should use \n)
2025-12-15 12:47:36,039 - WARNING - Part 5, row 4: Extraction contains newlines (should use \n)
2025-12-15 12:47:36,040 - WARNING - Part 5, row 5: Extraction contains newlines (should use \n)
2025-12-15 12:47:36,040 - INFO - Part 5: Parsed successfully - is_last=True, rows=24
2025-12-15 12:47:36,043 - INFO - Part 5: Added 24 rows (total: 90)
2025-12-15 12:47:36,044 - INFO - Part 5: is_last=true, processing complete!
2025-12-15 12:47:36,045 - INFO - === Processing Summary ===
2025-12-15 12:47:36,046 - INFO - Parts processed: 4
2025-12-15 12:47:36,046 - INFO - Total parts in final output: 4
2025-12-15 12:47:36,047 - INFO - Total rows collected: 90
2025-12-15 12:47:36,048 - INFO - Deduplicating 90 rows...
2025-12-15 12:47:36,066 - WARNING - Removed 1 duplicate rows using enhanced deduplication
2025-12-15 12:47:36,069 - INFO - Final row count after deduplication: 89
2025-12-15 12:47:36,070 - INFO - Sorting 89 rows by Number (as float)...
2025-12-15 12:47:36,071 - INFO - Rows sorted successfully
2025-12-15 12:47:36,091 - INFO - ✓ Final JSON output saved to /home/mohammadbagher/Desktop/tts app bagher/content_automation_project/Bolognia 5th Edition 2024 1-7-26-46_final_output.json
2025-12-15 12:47:36,092 - INFO -   - File path: /home/mohammadbagher/Desktop/tts app bagher/content_automation_project/Bolognia 5th Edition 2024 1-7-26-46_final_output.json
2025-12-15 12:47:36,092 - INFO -   - Total parts: 4
2025-12-15 12:47:36,095 - INFO -   - Total rows: 89
2025-12-15 12:47:36,096 - INFO -   - File size: 118.96 KB
2025-12-15 12:47:36,110 - INFO - ✓ Final CSV output saved to /home/mohammadbagher/Desktop/tts app bagher/content_automation_project/Bolognia 5th Edition 2024 1-7-26-46_final_output.csv
2025-12-15 12:47:36,111 - INFO -   - File path: /home/mohammadbagher/Desktop/tts app bagher/content_automation_project/Bolognia 5th Edition 2024 1-7-26-46_final_output.csv
2025-12-15 12:47:36,111 - INFO -   - Total rows: 89
2025-12-15 12:47:36,111 - INFO -   - File size: 111.25 KB
2025-12-15 13:49:41,853 - INFO - Loaded 6 predefined prompts
2025-12-15 13:50:46,663 - INFO - Processing Part 1 with second-stage prompt...
2025-12-15 13:50:46,664 - ERROR - No API key available
2025-12-15 13:50:46,664 - ERROR - No response for Part 1, aborting post-process
2025-12-15 13:52:06,504 - INFO - Loaded 3 API keys
2025-12-15 13:53:01,654 - INFO - Processing Part 1 with second-stage prompt...
2025-12-15 13:54:23,272 - INFO - Text processed successfully with gemini-2.5-flash
2025-12-15 13:54:23,276 - ERROR - Failed to parse JSON response in post-processor
2025-12-15 13:54:23,277 - ERROR - Failed to parse JSON for Part 1, aborting
2025-12-15 13:58:39,337 - INFO - Processing Part 1 with second-stage prompt...
2025-12-15 14:00:04,572 - INFO - Text processed successfully with gemini-2.5-pro
2025-12-15 14:00:04,573 - ERROR - Failed to parse JSON response in post-processor
2025-12-15 14:00:04,575 - ERROR - Failed to parse JSON for Part 1, aborting
2025-12-15 14:00:58,266 - INFO - Loaded 6 predefined prompts
2025-12-15 14:01:21,500 - INFO - Loaded 3 API keys
2025-12-15 14:02:54,425 - INFO - Processing Part 1 with second-stage prompt...
2025-12-15 14:03:04,542 - INFO - Processing Part 1 with second-stage prompt...
2025-12-15 14:04:28,173 - INFO - Text processed successfully with gemini-2.5-pro
2025-12-15 14:04:28,179 - INFO - Processing Part 2 with second-stage prompt...
2025-12-15 14:05:07,354 - INFO - Text processed successfully with gemini-2.5-pro
2025-12-15 14:05:07,359 - INFO - Processing Part 2 with second-stage prompt...
2025-12-15 14:06:21,765 - INFO - Text processed successfully with gemini-2.5-pro
2025-12-15 14:06:21,770 - INFO - Processing Part 3 with second-stage prompt...
2025-12-15 14:07:13,355 - INFO - Text processed successfully with gemini-2.5-pro
2025-12-15 14:07:13,355 - ERROR - Failed to parse JSON response in post-processor
2025-12-15 14:07:13,355 - ERROR - Failed to parse JSON for Part 2, aborting
2025-12-15 14:07:46,110 - INFO - Text processed successfully with gemini-2.5-pro
2025-12-15 14:07:46,125 - INFO - Post-processed JSON saved to: /home/mohammadbagher/Desktop/tts app bagher/content_automation_project/Bolognia 5th Edition 2024 1-7-26-46_final_output_post_processed.json
2025-12-15 14:20:30,838 - INFO - Loaded 6 predefined prompts
2025-12-15 14:22:43,650 - INFO - Loaded 3 API keys
2025-12-15 14:23:48,849 - INFO - Processing Part 1 with second-stage prompt...
2025-12-15 14:25:44,731 - INFO - Text processed successfully with gemini-2.5-pro
2025-12-15 14:25:44,736 - INFO - Processing Part 2 with second-stage prompt...
2025-12-15 14:27:26,765 - INFO - Text processed successfully with gemini-2.5-pro
2025-12-15 14:27:26,768 - INFO - Processing Part 3 with second-stage prompt...
2025-12-15 14:27:27,340 - ERROR - Text processing failed: 429 Resource has been exhausted (e.g. check quota).
2025-12-15 14:27:27,342 - ERROR - No response for Part 3, aborting post-process
2025-12-15 14:30:09,494 - INFO - === Starting PDF Processing ===
2025-12-15 14:30:09,495 - INFO - Model: gemini-2.5-pro
2025-12-15 14:30:09,496 - INFO - PDF: /home/mohammadbagher/Downloads/PDFs/Bolognia 5th Edition 2024 (1)-7-26-46.pdf
2025-12-15 14:30:09,496 - INFO - Full prompt being sent (6000 chars): You are a meticulous medical OCR & structuring assistant.

Your job is to extract ONLY what is present on each provided textbook page image/PDF
and convert it into clean, AI-ready text with structured sections.

You MUST avoid hallucinations and preserve original medical meaning precisely.

====================
GLOBAL PRINCIPLES
====================
- NO HALLUCINATIONS: Output only content visible on the page(s). If unreadable/unclear, write "[UNREADABLE]" or add an "uncertain" flag with brief reason.
- LANGUAGE & SPELLING: Preserve original English spelling and medical terminology.
- CLEAN OCR:
  - Remove headers/footers and running titles.
  - Fix broken words at line breaks.
  - Replace ligatures (ﬁ, ﬂ).
  - Preserve italics (*italic*), bold (**bold**), and subscripts/superscripts via LaTeX.
- CITATIONS: Keep in-text citations verbatim.
- MATH/CHEM: Use inline LaTeX.
- NO IMAGES: Describe figures textually only; do not invent labels.

====================
CRITICAL OUTPUT CONTRACT (MULTI-PART)
====================
The full output is TOO LARGE to fit in one response.

You MUST split the final output into multiple CHUNKS.

IMPORTANT:
- A CHUNK is ONLY a technical split of the RESPONSE due to size limits.
- CHUNKS are identified ONLY by the field "chunk_index".
- CHUNKS have NOTHING to do with the medical or logical structure of the chapter.

Each response MUST:
- Output ONLY valid JSON
- Contain ONLY ONE CHUNK of the final output
- NOT repeat rows from previous chunks
- Preserve the exact order of rows across chunks

====================
OUTPUT FORMAT (EXACT)
====================
{
  "chunk_index": <integer starting from 1>,
  "is_last": <true | false>,
  "rows": [
    {
      "Type": "page text | Figure | Table",
      "Extraction": "<single-line text or JSON>",
      "Number": <page number>,
      "Part": <integer>
    }
  ]
}

====================
MEANING OF chunk_index
====================
- "chunk_index" indicates ONLY the sequential number of this RESPONSE CHUNK.
- chunk_index = 1 means: first technical chunk of the output.
- chunk_index = 2 means: second technical chunk of the output.
- chunk_index has NO semantic meaning about the chapter content.
- chunk_index MUST strictly increase by 1 across responses.

====================
MEANING OF Part (VERY IMPORTANT)
====================
- "Part" represents the LOGICAL CONTENT PART of the chapter.
- "Part" is NOT related to chunk_index.
- "Part" is the result of grouping AUTHOR PARTS into YOUR OWN PARTS ("Our parts").

How to define "Part":
1) At the beginning of the chapter, there is a "Chapter contents" section that lists
   the author-defined parts ("author parts") and their first page.
2) You MUST group consecutive author parts into larger groups called "Our parts".
3) Each "Our part" MUST:
   - consist of consecutive author parts
   - NOT exceed 10 pages total
4) Assign integer labels starting from 1:
   - Our part 1
   - Our part 2
   - Our part 3
   - etc.

Example:
If author parts have page counts:
2, 4, 5, 3, 1, 7, 5

Then:
- Our part 1 = author parts 1 + 2 (in this example it is wrong to add the third author part because this way the first our part will be 11 pages which is more than 10 pages.)
- Our part 2 = author parts 3 + 4 + 5 (it is correct because they are 9 pages together which is less than 10 pages.)
- Our part 3 = author part 6
- Our part 4 = author part 7

Rules for assigning "Part" in rows:
- Every row MUST have exactly ONE integer "Part" value.
- A single page MAY belong to TWO different "Part" values if an Our part boundary
  occurs in the middle of the page.
- In such cases, split the page text into TWO separate rows:
  - one row with the previous Part value
  - one row with the next Part value
- NEVER mix content from two different Parts inside the same row.
- NEVER change Part value before an author part ends.
====================
PAGE-BY-PAGE FORWARD-ONLY PROCESSING (CRITICAL)
====================
You MUST process the document STRICTLY page by page, in ascending page order.
- NEVER go back to a previous page.
- NEVER re-extract or regenerate content from any page that has already appeared
  in earlier chunks.
- Once a page (or a portion of a page) is output in any chunk, it is considered FINAL.
- Subsequent chunks MUST continue ONLY from the next unprocessed page or page segment.
====================
Rules for rows
====================
- Each row represents exactly ONE of:
  - page text
  - figure
  - table
- Extraction MUST be single-line (no ENTER).
- JSON inside Extraction MUST be minified and valid.
- References section at end of chapter MUST be ignored.
====================
Rules for eFig and eTable
====================
- eFigs and eTables are some contents added after the chapter ends. They are not necessarily related contextually to the last our part. They can be related each of the previous our parts.
- you must find that each eFig and eTable belongs to which one of the our parts. 
- so when you are working on each chunk you must also check and find and include the eFigs and eTables that are related contextually to this chunk. Write the correct our part value for each eFig and eTable.
  


====================
CHUNK INSTRUCTIONS
====================
This is CHUNK {chunk_index} of the output.

Generate ONLY the rows that belong to this CHUNK.
Stop when you reach a safe size limit for a single response.
If more content remains after this CHUNK, set:
  "is_last": false
Otherwise set:
  "is_last": true

====================
AUTHOR PARTS → OUR PARTS RULES
====================
[keep your full original rules here verbatim — unchanged]

====================
FINAL RULES
====================
- DO NOT summarize.
- DO NOT explain.
- DO NOT add commentary.
- Output ONLY the JSON object described above.

You will now receive a PDF.
Generate CHUNK {chunk_index}.
2025-12-15 14:30:09,505 - INFO - Parts directory: /home/mohammadbagher/Desktop/tts app bagher/content_automation_project/parts_Bolognia 5th Edition 2024 (1)-7-26-46.pdf_e5082c0d
2025-12-15 14:30:09,507 - INFO - Final output will be saved to current directory: /home/mohammadbagher/Desktop/tts app bagher/content_automation_project
2025-12-15 14:30:09,508 - INFO - === Processing Part 1 ===
2025-12-15 14:30:23,936 - INFO - PDF uploaded successfully with API key: bagher
2025-12-15 14:30:23,936 - INFO - Uploaded PDF file: Bolognia 5th Edition 2024 (1)-7-26-46.pdf
2025-12-15 14:30:23,937 - INFO - Model: gemini-2.5-pro, Max tokens for model: 32768, Using: 32768
2025-12-15 14:30:23,937 - INFO - Using max_output_tokens: 32768
2025-12-15 14:30:23,938 - INFO - Using model: gemini-2.5-pro
2025-12-15 14:30:23,938 - INFO - Sending prompt (length: 6113 characters)
2025-12-15 14:30:23,938 - INFO - Max output tokens: 32768
2025-12-15 14:30:23,939 - INFO - Multi-part mode: Using user's prompt as-is
2025-12-15 14:30:23,939 - INFO - Streaming disabled (force_no_streaming=True for multi-part processing)
2025-12-15 14:30:23,940 - INFO - Generating content with NON-STREAMING (large request detected to avoid rate limits)...
2025-12-15 14:30:25,674 - ERROR - ================================================================================
2025-12-15 14:30:25,674 - ERROR - 🔴 RATE LIMIT ERROR (429) - COMPLETE DETAILS
2025-12-15 14:30:25,675 - ERROR - ================================================================================
2025-12-15 14:30:25,675 - ERROR - Error Type: ResourceExhausted
2025-12-15 14:30:25,676 - ERROR - Status Code: 429
2025-12-15 14:30:25,676 - ERROR - Error Message: 429 Resource has been exhausted (e.g. check quota).
2025-12-15 14:30:25,677 - ERROR - 
2025-12-15 14:30:25,677 - ERROR - 📊 CONCURRENCY INFORMATION:
2025-12-15 14:30:25,677 - ERROR -   Process ID (PID): 27530
2025-12-15 14:30:25,678 - ERROR -   Process Name: run.py
2025-12-15 14:30:25,678 - ERROR -   Thread ID: 127549224711744
2025-12-15 14:30:25,679 - ERROR -   Thread Name: Thread-6 (worker)
2025-12-15 14:30:25,679 - ERROR -   Worker ID: 127549371410240
2025-12-15 14:30:25,680 - ERROR - 
2025-12-15 14:30:25,680 - ERROR - 🔍 FULL ERROR REPRESENTATION:
2025-12-15 14:30:25,681 - ERROR -   ResourceExhausted('Resource has been exhausted (e.g. check quota).')
2025-12-15 14:30:25,682 - ERROR - ================================================================================
2025-12-15 14:30:25,683 - WARNING - ⚠️ Rate limit hit (429) - Attempt 1/3
2025-12-15 14:30:25,684 - WARNING -    Waiting 60.0s before retry... (Error count: 1/5)
2025-12-15 14:31:26,121 - ERROR - ================================================================================
2025-12-15 14:31:26,121 - ERROR - 🔴 RATE LIMIT ERROR (429) - COMPLETE DETAILS
2025-12-15 14:31:26,121 - ERROR - ================================================================================
2025-12-15 14:31:26,121 - ERROR - Error Type: ResourceExhausted
2025-12-15 14:31:26,121 - ERROR - Status Code: 429
2025-12-15 14:31:26,121 - ERROR - Error Message: 429 Resource has been exhausted (e.g. check quota).
2025-12-15 14:31:26,121 - ERROR - 
2025-12-15 14:31:26,121 - ERROR - 📊 CONCURRENCY INFORMATION:
2025-12-15 14:31:26,121 - ERROR -   Process ID (PID): 27530
2025-12-15 14:31:26,121 - ERROR -   Process Name: run.py
2025-12-15 14:31:26,122 - ERROR -   Thread ID: 127549224711744
2025-12-15 14:31:26,122 - ERROR -   Thread Name: Thread-6 (worker)
2025-12-15 14:31:26,122 - ERROR -   Worker ID: 127549371410240
2025-12-15 14:31:26,122 - ERROR - 
2025-12-15 14:31:26,122 - ERROR - 🔍 FULL ERROR REPRESENTATION:
2025-12-15 14:31:26,122 - ERROR -   ResourceExhausted('Resource has been exhausted (e.g. check quota).')
2025-12-15 14:31:26,122 - ERROR - ================================================================================
2025-12-15 14:31:26,122 - WARNING - ⚠️ Rate limit hit (429) - Attempt 2/3
2025-12-15 14:31:26,122 - WARNING -    Waiting 90.0s before retry... (Error count: 2/5)
2025-12-16 08:11:14,862 - INFO - Loaded 6 predefined prompts
2025-12-16 08:13:16,247 - INFO - Loaded 3 API keys
2025-12-16 08:14:03,336 - INFO - === Starting PDF Processing ===
2025-12-16 08:14:03,337 - INFO - Model: gemini-2.5-pro
2025-12-16 08:14:03,337 - INFO - PDF: /home/mohammadbagher/Downloads/PDFs/Bolognia 5th Edition 2024 (1)-7-26-46.pdf
2025-12-16 08:14:03,337 - INFO - Full prompt being sent (6000 chars): You are a meticulous medical OCR & structuring assistant.

Your job is to extract ONLY what is present on each provided textbook page image/PDF
and convert it into clean, AI-ready text with structured sections.

You MUST avoid hallucinations and preserve original medical meaning precisely.

====================
GLOBAL PRINCIPLES
====================
- NO HALLUCINATIONS: Output only content visible on the page(s). If unreadable/unclear, write "[UNREADABLE]" or add an "uncertain" flag with brief reason.
- LANGUAGE & SPELLING: Preserve original English spelling and medical terminology.
- CLEAN OCR:
  - Remove headers/footers and running titles.
  - Fix broken words at line breaks.
  - Replace ligatures (ﬁ, ﬂ).
  - Preserve italics (*italic*), bold (**bold**), and subscripts/superscripts via LaTeX.
- CITATIONS: Keep in-text citations verbatim.
- MATH/CHEM: Use inline LaTeX.
- NO IMAGES: Describe figures textually only; do not invent labels.

====================
CRITICAL OUTPUT CONTRACT (MULTI-PART)
====================
The full output is TOO LARGE to fit in one response.

You MUST split the final output into multiple CHUNKS.

IMPORTANT:
- A CHUNK is ONLY a technical split of the RESPONSE due to size limits.
- CHUNKS are identified ONLY by the field "chunk_index".
- CHUNKS have NOTHING to do with the medical or logical structure of the chapter.

Each response MUST:
- Output ONLY valid JSON
- Contain ONLY ONE CHUNK of the final output
- NOT repeat rows from previous chunks
- Preserve the exact order of rows across chunks

====================
OUTPUT FORMAT (EXACT)
====================
{
  "chunk_index": <integer starting from 1>,
  "is_last": <true | false>,
  "rows": [
    {
      "Type": "page text | Figure | Table",
      "Extraction": "<single-line text or JSON>",
      "Number": <page number>,
      "Part": <integer>
    }
  ]
}

====================
MEANING OF chunk_index
====================
- "chunk_index" indicates ONLY the sequential number of this RESPONSE CHUNK.
- chunk_index = 1 means: first technical chunk of the output.
- chunk_index = 2 means: second technical chunk of the output.
- chunk_index has NO semantic meaning about the chapter content.
- chunk_index MUST strictly increase by 1 across responses.

====================
MEANING OF Part (VERY IMPORTANT)
====================
- "Part" represents the LOGICAL CONTENT PART of the chapter.
- "Part" is NOT related to chunk_index.
- "Part" is the result of grouping AUTHOR PARTS into YOUR OWN PARTS ("Our parts").

How to define "Part":
1) At the beginning of the chapter, there is a "Chapter contents" section that lists
   the author-defined parts ("author parts") and their first page.
2) You MUST group consecutive author parts into larger groups called "Our parts".
3) Each "Our part" MUST:
   - consist of consecutive author parts
   - NOT exceed 10 pages total
4) Assign integer labels starting from 1:
   - Our part 1
   - Our part 2
   - Our part 3
   - etc.

Example:
If author parts have page counts:
2, 4, 5, 3, 1, 7, 5

Then:
- Our part 1 = author parts 1 + 2 (in this example it is wrong to add the third author part because this way the first our part will be 11 pages which is more than 10 pages.)
- Our part 2 = author parts 3 + 4 + 5 (it is correct because they are 9 pages together which is less than 10 pages.)
- Our part 3 = author part 6
- Our part 4 = author part 7

Rules for assigning "Part" in rows:
- Every row MUST have exactly ONE integer "Part" value.
- A single page MAY belong to TWO different "Part" values if an Our part boundary
  occurs in the middle of the page.
- In such cases, split the page text into TWO separate rows:
  - one row with the previous Part value
  - one row with the next Part value
- NEVER mix content from two different Parts inside the same row.
- NEVER change Part value before an author part ends.
====================
PAGE-BY-PAGE FORWARD-ONLY PROCESSING (CRITICAL)
====================
You MUST process the document STRICTLY page by page, in ascending page order.
- NEVER go back to a previous page.
- NEVER re-extract or regenerate content from any page that has already appeared
  in earlier chunks.
- Once a page (or a portion of a page) is output in any chunk, it is considered FINAL.
- Subsequent chunks MUST continue ONLY from the next unprocessed page or page segment.
====================
Rules for rows
====================
- Each row represents exactly ONE of:
  - page text
  - figure
  - table
- Extraction MUST be single-line (no ENTER).
- JSON inside Extraction MUST be minified and valid.
- References section at end of chapter MUST be ignored.
====================
Rules for eFig and eTable
====================
- eFigs and eTables are some contents added after the chapter ends. They are not necessarily related contextually to the last our part. They can be related each of the previous our parts.
- you must find that each eFig and eTable belongs to which one of the our parts. 
- so when you are working on each chunk you must also check and find and include the eFigs and eTables that are related contextually to this chunk. Write the correct our part value for each eFig and eTable.
  


====================
CHUNK INSTRUCTIONS
====================
This is CHUNK {chunk_index} of the output.

Generate ONLY the rows that belong to this CHUNK.
Stop when you reach a safe size limit for a single response.
If more content remains after this CHUNK, set:
  "is_last": false
Otherwise set:
  "is_last": true

====================
AUTHOR PARTS → OUR PARTS RULES
====================
[keep your full original rules here verbatim — unchanged]

====================
FINAL RULES
====================
- DO NOT summarize.
- DO NOT explain.
- DO NOT add commentary.
- Output ONLY the JSON object described above.

You will now receive a PDF.
Generate CHUNK {chunk_index}.
2025-12-16 08:14:03,339 - INFO - Parts directory: /home/mohammadbagher/Desktop/tts app bagher/content_automation_project/parts_Bolognia 5th Edition 2024 (1)-7-26-46.pdf_e5082c0d
2025-12-16 08:14:03,339 - INFO - Final output will be saved to current directory: /home/mohammadbagher/Desktop/tts app bagher/content_automation_project
2025-12-16 08:14:03,339 - INFO - === Processing Part 1 ===
2025-12-16 08:14:15,419 - INFO - PDF uploaded successfully with API key: bagher
2025-12-16 08:14:15,419 - INFO - Uploaded PDF file: Bolognia 5th Edition 2024 (1)-7-26-46.pdf
2025-12-16 08:14:15,420 - INFO - Model: gemini-2.5-pro, Max tokens for model: 32768, Using: 32768
2025-12-16 08:14:15,421 - INFO - Using max_output_tokens: 32768
2025-12-16 08:14:15,421 - INFO - Using model: gemini-2.5-pro
2025-12-16 08:14:15,422 - INFO - Sending prompt (length: 6113 characters)
2025-12-16 08:14:15,422 - INFO - Max output tokens: 32768
2025-12-16 08:14:15,423 - INFO - Multi-part mode: Using user's prompt as-is
2025-12-16 08:14:15,424 - INFO - Streaming disabled (force_no_streaming=True for multi-part processing)
2025-12-16 08:14:15,424 - INFO - Generating content with NON-STREAMING (large request detected to avoid rate limits)...
2025-12-16 08:15:59,677 - INFO - ✓ Request completed: 38564 characters received
2025-12-16 08:15:59,678 - INFO - Finish reason: STOP (normal completion)
2025-12-16 08:15:59,679 - INFO - ✓ Response completed normally
2025-12-16 08:15:59,683 - WARNING - Part 1, row 0: Extraction contains newlines (should use \n)
2025-12-16 08:15:59,685 - WARNING - Part 1, row 2: Extraction contains newlines (should use \n)
2025-12-16 08:15:59,686 - WARNING - Part 1, row 6: Extraction contains newlines (should use \n)
2025-12-16 08:15:59,686 - WARNING - Part 1, row 8: Extraction contains newlines (should use \n)
2025-12-16 08:15:59,687 - WARNING - Part 1, row 14: Extraction contains newlines (should use \n)
2025-12-16 08:15:59,687 - WARNING - Part 1, row 17: Extraction contains newlines (should use \n)
2025-12-16 08:15:59,688 - WARNING - Part 1, row 21: Extraction contains newlines (should use \n)
2025-12-16 08:15:59,688 - WARNING - Part 1, row 0: Extraction contains newlines (should use \n)
2025-12-16 08:15:59,689 - WARNING - Part 1, row 2: Extraction contains newlines (should use \n)
2025-12-16 08:15:59,689 - WARNING - Part 1, row 6: Extraction contains newlines (should use \n)
2025-12-16 08:15:59,690 - WARNING - Part 1, row 8: Extraction contains newlines (should use \n)
2025-12-16 08:15:59,690 - WARNING - Part 1, row 14: Extraction contains newlines (should use \n)
2025-12-16 08:15:59,691 - WARNING - Part 1, row 17: Extraction contains newlines (should use \n)
2025-12-16 08:15:59,691 - WARNING - Part 1, row 21: Extraction contains newlines (should use \n)
2025-12-16 08:15:59,692 - INFO - Part 1: Parsed successfully - is_last=False, rows=22
2025-12-16 08:15:59,695 - INFO - Part 1: Added 22 rows (total: 22)
2025-12-16 08:15:59,696 - INFO - Part 1: is_last=false, continuing to next part...
2025-12-16 08:15:59,697 - INFO - Waiting 11.8s before next part...
2025-12-16 08:16:11,464 - INFO - === Processing Part 2 ===
2025-12-16 08:16:24,201 - INFO - PDF uploaded successfully with API key: bagher
2025-12-16 08:16:24,202 - INFO - Uploaded PDF file: Bolognia 5th Edition 2024 (1)-7-26-46.pdf
2025-12-16 08:16:24,203 - INFO - Model: gemini-2.5-pro, Max tokens for model: 32768, Using: 32768
2025-12-16 08:16:24,203 - INFO - Using max_output_tokens: 32768
2025-12-16 08:16:24,204 - INFO - Using model: gemini-2.5-pro
2025-12-16 08:16:24,204 - INFO - Sending prompt (length: 6196 characters)
2025-12-16 08:16:24,205 - INFO - Max output tokens: 32768
2025-12-16 08:16:24,205 - INFO - Multi-part mode: Using user's prompt as-is
2025-12-16 08:16:24,206 - INFO - Streaming disabled (force_no_streaming=True for multi-part processing)
2025-12-16 08:16:24,206 - INFO - Generating content with NON-STREAMING (large request detected to avoid rate limits)...
2025-12-16 08:18:33,302 - INFO - ✓ Request completed: 28597 characters received
2025-12-16 08:18:33,303 - INFO - Finish reason: STOP (normal completion)
2025-12-16 08:18:33,307 - INFO - ✓ Response completed normally
2025-12-16 08:18:33,311 - WARNING - Part 2, row 4: Extraction contains newlines (should use \n)
2025-12-16 08:18:33,312 - WARNING - Part 2, row 7: Extraction contains newlines (should use \n)
2025-12-16 08:18:33,313 - WARNING - Part 2, row 10: Extraction contains newlines (should use \n)
2025-12-16 08:18:33,313 - WARNING - Part 2, row 14: Extraction contains newlines (should use \n)
2025-12-16 08:18:33,313 - WARNING - Part 2, row 16: Extraction contains newlines (should use \n)
2025-12-16 08:18:33,314 - WARNING - Part 2, row 19: Extraction contains newlines (should use \n)
2025-12-16 08:18:33,314 - WARNING - Part 2, row 4: Extraction contains newlines (should use \n)
2025-12-16 08:18:33,315 - WARNING - Part 2, row 7: Extraction contains newlines (should use \n)
2025-12-16 08:18:33,318 - WARNING - Part 2, row 10: Extraction contains newlines (should use \n)
2025-12-16 08:18:33,320 - WARNING - Part 2, row 14: Extraction contains newlines (should use \n)
2025-12-16 08:18:33,321 - WARNING - Part 2, row 16: Extraction contains newlines (should use \n)
2025-12-16 08:18:33,324 - WARNING - Part 2, row 19: Extraction contains newlines (should use \n)
2025-12-16 08:18:33,324 - INFO - Part 2: Parsed successfully - is_last=False, rows=20
2025-12-16 08:18:33,329 - INFO - Part 2: Added 20 rows (total: 42)
2025-12-16 08:18:33,330 - INFO - Part 2: is_last=false, continuing to next part...
2025-12-16 08:18:33,333 - INFO - Waiting 9.5s before next part...
2025-12-16 08:18:42,846 - INFO - === Processing Part 3 ===
2025-12-16 08:18:55,139 - INFO - PDF uploaded successfully with API key: bagher
2025-12-16 08:18:55,141 - INFO - Uploaded PDF file: Bolognia 5th Edition 2024 (1)-7-26-46.pdf
2025-12-16 08:18:55,144 - INFO - Model: gemini-2.5-pro, Max tokens for model: 32768, Using: 32768
2025-12-16 08:18:55,146 - INFO - Using max_output_tokens: 32768
2025-12-16 08:18:55,150 - INFO - Using model: gemini-2.5-pro
2025-12-16 08:18:55,151 - INFO - Sending prompt (length: 6196 characters)
2025-12-16 08:18:55,151 - INFO - Max output tokens: 32768
2025-12-16 08:18:55,152 - INFO - Multi-part mode: Using user's prompt as-is
2025-12-16 08:18:55,152 - INFO - Streaming disabled (force_no_streaming=True for multi-part processing)
2025-12-16 08:18:55,155 - INFO - Generating content with NON-STREAMING (large request detected to avoid rate limits)...
2025-12-16 08:20:40,431 - INFO - ✓ Request completed: 28316 characters received
2025-12-16 08:20:40,433 - INFO - Finish reason: STOP (normal completion)
2025-12-16 08:20:40,433 - INFO - ✓ Response completed normally
2025-12-16 08:20:40,437 - WARNING - Part 3, row 4: Extraction contains newlines (should use \n)
2025-12-16 08:20:40,438 - WARNING - Part 3, row 6: Extraction contains newlines (should use \n)
2025-12-16 08:20:40,439 - WARNING - Part 3, row 9: Extraction contains newlines (should use \n)
2025-12-16 08:20:40,439 - WARNING - Part 3, row 11: Extraction contains newlines (should use \n)
2025-12-16 08:20:40,440 - WARNING - Part 3, row 12: Extraction contains newlines (should use \n)
2025-12-16 08:20:40,440 - WARNING - Part 3, row 13: Extraction contains newlines (should use \n)
2025-12-16 08:20:40,440 - WARNING - Part 3, row 14: Extraction contains newlines (should use \n)
2025-12-16 08:20:40,441 - WARNING - Part 3, row 4: Extraction contains newlines (should use \n)
2025-12-16 08:20:40,442 - WARNING - Part 3, row 6: Extraction contains newlines (should use \n)
2025-12-16 08:20:40,442 - WARNING - Part 3, row 9: Extraction contains newlines (should use \n)
2025-12-16 08:20:40,443 - WARNING - Part 3, row 11: Extraction contains newlines (should use \n)
2025-12-16 08:20:40,443 - WARNING - Part 3, row 12: Extraction contains newlines (should use \n)
2025-12-16 08:20:40,444 - WARNING - Part 3, row 13: Extraction contains newlines (should use \n)
2025-12-16 08:20:40,444 - WARNING - Part 3, row 14: Extraction contains newlines (should use \n)
2025-12-16 08:20:40,445 - INFO - Part 3: Parsed successfully - is_last=False, rows=25
2025-12-16 08:20:40,450 - INFO - Part 3: Added 25 rows (total: 67)
2025-12-16 08:20:40,451 - INFO - Part 3: is_last=false, continuing to next part...
2025-12-16 08:20:40,455 - INFO - Waiting 9.1s before next part...
2025-12-16 08:20:49,538 - INFO - === Processing Part 4 ===
2025-12-16 08:21:01,542 - INFO - PDF uploaded successfully with API key: bagher
2025-12-16 08:21:01,542 - INFO - Uploaded PDF file: Bolognia 5th Edition 2024 (1)-7-26-46.pdf
2025-12-16 08:21:01,543 - INFO - Model: gemini-2.5-pro, Max tokens for model: 32768, Using: 32768
2025-12-16 08:21:01,544 - INFO - Using max_output_tokens: 32768
2025-12-16 08:21:01,544 - INFO - Using model: gemini-2.5-pro
2025-12-16 08:21:01,544 - INFO - Sending prompt (length: 6196 characters)
2025-12-16 08:21:01,545 - INFO - Max output tokens: 32768
2025-12-16 08:21:01,546 - INFO - Multi-part mode: Using user's prompt as-is
2025-12-16 08:21:01,546 - INFO - Streaming disabled (force_no_streaming=True for multi-part processing)
2025-12-16 08:21:01,547 - INFO - Generating content with NON-STREAMING (large request detected to avoid rate limits)...
2025-12-16 08:22:28,406 - INFO - ✓ Request completed: 24451 characters received
2025-12-16 08:22:28,407 - INFO - Finish reason: STOP (normal completion)
2025-12-16 08:22:28,408 - INFO - ✓ Response completed normally
2025-12-16 08:22:28,411 - WARNING - Part 4, row 1: Extraction contains newlines (should use \n)
2025-12-16 08:22:28,411 - WARNING - Part 4, row 2: Extraction contains newlines (should use \n)
2025-12-16 08:22:28,412 - WARNING - Part 4, row 6: Extraction contains newlines (should use \n)
2025-12-16 08:22:28,412 - WARNING - Part 4, row 7: Extraction contains newlines (should use \n)
2025-12-16 08:22:28,413 - WARNING - Part 4, row 1: Extraction contains newlines (should use \n)
2025-12-16 08:22:28,413 - WARNING - Part 4, row 2: Extraction contains newlines (should use \n)
2025-12-16 08:22:28,413 - WARNING - Part 4, row 6: Extraction contains newlines (should use \n)
2025-12-16 08:22:28,414 - WARNING - Part 4, row 7: Extraction contains newlines (should use \n)
2025-12-16 08:22:28,414 - INFO - Part 4: Parsed successfully - is_last=False, rows=8
2025-12-16 08:22:28,417 - INFO - Part 4: Added 8 rows (total: 75)
2025-12-16 08:22:28,417 - INFO - Part 4: is_last=false, continuing to next part...
2025-12-16 08:22:28,418 - INFO - Waiting 11.2s before next part...
2025-12-16 08:22:39,584 - INFO - === Processing Part 5 ===
2025-12-16 08:22:50,694 - INFO - PDF uploaded successfully with API key: bagher
2025-12-16 08:22:50,695 - INFO - Uploaded PDF file: Bolognia 5th Edition 2024 (1)-7-26-46.pdf
2025-12-16 08:22:50,696 - INFO - Model: gemini-2.5-pro, Max tokens for model: 32768, Using: 32768
2025-12-16 08:22:50,696 - INFO - Using max_output_tokens: 32768
2025-12-16 08:22:50,697 - INFO - Using model: gemini-2.5-pro
2025-12-16 08:22:50,697 - INFO - Sending prompt (length: 6196 characters)
2025-12-16 08:22:50,699 - INFO - Max output tokens: 32768
2025-12-16 08:22:50,702 - INFO - Multi-part mode: Using user's prompt as-is
2025-12-16 08:22:50,703 - INFO - Streaming disabled (force_no_streaming=True for multi-part processing)
2025-12-16 08:22:50,705 - INFO - Generating content with NON-STREAMING (large request detected to avoid rate limits)...
2025-12-16 08:25:01,175 - INFO - ✓ Request completed: 52217 characters received
2025-12-16 08:25:01,177 - INFO - Finish reason: STOP (normal completion)
2025-12-16 08:25:01,177 - INFO - ✓ Response completed normally
2025-12-16 08:25:01,182 - ERROR - Part 5: JSON parse error: Expecting ',' delimiter: line 128 column 20 (char 45517)
2025-12-16 08:25:01,184 - ERROR - Part 5: Response text (first 1000 chars): {
  "chunk_index": 5,
  "is_last": true,
  "rows": [
    {
      "Type": "Table",
      "Extraction": "{\"Title\": \"THERAPEUTIC LADDER FOR BULLOUS PEMPHIGOID\", \"Number\": \"30.4\", \"Header\": [\"\", \"\"], \"Body\": [{\"Row\": [\"Mild and/or localized disease\", \"\"]}, {\"Row\": [\"First-line\", \"• Superpotent topical corticosteroids (1*)\\n• Oral corticosteroidst (1)\\n• Minocycline, doxycycline or tetracycline, alone or in combination with nicotinamide (1)\"]}, {\"Row\": [\"Second-line\", \"• Topical immunomodulators (e.g. tacrolimus) (3)\\n• Dapsone, sulfonamides (3)\\n• Erythromycin, penicillins (3)\"]}, {\"Row\": [\"Extensive/persistent cutaneous disease\", \"\"]}, {\"Row\": [\"First-line, as primary treatment\", \"• Superpotent topical corticosteroids (1*)\\n• Oral corticosteroids+ (1+)\"]}, {\"Row\": [\"Second-line, or as adjunctive therapy\", \"• Azathioprine (1)\\n• Mycophenolate mofetil (1)\\n• Methotrexate# (2)\\n• Omalizumab (3)\\n• Dupilumab (3)\\n• IVIg (1)\\n• Ritu
2025-12-16 08:25:01,184 - ERROR - Part 5: Response text (last 500 chars): overlying joints. Note the resemblance to dystrophic epidermolysis bullosa. *Courtesy Kalman Watsky, MD.*\", \"Labels\": []}",
      "Number": 533.e4,
      "Part": 2
    },
    {
      "Type": "Figure",
      "Extraction": "{\"Number\": \"eFig. 30.18\", \"Description\": \"**Epidermolysis bullosa acquisita - inflammatory bullous pemphigoid-like presentation.** Bullae and circular erosions in a patient with multiple myeloma.\", \"Labels\": []}",
      "Number": 533.e4,
      "Part": 2
    }
  ]
}
2025-12-16 08:25:01,185 - ERROR - Part 5: Failed to parse response
2025-12-16 08:25:01,185 - ERROR - Part 5: Response text (first 1000 chars): ```json
{
  "chunk_index": 5,
  "is_last": true,
  "rows": [
    {
      "Type": "Table",
      "Extraction": "{\"Title\": \"THERAPEUTIC LADDER FOR BULLOUS PEMPHIGOID\", \"Number\": \"30.4\", \"Header\": [\"\", \"\"], \"Body\": [{\"Row\": [\"Mild and/or localized disease\", \"\"]}, {\"Row\": [\"First-line\", \"• Superpotent topical corticosteroids (1*)\\n• Oral corticosteroidst (1)\\n• Minocycline, doxycycline or tetracycline, alone or in combination with nicotinamide (1)\"]}, {\"Row\": [\"Second-line\", \"• Topical immunomodulators (e.g. tacrolimus) (3)\\n• Dapsone, sulfonamides (3)\\n• Erythromycin, penicillins (3)\"]}, {\"Row\": [\"Extensive/persistent cutaneous disease\", \"\"]}, {\"Row\": [\"First-line, as primary treatment\", \"• Superpotent topical corticosteroids (1*)\\n• Oral corticosteroids+ (1+)\"]}, {\"Row\": [\"Second-line, or as adjunctive therapy\", \"• Azathioprine (1)\\n• Mycophenolate mofetil (1)\\n• Methotrexate# (2)\\n• Omalizumab (3)\\n• Dupilumab (3)\\n• IVIg (1)\
2025-12-16 08:25:01,186 - ERROR - Part 5: Retrying same part...
2025-12-16 08:25:06,186 - INFO - === Processing Part 5 ===
2025-12-16 08:25:19,368 - INFO - PDF uploaded successfully with API key: bagher
2025-12-16 08:25:19,369 - INFO - Uploaded PDF file: Bolognia 5th Edition 2024 (1)-7-26-46.pdf
2025-12-16 08:25:19,370 - INFO - Model: gemini-2.5-pro, Max tokens for model: 32768, Using: 32768
2025-12-16 08:25:19,370 - INFO - Using max_output_tokens: 32768
2025-12-16 08:25:19,371 - INFO - Using model: gemini-2.5-pro
2025-12-16 08:25:19,372 - INFO - Sending prompt (length: 6196 characters)
2025-12-16 08:25:19,372 - INFO - Max output tokens: 32768
2025-12-16 08:25:19,373 - INFO - Multi-part mode: Using user's prompt as-is
2025-12-16 08:25:19,373 - INFO - Streaming disabled (force_no_streaming=True for multi-part processing)
2025-12-16 08:25:19,374 - INFO - Generating content with NON-STREAMING (large request detected to avoid rate limits)...
2025-12-16 08:26:31,443 - INFO - ✓ Request completed: 11539 characters received
2025-12-16 08:26:31,445 - INFO - Finish reason: STOP (normal completion)
2025-12-16 08:26:31,445 - INFO - ✓ Response completed normally
2025-12-16 08:26:31,446 - INFO - Part 5: Parsed successfully - is_last=True, rows=19
2025-12-16 08:26:31,446 - INFO - Part 5: Added 19 rows (total: 94)
2025-12-16 08:26:31,446 - INFO - Part 5: is_last=true, processing complete!
2025-12-16 08:26:31,447 - INFO - === Processing Summary ===
2025-12-16 08:26:31,447 - INFO - Parts processed: 4
2025-12-16 08:26:31,447 - INFO - Total parts in final output: 4
2025-12-16 08:26:31,447 - INFO - Total rows collected: 94
2025-12-16 08:26:31,447 - INFO - Deduplicating 94 rows...
2025-12-16 08:26:31,450 - WARNING - Removed 7 duplicate rows using enhanced deduplication
2025-12-16 08:26:31,451 - INFO - Final row count after deduplication: 87
2025-12-16 08:26:31,451 - INFO - Sorting 87 rows by Number (as float)...
2025-12-16 08:26:31,451 - INFO - Rows sorted successfully
2025-12-16 08:26:31,455 - INFO - ✓ Final JSON output saved to /home/mohammadbagher/Desktop/tts app bagher/content_automation_project/Bolognia 5th Edition 2024 1-7-26-46_final_output.json
2025-12-16 08:26:31,456 - INFO -   - File path: /home/mohammadbagher/Desktop/tts app bagher/content_automation_project/Bolognia 5th Edition 2024 1-7-26-46_final_output.json
2025-12-16 08:26:31,456 - INFO -   - Total parts: 4
2025-12-16 08:26:31,456 - INFO -   - Total rows: 87
2025-12-16 08:26:31,456 - INFO -   - File size: 122.12 KB
2025-12-16 08:26:31,464 - INFO - ✓ Final CSV output saved to /home/mohammadbagher/Desktop/tts app bagher/content_automation_project/Bolognia 5th Edition 2024 1-7-26-46_final_output.csv
2025-12-16 08:26:31,464 - INFO -   - File path: /home/mohammadbagher/Desktop/tts app bagher/content_automation_project/Bolognia 5th Edition 2024 1-7-26-46_final_output.csv
2025-12-16 08:26:31,464 - INFO -   - Total rows: 87
2025-12-16 08:26:31,464 - INFO -   - File size: 114.72 KB
2025-12-16 08:31:01,891 - INFO - Processing Part 1 with second-stage prompt...
2025-12-16 08:32:22,443 - INFO - Text processed successfully with gemini-2.5-pro
2025-12-16 08:32:22,448 - INFO - Processing Part 2 with second-stage prompt...
2025-12-16 08:33:38,485 - INFO - Text processed successfully with gemini-2.5-pro
2025-12-16 08:33:38,488 - INFO - Processing Part 3 with second-stage prompt...
2025-12-16 08:35:03,542 - INFO - Text processed successfully with gemini-2.5-pro
2025-12-16 08:35:03,571 - INFO - Post-processed JSON saved to: /home/mohammadbagher/Desktop/tts app bagher/content_automation_project/Bolognia 5th Edition 2024 1-7-26-46_final_output_post_processed.json
2025-12-16 09:16:50,393 - INFO - Loaded 6 predefined prompts
2025-12-16 09:32:05,510 - INFO - Loaded 6 predefined prompts
2025-12-16 09:38:02,469 - INFO - Loaded 6 predefined prompts
2025-12-16 09:39:57,718 - INFO - Loaded 6 predefined prompts
2025-12-16 09:40:53,025 - INFO - Loaded 6 predefined prompts
2025-12-16 09:41:16,577 - INFO - Loaded 3 API keys
2025-12-16 10:06:17,222 - INFO - Text processed successfully with gemini-2.5-pro
2025-12-16 10:24:06,643 - INFO - Text processed successfully with gemini-2.5-pro
2025-12-16 10:25:32,448 - INFO - Loaded 6 predefined prompts
2025-12-16 11:47:53,012 - INFO - Loaded 6 predefined prompts
2025-12-16 11:50:23,422 - INFO - Loaded 3 API keys
2025-12-16 11:58:36,808 - INFO - Text processed successfully with gemini-2.5-pro
2025-12-16 12:03:56,843 - INFO - Loaded 6 predefined prompts
2025-12-16 12:04:19,840 - INFO - Loaded 3 API keys
2025-12-16 12:08:31,630 - INFO - Text processed successfully with gemini-2.5-pro
2025-12-16 12:11:30,411 - INFO - Loaded 6 predefined prompts
2025-12-16 12:11:51,575 - INFO - Loaded 3 API keys
2025-12-16 12:16:11,146 - INFO - Text processed successfully with gemini-2.5-pro
2025-12-16 12:57:21,708 - INFO - Loaded 6 predefined prompts
2025-12-16 12:58:12,342 - INFO - Loaded 3 API keys
2025-12-16 13:00:43,423 - INFO - === Starting PDF Processing ===
2025-12-16 13:00:43,423 - INFO - Model: gemini-2.5-pro
2025-12-16 13:00:43,423 - INFO - PDF: /home/mohammadbagher/Downloads/PDFs/Bolognia 5th Edition 2024 (1)-7-26-46.pdf
2025-12-16 13:00:43,424 - INFO - Full prompt being sent (5165 chars): You are a meticulous medical OCR & structuring assistant.

Your job is to extract ONLY what is present on each provided textbook page image/PDF
and convert it into clean, AI-ready text with structured sections.

You MUST avoid hallucinations and preserve original medical meaning precisely.

====================
GLOBAL PRINCIPLES
====================
- NO HALLUCINATIONS: Output only content visible on the page(s). If unreadable/unclear, write "[UNREADABLE]" or add an "uncertain" flag with brief reason.
- LANGUAGE & SPELLING: Preserve original English spelling and medical terminology.
- CLEAN OCR:
  - Remove headers/footers and running titles.
  - Fix broken words at line breaks.
  - Replace ligatures (ﬁ, ﬂ).
  - Preserve italics (*italic*), bold (**bold**), and subscripts/superscripts via LaTeX.
- CITATIONS: Keep in-text citations verbatim.
- MATH/CHEM: Use inline LaTeX.
- NO IMAGES: Describe figures textually only; do not invent labels.

====================
CRITICAL OUTPUT CONTRACT (MULTI-PART)
====================
The full output is TOO LARGE to fit in one response.

You MUST split the final output into multiple CHUNKS.

IMPORTANT:
- A CHUNK is ONLY a technical split of the RESPONSE due to size limits.
- CHUNKS are identified ONLY by the field "chunk_index".
- CHUNKS have NOTHING to do with the medical or logical structure of the chapter.

Each response MUST:
- Output ONLY valid JSON
- Contain ONLY ONE CHUNK of the final output
- NOT repeat rows from previous chunks
- Preserve the exact order of rows across chunks

====================
OUTPUT FORMAT (EXACT)
====================
{
  "chunk_index": <integer starting from 1>,
  "is_last": <true | false>,
  "rows": [
    {
      "Type": "page text | Figure | Table",
      "Extraction": "<single-line text or JSON>",
      "Number": <page number>,
      "Part": <integer>
    }
  ]
}

====================
MEANING OF chunk_index
====================
- "chunk_index" indicates ONLY the sequential number of this RESPONSE CHUNK.
- chunk_index = 1 means: first technical chunk of the output.
- chunk_index = 2 means: second technical chunk of the output.
- chunk_index has NO semantic meaning about the chapter content.
- chunk_index MUST strictly increase by 1 across responses.

====================
MEANING OF Part (VERY IMPORTANT)
====================
- "Part" represents the LOGICAL CONTENT PART of the chapter.
- "Part" is NOT related to chunk_index.

How to define "Part":
1) At the beginning of the chapter, there is a "Chapter contents" section that lists
   the parts and their first page.
2) Assign integer labels starting from 1:
   - part 1
   - part 2
   - part 3
   - etc.


Rules for assigning "Part" in rows:
- Every row MUST have exactly ONE integer "Part" value.
- A single page MAY belong to more than one "Part" values if a part boundary
  occurs in the middle of the page.
- In such cases, split the page text into multiple separate rows:
  - one row for the text of the previous part with the previous Part value
  - one row for the text of the next part with the next Part value
- NEVER mix content from two different Parts inside the same row.
- NEVER change Part value before a part ends.
====================
PAGE-BY-PAGE FORWARD-ONLY PROCESSING (CRITICAL)
====================
You MUST process the document STRICTLY page by page, in ascending page order.
- NEVER go back to a previous page.
- NEVER re-extract or regenerate content from any page that has already appeared
  in earlier chunks.
- Once a page (or a portion of a page) is output in any chunk, it is considered FINAL.
- Subsequent chunks MUST continue ONLY from the next unprocessed page or page segment.
====================
Rules for rows
====================
- Each row represents exactly ONE of:
  - page text
  - figure
  - table
- Extraction MUST be single-line (no ENTER).
- JSON inside Extraction MUST be minified and valid.
- References section at end of chapter MUST be ignored.
====================
Rules for eFig and eTable
====================
- eFigs and eTables are some contents added after the chapter ends. They are not necessarily related contextually to the last part. They can be related each of the previous parts.
- you must find that each eFig and eTable belongs to which one of the parts. 
- so when you are working on each chunk you must also check and find and include the eFigs and eTables that are related contextually to this chunk. Write the correct part value for each eFig and eTable.
  


====================
CHUNK INSTRUCTIONS
====================
This is CHUNK {chunk_index} of the output.

Generate ONLY the rows that belong to this CHUNK.
Stop when you reach a safe size limit for a single response.
If more content remains after this CHUNK, set:
  "is_last": false
Otherwise set:
  "is_last": true


====================
FINAL RULES
====================
- DO NOT summarize.
- DO NOT explain.
- DO NOT add commentary.
- Output ONLY the JSON object described above.

You will now receive a PDF.
Generate CHUNK {chunk_index}.
2025-12-16 13:00:43,429 - INFO - Parts directory: /home/mohammadbagher/Desktop/tts app bagher/content_automation_project/parts_Bolognia 5th Edition 2024 (1)-7-26-46.pdf_d9f553c4
2025-12-16 13:00:43,430 - INFO - Final output will be saved to current directory: /home/mohammadbagher/Desktop/tts app bagher/content_automation_project
2025-12-16 13:00:43,430 - INFO - === Processing Part 1 ===
2025-12-16 13:00:59,270 - INFO - PDF uploaded successfully with API key: bagher
2025-12-16 13:00:59,271 - INFO - Uploaded PDF file: Bolognia 5th Edition 2024 (1)-7-26-46.pdf
2025-12-16 13:00:59,271 - INFO - Model: gemini-2.5-pro, Max tokens for model: 32768, Using: 32768
2025-12-16 13:00:59,272 - INFO - Using max_output_tokens: 32768
2025-12-16 13:00:59,272 - INFO - Using model: gemini-2.5-pro
2025-12-16 13:00:59,273 - INFO - Sending prompt (length: 5278 characters)
2025-12-16 13:00:59,273 - INFO - Max output tokens: 32768
2025-12-16 13:00:59,273 - INFO - Multi-part mode: Using user's prompt as-is
2025-12-16 13:00:59,274 - INFO - Streaming disabled (force_no_streaming=True for multi-part processing)
2025-12-16 13:00:59,274 - INFO - Generating content with NON-STREAMING (large request detected to avoid rate limits)...
2025-12-16 13:02:35,059 - INFO - ✓ Request completed: 30770 characters received
2025-12-16 13:02:35,060 - INFO - Finish reason: STOP (normal completion)
2025-12-16 13:02:35,062 - INFO - ✓ Response completed normally
2025-12-16 13:02:35,066 - WARNING - Part 1, row 2: Extraction contains newlines (should use \n)
2025-12-16 13:02:35,067 - WARNING - Part 1, row 5: Extraction contains newlines (should use \n)
2025-12-16 13:02:35,067 - WARNING - Part 1, row 6: Extraction contains newlines (should use \n)
2025-12-16 13:02:35,068 - WARNING - Part 1, row 7: Extraction contains newlines (should use \n)
2025-12-16 13:02:35,068 - WARNING - Part 1, row 8: Extraction contains newlines (should use \n)
2025-12-16 13:02:35,069 - WARNING - Part 1, row 9: Extraction contains newlines (should use \n)
2025-12-16 13:02:35,069 - WARNING - Part 1, row 10: Extraction contains newlines (should use \n)
2025-12-16 13:02:35,070 - WARNING - Part 1, row 14: Extraction contains newlines (should use \n)
2025-12-16 13:02:35,071 - WARNING - Part 1, row 16: Extraction contains newlines (should use \n)
2025-12-16 13:02:35,072 - WARNING - Part 1, row 17: Extraction contains newlines (should use \n)
2025-12-16 13:02:35,073 - WARNING - Part 1, row 18: Extraction contains newlines (should use \n)
2025-12-16 13:02:35,073 - WARNING - Part 1, row 19: Extraction contains newlines (should use \n)
2025-12-16 13:02:35,074 - WARNING - Part 1, row 23: Extraction contains newlines (should use \n)
2025-12-16 13:02:35,074 - WARNING - Part 1, row 25: Extraction contains newlines (should use \n)
2025-12-16 13:02:35,075 - WARNING - Part 1, row 26: Extraction contains newlines (should use \n)
2025-12-16 13:02:35,075 - WARNING - Part 1, row 27: Extraction contains newlines (should use \n)
2025-12-16 13:02:35,076 - WARNING - Part 1, row 31: Extraction contains newlines (should use \n)
2025-12-16 13:02:35,076 - WARNING - Part 1, row 32: Extraction contains newlines (should use \n)
2025-12-16 13:02:35,077 - WARNING - Part 1, row 33: Extraction contains newlines (should use \n)
2025-12-16 13:02:35,078 - WARNING - Part 1, row 2: Extraction contains newlines (should use \n)
2025-12-16 13:02:35,079 - WARNING - Part 1, row 5: Extraction contains newlines (should use \n)
2025-12-16 13:02:35,080 - WARNING - Part 1, row 6: Extraction contains newlines (should use \n)
2025-12-16 13:02:35,080 - WARNING - Part 1, row 7: Extraction contains newlines (should use \n)
2025-12-16 13:02:35,081 - WARNING - Part 1, row 8: Extraction contains newlines (should use \n)
2025-12-16 13:02:35,082 - WARNING - Part 1, row 9: Extraction contains newlines (should use \n)
2025-12-16 13:02:35,083 - WARNING - Part 1, row 10: Extraction contains newlines (should use \n)
2025-12-16 13:02:35,083 - WARNING - Part 1, row 14: Extraction contains newlines (should use \n)
2025-12-16 13:02:35,084 - WARNING - Part 1, row 16: Extraction contains newlines (should use \n)
2025-12-16 13:02:35,084 - WARNING - Part 1, row 17: Extraction contains newlines (should use \n)
2025-12-16 13:02:35,086 - WARNING - Part 1, row 18: Extraction contains newlines (should use \n)
2025-12-16 13:02:35,087 - WARNING - Part 1, row 19: Extraction contains newlines (should use \n)
2025-12-16 13:02:35,089 - WARNING - Part 1, row 23: Extraction contains newlines (should use \n)
2025-12-16 13:02:35,089 - WARNING - Part 1, row 25: Extraction contains newlines (should use \n)
2025-12-16 13:02:35,094 - WARNING - Part 1, row 26: Extraction contains newlines (should use \n)
2025-12-16 13:02:35,095 - WARNING - Part 1, row 27: Extraction contains newlines (should use \n)
2025-12-16 13:02:35,095 - WARNING - Part 1, row 31: Extraction contains newlines (should use \n)
2025-12-16 13:02:35,096 - WARNING - Part 1, row 32: Extraction contains newlines (should use \n)
2025-12-16 13:02:35,096 - WARNING - Part 1, row 33: Extraction contains newlines (should use \n)
2025-12-16 13:02:35,101 - INFO - Part 1: Parsed successfully - is_last=False, rows=34
2025-12-16 13:02:35,116 - INFO - Part 1: Added 34 rows (total: 34)
2025-12-16 13:02:35,118 - INFO - Part 1: is_last=false, continuing to next part...
2025-12-16 13:02:35,121 - INFO - Waiting 12.9s before next part...
2025-12-16 13:02:48,006 - INFO - === Processing Part 2 ===
2025-12-16 13:02:56,846 - INFO - PDF uploaded successfully with API key: bagher
2025-12-16 13:02:56,847 - INFO - Uploaded PDF file: Bolognia 5th Edition 2024 (1)-7-26-46.pdf
2025-12-16 13:02:56,848 - INFO - Model: gemini-2.5-pro, Max tokens for model: 32768, Using: 32768
2025-12-16 13:02:56,848 - INFO - Using max_output_tokens: 32768
2025-12-16 13:02:56,849 - INFO - Using model: gemini-2.5-pro
2025-12-16 13:02:56,849 - INFO - Sending prompt (length: 5361 characters)
2025-12-16 13:02:56,849 - INFO - Max output tokens: 32768
2025-12-16 13:02:56,850 - INFO - Multi-part mode: Using user's prompt as-is
2025-12-16 13:02:56,850 - INFO - Streaming disabled (force_no_streaming=True for multi-part processing)
2025-12-16 13:02:56,851 - INFO - Generating content with NON-STREAMING (large request detected to avoid rate limits)...
2025-12-16 13:04:43,747 - INFO - ✓ Request completed: 38991 characters received
2025-12-16 13:04:43,748 - INFO - Finish reason: STOP (normal completion)
2025-12-16 13:04:43,749 - INFO - ✓ Response completed normally
2025-12-16 13:04:43,753 - INFO - Part 2: Parsed successfully - is_last=False, rows=22
2025-12-16 13:04:43,758 - INFO - Part 2: Added 22 rows (total: 56)
2025-12-16 13:04:43,759 - INFO - Part 2: is_last=false, continuing to next part...
2025-12-16 13:04:43,760 - INFO - Waiting 8.8s before next part...
2025-12-16 13:04:52,543 - INFO - === Processing Part 3 ===
2025-12-16 13:05:02,684 - INFO - PDF uploaded successfully with API key: bagher
2025-12-16 13:05:02,685 - INFO - Uploaded PDF file: Bolognia 5th Edition 2024 (1)-7-26-46.pdf
2025-12-16 13:05:02,686 - INFO - Model: gemini-2.5-pro, Max tokens for model: 32768, Using: 32768
2025-12-16 13:05:02,687 - INFO - Using max_output_tokens: 32768
2025-12-16 13:05:02,687 - INFO - Using model: gemini-2.5-pro
2025-12-16 13:05:02,689 - INFO - Sending prompt (length: 5361 characters)
2025-12-16 13:05:02,690 - INFO - Max output tokens: 32768
2025-12-16 13:05:02,690 - INFO - Multi-part mode: Using user's prompt as-is
2025-12-16 13:05:02,691 - INFO - Streaming disabled (force_no_streaming=True for multi-part processing)
2025-12-16 13:05:02,691 - INFO - Generating content with NON-STREAMING (large request detected to avoid rate limits)...
2025-12-16 13:07:15,043 - INFO - ✓ Request completed: 39824 characters received
2025-12-16 13:07:15,045 - INFO - Finish reason: STOP (normal completion)
2025-12-16 13:07:15,046 - INFO - ✓ Response completed normally
2025-12-16 13:07:15,050 - WARNING - Part 3, row 3: Extraction contains newlines (should use \n)
2025-12-16 13:07:15,051 - WARNING - Part 3, row 4: Extraction contains newlines (should use \n)
2025-12-16 13:07:15,051 - WARNING - Part 3, row 5: Extraction contains newlines (should use \n)
2025-12-16 13:07:15,052 - WARNING - Part 3, row 9: Extraction contains newlines (should use \n)
2025-12-16 13:07:15,052 - WARNING - Part 3, row 10: Extraction contains newlines (should use \n)
2025-12-16 13:07:15,052 - WARNING - Part 3, row 14: Extraction contains newlines (should use \n)
2025-12-16 13:07:15,053 - WARNING - Part 3, row 15: Extraction contains newlines (should use \n)
2025-12-16 13:07:15,054 - WARNING - Part 3, row 16: Extraction contains newlines (should use \n)
2025-12-16 13:07:15,055 - WARNING - Part 3, row 19: Extraction contains newlines (should use \n)
2025-12-16 13:07:15,056 - WARNING - Part 3, row 20: Extraction contains newlines (should use \n)
2025-12-16 13:07:15,056 - WARNING - Part 3, row 22: Extraction contains newlines (should use \n)
2025-12-16 13:07:15,057 - WARNING - Part 3, row 24: Extraction contains newlines (should use \n)
2025-12-16 13:07:15,057 - WARNING - Part 3, row 25: Extraction contains newlines (should use \n)
2025-12-16 13:07:15,058 - WARNING - Part 3, row 26: Extraction contains newlines (should use \n)
2025-12-16 13:07:15,058 - WARNING - Part 3, row 27: Extraction contains newlines (should use \n)
2025-12-16 13:07:15,059 - WARNING - Part 3, row 28: Extraction contains newlines (should use \n)
2025-12-16 13:07:15,059 - WARNING - Part 3, row 29: Extraction contains newlines (should use \n)
2025-12-16 13:07:15,060 - WARNING - Part 3, row 3: Extraction contains newlines (should use \n)
2025-12-16 13:07:15,060 - WARNING - Part 3, row 4: Extraction contains newlines (should use \n)
2025-12-16 13:07:15,061 - WARNING - Part 3, row 5: Extraction contains newlines (should use \n)
2025-12-16 13:07:15,061 - WARNING - Part 3, row 9: Extraction contains newlines (should use \n)
2025-12-16 13:07:15,062 - WARNING - Part 3, row 10: Extraction contains newlines (should use \n)
2025-12-16 13:07:15,062 - WARNING - Part 3, row 14: Extraction contains newlines (should use \n)
2025-12-16 13:07:15,063 - WARNING - Part 3, row 15: Extraction contains newlines (should use \n)
2025-12-16 13:07:15,063 - WARNING - Part 3, row 16: Extraction contains newlines (should use \n)
2025-12-16 13:07:15,064 - WARNING - Part 3, row 19: Extraction contains newlines (should use \n)
2025-12-16 13:07:15,064 - WARNING - Part 3, row 20: Extraction contains newlines (should use \n)
2025-12-16 13:07:15,065 - WARNING - Part 3, row 22: Extraction contains newlines (should use \n)
2025-12-16 13:07:15,065 - WARNING - Part 3, row 24: Extraction contains newlines (should use \n)
2025-12-16 13:07:15,067 - WARNING - Part 3, row 25: Extraction contains newlines (should use \n)
2025-12-16 13:07:15,067 - WARNING - Part 3, row 26: Extraction contains newlines (should use \n)
2025-12-16 13:07:15,068 - WARNING - Part 3, row 27: Extraction contains newlines (should use \n)
2025-12-16 13:07:15,068 - WARNING - Part 3, row 28: Extraction contains newlines (should use \n)
2025-12-16 13:07:15,068 - WARNING - Part 3, row 29: Extraction contains newlines (should use \n)
2025-12-16 13:07:15,070 - INFO - Part 3: Parsed successfully - is_last=False, rows=40
2025-12-16 13:07:15,076 - INFO - Part 3: Added 40 rows (total: 96)
2025-12-16 13:07:15,077 - INFO - Part 3: is_last=false, continuing to next part...
2025-12-16 13:07:15,079 - INFO - Waiting 11.3s before next part...
2025-12-16 13:07:26,334 - INFO - === Processing Part 4 ===
2025-12-16 13:07:37,115 - INFO - PDF uploaded successfully with API key: bagher
2025-12-16 13:07:37,116 - INFO - Uploaded PDF file: Bolognia 5th Edition 2024 (1)-7-26-46.pdf
2025-12-16 13:07:37,117 - INFO - Model: gemini-2.5-pro, Max tokens for model: 32768, Using: 32768
2025-12-16 13:07:37,117 - INFO - Using max_output_tokens: 32768
2025-12-16 13:07:37,118 - INFO - Using model: gemini-2.5-pro
2025-12-16 13:07:37,118 - INFO - Sending prompt (length: 5361 characters)
2025-12-16 13:07:37,119 - INFO - Max output tokens: 32768
2025-12-16 13:07:37,119 - INFO - Multi-part mode: Using user's prompt as-is
2025-12-16 13:07:37,120 - INFO - Streaming disabled (force_no_streaming=True for multi-part processing)
2025-12-16 13:07:37,120 - INFO - Generating content with NON-STREAMING (large request detected to avoid rate limits)...
2025-12-16 13:09:18,928 - INFO - ✓ Request completed: 37874 characters received
2025-12-16 13:09:18,929 - INFO - Finish reason: STOP (normal completion)
2025-12-16 13:09:18,930 - INFO - ✓ Response completed normally
2025-12-16 13:09:18,934 - WARNING - Part 4, row 2: Extraction contains newlines (should use \n)
2025-12-16 13:09:18,935 - WARNING - Part 4, row 4: Extraction contains newlines (should use \n)
2025-12-16 13:09:18,935 - WARNING - Part 4, row 7: Extraction contains newlines (should use \n)
2025-12-16 13:09:18,936 - WARNING - Part 4, row 9: Extraction contains newlines (should use \n)
2025-12-16 13:09:18,937 - WARNING - Part 4, row 10: Extraction contains newlines (should use \n)
2025-12-16 13:09:18,938 - WARNING - Part 4, row 11: Extraction contains newlines (should use \n)
2025-12-16 13:09:18,938 - WARNING - Part 4, row 15: Extraction contains newlines (should use \n)
2025-12-16 13:09:18,939 - WARNING - Part 4, row 2: Extraction contains newlines (should use \n)
2025-12-16 13:09:18,940 - WARNING - Part 4, row 4: Extraction contains newlines (should use \n)
2025-12-16 13:09:18,940 - WARNING - Part 4, row 7: Extraction contains newlines (should use \n)
2025-12-16 13:09:18,941 - WARNING - Part 4, row 9: Extraction contains newlines (should use \n)
2025-12-16 13:09:18,942 - WARNING - Part 4, row 10: Extraction contains newlines (should use \n)
2025-12-16 13:09:18,943 - WARNING - Part 4, row 11: Extraction contains newlines (should use \n)
2025-12-16 13:09:18,944 - WARNING - Part 4, row 15: Extraction contains newlines (should use \n)
2025-12-16 13:09:18,944 - INFO - Part 4: Parsed successfully - is_last=False, rows=16
2025-12-16 13:09:18,949 - INFO - Part 4: Added 16 rows (total: 112)
2025-12-16 13:09:18,951 - INFO - Part 4: is_last=false, continuing to next part...
2025-12-16 13:09:18,953 - INFO - Waiting 10.7s before next part...
2025-12-16 13:09:29,657 - INFO - === Processing Part 5 ===
2025-12-16 13:09:39,416 - INFO - PDF uploaded successfully with API key: bagher
2025-12-16 13:09:39,417 - INFO - Uploaded PDF file: Bolognia 5th Edition 2024 (1)-7-26-46.pdf
2025-12-16 13:09:39,418 - INFO - Model: gemini-2.5-pro, Max tokens for model: 32768, Using: 32768
2025-12-16 13:09:39,418 - INFO - Using max_output_tokens: 32768
2025-12-16 13:09:39,419 - INFO - Using model: gemini-2.5-pro
2025-12-16 13:09:39,420 - INFO - Sending prompt (length: 5361 characters)
2025-12-16 13:09:39,420 - INFO - Max output tokens: 32768
2025-12-16 13:09:39,421 - INFO - Multi-part mode: Using user's prompt as-is
2025-12-16 13:09:39,421 - INFO - Streaming disabled (force_no_streaming=True for multi-part processing)
2025-12-16 13:09:39,422 - INFO - Generating content with NON-STREAMING (large request detected to avoid rate limits)...
2025-12-16 13:12:47,416 - INFO - ✓ Request completed: 72688 characters received
2025-12-16 13:12:47,418 - INFO - Finish reason: STOP (normal completion)
2025-12-16 13:12:47,419 - INFO - ✓ Response completed normally
2025-12-16 13:12:47,427 - INFO - Part 5: Parsed successfully - is_last=True, rows=50
2025-12-16 13:12:47,435 - INFO - Part 5: Added 50 rows (total: 162)
2025-12-16 13:12:47,436 - INFO - Part 5: is_last=true, processing complete!
2025-12-16 13:12:47,437 - INFO - === Processing Summary ===
2025-12-16 13:12:47,438 - INFO - Parts processed: 4
2025-12-16 13:12:47,439 - INFO - Total parts in final output: 4
2025-12-16 13:12:47,439 - INFO - Total rows collected: 162
2025-12-16 13:12:47,440 - INFO - Deduplicating 162 rows...
2025-12-16 13:12:47,465 - WARNING - Removed 19 duplicate rows using enhanced deduplication
2025-12-16 13:12:47,466 - INFO - Final row count after deduplication: 143
2025-12-16 13:12:47,467 - INFO - Sorting 143 rows by Number (as float)...
2025-12-16 13:12:47,468 - INFO - Rows sorted successfully
2025-12-16 13:12:47,497 - INFO - ✓ Final JSON output saved to /home/mohammadbagher/Desktop/tts app bagher/content_automation_project/Bolognia 5th Edition 2024 1-7-26-46_final_output.json
2025-12-16 13:12:47,498 - INFO -   - File path: /home/mohammadbagher/Desktop/tts app bagher/content_automation_project/Bolognia 5th Edition 2024 1-7-26-46_final_output.json
2025-12-16 13:12:47,498 - INFO -   - Total parts: 4
2025-12-16 13:12:47,498 - INFO -   - Total rows: 143
2025-12-16 13:12:47,498 - INFO -   - File size: 208.99 KB
2025-12-16 13:12:47,523 - INFO - ✓ Final CSV output saved to /home/mohammadbagher/Desktop/tts app bagher/content_automation_project/Bolognia 5th Edition 2024 1-7-26-46_final_output.csv
2025-12-16 13:12:47,523 - INFO -   - File path: /home/mohammadbagher/Desktop/tts app bagher/content_automation_project/Bolognia 5th Edition 2024 1-7-26-46_final_output.csv
2025-12-16 13:12:47,524 - INFO -   - Total rows: 143
2025-12-16 13:12:47,524 - INFO -   - File size: 197.15 KB
2025-12-16 13:20:51,361 - INFO - Processing Part 1 with second-stage prompt...
2025-12-16 13:23:00,595 - INFO - Text processed successfully with gemini-2.5-pro
2025-12-16 13:23:00,597 - ERROR - Failed to parse JSON response in post-processor
2025-12-16 13:23:00,599 - ERROR - Failed to parse JSON for Part 1, aborting
2025-12-16 13:25:13,654 - INFO - Processing Part 1 with second-stage prompt...
2025-12-16 13:27:17,012 - INFO - Text processed successfully with gemini-2.5-pro
2025-12-16 13:27:17,017 - ERROR - Failed to parse JSON response in post-processor
2025-12-16 13:27:17,019 - ERROR - Failed to parse JSON for Part 1, aborting
2025-12-16 13:40:29,387 - INFO - Processing Part 1 with second-stage prompt...
2025-12-16 13:42:07,000 - INFO - Loaded 6 predefined prompts
2025-12-16 13:44:32,605 - INFO - Loaded 3 API keys
2025-12-16 13:46:16,187 - INFO - Processing Part 1 with second-stage prompt...
2025-12-16 13:48:24,748 - INFO - Text processed successfully with gemini-2.5-pro
2025-12-16 13:48:24,752 - ERROR - Failed to parse JSON response in post-processor
2025-12-16 13:48:24,752 - ERROR - Failed to parse JSON for Part 1, aborting
2025-12-16 14:03:35,551 - INFO - Loaded 6 predefined prompts
2025-12-16 14:03:53,879 - INFO - Loaded 3 API keys
2025-12-16 14:05:22,669 - INFO - Processing Part 1 with second-stage prompt...
2025-12-16 14:05:25,117 - ERROR - Text processing failed: 429 Resource has been exhausted (e.g. check quota).
2025-12-16 14:05:25,118 - ERROR - No response for Part 1, aborting post-process
2025-12-16 14:07:50,009 - INFO - Processing Part 1 with second-stage prompt...
2025-12-16 14:07:51,359 - ERROR - Text processing failed: 429 Resource has been exhausted (e.g. check quota).
2025-12-16 14:07:51,359 - ERROR - No response for Part 1, aborting post-process
2025-12-16 14:10:22,411 - INFO - === Starting PDF Processing ===
2025-12-16 14:10:22,412 - INFO - Model: gemini-2.5-pro
2025-12-16 14:10:22,413 - INFO - PDF: /home/mohammadbagher/Downloads/PDFs/Bolognia 5th Edition 2024 (1)-29-6-22.pdf
2025-12-16 14:10:22,413 - INFO - Full prompt being sent (6000 chars): You are a meticulous medical OCR & structuring assistant.

Your job is to extract ONLY what is present on each provided textbook page image/PDF
and convert it into clean, AI-ready text with structured sections.

You MUST avoid hallucinations and preserve original medical meaning precisely.

====================
GLOBAL PRINCIPLES
====================
- NO HALLUCINATIONS: Output only content visible on the page(s). If unreadable/unclear, write "[UNREADABLE]" or add an "uncertain" flag with brief reason.
- LANGUAGE & SPELLING: Preserve original English spelling and medical terminology.
- CLEAN OCR:
  - Remove headers/footers and running titles.
  - Fix broken words at line breaks.
  - Replace ligatures (ﬁ, ﬂ).
  - Preserve italics (*italic*), bold (**bold**), and subscripts/superscripts via LaTeX.
- CITATIONS: Keep in-text citations verbatim.
- MATH/CHEM: Use inline LaTeX.
- NO IMAGES: Describe figures textually only; do not invent labels.

====================
CRITICAL OUTPUT CONTRACT (MULTI-PART)
====================
The full output is TOO LARGE to fit in one response.

You MUST split the final output into multiple CHUNKS.

IMPORTANT:
- A CHUNK is ONLY a technical split of the RESPONSE due to size limits.
- CHUNKS are identified ONLY by the field "chunk_index".
- CHUNKS have NOTHING to do with the medical or logical structure of the chapter.

Each response MUST:
- Output ONLY valid JSON
- Contain ONLY ONE CHUNK of the final output
- NOT repeat rows from previous chunks
- Preserve the exact order of rows across chunks

====================
OUTPUT FORMAT (EXACT)
====================
{
  "chunk_index": <integer starting from 1>,
  "is_last": <true | false>,
  "rows": [
    {
      "Type": "page text | Figure | Table",
      "Extraction": "<single-line text or JSON>",
      "Number": <page number>,
      "Part": <integer>
    }
  ]
}

====================
MEANING OF chunk_index
====================
- "chunk_index" indicates ONLY the sequential number of this RESPONSE CHUNK.
- chunk_index = 1 means: first technical chunk of the output.
- chunk_index = 2 means: second technical chunk of the output.
- chunk_index has NO semantic meaning about the chapter content.
- chunk_index MUST strictly increase by 1 across responses.

====================
MEANING OF Part (VERY IMPORTANT)
====================
- "Part" represents the LOGICAL CONTENT PART of the chapter.
- "Part" is NOT related to chunk_index.
- "Part" is the result of grouping AUTHOR PARTS into YOUR OWN PARTS ("Our parts").

How to define "Part":
1) At the beginning of the chapter, there is a "Chapter contents" section that lists
   the author-defined parts ("author parts") and their first page.
2) You MUST group consecutive author parts into larger groups called "Our parts".
3) Each "Our part" MUST:
   - consist of consecutive author parts
   - NOT exceed 10 pages total
4) Assign integer labels starting from 1:
   - Our part 1
   - Our part 2
   - Our part 3
   - etc.

Example:
If author parts have page counts:
2, 4, 5, 3, 1, 7, 5

Then:
- Our part 1 = author parts 1 + 2 (in this example it is wrong to add the third author part because this way the first our part will be 11 pages which is more than 10 pages.)
- Our part 2 = author parts 3 + 4 + 5 (it is correct because they are 9 pages together which is less than 10 pages.)
- Our part 3 = author part 6
- Our part 4 = author part 7

Rules for assigning "Part" in rows:
- Every row MUST have exactly ONE integer "Part" value.
- A single page MAY belong to TWO different "Part" values if an Our part boundary
  occurs in the middle of the page.
- In such cases, split the page text into TWO separate rows:
  - one row with the previous Part value
  - one row with the next Part value
- NEVER mix content from two different Parts inside the same row.
- NEVER change Part value before an author part ends.
====================
PAGE-BY-PAGE FORWARD-ONLY PROCESSING (CRITICAL)
====================
You MUST process the document STRICTLY page by page, in ascending page order.
- NEVER go back to a previous page.
- NEVER re-extract or regenerate content from any page that has already appeared
  in earlier chunks.
- Once a page (or a portion of a page) is output in any chunk, it is considered FINAL.
- Subsequent chunks MUST continue ONLY from the next unprocessed page or page segment.
====================
Rules for rows
====================
- Each row represents exactly ONE of:
  - page text
  - figure
  - table
- Extraction MUST be single-line (no ENTER).
- JSON inside Extraction MUST be minified and valid.
- References section at end of chapter MUST be ignored.
====================
Rules for eFig and eTable
====================
- eFigs and eTables are some contents added after the chapter ends. They are not necessarily related contextually to the last our part. They can be related each of the previous our parts.
- you must find that each eFig and eTable belongs to which one of the our parts. 
- so when you are working on each chunk you must also check and find and include the eFigs and eTables that are related contextually to this chunk. Write the correct our part value for each eFig and eTable.
  


====================
CHUNK INSTRUCTIONS
====================
This is CHUNK {chunk_index} of the output.

Generate ONLY the rows that belong to this CHUNK.
Stop when you reach a safe size limit for a single response.
If more content remains after this CHUNK, set:
  "is_last": false
Otherwise set:
  "is_last": true

====================
AUTHOR PARTS → OUR PARTS RULES
====================
[keep your full original rules here verbatim — unchanged]

====================
FINAL RULES
====================
- DO NOT summarize.
- DO NOT explain.
- DO NOT add commentary.
- Output ONLY the JSON object described above.

You will now receive a PDF.
Generate CHUNK {chunk_index}.
2025-12-16 14:10:22,457 - INFO - Processing PDF with 17 pages in batches of 10 pages
2025-12-16 14:10:22,458 - INFO - Using original prompt with JSON output instruction for batch processing (prompt preserved)
2025-12-16 14:10:30,777 - INFO - Uploaded PDF file: Bolognia 5th Edition 2024 (1)-29-6-22.pdf
2025-12-16 14:10:30,778 - INFO - Processing batch 1/2: pages 1-10
2025-12-16 14:13:32,355 - INFO - ✓ Batch pages 1-10: Completed normally
2025-12-16 14:13:32,356 - INFO - Extracted content from generic code block
2025-12-16 14:13:32,356 - INFO - Found JSON array in 'rows' key with 55 items
2025-12-16 14:13:32,356 - INFO - Batch pages 1-10: Extracted 55 rows
2025-12-16 14:13:32,360 - INFO - Processing batch 2/2: pages 11-17
2025-12-16 14:16:00,995 - INFO - ✓ Batch pages 11-17: Completed normally
2025-12-16 14:16:00,997 - INFO - Extracted content from generic code block
2025-12-16 14:16:01,001 - INFO - Found JSON array in 'rows' key with 55 items
2025-12-16 14:16:01,001 - INFO - Batch pages 11-17: Extracted 55 rows
2025-12-16 14:16:01,035 - INFO - JSON saved to: /home/mohammadbagher/Desktop/tts app bagher/content_automation_project/Bolognia 5th Edition 2024 (1)-29-6-22_output_20251216_141601.json
2025-12-16 14:16:01,074 - INFO - JSON saved to: /home/mohammadbagher/Desktop/tts app bagher/content_automation_project/Bolognia 5th Edition 2024 (1)-29-6-22_output_20251216_141601.json
2025-12-16 14:16:02,876 - ERROR - Batch processing failed or returned no output
2025-12-16 14:16:02,878 - ERROR - Multi-part processing returned no final output file
2025-12-16 14:18:53,381 - INFO - Processing Part 1 with second-stage prompt...
2025-12-16 14:18:55,445 - ERROR - Text processing failed: 429 Resource has been exhausted (e.g. check quota).
2025-12-16 14:18:55,447 - ERROR - No response for Part 1, aborting post-process
2025-12-16 14:25:36,823 - INFO - Loaded 6 predefined prompts
2025-12-16 14:26:06,109 - INFO - Loaded 3 API keys
2025-12-16 14:28:05,510 - INFO - Processing Part 1 with second-stage prompt...
2025-12-16 14:28:07,952 - ERROR - Text processing failed: 429 Resource has been exhausted (e.g. check quota).
2025-12-16 14:28:07,953 - ERROR - No response for Part 1, aborting post-process
2025-12-17 08:10:45,284 - INFO - Loaded 6 predefined prompts
2025-12-17 08:11:05,877 - INFO - Loaded 3 API keys
2025-12-17 08:15:11,068 - INFO - Processing Part 1 with second-stage prompt...
2025-12-17 08:17:07,984 - INFO - Text processed successfully with gemini-2.5-pro
2025-12-17 08:17:07,988 - ERROR - Failed to parse JSON response in post-processor
2025-12-17 08:17:07,989 - ERROR - Failed to parse JSON for Part 1, aborting
2025-12-17 08:20:22,048 - INFO - Loaded 6 predefined prompts
2025-12-17 08:20:45,238 - INFO - Loaded 3 API keys
2025-12-17 08:22:12,137 - INFO - Processing Part 1 with second-stage prompt...
2025-12-17 08:23:55,162 - INFO - Text processed successfully with gemini-2.5-pro
2025-12-17 08:23:55,172 - INFO - Processing Part 2 with second-stage prompt...
2025-12-17 08:25:56,001 - INFO - Text processed successfully with gemini-2.5-pro
2025-12-17 08:25:56,006 - ERROR - Failed to parse JSON response in post-processor
2025-12-17 08:25:56,006 - ERROR - Response length: 31706
2025-12-17 08:25:56,007 - ERROR - Response text (first 1000 chars):
```json
{
  "chapter": "گروه پمفیگوئید",
  "content": [
    {
      "level_1": "فصل: گروه پمفیگوئید",
      "children": [
        {
          "level_2": "زیرفصل: پمفیگوئید غشاء مخاطی (MMP) - کلیات",
          "children": [
            {
              "level_3": "مبحث: تعاریف و تاریخچه",
              "children": [
                {
                  "level_4": "عنوان: تعاریف کلیدی و مشخصات اصلی",
                  "children": [
                    {
                      "level_5": "زیرعنوان: ماهیت بیماری",
                      "points": [
                        "• یک اختلال تاولی، خودایمن و مزمن زیر اپیتلیال",
                        "• مشخصه اصلی: درگیری غالب سطوح مخاطی خارجی",
                        "• مشخصه اصلی: تمایل به ایجاد اسکار در نواحی درگیر",
                        "• یک \"فنوتیپ بیماری\" مشترک بین گروهی از بیماری‌های هتروژن با ترجیح درگیری مخاط",
                        "• سیر مزمن و پیشرونده"
                      ]
                    },
                    {
       
2025-12-17 08:25:56,008 - ERROR - Direct parse error: Expecting value: line 1 column 1 (char 0)
2025-12-17 08:25:56,008 - ERROR - Extract parse error: Expecting ',' delimiter: line 624 column 24 (char 31298)
2025-12-17 08:25:56,008 - ERROR - Failed to parse JSON for Part 2, aborting
2025-12-17 08:25:56,009 - ERROR - Response received (first 500 chars): ```json
{
  "chapter": "گروه پمفیگوئید",
  "content": [
    {
      "level_1": "فصل: گروه پمفیگوئید",
      "children": [
        {
          "level_2": "زیرفصل: پمفیگوئید غشاء مخاطی (MMP) - کلیات",
          "children": [
            {
              "level_3": "مبحث: تعاریف و تاریخچه",
              "children": [
                {
                  "level_4": "عنوان: تعاریف کلیدی و مشخصات اصلی",
                  "children": [
                    {
                      "level_5": "زیرعنوان: ما
2025-12-17 08:31:26,909 - INFO - Loaded 6 predefined prompts
2025-12-17 08:31:51,475 - INFO - Loaded 3 API keys
2025-12-17 08:33:10,015 - INFO - Processing Part 1 with second-stage prompt...
2025-12-17 08:35:10,716 - INFO - Text processed successfully with gemini-2.5-pro
2025-12-17 08:35:10,720 - INFO - Processing Part 2 with second-stage prompt...
2025-12-17 08:36:42,660 - INFO - Text processed successfully with gemini-2.5-pro
2025-12-17 08:36:42,660 - INFO - Processing Part 3 with second-stage prompt...
2025-12-17 08:38:04,937 - INFO - Text processed successfully with gemini-2.5-pro
2025-12-17 08:38:04,941 - INFO - Post-processed output saved to: /home/mohammadbagher/Desktop/tts app bagher/content_automation_project/Bolognia 5th Edition 2024 1-7-26-46_final_output_post_processed.txt
2025-12-17 08:43:32,623 - INFO - Loaded 6 predefined prompts
2025-12-17 08:43:51,371 - INFO - Loaded 3 API keys
2025-12-17 08:45:16,851 - INFO - Loading input JSON file: /home/mohammadbagher/Desktop/tts app bagher/content_automation_project/Bolognia 5th Edition 2024 1-7-26-46_final_output.json
2025-12-17 08:45:16,864 - INFO - Found 143 rows in input JSON. Grouping by Part...
2025-12-17 08:45:16,866 - INFO - Processing 3 parts: [1, 2, 3]
2025-12-17 08:45:16,881 - INFO - Processing Part 1 (94 rows) with second-stage prompt...
2025-12-17 08:47:15,416 - INFO - Text processed successfully with gemini-2.5-pro
2025-12-17 08:47:15,417 - INFO - Part 1 processed successfully. Response length: 27438 characters
2025-12-17 08:47:15,423 - INFO - Processing Part 2 (36 rows) with second-stage prompt...
2025-12-17 08:49:11,357 - INFO - Text processed successfully with gemini-2.5-pro
2025-12-17 08:49:11,358 - INFO - Part 2 processed successfully. Response length: 21308 characters
2025-12-17 08:49:11,360 - INFO - Processing Part 3 (13 rows) with second-stage prompt...
2025-12-17 08:50:31,669 - INFO - Text processed successfully with gemini-2.5-pro
2025-12-17 08:50:31,670 - INFO - Part 3 processed successfully. Response length: 18410 characters
2025-12-17 08:50:31,671 - INFO - Combining responses from all parts...
2025-12-17 08:50:31,671 - INFO - Extracting JSON blocks from responses...
2025-12-17 08:50:31,702 - INFO - Found 2 JSON block(s) in responses
2025-12-17 08:50:31,705 - WARNING - Failed to parse JSON block 2/2: Expecting ',' delimiter: line 428 column 12 (char 21299). Attempting fallback extraction...
2025-12-17 08:50:31,706 - WARNING - Fallback extraction failed for block 2
2025-12-17 08:50:31,706 - INFO - Successfully extracted 1 valid JSON block(s)
2025-12-17 08:50:31,706 - INFO - Combining JSON blocks into final structure...
2025-12-17 08:50:31,706 - INFO - Final structure: chapter 'گروه پمفیگوئید' with 1 content items
2025-12-17 08:50:31,707 - INFO - Saving post-processed JSON to: /home/mohammadbagher/Desktop/tts app bagher/content_automation_project/Bolognia 5th Edition 2024 1-7-26-46_final_output_post_processed.json
2025-12-17 08:50:31,712 - INFO - Post-processed JSON saved successfully: /home/mohammadbagher/Desktop/tts app bagher/content_automation_project/Bolognia 5th Edition 2024 1-7-26-46_final_output_post_processed.json
2025-12-17 08:56:50,411 - INFO - Text processed successfully with gemini-2.5-pro
2025-12-17 08:56:50,427 - ERROR - Failed to parse JSON from response. Direct parse error: Expecting value: line 1 column 1 (char 0), Extract parse error: Expecting ',' delimiter: line 842 column 22 (char 44493)
2025-12-17 08:56:50,429 - WARNING - Could not parse hierarchical structure from model response.

Reason: Failed to extract JSON from response string.
2025-12-17 09:07:21,346 - INFO - Loaded 6 predefined prompts
2025-12-17 09:07:40,348 - INFO - Loaded 3 API keys
2025-12-17 09:11:36,675 - INFO - Text processed successfully with gemini-2.5-pro
2025-12-17 09:11:36,716 - INFO - Loading third stage file: /home/mohammadbagher/Desktop/tts app bagher/content_automation_project/Bolognia 5th Edition 2024 1-7-26-46_final_output_Bolognia 5th Edition 2024 1-7-26-46_final_output_post_processed_corrected_raw.json
2025-12-17 09:11:36,727 - INFO - Extracting JSON from response field...
2025-12-17 09:11:36,779 - WARNING - Direct JSON parse failed: Expecting value: line 1 column 1 (char 0). Trying fallback extraction...
2025-12-17 09:11:36,780 - ERROR - Failed to extract JSON from response
2025-12-17 09:11:36,780 - WARNING - Converter failed, falling back to old method
2025-12-17 09:11:36,782 - ERROR - Failed to parse JSON from response. Direct parse error: Expecting value: line 1 column 1 (char 0), Extract parse error: Expecting ',' delimiter: line 897 column 14 (char 40218)
2025-12-17 09:11:36,783 - WARNING - Could not parse hierarchical structure from model response.

Reason: Failed to extract JSON from response string.
2025-12-17 09:14:26,379 - INFO - Loaded 6 predefined prompts
2025-12-17 09:14:59,051 - INFO - Loaded 3 API keys
2025-12-17 09:18:58,263 - INFO - Text processed successfully with gemini-2.5-pro
2025-12-17 09:18:58,316 - INFO - Loading third stage file: /home/mohammadbagher/Desktop/tts app bagher/content_automation_project/Bolognia 5th Edition 2024 1-7-26-46_final_output_Bolognia 5th Edition 2024 1-7-26-46_final_output_post_processed_corrected_raw.json
2025-12-17 09:18:58,321 - INFO - Extracting JSON from response field...
2025-12-17 09:18:58,386 - WARNING - Direct JSON parse failed: Expecting value: line 1 column 1 (char 0). Trying fallback extraction...
2025-12-17 09:18:58,387 - WARNING - Object extraction parse failed: Expecting ',' delimiter: line 844 column 22 (char 43852)
2025-12-17 09:18:58,399 - ERROR - All JSON extraction methods failed
2025-12-17 09:18:58,399 - ERROR - Failed to extract JSON from response
2025-12-17 09:18:58,399 - WARNING - Converter failed, falling back to old method
2025-12-17 09:18:58,401 - ERROR - Failed to parse JSON from response. Direct parse error: Expecting value: line 1 column 1 (char 0), Extract parse error: Expecting ',' delimiter: line 844 column 22 (char 43852)
2025-12-17 09:18:58,401 - WARNING - Could not parse hierarchical structure from model response.

Reason: Failed to extract JSON from response string.
2025-12-17 09:46:17,452 - INFO - Text processed successfully with gemini-2.5-pro
2025-12-17 09:46:17,463 - INFO - Loading third stage file: /home/mohammadbagher/Desktop/tts app bagher/content_automation_project/Bolognia 5th Edition 2024 1-7-26-46_final_output_Bolognia 5th Edition 2024 1-7-26-46_final_output_post_processed_corrected_raw.json
2025-12-17 09:46:17,470 - INFO - Extracting JSON from response field...
2025-12-17 09:46:17,543 - WARNING - Direct JSON parse failed: Expecting value: line 1 column 1 (char 0). Trying fallback extraction...
2025-12-17 09:46:17,544 - WARNING - Object extraction parse failed: Expecting ',' delimiter: line 895 column 22 (char 47987)
2025-12-17 09:46:17,561 - ERROR - All JSON extraction methods failed
2025-12-17 09:46:17,564 - ERROR - Failed to extract JSON from response
2025-12-17 09:46:17,564 - WARNING - Converter failed, falling back to old method
2025-12-17 09:46:17,566 - ERROR - Failed to parse JSON from response. Direct parse error: Expecting value: line 1 column 1 (char 0), Extract parse error: Expecting ',' delimiter: line 895 column 22 (char 47987)
2025-12-17 09:46:17,567 - WARNING - Could not parse hierarchical structure from model response.

Reason: Failed to extract JSON from response string.
2025-12-17 10:10:46,242 - INFO - Loaded 6 predefined prompts
2025-12-17 10:12:06,938 - INFO - Loaded 3 API keys
2025-12-17 10:13:32,247 - INFO - Starting third-stage chunked processing...
2025-12-17 10:13:32,248 - INFO - Processing third-stage chunk 1...
2025-12-17 10:15:11,212 - INFO - Text processed successfully with gemini-2.5-pro
2025-12-17 10:15:11,213 - INFO - Chunk 1: added 1 content item(s). Total so far: 1
2025-12-17 10:15:11,213 - INFO - Processing third-stage chunk 2...
2025-12-17 10:17:16,626 - INFO - Text processed successfully with gemini-2.5-pro
2025-12-17 10:17:16,631 - INFO - Chunk 2: added 1 content item(s). Total so far: 2
2025-12-17 10:17:16,633 - INFO - Processing third-stage chunk 3...
2025-12-17 10:18:43,355 - INFO - Text processed successfully with gemini-2.5-pro
2025-12-17 10:18:43,359 - INFO - Chunk 3: added 1 content item(s). Total so far: 3
2025-12-17 10:18:43,361 - INFO - Processing third-stage chunk 4...
2025-12-17 10:19:51,285 - INFO - Text processed successfully with gemini-2.5-pro
2025-12-17 10:19:51,286 - INFO - Chunk 4: added 1 content item(s). Total so far: 4
2025-12-17 10:19:51,288 - INFO - Received last chunk (index=4).
2025-12-17 10:19:51,288 - INFO - Third-stage chunked processing completed. Total content items: 4
2025-12-17 10:19:51,303 - INFO - Loading third stage file: /home/mohammadbagher/Desktop/tts app bagher/content_automation_project/Bolognia 5th Edition 2024 1-7-26-46_final_output_Bolognia 5th Edition 2024 1-7-26-46_final_output_post_processed_corrected_raw.json
2025-12-17 10:19:51,304 - INFO - Extracting JSON from response field...
2025-12-17 10:19:51,306 - INFO - Flattening hierarchical structure to points...
2025-12-17 10:19:51,306 - INFO - Processing chapter: 'گروه پمفیگوئید' with 4 top-level items
2025-12-17 10:19:51,312 - INFO - Extracted 561 points. Generating PointIds...
2025-12-17 10:19:51,320 - INFO - Saving converted JSON to: /home/mohammadbagher/Desktop/tts app bagher/content_automation_project/Bolognia 5th Edition 2024 1-7-26-46_final_output_Bolognia 5th Edition 2024 1-7-26-46_final_output_post_processed_corrected_raw_converted.json
2025-12-17 10:19:51,338 - INFO - Successfully converted and saved: /home/mohammadbagher/Desktop/tts app bagher/content_automation_project/Bolognia 5th Edition 2024 1-7-26-46_final_output_Bolognia 5th Edition 2024 1-7-26-46_final_output_post_processed_corrected_raw_converted.json
2025-12-17 11:33:55,629 - INFO - Loaded 6 predefined prompts
2025-12-17 11:34:54,421 - INFO - Loaded 3 API keys
2025-12-17 11:37:24,295 - INFO - Starting third-stage chunked processing...
2025-12-17 11:37:24,296 - INFO - Processing third-stage chunk 1...
2025-12-17 11:38:36,138 - INFO - Text processed successfully with gemini-2.5-pro
2025-12-17 11:38:36,140 - ERROR - Error in fourth-stage processing: 'list' object has no attribute 'get'
Traceback (most recent call last):
  File "/home/mohammadbagher/Desktop/tts app bagher/content_automation_project/main_gui.py", line 1541, in process_fourth_stage_worker
    final_structured_json = run_third_stage_chunked(
                            ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/mohammadbagher/Desktop/tts app bagher/content_automation_project/third_stage_chunk_processor.py", line 179, in run_third_stage_chunked
    payload_content = payload.get("content", [])
                      ^^^^^^^^^^^
AttributeError: 'list' object has no attribute 'get'
2025-12-17 11:42:34,092 - INFO - Loaded 6 predefined prompts
2025-12-17 11:42:53,460 - INFO - Loaded 3 API keys
2025-12-17 11:44:20,498 - INFO - Starting third-stage chunked processing...
2025-12-17 11:44:20,498 - INFO - Processing third-stage chunk 1...
2025-12-17 11:45:11,604 - INFO - Text processed successfully with gemini-2.5-pro
2025-12-17 11:45:11,605 - INFO - Chunk 1: added 10 content item(s). Total so far: 10
2025-12-17 11:45:11,606 - INFO - Processing third-stage chunk 2...
2025-12-17 11:45:59,219 - INFO - Text processed successfully with gemini-2.5-pro
2025-12-17 11:45:59,220 - INFO - Chunk 2: added 7 content item(s). Total so far: 17
2025-12-17 11:45:59,222 - INFO - Processing third-stage chunk 3...
2025-12-17 11:46:32,499 - INFO - Text processed successfully with gemini-2.5-pro
2025-12-17 11:46:32,500 - INFO - Chunk 3: added 4 content item(s). Total so far: 21
2025-12-17 11:46:32,500 - INFO - Processing third-stage chunk 4...
2025-12-17 11:47:47,465 - INFO - Text processed successfully with gemini-2.5-pro
2025-12-17 11:47:47,468 - INFO - Chunk 4: added 21 content item(s). Total so far: 42
2025-12-17 11:47:47,470 - INFO - Received last chunk (index=4).
2025-12-17 11:47:47,472 - INFO - Third-stage chunked processing completed. Total content items: 42
2025-12-17 12:18:59,199 - INFO - Loaded 6 predefined prompts
2025-12-17 12:20:17,132 - INFO - Loaded 3 API keys
2025-12-17 12:24:13,765 - INFO - Text processed successfully with gemini-2.5-pro
2025-12-17 12:27:40,805 - INFO - Text processed successfully with gemini-2.5-pro
2025-12-17 12:32:22,280 - INFO - Starting third-stage chunked processing...
2025-12-17 12:32:22,281 - INFO - Processing third-stage chunk 1...
2025-12-17 12:34:41,351 - INFO - Text processed successfully with gemini-2.5-pro
2025-12-17 12:34:41,352 - ERROR - Failed to parse JSON for third-stage chunk 1: Expecting value: line 1 column 1 (char 0)
2025-12-17 12:59:32,055 - INFO - Loaded 6 predefined prompts
2025-12-17 12:59:50,716 - INFO - Loaded 3 API keys
2025-12-17 13:05:17,229 - INFO - Text processed successfully with gemini-2.5-pro
2025-12-17 13:07:38,775 - INFO - Starting third-stage chunked processing...
2025-12-17 13:07:38,776 - INFO - Processing third-stage chunk 1...
2025-12-17 13:08:55,572 - INFO - Text processed successfully with gemini-2.5-pro
2025-12-17 13:08:55,576 - INFO - Chunk 1: added 1 content item(s). Total so far: 1
2025-12-17 13:08:55,578 - INFO - Processing third-stage chunk 2...
2025-12-17 13:10:52,894 - INFO - Text processed successfully with gemini-2.5-pro
2025-12-17 13:10:52,899 - INFO - Chunk 2: added 1 content item(s). Total so far: 2
2025-12-17 13:10:52,901 - INFO - Processing third-stage chunk 3...
2025-12-17 13:12:56,733 - INFO - Text processed successfully with gemini-2.5-pro
2025-12-17 13:12:56,738 - INFO - Chunk 3: added 1 content item(s). Total so far: 3
2025-12-17 13:12:56,740 - INFO - Processing third-stage chunk 4...
2025-12-17 13:14:25,647 - INFO - Text processed successfully with gemini-2.5-pro
2025-12-17 13:14:25,656 - INFO - Chunk 4: added 1 content item(s). Total so far: 4
2025-12-17 13:14:25,660 - INFO - Received last chunk (index=4).
2025-12-17 13:14:25,661 - INFO - Third-stage chunked processing completed. Total content items: 4
2025-12-17 13:14:25,675 - WARNING - Failed to save raw corrected JSON: [Errno 36] File name too long: '/home/mohammadbagher/Desktop/tts app bagher/content_automation_project/Bolognia 5th Edition 2024 1-7-26-46_final_output_Bolognia 5th Edition 2024 1-7-26-46_final_output_Bolognia 5th Edition 2024 1-7-26-46_final_output_Bolognia 5th Edition 2024 1-7-26-46_final_output_post_processed_corrected_stage3_raw_converted_corrected_raw.json'
2025-12-17 13:14:25,676 - ERROR - Input file not found: /home/mohammadbagher/Desktop/tts app bagher/content_automation_project/Bolognia 5th Edition 2024 1-7-26-46_final_output_Bolognia 5th Edition 2024 1-7-26-46_final_output_Bolognia 5th Edition 2024 1-7-26-46_final_output_Bolognia 5th Edition 2024 1-7-26-46_final_output_post_processed_corrected_stage3_raw_converted_corrected_raw.json
2025-12-17 13:14:25,676 - WARNING - Converter failed, falling back to old method
2025-12-17 13:14:25,684 - ERROR - Error in third-stage processing: [Errno 36] File name too long: '/home/mohammadbagher/Desktop/tts app bagher/content_automation_project/Bolognia 5th Edition 2024 1-7-26-46_final_output_Bolognia 5th Edition 2024 1-7-26-46_final_output_Bolognia 5th Edition 2024 1-7-26-46_final_output_Bolognia 5th Edition 2024 1-7-26-46_final_output_post_processed_corrected_stage3_raw_converted_corrected.json'
Traceback (most recent call last):
  File "/home/mohammadbagher/Desktop/tts app bagher/content_automation_project/main_gui.py", line 1487, in process_third_stage_worker
    with open(output_path, "w", encoding="utf-8") as f:
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
OSError: [Errno 36] File name too long: '/home/mohammadbagher/Desktop/tts app bagher/content_automation_project/Bolognia 5th Edition 2024 1-7-26-46_final_output_Bolognia 5th Edition 2024 1-7-26-46_final_output_Bolognia 5th Edition 2024 1-7-26-46_final_output_Bolognia 5th Edition 2024 1-7-26-46_final_output_post_processed_corrected_stage3_raw_converted_corrected.json'
2025-12-17 13:23:07,442 - INFO - Loaded 6 predefined prompts
2025-12-17 13:23:58,313 - INFO - Loaded 3 API keys
2025-12-17 13:26:09,486 - INFO - Starting third-stage chunked processing...
2025-12-17 13:26:09,487 - INFO - Processing third-stage chunk 1...
2025-12-17 13:27:59,516 - INFO - Text processed successfully with gemini-2.5-pro
2025-12-17 13:27:59,520 - INFO - Chunk 1: added 1 content item(s). Total so far: 1
2025-12-17 13:27:59,522 - INFO - Processing third-stage chunk 2...
2025-12-17 13:29:35,924 - INFO - Text processed successfully with gemini-2.5-pro
2025-12-17 13:29:35,928 - INFO - Chunk 2: added 1 content item(s). Total so far: 2
2025-12-17 13:29:35,929 - INFO - Processing third-stage chunk 3...
2025-12-17 13:31:15,664 - INFO - Text processed successfully with gemini-2.5-pro
2025-12-17 13:31:15,667 - INFO - Chunk 3: added 1 content item(s). Total so far: 3
2025-12-17 13:31:15,669 - INFO - Processing third-stage chunk 4...
2025-12-17 13:33:11,812 - INFO - Text processed successfully with gemini-2.5-pro
2025-12-17 13:33:11,816 - INFO - Chunk 4: added 1 content item(s). Total so far: 4
2025-12-17 13:33:11,818 - INFO - Processing third-stage chunk 5...
2025-12-17 13:34:46,791 - INFO - Text processed successfully with gemini-2.5-pro
2025-12-17 13:34:46,792 - INFO - Chunk 5: added 1 content item(s). Total so far: 5
2025-12-17 13:34:46,792 - INFO - Received last chunk (index=5).
2025-12-17 13:34:46,792 - INFO - Third-stage chunked processing completed. Total content items: 5
2025-12-17 13:34:46,797 - WARNING - Failed to save raw corrected JSON: [Errno 36] File name too long: '/home/mohammadbagher/Desktop/tts app bagher/content_automation_project/Bolognia 5th Edition 2024 1-7-26-46_final_output_Bolognia 5th Edition 2024 1-7-26-46_final_output_Bolognia 5th Edition 2024 1-7-26-46_final_output_Bolognia 5th Edition 2024 1-7-26-46_final_output_post_processed_corrected_stage3_raw_converted_corrected_raw.json'
2025-12-17 13:34:46,798 - ERROR - Input file not found: /home/mohammadbagher/Desktop/tts app bagher/content_automation_project/Bolognia 5th Edition 2024 1-7-26-46_final_output_Bolognia 5th Edition 2024 1-7-26-46_final_output_Bolognia 5th Edition 2024 1-7-26-46_final_output_Bolognia 5th Edition 2024 1-7-26-46_final_output_post_processed_corrected_stage3_raw_converted_corrected_raw.json
2025-12-17 13:34:46,798 - WARNING - Converter failed, falling back to old method
2025-12-17 14:04:32,649 - INFO - Loaded 6 predefined prompts
2025-12-17 14:10:11,088 - INFO - Starting fourth-stage chunked processing...
2025-12-17 14:10:11,090 - INFO - Processing fourth-stage chunk 1...
2025-12-17 14:10:11,091 - ERROR - No API key available
2025-12-17 14:10:11,093 - INFO - ❌ No response for chunk 1
2025-12-20 08:26:06,780 - INFO - Loaded 6 predefined prompts
2025-12-20 11:08:27,005 - INFO - Loaded 6 predefined prompts
2025-12-20 11:10:11,338 - INFO - Loaded 3 API keys
2025-12-20 11:13:29,251 - INFO - Starting Stage E processing...
2025-12-20 11:13:29,252 - INFO - Loading Stage 4 JSON...
2025-12-20 11:13:29,256 - INFO - Successfully loaded JSON: /home/mohammadbagher/Downloads/Bolognia 5th Edition 2024 1-7-26-46_final_output_final_points.json
2025-12-20 11:13:29,257 - INFO - Loading Stage 1 JSON...
2025-12-20 11:13:29,259 - INFO - Successfully loaded JSON: /home/mohammadbagher/Downloads/Bolognia 5th Edition 2024 1-7-26-46_final_output.json
2025-12-20 11:13:29,259 - INFO - Detected Book ID: 105, Chapter ID: 30
2025-12-20 11:13:29,260 - INFO - Last PointId in Stage 4: 1050300708, Starting image notes from index: 709
2025-12-20 11:13:29,260 - INFO - Preparing input for model...
2025-12-20 11:13:29,276 - INFO - Calling model gemini-2.5-pro...
2025-12-20 11:16:56,777 - INFO - Text processed successfully with gemini-2.5-pro
2025-12-20 11:16:56,779 - INFO - Extracting JSON from model response...
2025-12-20 11:16:56,781 - WARNING - No closing markdown marker found, JSON may be incomplete
2025-12-20 11:16:56,783 - WARNING - Direct JSON parse failed: Expecting property name enclosed in double quotes: line 122 column 45 (char 13145). Trying fallback extraction...
2025-12-20 11:16:56,786 - WARNING - Object extraction parse failed: Expecting ',' delimiter: line 119 column 6 (char 13058)
2025-12-20 11:16:56,802 - INFO - Attempting to repair incomplete JSON...
2025-12-20 11:16:56,840 - WARNING - Repair method returned None
2025-12-20 11:16:56,841 - ERROR - All JSON extraction methods failed
2025-12-20 11:16:56,841 - WARNING - Failed to extract JSON from response
2025-12-20 11:16:56,842 - ERROR - Failed to extract JSON from model response
2025-12-20 11:20:17,748 - INFO - Loaded 6 predefined prompts
2025-12-20 11:21:19,708 - INFO - Loaded 3 API keys
2025-12-20 11:21:43,303 - INFO - Starting Stage E processing...
2025-12-20 11:21:43,303 - INFO - Loading Stage 4 JSON...
2025-12-20 11:21:43,307 - INFO - Successfully loaded JSON: /home/mohammadbagher/Downloads/Bolognia 5th Edition 2024 1-7-26-46_final_output_final_points.json
2025-12-20 11:21:43,308 - INFO - Loading Stage 1 JSON...
2025-12-20 11:21:43,310 - INFO - Successfully loaded JSON: /home/mohammadbagher/Downloads/Bolognia 5th Edition 2024 1-7-26-46_final_output.json
2025-12-20 11:21:43,310 - INFO - Detected Book ID: 105, Chapter ID: 30
2025-12-20 11:21:43,311 - INFO - Last PointId in Stage 4: 1050300708, Starting image notes from index: 709
2025-12-20 11:21:43,312 - INFO - Preparing input for model...
2025-12-20 11:21:43,326 - INFO - Calling model gemini-2.5-pro...
2025-12-20 11:24:36,865 - INFO - Text processed successfully with gemini-2.5-pro
2025-12-20 11:24:36,866 - INFO - Saving model response as TXT file...
2025-12-20 11:24:36,874 - INFO - Model response saved to: /home/mohammadbagher/Downloads/Bolognia 5th Edition 2024 1-7-26-46_final_output_final_points_stage_e.txt
2025-12-20 11:24:36,876 - INFO - Stage E raw text saved: /home/mohammadbagher/Downloads/Bolognia 5th Edition 2024 1-7-26-46_final_output_final_points_stage_e.txt
2025-12-20 11:24:36,882 - INFO - Converting TXT to JSON...
2025-12-20 11:24:36,887 - INFO - Successfully extracted JSON from TXT using ThirdStageConverter for /home/mohammadbagher/Downloads/Bolognia 5th Edition 2024 1-7-26-46_final_output_final_points_stage_e.txt
2025-12-20 11:24:36,893 - INFO - Successfully loaded JSON from TXT: /home/mohammadbagher/Downloads/Bolognia 5th Edition 2024 1-7-26-46_final_output_final_points_stage_e.txt
2025-12-20 11:24:36,895 - INFO - Extracted 42 image note records
2025-12-20 11:24:36,898 - INFO - Processing image notes...
2025-12-20 11:24:36,908 - INFO - Processed 42 image notes
2025-12-20 11:24:36,914 - INFO - First image PointId: 1050300709
2025-12-20 11:24:36,916 - INFO - Merging Stage 4 points with image notes...
2025-12-20 11:24:36,920 - INFO - Saving merged JSON to: /home/mohammadbagher/Downloads/e105030.json
2025-12-20 11:24:36,963 - INFO - Successfully saved JSON: /home/mohammadbagher/Downloads/e105030.json (750 records)
2025-12-20 11:24:36,963 - INFO - Stage E completed successfully: /home/mohammadbagher/Downloads/e105030.json
2025-12-20 11:37:25,634 - INFO - Loaded 6 predefined prompts
2025-12-20 11:38:47,937 - INFO - Loaded 3 API keys
2025-12-20 11:39:30,390 - INFO - Starting Stage E processing...
2025-12-20 11:39:30,390 - INFO - Loading Stage 4 JSON...
2025-12-20 11:39:30,395 - INFO - Successfully loaded JSON: /home/mohammadbagher/Downloads/Bolognia 5th Edition 2024 1-7-26-46_final_output_final_points.json
2025-12-20 11:39:30,396 - INFO - Loading Stage 1 JSON...
2025-12-20 11:39:30,398 - INFO - Successfully loaded JSON: /home/mohammadbagher/Downloads/Bolognia 5th Edition 2024 1-7-26-46_final_output.json
2025-12-20 11:39:30,398 - INFO - Detected Book ID: 105, Chapter ID: 30
2025-12-20 11:39:30,399 - INFO - Last PointId in Stage 4: 1050300708, Starting image notes from index: 709
2025-12-20 11:39:30,399 - INFO - Preparing input for model...
2025-12-20 11:39:30,418 - INFO - Calling model gemini-2.5-pro...
2025-12-20 11:42:47,256 - INFO - Text processed successfully with gemini-2.5-pro
2025-12-20 11:42:47,258 - INFO - Saving model response as TXT file...
2025-12-20 11:42:47,262 - INFO - Model response saved to: /home/mohammadbagher/Downloads/Bolognia 5th Edition 2024 1-7-26-46_final_output_final_points_stage_e.txt
2025-12-20 11:42:47,263 - INFO - Stage E raw text saved: /home/mohammadbagher/Downloads/Bolognia 5th Edition 2024 1-7-26-46_final_output_final_points_stage_e.txt
2025-12-20 11:42:47,266 - INFO - Converting TXT to JSON...
2025-12-20 11:42:47,269 - INFO - Successfully extracted JSON from TXT using ThirdStageConverter for /home/mohammadbagher/Downloads/Bolognia 5th Edition 2024 1-7-26-46_final_output_final_points_stage_e.txt
2025-12-20 11:42:47,273 - INFO - Successfully loaded JSON from TXT: /home/mohammadbagher/Downloads/Bolognia 5th Edition 2024 1-7-26-46_final_output_final_points_stage_e.txt
2025-12-20 11:42:47,278 - INFO - Extracted 24 image note records
2025-12-20 11:42:47,287 - INFO - Processing image notes...
2025-12-20 11:42:47,296 - INFO - Processed 24 image notes
2025-12-20 11:42:47,298 - INFO - First image PointId: 1050300709
2025-12-20 11:42:47,303 - INFO - Merging Stage 4 points with image notes...
2025-12-20 11:42:47,308 - INFO - Saving merged JSON to: /home/mohammadbagher/Downloads/e105030.json
2025-12-20 11:42:47,362 - INFO - Successfully saved JSON: /home/mohammadbagher/Downloads/e105030.json (732 records)
2025-12-20 11:42:47,362 - INFO - Stage E completed successfully: /home/mohammadbagher/Downloads/e105030.json
2025-12-20 11:56:48,916 - INFO - Loaded 6 predefined prompts
2025-12-20 11:59:42,052 - INFO - Starting Stage F processing...
2025-12-20 11:59:42,052 - INFO - Loading Stage E JSON...
2025-12-20 11:59:42,057 - INFO - Successfully loaded JSON: /home/mohammadbagher/Downloads/e105030.json
2025-12-20 11:59:42,058 - INFO - First image PointId: 1050300709
2025-12-20 11:59:42,059 - INFO - Found 24 image records starting from index 708
2025-12-20 11:59:42,060 - INFO - Loading descriptions from Stage E TXT file...
2025-12-20 11:59:42,065 - INFO - Successfully extracted JSON from TXT using ThirdStageConverter for /home/mohammadbagher/Downloads/Bolognia 5th Edition 2024 1-7-26-46_final_output_final_points_stage_e.txt
2025-12-20 11:59:42,066 - INFO - Successfully loaded JSON from TXT: /home/mohammadbagher/Downloads/Bolognia 5th Edition 2024 1-7-26-46_final_output_final_points_stage_e.txt
2025-12-20 11:59:42,067 - INFO - Loaded 0 descriptions from filepic
2025-12-20 11:59:42,068 - INFO - Processing image records...
2025-12-20 11:59:42,069 - INFO - Generated 24 image records
2025-12-20 11:59:42,070 - INFO - Saving image file JSON to: /home/mohammadbagher/Downloads/f.json
2025-12-20 11:59:42,071 - INFO - Successfully saved JSON: /home/mohammadbagher/Downloads/f.json (24 records)
2025-12-20 11:59:42,072 - INFO - Stage F completed successfully: /home/mohammadbagher/Downloads/f.json
2025-12-20 12:08:55,722 - INFO - Loaded 6 predefined prompts
2025-12-20 12:09:29,662 - INFO - Starting Stage F processing...
2025-12-20 12:09:29,664 - INFO - Loading Stage E JSON...
2025-12-20 12:09:29,668 - INFO - Successfully loaded JSON: /home/mohammadbagher/Downloads/e105030.json
2025-12-20 12:09:29,669 - INFO - First image PointId: 1050300709
2025-12-20 12:09:29,670 - INFO - Found 24 image records starting from index 708
2025-12-20 12:09:29,671 - INFO - Loading descriptions from Stage E TXT file (fallback)...
2025-12-20 12:09:29,671 - INFO - Successfully extracted JSON from TXT using ThirdStageConverter for /home/mohammadbagher/Downloads/Bolognia 5th Edition 2024 1-7-26-46_final_output_final_points_stage_e.txt
2025-12-20 12:09:29,672 - INFO - Successfully loaded JSON from TXT: /home/mohammadbagher/Downloads/Bolognia 5th Edition 2024 1-7-26-46_final_output_final_points_stage_e.txt
2025-12-20 12:09:29,672 - INFO - Loaded 0 descriptions from TXT file
2025-12-20 12:09:29,672 - WARNING - No descriptions found in filepic. Descriptions will be empty.
2025-12-20 12:09:29,673 - INFO - Processing image records...
2025-12-20 12:09:29,673 - INFO - Generated 24 image records
2025-12-20 12:09:29,674 - INFO - Saving image file JSON to: /home/mohammadbagher/Downloads/f.json
2025-12-20 12:09:29,675 - INFO - Successfully saved JSON: /home/mohammadbagher/Downloads/f.json (24 records)
2025-12-20 12:09:29,677 - INFO - Stage F completed successfully: /home/mohammadbagher/Downloads/f.json
2025-12-20 12:10:47,743 - INFO - Loaded 3 API keys
2025-12-20 12:10:55,287 - INFO - Starting Stage E processing...
2025-12-20 12:10:55,290 - INFO - Loading Stage 4 JSON...
2025-12-20 12:10:55,305 - INFO - Successfully loaded JSON: /home/mohammadbagher/Downloads/Bolognia 5th Edition 2024 1-7-26-46_final_output_final_points.json
2025-12-20 12:10:55,306 - INFO - Loading Stage 1 JSON...
2025-12-20 12:10:55,310 - INFO - Successfully loaded JSON: /home/mohammadbagher/Downloads/Bolognia 5th Edition 2024 1-7-26-46_final_output.json
2025-12-20 12:10:55,313 - INFO - Detected Book ID: 105, Chapter ID: 30
2025-12-20 12:10:55,314 - INFO - Last PointId in Stage 4: 1050300708, Starting image notes from index: 709
2025-12-20 12:10:55,317 - INFO - Preparing input for model...
2025-12-20 12:10:55,335 - INFO - Calling model gemini-2.5-pro...
2025-12-20 12:14:36,026 - INFO - Text processed successfully with gemini-2.5-pro
2025-12-20 12:14:36,027 - INFO - Saving model response as TXT file...
2025-12-20 12:14:36,029 - INFO - Model response saved to: /home/mohammadbagher/Downloads/Bolognia 5th Edition 2024 1-7-26-46_final_output_final_points_stage_e.txt
2025-12-20 12:14:36,030 - INFO - Stage E raw text saved: /home/mohammadbagher/Downloads/Bolognia 5th Edition 2024 1-7-26-46_final_output_final_points_stage_e.txt
2025-12-20 12:14:36,039 - INFO - Converting TXT to JSON...
2025-12-20 12:14:36,043 - WARNING - No closing markdown marker found, JSON may be incomplete
2025-12-20 12:14:36,045 - WARNING - Direct JSON parse failed: Unterminated string starting at: line 145 column 18 (char 16048). Trying fallback extraction...
2025-12-20 12:14:36,047 - WARNING - Object extraction parse failed: Unterminated string starting at: line 145 column 18 (char 16048)
2025-12-20 12:14:36,069 - INFO - Attempting to repair incomplete JSON...
2025-12-20 12:14:36,103 - WARNING - Repair method returned None
2025-12-20 12:14:36,103 - ERROR - All JSON extraction methods failed
2025-12-20 12:14:36,103 - INFO - Falling back to manual JSON extraction for /home/mohammadbagher/Downloads/Bolognia 5th Edition 2024 1-7-26-46_final_output_final_points_stage_e.txt
2025-12-20 12:14:36,106 - ERROR - Failed to parse JSON from cleaned TXT content for /home/mohammadbagher/Downloads/Bolognia 5th Edition 2024 1-7-26-46_final_output_final_points_stage_e.txt: Unterminated string starting at: line 145 column 18 (char 16048)
2025-12-20 12:14:36,106 - ERROR - Failed to extract JSON from TXT file
2025-12-20 12:21:28,807 - INFO - Loaded 6 predefined prompts
2025-12-20 12:21:57,241 - INFO - Starting Stage F processing...
2025-12-20 12:21:57,242 - INFO - Loading Stage E JSON...
2025-12-20 12:21:57,248 - INFO - Successfully loaded JSON: /home/mohammadbagher/Downloads/e105030.json
2025-12-20 12:21:57,249 - INFO - First image PointId: 1050300709
2025-12-20 12:21:57,249 - INFO - Found 24 image records starting from index 708
2025-12-20 12:21:57,250 - INFO - Loading descriptions from Stage E TXT file (fallback)...
2025-12-20 12:21:57,251 - WARNING - No closing markdown marker found, JSON may be incomplete
2025-12-20 12:21:57,251 - WARNING - Direct JSON parse failed: Unterminated string starting at: line 145 column 18 (char 16048). Trying fallback extraction...
2025-12-20 12:21:57,252 - WARNING - Object extraction parse failed: Unterminated string starting at: line 145 column 18 (char 16048)
2025-12-20 12:21:57,256 - INFO - Attempting to repair incomplete JSON...
2025-12-20 12:21:57,261 - WARNING - Repair method returned None
2025-12-20 12:21:57,261 - ERROR - All JSON extraction methods failed
2025-12-20 12:21:57,261 - INFO - Falling back to manual JSON extraction for /home/mohammadbagher/Downloads/Bolognia 5th Edition 2024 1-7-26-46_final_output_final_points_stage_e.txt
2025-12-20 12:21:57,264 - ERROR - Failed to parse JSON from cleaned TXT content for /home/mohammadbagher/Downloads/Bolognia 5th Edition 2024 1-7-26-46_final_output_final_points_stage_e.txt: Unterminated string starting at: line 145 column 18 (char 16048)
2025-12-20 12:21:57,264 - WARNING - No descriptions found in filepic. Descriptions will be empty.
2025-12-20 12:21:57,264 - INFO - Processing image records...
2025-12-20 12:21:57,265 - INFO - Generated 24 image records
2025-12-20 12:21:57,265 - INFO - Saving image file JSON to: /home/mohammadbagher/Downloads/f.json
2025-12-20 12:21:57,267 - INFO - Successfully saved JSON: /home/mohammadbagher/Downloads/f.json (24 records)
2025-12-20 12:21:57,268 - INFO - Stage F completed successfully: /home/mohammadbagher/Downloads/f.json
2025-12-20 12:29:16,090 - INFO - Loaded 6 predefined prompts
2025-12-20 12:30:34,088 - INFO - Starting Stage F processing...
2025-12-20 12:30:34,089 - INFO - Loading Stage E JSON...
2025-12-20 12:30:34,093 - INFO - Successfully loaded JSON: /home/mohammadbagher/Downloads/e105030.json
2025-12-20 12:30:34,093 - INFO - First image PointId: 1050300709
2025-12-20 12:30:34,094 - INFO - Found 24 image records starting from index 708
2025-12-20 12:30:34,094 - INFO - Trying fallback: Loading from TXT file...
2025-12-20 12:30:34,095 - INFO - Loading descriptions from Stage E TXT file: Bolognia 5th Edition 2024 1-7-26-46_final_output_final_points_stage_e.txt
2025-12-20 12:30:34,095 - WARNING - No closing markdown marker found, JSON may be incomplete
2025-12-20 12:30:34,096 - WARNING - Direct JSON parse failed: Unterminated string starting at: line 145 column 18 (char 16048). Trying fallback extraction...
2025-12-20 12:30:34,096 - WARNING - Object extraction parse failed: Unterminated string starting at: line 145 column 18 (char 16048)
2025-12-20 12:30:34,100 - INFO - Attempting to repair incomplete JSON...
2025-12-20 12:30:34,106 - WARNING - Repair method returned None
2025-12-20 12:30:34,106 - ERROR - All JSON extraction methods failed
2025-12-20 12:30:34,107 - INFO - Falling back to manual JSON extraction for /home/mohammadbagher/Downloads/Bolognia 5th Edition 2024 1-7-26-46_final_output_final_points_stage_e.txt
2025-12-20 12:30:34,108 - ERROR - Failed to parse JSON from cleaned TXT content for /home/mohammadbagher/Downloads/Bolognia 5th Edition 2024 1-7-26-46_final_output_final_points_stage_e.txt: Unterminated string starting at: line 145 column 18 (char 16048)
2025-12-20 12:30:34,109 - WARNING - No descriptions found in filepic. Descriptions will be empty.
2025-12-20 12:30:34,109 - INFO - Processing image records...
2025-12-20 12:30:34,110 - INFO - Generated 24 image records
2025-12-20 12:30:34,110 - INFO - Saving image file JSON to: /home/mohammadbagher/Downloads/f.json
2025-12-20 12:30:34,112 - INFO - Successfully saved JSON: /home/mohammadbagher/Downloads/f.json (24 records)
2025-12-20 12:30:34,113 - INFO - Stage F completed successfully: /home/mohammadbagher/Downloads/f.json
2025-12-20 12:49:24,651 - INFO - Loaded 3 API keys
2025-12-20 12:49:58,175 - INFO - Starting Stage E processing...
2025-12-20 12:49:58,176 - INFO - Loading Stage 4 JSON...
2025-12-20 12:49:58,181 - INFO - Successfully loaded JSON: /home/mohammadbagher/Downloads/Bolognia 5th Edition 2024 1-7-26-46_final_output_final_points.json
2025-12-20 12:49:58,182 - INFO - Loading Stage 1 JSON...
2025-12-20 12:49:58,184 - INFO - Successfully loaded JSON: /home/mohammadbagher/Downloads/Bolognia 5th Edition 2024 1-7-26-46_final_output.json
2025-12-20 12:49:58,184 - INFO - Detected Book ID: 105, Chapter ID: 30
2025-12-20 12:49:58,185 - INFO - Last PointId in Stage 4: 1050300708, Starting image notes from index: 709
2025-12-20 12:49:58,185 - INFO - Preparing input for model...
2025-12-20 12:49:58,207 - INFO - Calling model gemini-2.5-pro...
2025-12-20 12:53:12,714 - INFO - Text processed successfully with gemini-2.5-pro
2025-12-20 12:53:12,715 - INFO - Saving model response as TXT file...
2025-12-20 12:53:12,723 - INFO - Model response saved to: /home/mohammadbagher/Downloads/Bolognia 5th Edition 2024 1-7-26-46_final_output_final_points_stage_e.txt
2025-12-20 12:53:12,725 - INFO - Stage E raw text saved: /home/mohammadbagher/Downloads/Bolognia 5th Edition 2024 1-7-26-46_final_output_final_points_stage_e.txt
2025-12-20 12:53:12,726 - INFO - Converting TXT to JSON...
2025-12-20 12:53:12,727 - WARNING - No closing markdown marker found, JSON may be incomplete
2025-12-20 12:53:12,727 - WARNING - Direct JSON parse failed: Unterminated string starting at: line 136 column 18 (char 10906). Trying fallback extraction...
2025-12-20 12:53:12,728 - WARNING - Object extraction parse failed: Expecting ',' delimiter: line 128 column 6 (char 10627)
2025-12-20 12:53:12,731 - INFO - Attempting to repair incomplete JSON...
2025-12-20 12:53:12,736 - WARNING - Repair method returned None
2025-12-20 12:53:12,737 - ERROR - All JSON extraction methods failed
2025-12-20 12:53:12,737 - INFO - Falling back to manual JSON extraction for /home/mohammadbagher/Downloads/Bolognia 5th Edition 2024 1-7-26-46_final_output_final_points_stage_e.txt
2025-12-20 12:53:12,739 - ERROR - Failed to parse JSON from cleaned TXT content for /home/mohammadbagher/Downloads/Bolognia 5th Edition 2024 1-7-26-46_final_output_final_points_stage_e.txt: Expecting ',' delimiter: line 128 column 6 (char 10627)
2025-12-20 12:53:12,739 - ERROR - Failed to extract JSON from TXT file
2025-12-20 13:05:05,464 - INFO - Loaded 6 predefined prompts
2025-12-20 13:05:31,805 - INFO - Loaded 3 API keys
2025-12-20 13:06:42,133 - INFO - Starting Stage E processing...
2025-12-20 13:06:42,134 - INFO - Loading Stage 4 JSON...
2025-12-20 13:06:42,139 - INFO - Successfully loaded JSON: /home/mohammadbagher/Downloads/Bolognia 5th Edition 2024 1-7-26-46_final_output_final_points.json
2025-12-20 13:06:42,140 - INFO - Loading Stage 1 JSON...
2025-12-20 13:06:42,142 - INFO - Successfully loaded JSON: /home/mohammadbagher/Downloads/Bolognia 5th Edition 2024 1-7-26-46_final_output.json
2025-12-20 13:06:42,142 - INFO - Detected Book ID: 105, Chapter ID: 30
2025-12-20 13:06:42,143 - INFO - Last PointId in Stage 4: 1050300708, Starting image notes from index: 709
2025-12-20 13:06:42,143 - INFO - Preparing input for model...
2025-12-20 13:06:42,158 - INFO - Calling model gemini-2.5-pro...
2025-12-20 13:10:20,385 - INFO - Text processed successfully with gemini-2.5-pro
2025-12-20 13:10:20,387 - INFO - Saving model response as TXT file...
2025-12-20 13:10:20,389 - INFO - Stage E raw text saved: /home/mohammadbagher/Downloads/Bolognia 5th Edition 2024 1-7-26-46_final_output_final_points_stage_e.txt
2025-12-20 13:10:20,394 - INFO - Converting TXT to JSON...
2025-12-20 13:10:20,397 - WARNING - No closing markdown marker found, JSON may be incomplete
2025-12-20 13:10:20,397 - WARNING - Direct JSON parse failed: Unterminated string starting at: line 100 column 18 (char 12583). Trying fallback extraction...
2025-12-20 13:10:20,398 - WARNING - Object extraction parse failed: Expecting ',' delimiter: line 92 column 6 (char 12289)
2025-12-20 13:10:20,401 - INFO - Attempting to repair incomplete JSON...
2025-12-20 13:10:20,410 - WARNING - Repair method returned None
2025-12-20 13:10:20,410 - ERROR - All JSON extraction methods failed
2025-12-20 13:10:20,410 - INFO - Falling back to manual JSON extraction for /home/mohammadbagher/Downloads/Bolognia 5th Edition 2024 1-7-26-46_final_output_final_points_stage_e.txt
2025-12-20 13:10:20,414 - INFO - Extracted 10 complete objects from incomplete JSON array for /home/mohammadbagher/Downloads/Bolognia 5th Edition 2024 1-7-26-46_final_output_final_points_stage_e.txt
2025-12-20 13:10:20,415 - INFO - Successfully loaded JSON from TXT: /home/mohammadbagher/Downloads/Bolognia 5th Edition 2024 1-7-26-46_final_output_final_points_stage_e.txt
2025-12-20 13:10:20,416 - INFO - Successfully extracted JSON (attempt 1)
2025-12-20 13:10:20,417 - INFO - Extracted 10 image note records
2025-12-20 13:10:20,417 - INFO - Processing image notes...
2025-12-20 13:10:20,418 - INFO - Processed 10 image notes
2025-12-20 13:10:20,419 - INFO - First image PointId: 1050300709
2025-12-20 13:10:20,420 - INFO - Saving filepic JSON for Stage F...
2025-12-20 13:10:20,421 - INFO - Found 10 records with caption out of 10
2025-12-20 13:10:20,422 - INFO - Successfully saved JSON: /home/mohammadbagher/Downloads/Bolognia 5th Edition 2024 1-7-26-46_final_output_final_points_filepic.json (10 records)
2025-12-20 13:10:20,423 - INFO - Filepic saved to: /home/mohammadbagher/Downloads/Bolognia 5th Edition 2024 1-7-26-46_final_output_final_points_filepic.json
2025-12-20 13:10:20,425 - INFO - Verified: filepic contains caption field (first caption: 3416 chars)
2025-12-20 13:10:20,428 - INFO - Merging Stage 4 points with image notes...
2025-12-20 13:10:20,429 - INFO - Saving merged JSON to: /home/mohammadbagher/Downloads/e105030.json
2025-12-20 13:10:20,456 - INFO - Successfully saved JSON: /home/mohammadbagher/Downloads/e105030.json (718 records)
2025-12-20 13:10:20,457 - INFO - Stage E completed successfully: /home/mohammadbagher/Downloads/e105030.json
2025-12-20 13:11:53,572 - INFO - Starting Stage F processing...
2025-12-20 13:11:53,573 - INFO - Loading Stage E JSON...
2025-12-20 13:11:53,577 - INFO - Successfully loaded JSON: /home/mohammadbagher/Downloads/e105030.json
2025-12-20 13:11:53,578 - INFO - First image PointId: 1050300709
2025-12-20 13:11:53,579 - INFO - Found 10 image records starting from index 708
2025-12-20 13:11:53,580 - INFO - Using filepic path from metadata: /home/mohammadbagher/Downloads/Bolognia 5th Edition 2024 1-7-26-46_final_output_final_points_filepic.json
2025-12-20 13:11:53,580 - INFO - Loading descriptions from filepic JSON...
2025-12-20 13:11:53,581 - INFO - Successfully loaded JSON: /home/mohammadbagher/Downloads/Bolognia 5th Edition 2024 1-7-26-46_final_output_final_points_filepic.json
2025-12-20 13:11:53,581 - INFO - Found 10 records in filepic JSON
2025-12-20 13:11:53,581 - INFO - Loaded 10 descriptions from filepic JSON
2025-12-20 13:11:53,582 - INFO - Found 10 non-empty captions out of 10
2025-12-20 13:11:53,582 - INFO - Processing image records...
2025-12-20 13:11:53,583 - INFO - Generated 10 image records
2025-12-20 13:11:53,583 - INFO - Saving image file JSON to: /home/mohammadbagher/Downloads/f.json
2025-12-20 13:11:53,584 - INFO - Successfully saved JSON: /home/mohammadbagher/Downloads/f.json (10 records)
2025-12-20 13:11:53,585 - INFO - Stage F completed successfully: /home/mohammadbagher/Downloads/f.json
2025-12-20 13:19:47,502 - INFO - Starting Stage E processing...
2025-12-20 13:19:47,503 - INFO - Loading Stage 4 JSON...
2025-12-20 13:19:47,509 - INFO - Successfully loaded JSON: /home/mohammadbagher/Downloads/Bolognia 5th Edition 2024 1-7-26-46_final_output_final_points.json
2025-12-20 13:19:47,509 - INFO - Loading Stage 1 JSON...
2025-12-20 13:19:47,512 - INFO - Successfully loaded JSON: /home/mohammadbagher/Downloads/Bolognia 5th Edition 2024 1-7-26-46_final_output.json
2025-12-20 13:19:47,514 - INFO - Detected Book ID: 105, Chapter ID: 30
2025-12-20 13:19:47,514 - INFO - Last PointId in Stage 4: 1050300708, Starting image notes from index: 709
2025-12-20 13:19:47,515 - INFO - Preparing input for model...
2025-12-20 13:19:47,538 - INFO - Calling model gemini-2.5-pro...
2025-12-20 13:23:21,966 - INFO - Text processed successfully with gemini-2.5-pro
2025-12-20 13:23:21,968 - INFO - Saving model response as TXT file...
2025-12-20 13:23:21,972 - INFO - Stage E raw text saved: /home/mohammadbagher/Downloads/Bolognia 5th Edition 2024 1-7-26-46_final_output_final_points_stage_e.txt
2025-12-20 13:23:21,979 - INFO - Converting TXT to JSON...
2025-12-20 13:23:21,983 - WARNING - No closing markdown marker found, JSON may be incomplete
2025-12-20 13:23:21,986 - WARNING - Direct JSON parse failed: Expecting value: line 353 column 7 (char 18898). Trying fallback extraction...
2025-12-20 13:23:21,988 - WARNING - Object extraction parse failed: Expecting ',' delimiter: line 353 column 6 (char 18897)
2025-12-20 13:23:22,018 - INFO - Attempting to repair incomplete JSON...
2025-12-20 13:23:22,046 - WARNING - Repair method returned None
2025-12-20 13:23:22,047 - ERROR - All JSON extraction methods failed
2025-12-20 13:23:22,047 - INFO - Falling back to manual JSON extraction for /home/mohammadbagher/Downloads/Bolognia 5th Edition 2024 1-7-26-46_final_output_final_points_stage_e.txt
2025-12-20 13:23:22,059 - INFO - Extracted 39 complete objects from incomplete JSON array for /home/mohammadbagher/Downloads/Bolognia 5th Edition 2024 1-7-26-46_final_output_final_points_stage_e.txt
2025-12-20 13:23:22,059 - INFO - Successfully loaded JSON from TXT: /home/mohammadbagher/Downloads/Bolognia 5th Edition 2024 1-7-26-46_final_output_final_points_stage_e.txt
2025-12-20 13:23:22,060 - INFO - Successfully extracted JSON (attempt 1)
2025-12-20 13:23:22,063 - INFO - Extracted 39 image note records
2025-12-20 13:23:22,063 - INFO - Processing image notes...
2025-12-20 13:23:22,065 - INFO - Processed 39 image notes
2025-12-20 13:23:22,066 - INFO - First image PointId: 1050300709
2025-12-20 13:23:22,068 - INFO - Saving filepic JSON for Stage F...
2025-12-20 13:23:22,070 - INFO - Found 39 records with caption out of 39
2025-12-20 13:23:22,074 - INFO - Successfully saved JSON: /home/mohammadbagher/Downloads/Bolognia 5th Edition 2024 1-7-26-46_final_output_final_points_filepic.json (39 records)
2025-12-20 13:23:22,075 - INFO - Filepic saved to: /home/mohammadbagher/Downloads/Bolognia 5th Edition 2024 1-7-26-46_final_output_final_points_filepic.json
2025-12-20 13:23:22,076 - INFO - Verified: filepic contains caption field (first caption: 437 chars)
2025-12-20 13:23:22,078 - INFO - Merging Stage 4 points with image notes...
2025-12-20 13:23:22,079 - INFO - Saving merged JSON to: /home/mohammadbagher/Downloads/e105030.json
2025-12-20 13:23:22,109 - INFO - Successfully saved JSON: /home/mohammadbagher/Downloads/e105030.json (747 records)
2025-12-20 13:23:22,109 - INFO - Stage E completed successfully: /home/mohammadbagher/Downloads/e105030.json
2025-12-20 13:24:37,252 - INFO - Starting Stage F processing...
2025-12-20 13:24:37,252 - INFO - Loading Stage E JSON...
2025-12-20 13:24:37,256 - INFO - Successfully loaded JSON: /home/mohammadbagher/Downloads/e105030.json
2025-12-20 13:24:37,257 - INFO - First image PointId: 1050300709
2025-12-20 13:24:37,258 - INFO - Found 39 image records starting from index 708
2025-12-20 13:24:37,258 - INFO - Using filepic path from metadata: /home/mohammadbagher/Downloads/Bolognia 5th Edition 2024 1-7-26-46_final_output_final_points_filepic.json
2025-12-20 13:24:37,259 - INFO - Loading descriptions from filepic JSON...
2025-12-20 13:24:37,260 - INFO - Successfully loaded JSON: /home/mohammadbagher/Downloads/Bolognia 5th Edition 2024 1-7-26-46_final_output_final_points_filepic.json
2025-12-20 13:24:37,260 - INFO - Found 39 records in filepic JSON
2025-12-20 13:24:37,260 - INFO - Loaded 39 descriptions from filepic JSON
2025-12-20 13:24:37,261 - INFO - Found 39 non-empty captions out of 39
2025-12-20 13:24:37,261 - INFO - Processing image records...
2025-12-20 13:24:37,262 - INFO - Generated 39 image records
2025-12-20 13:24:37,262 - INFO - Saving image file JSON to: /home/mohammadbagher/Downloads/f.json
2025-12-20 13:24:37,264 - INFO - Successfully saved JSON: /home/mohammadbagher/Downloads/f.json (39 records)
2025-12-20 13:24:37,266 - INFO - Stage F completed successfully: /home/mohammadbagher/Downloads/f.json
2025-12-20 13:34:34,398 - INFO - Loaded 6 predefined prompts
2025-12-20 13:41:36,560 - INFO - Loaded 6 predefined prompts
2025-12-20 13:45:08,930 - INFO - Loaded 6 predefined prompts
2025-12-20 13:49:04,063 - INFO - Loaded 6 predefined prompts
2025-12-20 13:52:21,404 - INFO - Loaded 6 predefined prompts
2025-12-20 13:55:10,184 - INFO - Loaded 6 predefined prompts
2025-12-20 14:01:45,541 - INFO - Loaded 6 predefined prompts
2025-12-20 14:04:30,454 - INFO - Loaded 6 predefined prompts
2025-12-20 14:14:43,549 - INFO - Loaded 6 predefined prompts
2025-12-20 14:15:32,183 - INFO - Starting Stage F processing...
2025-12-20 14:15:32,185 - INFO - Loading Stage E JSON...
2025-12-20 14:15:32,201 - INFO - Successfully loaded JSON: /home/mohammadbagher/Downloads/e105030.json
2025-12-20 14:15:32,203 - INFO - First image PointId: 1050300709
2025-12-20 14:15:32,205 - INFO - Found 39 image records starting from index 708
2025-12-20 14:15:32,205 - INFO - Using filepic path from metadata: /home/mohammadbagher/Downloads/Bolognia 5th Edition 2024 1-7-26-46_final_output_final_points_filepic.json
2025-12-20 14:15:32,206 - INFO - Loading descriptions from filepic JSON...
2025-12-20 14:15:32,208 - INFO - Successfully loaded JSON: /home/mohammadbagher/Downloads/Bolognia 5th Edition 2024 1-7-26-46_final_output_final_points_filepic.json
2025-12-20 14:15:32,208 - INFO - Found 39 records in filepic JSON
2025-12-20 14:15:32,210 - INFO - Loaded 39 descriptions from filepic JSON
2025-12-20 14:15:32,211 - INFO - Found 39 non-empty captions out of 39
2025-12-20 14:15:32,212 - INFO - Processing image records...
2025-12-20 14:15:32,215 - INFO - Generated 39 image records
2025-12-20 14:15:32,216 - INFO - Saving image file JSON to: /home/mohammadbagher/Downloads/f.json
2025-12-20 14:15:32,220 - INFO - Successfully saved JSON: /home/mohammadbagher/Downloads/f.json (39 records)
2025-12-20 14:15:32,220 - INFO - Stage F completed successfully: /home/mohammadbagher/Downloads/f.json
2025-12-20 14:20:27,049 - INFO - Loaded 6 predefined prompts
2025-12-20 14:20:27,049 - WARNING - python-docx not available. Will try alternative methods.
2025-12-21 09:05:15,673 - INFO - Loaded 6 predefined prompts
2025-12-21 09:05:15,674 - WARNING - python-docx not available. Will try alternative methods.
2025-12-21 09:06:24,444 - INFO - Starting Stage F processing...
2025-12-21 09:06:24,445 - INFO - Loading Stage E JSON...
2025-12-21 09:06:24,450 - INFO - Successfully loaded JSON: /home/mohammadbagher/Downloads/e105030.json
2025-12-21 09:06:24,450 - INFO - First image PointId: 1050300709
2025-12-21 09:06:24,452 - INFO - Found 39 image records starting from index 708
2025-12-21 09:06:24,453 - INFO - Using filepic path from metadata: /home/mohammadbagher/Downloads/Bolognia 5th Edition 2024 1-7-26-46_final_output_final_points_filepic.json
2025-12-21 09:06:24,453 - INFO - Loading descriptions from filepic JSON...
2025-12-21 09:06:24,458 - INFO - Successfully loaded JSON: /home/mohammadbagher/Downloads/Bolognia 5th Edition 2024 1-7-26-46_final_output_final_points_filepic.json
2025-12-21 09:06:24,458 - INFO - Found 39 records in filepic JSON
2025-12-21 09:06:24,459 - INFO - Loaded 39 descriptions from filepic JSON
2025-12-21 09:06:24,459 - INFO - Found 39 non-empty captions out of 39
2025-12-21 09:06:24,460 - INFO - Processing image records...
2025-12-21 09:06:24,461 - INFO - Generated 39 image records
2025-12-21 09:06:24,461 - INFO - Saving image file JSON to: /home/mohammadbagher/Downloads/f.json
2025-12-21 09:06:24,464 - INFO - Successfully saved JSON: /home/mohammadbagher/Downloads/f.json (39 records)
2025-12-21 09:06:24,465 - INFO - Stage F completed successfully: /home/mohammadbagher/Downloads/f.json
2025-12-21 09:25:26,974 - INFO - Loaded 3 API keys
2025-12-21 09:25:41,757 - INFO - Starting Stage J processing...
2025-12-21 09:25:41,758 - INFO - Loading Stage E JSON...
2025-12-21 09:25:41,763 - INFO - Successfully loaded JSON: /home/mohammadbagher/Downloads/e105030.json
2025-12-21 09:25:41,764 - INFO - Loaded 747 records from Stage E
2025-12-21 09:25:41,765 - INFO - Detected Book ID: 105, Chapter ID: 30
2025-12-21 09:25:41,766 - INFO - Reading Word file...
2025-12-21 09:25:41,777 - INFO - Read file as plain text (latin-1): /home/mohammadbagher/Downloads/تست های پمفیگوس.docx
2025-12-21 09:25:41,778 - INFO - Read Word file: 20856 characters
2025-12-21 09:25:41,798 - INFO - Calling model: gemini-2.5-pro...
2025-12-21 09:25:41,799 - WARNING - Model call attempt 1 failed: 'GeminiAPIClient' object has no attribute 'generate_content'
2025-12-21 09:25:41,800 - INFO - Retrying... (attempt 2/3)
2025-12-21 09:25:41,800 - WARNING - Model call attempt 2 failed: 'GeminiAPIClient' object has no attribute 'generate_content'
2025-12-21 09:25:41,801 - INFO - Retrying... (attempt 3/3)
2025-12-21 09:25:41,801 - WARNING - Model call attempt 3 failed: 'GeminiAPIClient' object has no attribute 'generate_content'
2025-12-21 09:25:41,801 - ERROR - All model call attempts failed
2025-12-21 09:27:23,319 - ERROR - No valid API keys found in the file
2025-12-21 09:27:30,058 - INFO - Loaded 3 API keys
2025-12-21 09:27:41,256 - INFO - Starting Stage J processing...
2025-12-21 09:27:41,257 - INFO - Loading Stage E JSON...
2025-12-21 09:27:41,263 - INFO - Successfully loaded JSON: /home/mohammadbagher/Downloads/e105030.json
2025-12-21 09:27:41,263 - INFO - Loaded 747 records from Stage E
2025-12-21 09:27:41,263 - INFO - Detected Book ID: 105, Chapter ID: 30
2025-12-21 09:27:41,264 - INFO - Reading Word file...
2025-12-21 09:27:41,264 - INFO - Read file as plain text (latin-1): /home/mohammadbagher/Downloads/تست های پمفیگوس.docx
2025-12-21 09:27:41,265 - INFO - Read Word file: 20856 characters
2025-12-21 09:27:41,275 - INFO - Calling model: gemini-2.5-pro...
2025-12-21 09:27:41,276 - WARNING - Model call attempt 1 failed: 'GeminiAPIClient' object has no attribute 'generate_content'
2025-12-21 09:27:41,276 - INFO - Retrying... (attempt 2/3)
2025-12-21 09:27:41,276 - WARNING - Model call attempt 2 failed: 'GeminiAPIClient' object has no attribute 'generate_content'
2025-12-21 09:27:41,276 - INFO - Retrying... (attempt 3/3)
2025-12-21 09:27:41,277 - WARNING - Model call attempt 3 failed: 'GeminiAPIClient' object has no attribute 'generate_content'
2025-12-21 09:27:41,277 - ERROR - All model call attempts failed
2025-12-21 09:29:21,912 - INFO - Loaded 6 predefined prompts
2025-12-21 09:29:21,912 - WARNING - python-docx not available. Will try alternative methods.
2025-12-21 09:30:27,674 - INFO - Loaded 3 API keys
2025-12-21 09:30:37,730 - INFO - Starting Stage J processing...
2025-12-21 09:30:37,731 - INFO - Loading Stage E JSON...
2025-12-21 09:30:37,735 - INFO - Successfully loaded JSON: /home/mohammadbagher/Downloads/e105030.json
2025-12-21 09:30:37,736 - INFO - Loaded 747 records from Stage E
2025-12-21 09:30:37,736 - INFO - Detected Book ID: 105, Chapter ID: 30
2025-12-21 09:30:37,737 - INFO - Reading Word file...
2025-12-21 09:30:37,738 - INFO - Read file as plain text (latin-1): /home/mohammadbagher/Downloads/تست های پمفیگوس.docx
2025-12-21 09:30:37,740 - INFO - Read Word file: 20856 characters
2025-12-21 09:30:37,752 - INFO - Calling model: gemini-2.5-pro...
2025-12-21 09:32:30,394 - INFO - Text processed successfully with gemini-2.5-pro
2025-12-21 09:32:30,395 - INFO - Received response from model (14203 characters)
2025-12-21 09:32:30,404 - INFO - Saved raw response to: /home/mohammadbagher/Downloads/e105030_stage_j.txt
2025-12-21 09:32:30,407 - INFO - Extracting JSON from model response...
2025-12-21 09:32:30,408 - WARNING - No closing markdown marker found, JSON may be incomplete
2025-12-21 09:32:30,412 - WARNING - Direct JSON parse failed: Expecting ',' delimiter: line 808 column 19 (char 14195). Trying fallback extraction...
2025-12-21 09:32:30,414 - ERROR - All JSON extraction methods failed
2025-12-21 09:32:30,416 - WARNING - Failed to extract JSON from response
2025-12-21 09:32:30,418 - INFO - Trying to load JSON from TXT file...
2025-12-21 09:32:30,419 - WARNING - No closing markdown marker found, JSON may be incomplete
2025-12-21 09:32:30,421 - WARNING - Direct JSON parse failed: Expecting ',' delimiter: line 808 column 19 (char 14195). Trying fallback extraction...
2025-12-21 09:32:30,423 - ERROR - All JSON extraction methods failed
2025-12-21 09:32:30,423 - INFO - Falling back to manual JSON extraction for /home/mohammadbagher/Downloads/e105030_stage_j.txt
2025-12-21 09:32:30,439 - INFO - Extracted 161 complete objects from incomplete JSON array for /home/mohammadbagher/Downloads/e105030_stage_j.txt
2025-12-21 09:32:30,440 - INFO - Successfully loaded JSON from TXT: /home/mohammadbagher/Downloads/e105030_stage_j.txt
2025-12-21 09:32:30,442 - INFO - Extracted 161 records from model output
2025-12-21 09:32:30,444 - INFO - Created mapping for 0 PointIds
2025-12-21 09:32:30,446 - INFO - Merging Stage E data with Imp and Type columns...
2025-12-21 09:32:30,450 - INFO - Merged 747 records
2025-12-21 09:32:30,451 - INFO - Saving Stage J output to: /home/mohammadbagher/Downloads/a105030.json
2025-12-21 09:32:30,478 - INFO - Successfully saved JSON: /home/mohammadbagher/Downloads/a105030.json (747 records)
2025-12-21 09:32:30,478 - INFO - Stage J completed successfully: /home/mohammadbagher/Downloads/a105030.json
2025-12-21 09:42:21,695 - INFO - Starting Stage J processing...
2025-12-21 09:42:21,696 - INFO - Loading Stage E JSON...
2025-12-21 09:42:21,701 - INFO - Successfully loaded JSON: /home/mohammadbagher/Downloads/e105030.json
2025-12-21 09:42:21,702 - INFO - Loaded 747 records from Stage E
2025-12-21 09:42:21,702 - INFO - Detected Book ID: 105, Chapter ID: 30
2025-12-21 09:42:21,703 - INFO - Reading Word file...
2025-12-21 09:42:21,703 - INFO - Read file as plain text (latin-1): /home/mohammadbagher/Downloads/تست های پمفیگوس.docx
2025-12-21 09:42:21,704 - INFO - Read Word file: 20856 characters
2025-12-21 09:42:21,719 - INFO - Calling model: gemini-2.5-pro...
2025-12-21 09:44:14,702 - INFO - Text processed successfully with gemini-2.5-pro
2025-12-21 09:44:14,703 - INFO - Received response from model (13456 characters)
2025-12-21 09:44:14,709 - INFO - Saved raw response to: /home/mohammadbagher/Downloads/e105030_stage_j.txt
2025-12-21 09:44:14,712 - INFO - Extracting JSON from model response...
2025-12-21 09:44:14,713 - WARNING - No closing markdown marker found, JSON may be incomplete
2025-12-21 09:44:14,715 - WARNING - Direct JSON parse failed: Expecting property name enclosed in double quotes: line 958 column 29 (char 13443). Trying fallback extraction...
2025-12-21 09:44:14,715 - ERROR - All JSON extraction methods failed
2025-12-21 09:44:14,716 - WARNING - Failed to extract JSON from response
2025-12-21 09:44:14,719 - INFO - Trying to load JSON from TXT file...
2025-12-21 09:44:14,725 - WARNING - No closing markdown marker found, JSON may be incomplete
2025-12-21 09:44:14,726 - WARNING - Direct JSON parse failed: Expecting property name enclosed in double quotes: line 958 column 29 (char 13443). Trying fallback extraction...
2025-12-21 09:44:14,727 - ERROR - All JSON extraction methods failed
2025-12-21 09:44:14,727 - INFO - Falling back to manual JSON extraction for /home/mohammadbagher/Downloads/e105030_stage_j.txt
2025-12-21 09:44:14,740 - INFO - Extracted 191 complete objects from incomplete JSON array for /home/mohammadbagher/Downloads/e105030_stage_j.txt
2025-12-21 09:44:14,741 - INFO - Successfully loaded JSON from TXT: /home/mohammadbagher/Downloads/e105030_stage_j.txt
2025-12-21 09:44:14,742 - INFO - Extracted 191 records from model output
2025-12-21 09:44:14,743 - INFO - Created mapping for 191 PointIds
2025-12-21 09:44:14,744 - INFO - Merging Stage E data with Imp and Type columns...
2025-12-21 09:44:14,747 - INFO - Merged 747 records
2025-12-21 09:44:14,749 - INFO - Saving Stage J output to: /home/mohammadbagher/Downloads/a105030.json
2025-12-21 09:44:14,780 - INFO - Successfully saved JSON: /home/mohammadbagher/Downloads/a105030.json (747 records)
2025-12-21 09:44:14,781 - INFO - Stage J completed successfully: /home/mohammadbagher/Downloads/a105030.json
2025-12-21 10:07:06,519 - INFO - Loaded 6 predefined prompts
2025-12-21 10:07:06,519 - WARNING - python-docx not available. Will try alternative methods.
2025-12-21 10:14:15,924 - INFO - Loaded 6 predefined prompts
2025-12-21 10:14:15,924 - WARNING - python-docx not available. Will try alternative methods.
2025-12-21 10:14:51,529 - INFO - Loaded 3 API keys
2025-12-21 10:15:43,758 - INFO - Starting Stage J processing...
2025-12-21 10:15:43,762 - INFO - Loading Stage E JSON...
2025-12-21 10:15:43,790 - INFO - Successfully loaded JSON: /home/mohammadbagher/Downloads/e105030.json
2025-12-21 10:15:43,792 - INFO - Loaded 747 records from Stage E
2025-12-21 10:15:43,795 - INFO - Detected Book ID: 105, Chapter ID: 30
2025-12-21 10:15:43,797 - INFO - Reading Word file...
2025-12-21 10:15:43,801 - INFO - Read file as plain text (latin-1): /home/mohammadbagher/Downloads/تست های پمفیگوس.docx
2025-12-21 10:15:43,803 - INFO - Read Word file: 20856 characters
2025-12-21 10:15:43,824 - INFO - Calling model: gemini-2.5-pro...
2025-12-21 10:15:43,825 - INFO - Using max_tokens: 32768 for model gemini-2.5-pro
2025-12-21 10:16:38,402 - INFO - Text processed successfully with gemini-2.5-pro
2025-12-21 10:16:38,404 - INFO - Received response from model (6255 characters)
2025-12-21 10:16:38,406 - INFO - Saved raw response to: /home/mohammadbagher/Downloads/e105030_stage_j.txt
2025-12-21 10:16:38,408 - INFO - Extracting JSON from model response...
2025-12-21 10:16:38,409 - INFO - Successfully extracted JSON from response
2025-12-21 10:16:38,410 - WARNING - No data/points/rows found in JSON, returning empty list
2025-12-21 10:16:38,410 - ERROR - Model output has no data
2025-12-21 10:17:54,316 - INFO - Starting Stage J processing...
2025-12-21 10:17:54,317 - INFO - Loading Stage E JSON...
2025-12-21 10:17:54,326 - INFO - Successfully loaded JSON: /home/mohammadbagher/Downloads/e105030.json
2025-12-21 10:17:54,326 - INFO - Loaded 747 records from Stage E
2025-12-21 10:17:54,327 - INFO - Detected Book ID: 105, Chapter ID: 30
2025-12-21 10:17:54,328 - INFO - Reading Word file...
2025-12-21 10:17:54,328 - INFO - Read file as plain text (latin-1): /home/mohammadbagher/Downloads/تست های پمفیگوس.docx
2025-12-21 10:17:54,330 - INFO - Read Word file: 20856 characters
2025-12-21 10:17:54,342 - INFO - Calling model: gemini-2.5-pro...
2025-12-21 10:17:54,342 - INFO - Using max_tokens: 32768 for model gemini-2.5-pro
2025-12-21 10:18:31,263 - INFO - Text processed successfully with gemini-2.5-pro
2025-12-21 10:18:31,265 - INFO - Received response from model (3277 characters)
2025-12-21 10:18:31,273 - INFO - Saved raw response to: /home/mohammadbagher/Downloads/e105030_stage_j.txt
2025-12-21 10:18:31,278 - INFO - Extracting JSON from model response...
2025-12-21 10:18:31,280 - INFO - Successfully extracted JSON from response
2025-12-21 10:18:31,282 - WARNING - No data/points/rows found in JSON, returning empty list
2025-12-21 10:18:31,284 - ERROR - Model output has no data
2025-12-21 10:20:28,395 - INFO - Starting Stage J processing...
2025-12-21 10:20:28,396 - INFO - Loading Stage E JSON...
2025-12-21 10:20:28,400 - INFO - Successfully loaded JSON: /home/mohammadbagher/Downloads/e105030.json
2025-12-21 10:20:28,400 - INFO - Loaded 747 records from Stage E
2025-12-21 10:20:28,401 - INFO - Detected Book ID: 105, Chapter ID: 30
2025-12-21 10:20:28,401 - INFO - Reading Word file...
2025-12-21 10:20:28,401 - INFO - Read file as plain text (latin-1): /home/mohammadbagher/Downloads/تست های پمفیگوس.docx
2025-12-21 10:20:28,402 - INFO - Read Word file: 20856 characters
2025-12-21 10:20:28,416 - INFO - Calling model: gemini-2.5-pro...
2025-12-21 10:20:28,417 - INFO - Using max_tokens: 32768 for model gemini-2.5-pro
2025-12-21 10:20:52,878 - INFO - Text processed successfully with gemini-2.5-pro
2025-12-21 10:20:52,879 - INFO - Received response from model (477 characters)
2025-12-21 10:20:52,886 - INFO - Saved raw response to: /home/mohammadbagher/Downloads/e105030_stage_j.txt
2025-12-21 10:20:52,891 - INFO - Extracting JSON from model response...
2025-12-21 10:20:52,892 - WARNING - Direct JSON parse failed: Expecting value: line 1 column 1 (char 0). Trying fallback extraction...
2025-12-21 10:20:52,893 - WARNING - Array extraction parse failed: Expecting value: line 1 column 2 (char 1)
2025-12-21 10:20:52,893 - ERROR - All JSON extraction methods failed
2025-12-21 10:20:52,896 - WARNING - Failed to extract JSON from response
2025-12-21 10:20:52,899 - INFO - Trying to load JSON from TXT file...
2025-12-21 10:20:52,902 - WARNING - Direct JSON parse failed: Expecting value: line 1 column 1 (char 0). Trying fallback extraction...
2025-12-21 10:20:52,902 - WARNING - Array extraction parse failed: Expecting value: line 1 column 2 (char 1)
2025-12-21 10:20:52,903 - ERROR - All JSON extraction methods failed
2025-12-21 10:20:52,904 - INFO - Falling back to manual JSON extraction for /home/mohammadbagher/Downloads/e105030_stage_j.txt
2025-12-21 10:20:52,905 - ERROR - No JSON object boundaries found in TXT file: /home/mohammadbagher/Downloads/e105030_stage_j.txt
2025-12-21 10:20:52,911 - ERROR - Failed to extract JSON from model response
2025-12-21 10:22:21,866 - INFO - Loaded 6 predefined prompts
2025-12-21 10:22:21,866 - WARNING - python-docx not available. Will try alternative methods.
2025-12-21 10:22:48,434 - INFO - Loaded 3 API keys
2025-12-21 10:23:29,250 - INFO - Starting Stage J processing...
2025-12-21 10:23:29,253 - INFO - Loading Stage E JSON...
2025-12-21 10:23:29,283 - INFO - Successfully loaded JSON: /home/mohammadbagher/Downloads/e105030.json
2025-12-21 10:23:29,286 - INFO - Loaded 747 records from Stage E
2025-12-21 10:23:29,289 - INFO - Detected Book ID: 105, Chapter ID: 30
2025-12-21 10:23:29,290 - INFO - Reading Word file...
2025-12-21 10:23:29,293 - INFO - Read file as plain text (latin-1): /home/mohammadbagher/Downloads/تست های پمفیگوس.docx
2025-12-21 10:23:29,298 - INFO - Read Word file: 20856 characters
2025-12-21 10:23:29,324 - INFO - Calling model: gemini-2.5-pro...
2025-12-21 10:26:53,799 - INFO - Text processed successfully with gemini-2.5-pro
2025-12-21 10:26:53,801 - INFO - Received response from model (44098 characters)
2025-12-21 10:26:53,809 - INFO - Saved raw response to: /home/mohammadbagher/Downloads/e105030_stage_j.txt
2025-12-21 10:26:53,812 - INFO - Extracting JSON from model response...
2025-12-21 10:26:53,814 - WARNING - No closing markdown marker found, JSON may be incomplete
2025-12-21 10:26:53,821 - WARNING - Direct JSON parse failed: Unterminated string starting at: line 3143 column 16 (char 44087). Trying fallback extraction...
2025-12-21 10:26:53,826 - ERROR - All JSON extraction methods failed
2025-12-21 10:26:53,828 - WARNING - Failed to extract JSON from response
2025-12-21 10:26:53,832 - INFO - Trying to load JSON from TXT file...
2025-12-21 10:26:53,836 - WARNING - No closing markdown marker found, JSON may be incomplete
2025-12-21 10:26:53,848 - WARNING - Direct JSON parse failed: Unterminated string starting at: line 3143 column 16 (char 44087). Trying fallback extraction...
2025-12-21 10:26:53,849 - ERROR - All JSON extraction methods failed
2025-12-21 10:26:53,851 - INFO - Falling back to manual JSON extraction for /home/mohammadbagher/Downloads/e105030_stage_j.txt
2025-12-21 10:26:53,893 - INFO - Extracted 628 complete objects from incomplete JSON array for /home/mohammadbagher/Downloads/e105030_stage_j.txt
2025-12-21 10:26:53,893 - INFO - Successfully loaded JSON from TXT: /home/mohammadbagher/Downloads/e105030_stage_j.txt
2025-12-21 10:26:53,893 - INFO - Extracted 628 records from model output
2025-12-21 10:26:53,895 - INFO - Created mapping for 628 PointIds
2025-12-21 10:26:53,896 - INFO - Merging Stage E data with Imp and Type columns...
2025-12-21 10:26:53,899 - INFO - Merged 747 records
2025-12-21 10:26:53,900 - INFO - Matched 628 records with Imp/Type data
2025-12-21 10:26:53,900 - INFO - Saving Stage J output to: /home/mohammadbagher/Downloads/a105030.json
2025-12-21 10:26:53,926 - INFO - Successfully saved JSON: /home/mohammadbagher/Downloads/a105030.json (747 records)
2025-12-21 10:26:53,927 - INFO - Stage J completed successfully: /home/mohammadbagher/Downloads/a105030.json
2025-12-21 11:46:59,996 - INFO - Loaded 6 predefined prompts
2025-12-21 11:46:59,996 - WARNING - python-docx not available. Will try alternative methods.
2025-12-21 11:47:30,596 - INFO - Loaded 3 API keys
2025-12-21 11:48:35,849 - INFO - Starting Stage J processing...
2025-12-21 11:48:35,853 - INFO - Loading Stage E JSON...
2025-12-21 11:48:35,865 - INFO - Successfully loaded JSON: /home/mohammadbagher/Downloads/e105030.json
2025-12-21 11:48:35,867 - INFO - Loaded 747 records from Stage E
2025-12-21 11:48:35,868 - INFO - Detected Book ID: 105, Chapter ID: 30
2025-12-21 11:48:35,869 - INFO - Reading Word file...
2025-12-21 11:48:35,873 - INFO - Read file as plain text (latin-1): /home/mohammadbagher/Downloads/تست های پمفیگوس.docx
2025-12-21 11:48:35,875 - INFO - Read Word file: 20856 characters
2025-12-21 11:48:35,879 - INFO - Splitting Stage E data into 2 parts: Part 1 (373 records), Part 2 (374 records)
2025-12-21 11:48:35,882 - INFO - Processing Part 1...
2025-12-21 11:50:48,250 - INFO - Text processed successfully with gemini-2.5-pro
2025-12-21 11:50:48,251 - INFO - Part 1 response received (29970 characters)
2025-12-21 11:50:48,254 - INFO - Processing Part 2...
2025-12-21 11:52:46,690 - INFO - Text processed successfully with gemini-2.5-pro
2025-12-21 11:52:46,692 - INFO - Part 2 response received (29925 characters)
2025-12-21 11:52:46,696 - INFO - Combining responses from both parts...
2025-12-21 11:52:46,701 - INFO - Saved combined response to: /home/mohammadbagher/Downloads/e105030_stage_j.txt
2025-12-21 11:52:46,704 - INFO - Extracting JSON from Part 1 response...
2025-12-21 11:52:46,707 - INFO - Successfully extracted JSON from response
2025-12-21 11:52:46,712 - INFO - Extracting JSON from Part 2 response...
2025-12-21 11:52:46,716 - INFO - Successfully extracted JSON from response
2025-12-21 11:52:46,718 - INFO - Combining JSON from both parts...
2025-12-21 11:52:46,720 - INFO - Extracted 747 records from combined model output (Part 1: 373, Part 2: 374)
2025-12-21 11:52:46,724 - INFO - Created mapping for 747 PointIds
2025-12-21 11:52:46,725 - INFO - Merging Stage E data with Imp and Type columns...
2025-12-21 11:52:46,732 - INFO - Merged 747 records
2025-12-21 11:52:46,734 - INFO - Matched 747 records with Imp/Type data
2025-12-21 11:52:46,735 - INFO - Saving Stage J output to: /home/mohammadbagher/Downloads/a105030.json
2025-12-21 11:52:46,766 - INFO - Successfully saved JSON: /home/mohammadbagher/Downloads/a105030.json (747 records)
2025-12-21 11:52:46,766 - INFO - Stage J completed successfully: /home/mohammadbagher/Downloads/a105030.json
2025-12-21 12:07:44,896 - INFO - Loaded 6 predefined prompts
2025-12-21 12:07:44,896 - WARNING - python-docx not available. Will try alternative methods.
2025-12-21 12:08:17,374 - INFO - Loaded 3 API keys
2025-12-21 12:09:01,221 - INFO - Starting Stage J processing...
2025-12-21 12:09:01,222 - INFO - Loading Stage E JSON...
2025-12-21 12:09:01,229 - INFO - Successfully loaded JSON: /home/mohammadbagher/Downloads/e105030.json
2025-12-21 12:09:01,229 - INFO - Loaded 747 records from Stage E
2025-12-21 12:09:01,230 - INFO - Detected Book ID: 105, Chapter ID: 30
2025-12-21 12:09:01,230 - INFO - Reading Word file...
2025-12-21 12:09:01,232 - INFO - Read file as plain text (latin-1): /home/mohammadbagher/Downloads/تست های پمفیگوس.docx
2025-12-21 12:09:01,232 - INFO - Read Word file: 20856 characters
2025-12-21 12:09:01,233 - INFO - Loading Stage F JSON...
2025-12-21 12:09:01,234 - INFO - Successfully loaded JSON: /home/mohammadbagher/Downloads/f.json
2025-12-21 12:09:01,234 - INFO - Loaded 39 records from Stage F
2025-12-21 12:09:01,236 - INFO - Splitting Stage E data into 2 parts: Part 1 (373 records), Part 2 (374 records)
2025-12-21 12:09:01,238 - INFO - Processing Part 1...
2025-12-21 12:11:24,085 - INFO - Text processed successfully with gemini-2.5-pro
2025-12-21 12:11:24,086 - INFO - Part 1 response received (33075 characters)
2025-12-21 12:11:24,089 - INFO - Processing Part 2...
2025-12-21 12:13:37,531 - INFO - Text processed successfully with gemini-2.5-pro
2025-12-21 12:13:37,532 - INFO - Part 2 response received (29973 characters)
2025-12-21 12:13:37,535 - INFO - Combining responses from both parts...
2025-12-21 12:13:37,542 - INFO - Saved combined response to: /home/mohammadbagher/Downloads/e105030_stage_j.txt
2025-12-21 12:13:37,547 - INFO - Extracting JSON from Part 1 response...
2025-12-21 12:13:37,552 - INFO - Successfully extracted JSON from response
2025-12-21 12:13:37,557 - INFO - Extracting JSON from Part 2 response...
2025-12-21 12:13:37,560 - INFO - Successfully extracted JSON from response
2025-12-21 12:13:37,562 - INFO - Combining JSON from both parts...
2025-12-21 12:13:37,564 - INFO - Extracted 786 records from combined model output (Part 1: 412, Part 2: 374)
2025-12-21 12:13:37,568 - INFO - Created mapping for 747 PointIds
2025-12-21 12:13:37,571 - INFO - Merging Stage E data with Imp and Type columns...
2025-12-21 12:13:37,577 - INFO - Merged 747 records
2025-12-21 12:13:37,579 - INFO - Matched 747 records with Imp/Type data
2025-12-21 12:13:37,581 - INFO - Saving Stage J output to: /home/mohammadbagher/Downloads/a105030.json
2025-12-21 12:13:37,610 - INFO - Successfully saved JSON: /home/mohammadbagher/Downloads/a105030.json (747 records)
2025-12-21 12:13:37,612 - INFO - Stage J completed successfully: /home/mohammadbagher/Downloads/a105030.json
2025-12-21 12:42:39,434 - INFO - Starting Stage H processing...
2025-12-21 12:42:39,434 - INFO - Loading Stage J JSON...
2025-12-21 12:42:39,522 - INFO - Successfully loaded JSON: /home/mohammadbagher/Downloads/a105030.json
2025-12-21 12:42:39,524 - INFO - Loaded 747 records from Stage J
2025-12-21 12:42:39,527 - INFO - Prepared 747 records from Stage J (without Imp column)
2025-12-21 12:42:39,528 - INFO - Detected Book ID: 105, Chapter ID: 30
2025-12-21 12:42:39,529 - INFO - Loading Stage F JSON...
2025-12-21 12:42:39,530 - INFO - Successfully loaded JSON: /home/mohammadbagher/Downloads/f.json
2025-12-21 12:42:39,532 - INFO - Loaded 39 records from Stage F
2025-12-21 12:42:39,551 - INFO - Calling model: gemini-2.5-pro...
2025-12-21 12:46:28,636 - INFO - Text processed successfully with gemini-2.5-pro
2025-12-21 12:46:28,637 - INFO - Received response from model (64720 characters)
2025-12-21 12:46:28,643 - INFO - Saved raw response to: /home/mohammadbagher/Downloads/a105030_stage_h.txt
2025-12-21 12:46:28,647 - INFO - Extracting JSON from model response...
2025-12-21 12:46:28,648 - WARNING - No closing markdown marker found, JSON may be incomplete
2025-12-21 12:46:28,652 - WARNING - Direct JSON parse failed: Unterminated string starting at: line 1871 column 17 (char 64711). Trying fallback extraction...
2025-12-21 12:46:28,652 - ERROR - All JSON extraction methods failed
2025-12-21 12:46:28,653 - WARNING - Failed to extract JSON from response
2025-12-21 12:46:28,654 - INFO - Trying to load JSON from TXT file...
2025-12-21 12:46:28,655 - WARNING - No closing markdown marker found, JSON may be incomplete
2025-12-21 12:46:28,658 - WARNING - Direct JSON parse failed: Unterminated string starting at: line 1871 column 17 (char 64711). Trying fallback extraction...
2025-12-21 12:46:28,658 - ERROR - All JSON extraction methods failed
2025-12-21 12:46:28,659 - INFO - Falling back to manual JSON extraction for /home/mohammadbagher/Downloads/a105030_stage_h.txt
2025-12-21 12:46:28,680 - INFO - Extracted 207 complete objects from incomplete JSON array for /home/mohammadbagher/Downloads/a105030_stage_h.txt
2025-12-21 12:46:28,681 - INFO - Successfully loaded JSON from TXT: /home/mohammadbagher/Downloads/a105030_stage_h.txt
2025-12-21 12:46:28,681 - INFO - Extracted 207 records from model output
2025-12-21 12:46:28,682 - INFO - Processing flashcard records...
2025-12-21 12:46:28,682 - INFO - Created mapping for 207 PointIds from model output
2025-12-21 12:46:28,688 - INFO - Generated 747 flashcard records
2025-12-21 12:46:28,690 - INFO - Matched 207 records with flashcard data from model
2025-12-21 12:46:28,691 - INFO - Saving Stage H output to: /home/mohammadbagher/Downloads/ac105030.json
2025-12-21 12:46:28,743 - INFO - Successfully saved JSON: /home/mohammadbagher/Downloads/ac105030.json (747 records)
2025-12-21 12:46:28,743 - INFO - Stage H completed successfully: /home/mohammadbagher/Downloads/ac105030.json
2025-12-21 12:51:22,243 - INFO - Loaded 6 predefined prompts
2025-12-21 12:51:22,244 - WARNING - python-docx not available. Will try alternative methods.
2025-12-21 12:51:52,149 - INFO - Loaded 3 API keys
2025-12-21 12:52:32,797 - INFO - Starting Stage H processing...
2025-12-21 12:52:32,798 - INFO - Loading Stage J JSON...
2025-12-21 12:52:32,803 - INFO - Successfully loaded JSON: /home/mohammadbagher/Downloads/a105030.json
2025-12-21 12:52:32,804 - INFO - Loaded 747 records from Stage J
2025-12-21 12:52:32,807 - INFO - Prepared 747 records from Stage J (without Imp column)
2025-12-21 12:52:32,808 - INFO - Detected Book ID: 105, Chapter ID: 30
2025-12-21 12:52:32,809 - INFO - Loading Stage F JSON...
2025-12-21 12:52:32,809 - INFO - Successfully loaded JSON: /home/mohammadbagher/Downloads/f.json
2025-12-21 12:52:32,810 - INFO - Loaded 39 records from Stage F
2025-12-21 12:52:32,811 - INFO - Splitting Stage J data into 2 parts: Part 1 (373 records), Part 2 (374 records)
2025-12-21 12:52:32,812 - INFO - Processing Part 1...
2025-12-21 12:56:02,612 - INFO - Text processed successfully with gemini-2.5-pro
2025-12-21 12:56:02,614 - INFO - Part 1 response received (64301 characters)
2025-12-21 12:56:02,616 - INFO - Processing Part 2...
2025-12-21 12:59:38,908 - INFO - Text processed successfully with gemini-2.5-pro
2025-12-21 12:59:38,909 - INFO - Part 2 response received (74009 characters)
2025-12-21 12:59:38,909 - INFO - Combining responses from both parts...
2025-12-21 12:59:38,912 - INFO - Saved combined response to: /home/mohammadbagher/Downloads/a105030_stage_h.txt
2025-12-21 12:59:38,913 - INFO - Extracting JSON from Part 1 response...
2025-12-21 12:59:38,914 - INFO - Successfully extracted JSON from response
2025-12-21 12:59:38,916 - INFO - Extracting JSON from Part 2 response...
2025-12-21 12:59:38,917 - WARNING - No closing markdown marker found, JSON may be incomplete
2025-12-21 12:59:38,918 - WARNING - Direct JSON parse failed: Expecting value: line 1892 column 7 (char 74000). Trying fallback extraction...
2025-12-21 12:59:38,919 - WARNING - Object extraction parse failed: Expecting ',' delimiter: line 1892 column 6 (char 73999)
2025-12-21 12:59:38,932 - INFO - Attempting to repair incomplete JSON...
2025-12-21 12:59:38,986 - WARNING - Repair method returned None
2025-12-21 12:59:38,988 - ERROR - All JSON extraction methods failed
2025-12-21 12:59:38,988 - WARNING - Failed to extract JSON from response
2025-12-21 12:59:38,989 - INFO - Trying to extract Part 2 JSON from text...
2025-12-21 12:59:38,989 - WARNING - No closing markdown marker found, JSON may be incomplete
2025-12-21 12:59:38,992 - WARNING - Direct JSON parse failed: Expecting value: line 1892 column 7 (char 74000). Trying fallback extraction...
2025-12-21 12:59:38,995 - WARNING - Object extraction parse failed: Expecting ',' delimiter: line 1892 column 6 (char 73999)
2025-12-21 12:59:39,019 - INFO - Attempting to repair incomplete JSON...
2025-12-21 12:59:39,065 - WARNING - Repair method returned None
2025-12-21 12:59:39,065 - ERROR - All JSON extraction methods failed
2025-12-21 12:59:39,065 - INFO - Combining JSON from both parts...
2025-12-21 12:59:39,066 - INFO - Extracted 80 records from combined model output (Part 1: 80, Part 2: 0)
2025-12-21 12:59:39,067 - INFO - Processing flashcard records...
2025-12-21 12:59:39,068 - INFO - Created mapping for 80 PointIds from model output
2025-12-21 12:59:39,075 - INFO - Generated 747 flashcard records
2025-12-21 12:59:39,076 - INFO - Matched 80 records with flashcard data from model
2025-12-21 12:59:39,076 - INFO - Saving Stage H output to: /home/mohammadbagher/Downloads/ac105030.json
2025-12-21 12:59:39,121 - INFO - Successfully saved JSON: /home/mohammadbagher/Downloads/ac105030.json (747 records)
2025-12-21 12:59:39,121 - INFO - Stage H completed successfully: /home/mohammadbagher/Downloads/ac105030.json
2025-12-21 13:14:27,479 - INFO - Loaded 6 predefined prompts
2025-12-21 13:14:27,479 - WARNING - python-docx not available. Will try alternative methods.
2025-12-21 13:14:54,460 - INFO - Loaded 3 API keys
2025-12-21 13:16:37,393 - INFO - Starting Stage H processing...
2025-12-21 13:16:37,397 - INFO - Loading Stage J JSON...
2025-12-21 13:16:37,426 - INFO - Successfully loaded JSON: /home/mohammadbagher/Downloads/a105030.json
2025-12-21 13:16:37,428 - INFO - Loaded 747 records from Stage J
2025-12-21 13:16:37,431 - INFO - Prepared 747 records from Stage J for prompt (without Imp column)
2025-12-21 13:16:37,432 - INFO - Detected Book ID: 105, Chapter ID: 30
2025-12-21 13:16:37,433 - INFO - Loading Stage F JSON...
2025-12-21 13:16:37,435 - INFO - Successfully loaded JSON: /home/mohammadbagher/Downloads/f.json
2025-12-21 13:16:37,436 - INFO - Loaded 39 records from Stage F
2025-12-21 13:16:37,437 - INFO - Splitting Stage J data into 2 parts: Part 1 (373 records), Part 2 (374 records)
2025-12-21 13:16:37,439 - INFO - Processing Part 1...
2025-12-21 13:20:16,234 - INFO - Text processed successfully with gemini-2.5-pro
2025-12-21 13:20:16,239 - INFO - Part 1 response received (62055 characters)
2025-12-21 13:20:16,241 - INFO - Processing Part 2...
2025-12-21 13:23:51,595 - INFO - Text processed successfully with gemini-2.5-pro
2025-12-21 13:23:51,596 - INFO - Part 2 response received (59828 characters)
2025-12-21 13:23:51,598 - INFO - Combining responses from both parts...
2025-12-21 13:23:51,610 - INFO - Saved combined response to: /home/mohammadbagher/Downloads/a105030_stage_h.txt
2025-12-21 13:23:51,613 - INFO - Extracting JSON from Part 1 response...
2025-12-21 13:23:51,616 - WARNING - No closing markdown marker found, JSON may be incomplete
2025-12-21 13:23:51,619 - WARNING - Direct JSON parse failed: Expecting property name enclosed in double quotes: line 1652 column 25 (char 62046). Trying fallback extraction...
2025-12-21 13:23:51,622 - WARNING - Object extraction parse failed: Expecting ',' delimiter: line 1640 column 6 (char 61563)
2025-12-21 13:23:51,636 - INFO - Attempting to repair incomplete JSON...
2025-12-21 13:23:51,676 - WARNING - Repair method returned None
2025-12-21 13:23:51,677 - ERROR - All JSON extraction methods failed
2025-12-21 13:23:51,677 - WARNING - Failed to extract JSON from response
2025-12-21 13:23:51,677 - INFO - Trying to extract Part 1 JSON from text...
2025-12-21 13:23:51,677 - WARNING - No closing markdown marker found, JSON may be incomplete
2025-12-21 13:23:51,679 - WARNING - Direct JSON parse failed: Expecting property name enclosed in double quotes: line 1652 column 25 (char 62046). Trying fallback extraction...
2025-12-21 13:23:51,680 - WARNING - Object extraction parse failed: Expecting ',' delimiter: line 1640 column 6 (char 61563)
2025-12-21 13:23:51,696 - INFO - Attempting to repair incomplete JSON...
2025-12-21 13:23:51,749 - WARNING - Repair method returned None
2025-12-21 13:23:51,750 - ERROR - All JSON extraction methods failed
2025-12-21 13:23:51,750 - INFO - Extracting JSON from Part 2 response...
2025-12-21 13:23:51,750 - WARNING - No closing markdown marker found, JSON may be incomplete
2025-12-21 13:23:51,751 - WARNING - Direct JSON parse failed: Unterminated string starting at: line 1666 column 27 (char 59765). Trying fallback extraction...
2025-12-21 13:23:51,751 - ERROR - All JSON extraction methods failed
2025-12-21 13:23:51,752 - WARNING - Failed to extract JSON from response
2025-12-21 13:23:51,753 - INFO - Trying to extract Part 2 JSON from text...
2025-12-21 13:23:51,753 - WARNING - No closing markdown marker found, JSON may be incomplete
2025-12-21 13:23:51,754 - WARNING - Direct JSON parse failed: Unterminated string starting at: line 1666 column 27 (char 59765). Trying fallback extraction...
2025-12-21 13:23:51,755 - ERROR - All JSON extraction methods failed
2025-12-21 13:23:51,755 - INFO - Combining JSON from both parts...
2025-12-21 13:23:51,755 - ERROR - Failed to extract JSON from model responses
2025-12-21 13:23:51,755 - INFO - Trying to load JSON from TXT file as fallback...
2025-12-21 13:23:51,758 - WARNING - Direct JSON parse failed: Expecting property name enclosed in double quotes: line 1655 column 1 (char 62049). Trying fallback extraction...
2025-12-21 13:23:51,759 - WARNING - Object extraction parse failed: Expecting ',' delimiter: line 1640 column 6 (char 61563)
2025-12-21 13:23:51,780 - INFO - Attempting to repair incomplete JSON...
2025-12-21 13:23:51,825 - WARNING - Repair method returned None
2025-12-21 13:23:51,825 - ERROR - All JSON extraction methods failed
2025-12-21 13:23:51,825 - INFO - Falling back to manual JSON extraction for /home/mohammadbagher/Downloads/a105030_stage_h.txt
2025-12-21 13:23:51,862 - INFO - Extracted 78 complete objects from incomplete JSON array for /home/mohammadbagher/Downloads/a105030_stage_h.txt
2025-12-21 13:23:51,862 - INFO - Successfully loaded JSON from TXT: /home/mohammadbagher/Downloads/a105030_stage_h.txt
2025-12-21 13:23:51,864 - INFO - Extracted 78 records from combined model output (Part 1: 0, Part 2: 0)
2025-12-21 13:23:51,864 - INFO - Created mapping for 78 PointIds from model output
2025-12-21 13:23:51,864 - INFO - Merging Stage J data with model output...
2025-12-21 13:23:51,867 - INFO - Generated 747 flashcard records
2025-12-21 13:23:51,867 - INFO - Matched 78 records with flashcard data from model
2025-12-21 13:23:51,867 - INFO - Saving Stage H output to: /home/mohammadbagher/Downloads/ac105030.json
2025-12-21 13:23:51,897 - INFO - Successfully saved JSON: /home/mohammadbagher/Downloads/ac105030.json (747 records)
2025-12-21 13:23:51,897 - INFO - Stage H completed successfully: /home/mohammadbagher/Downloads/ac105030.json
2025-12-21 13:40:55,910 - INFO - Loaded 6 predefined prompts
2025-12-21 13:40:55,911 - WARNING - python-docx not available. Will try alternative methods.
2025-12-21 13:43:40,721 - INFO - Loaded 3 API keys
2025-12-21 13:44:42,544 - INFO - Starting Stage H processing...
2025-12-21 13:44:42,544 - INFO - Loading Stage J JSON...
2025-12-21 13:44:42,552 - INFO - Successfully loaded JSON: /home/mohammadbagher/Downloads/a105030.json
2025-12-21 13:44:42,552 - INFO - Loaded 747 records from Stage J
2025-12-21 13:44:42,554 - INFO - Prepared 747 records from Stage J for prompt (without Imp column)
2025-12-21 13:44:42,554 - INFO - Detected Book ID: 105, Chapter ID: 30
2025-12-21 13:44:42,555 - INFO - Loading Stage F JSON...
2025-12-21 13:44:42,555 - INFO - Successfully loaded JSON: /home/mohammadbagher/Downloads/f.json
2025-12-21 13:44:42,556 - INFO - Loaded 39 records from Stage F
2025-12-21 13:44:42,556 - INFO - Splitting Stage J data into 2 parts: Part 1 (373 records), Part 2 (374 records)
2025-12-21 13:44:42,558 - INFO - Processing Part 1...
2025-12-21 13:48:20,556 - INFO - Text processed successfully with gemini-2.5-pro
2025-12-21 13:48:20,558 - INFO - Part 1 response received (69575 characters)
2025-12-21 13:48:20,561 - INFO - Processing Part 2...
2025-12-21 13:51:59,729 - INFO - Text processed successfully with gemini-2.5-pro
2025-12-21 13:51:59,730 - INFO - Part 2 response received (71035 characters)
2025-12-21 13:51:59,733 - INFO - Saved raw model responses to: /home/mohammadbagher/Downloads/a105030_stage_h.txt
2025-12-21 13:51:59,735 - INFO - Extracting JSON from Part 1 response...
2025-12-21 13:51:59,735 - WARNING - No closing markdown marker found, JSON may be incomplete
2025-12-21 13:51:59,738 - WARNING - Direct JSON parse failed: Expecting property name enclosed in double quotes: line 2086 column 32 (char 69560). Trying fallback extraction...
2025-12-21 13:51:59,740 - WARNING - Object extraction parse failed: Expecting ',' delimiter: line 2081 column 6 (char 69391)
2025-12-21 13:51:59,758 - INFO - Attempting to repair incomplete JSON...
2025-12-21 13:51:59,810 - WARNING - Repair method returned None
2025-12-21 13:51:59,812 - ERROR - All JSON extraction methods failed
2025-12-21 13:51:59,814 - WARNING - Failed to extract JSON from response
2025-12-21 13:51:59,817 - INFO - Trying to extract Part 1 JSON from text...
2025-12-21 13:51:59,819 - WARNING - No closing markdown marker found, JSON may be incomplete
2025-12-21 13:51:59,822 - WARNING - Direct JSON parse failed: Expecting property name enclosed in double quotes: line 2086 column 32 (char 69560). Trying fallback extraction...
2025-12-21 13:51:59,824 - WARNING - Object extraction parse failed: Expecting ',' delimiter: line 2081 column 6 (char 69391)
2025-12-21 13:51:59,845 - INFO - Attempting to repair incomplete JSON...
2025-12-21 13:51:59,884 - WARNING - Repair method returned None
2025-12-21 13:51:59,885 - ERROR - All JSON extraction methods failed
2025-12-21 13:51:59,885 - INFO - Extracting JSON from Part 2 response...
2025-12-21 13:51:59,886 - WARNING - No closing markdown marker found, JSON may be incomplete
2025-12-21 13:51:59,887 - WARNING - Direct JSON parse failed: Unterminated string starting at: line 2142 column 7 (char 71019). Trying fallback extraction...
2025-12-21 13:51:59,892 - WARNING - Object extraction parse failed: Expecting ',' delimiter: line 2135 column 6 (char 70792)
2025-12-21 13:51:59,914 - INFO - Attempting to repair incomplete JSON...
2025-12-21 13:51:59,967 - WARNING - Repair method returned None
2025-12-21 13:51:59,967 - ERROR - All JSON extraction methods failed
2025-12-21 13:51:59,968 - WARNING - Failed to extract JSON from response
2025-12-21 13:51:59,968 - INFO - Trying to extract Part 2 JSON from text...
2025-12-21 13:51:59,969 - WARNING - No closing markdown marker found, JSON may be incomplete
2025-12-21 13:51:59,970 - WARNING - Direct JSON parse failed: Unterminated string starting at: line 2142 column 7 (char 71019). Trying fallback extraction...
2025-12-21 13:51:59,971 - WARNING - Object extraction parse failed: Expecting ',' delimiter: line 2135 column 6 (char 70792)
2025-12-21 13:51:59,992 - INFO - Attempting to repair incomplete JSON...
2025-12-21 13:52:00,048 - WARNING - Repair method returned None
2025-12-21 13:52:00,049 - ERROR - All JSON extraction methods failed
2025-12-21 13:52:00,049 - INFO - Combining JSON from both parts...
2025-12-21 13:52:00,049 - ERROR - Failed to extract JSON from model responses
2025-12-21 13:52:00,049 - INFO - Trying to load JSON from TXT file as fallback...
2025-12-21 13:52:00,052 - WARNING - Direct JSON parse failed: Expecting property name enclosed in double quotes: line 2086 column 32 (char 69560). Trying fallback extraction...
2025-12-21 13:52:00,056 - WARNING - Object extraction parse failed: Expecting ',' delimiter: line 2081 column 6 (char 69391)
2025-12-21 13:52:00,075 - INFO - Attempting to repair incomplete JSON...
2025-12-21 13:52:00,132 - WARNING - Repair method returned None
2025-12-21 13:52:00,132 - ERROR - All JSON extraction methods failed
2025-12-21 13:52:00,133 - INFO - Falling back to manual JSON extraction for /home/mohammadbagher/Downloads/a105030_stage_h.txt
2025-12-21 13:52:00,184 - INFO - Extracted 231 complete objects from incomplete JSON array for /home/mohammadbagher/Downloads/a105030_stage_h.txt
2025-12-21 13:52:00,184 - INFO - Successfully loaded JSON from TXT: /home/mohammadbagher/Downloads/a105030_stage_h.txt
2025-12-21 13:52:00,186 - INFO - Extracted 231 records from combined model output (Part 1: 0, Part 2: 0)
2025-12-21 13:52:00,188 - INFO - Created mapping for 231 PointIds from model output
2025-12-21 13:52:00,188 - INFO - Merging Stage J data with model output...
2025-12-21 13:52:00,195 - INFO - Generated 747 flashcard records
2025-12-21 13:52:00,197 - INFO - Matched 231 records with flashcard data from model
2025-12-21 13:52:00,198 - INFO - Saving Stage H output to: /home/mohammadbagher/Downloads/ac105030.json
2025-12-21 13:52:00,253 - INFO - Successfully saved JSON: /home/mohammadbagher/Downloads/ac105030.json (747 records)
2025-12-21 13:52:00,254 - INFO - Stage H completed successfully: /home/mohammadbagher/Downloads/ac105030.json
2025-12-21 13:57:26,977 - INFO - Loaded 6 predefined prompts
2025-12-21 13:57:26,978 - WARNING - python-docx not available. Will try alternative methods.
2025-12-21 13:57:52,666 - INFO - Loaded 3 API keys
2025-12-21 13:58:23,742 - INFO - Starting Stage H processing...
2025-12-21 13:58:23,744 - INFO - Loading Stage J JSON...
2025-12-21 13:58:23,754 - INFO - Successfully loaded JSON: /home/mohammadbagher/Downloads/a105030.json
2025-12-21 13:58:23,755 - INFO - Loaded 747 records from Stage J
2025-12-21 13:58:23,757 - INFO - Prepared 747 records from Stage J for prompt (without Imp column)
2025-12-21 13:58:23,758 - INFO - Detected Book ID: 105, Chapter ID: 30
2025-12-21 13:58:23,759 - INFO - Loading Stage F JSON...
2025-12-21 13:58:23,760 - INFO - Successfully loaded JSON: /home/mohammadbagher/Downloads/f.json
2025-12-21 13:58:23,761 - INFO - Loaded 39 records from Stage F
2025-12-21 13:58:23,762 - INFO - Splitting Stage J data into 3 parts: Part 1 (249 records), Part 2 (249 records), Part 3 (249 records)
2025-12-21 13:58:23,765 - INFO - Processing Part 1...
2025-12-21 14:02:01,744 - INFO - Text processed successfully with gemini-2.5-pro
2025-12-21 14:02:01,745 - INFO - Part 1 response received (64049 characters)
2025-12-21 14:02:01,748 - INFO - Processing Part 2...
2025-12-21 14:05:36,013 - INFO - Text processed successfully with gemini-2.5-pro
2025-12-21 14:05:36,014 - INFO - Part 2 response received (60809 characters)
2025-12-21 14:05:36,025 - INFO - Saved raw model responses to: /home/mohammadbagher/Downloads/a105030_stage_h.txt
2025-12-21 14:05:36,028 - INFO - Extracting JSON from Part 1 response...
2025-12-21 14:05:36,031 - WARNING - No closing markdown marker found, JSON may be incomplete
2025-12-21 14:05:36,035 - WARNING - Direct JSON parse failed: Unterminated string starting at: line 1962 column 18 (char 64039). Trying fallback extraction...
2025-12-21 14:05:36,038 - WARNING - Object extraction parse failed: Expecting ',' delimiter: line 1955 column 6 (char 63814)
2025-12-21 14:05:36,055 - INFO - Attempting to repair incomplete JSON...
2025-12-21 14:05:36,098 - WARNING - Repair method returned None
2025-12-21 14:05:36,100 - ERROR - All JSON extraction methods failed
2025-12-21 14:05:36,100 - WARNING - Failed to extract JSON from response
2025-12-21 14:05:36,102 - INFO - Trying to extract Part 1 JSON from text...
2025-12-21 14:05:36,103 - WARNING - No closing markdown marker found, JSON may be incomplete
2025-12-21 14:05:36,104 - WARNING - Direct JSON parse failed: Unterminated string starting at: line 1962 column 18 (char 64039). Trying fallback extraction...
2025-12-21 14:05:36,106 - WARNING - Object extraction parse failed: Expecting ',' delimiter: line 1955 column 6 (char 63814)
2025-12-21 14:05:36,126 - INFO - Attempting to repair incomplete JSON...
2025-12-21 14:05:36,169 - WARNING - Repair method returned None
2025-12-21 14:05:36,169 - ERROR - All JSON extraction methods failed
2025-12-21 14:05:36,171 - INFO - Extracting JSON from Part 2 response...
2025-12-21 14:05:36,171 - WARNING - No closing markdown marker found, JSON may be incomplete
2025-12-21 14:05:36,174 - WARNING - Direct JSON parse failed: Unterminated string starting at: line 1914 column 18 (char 60784). Trying fallback extraction...
2025-12-21 14:05:36,177 - WARNING - Object extraction parse failed: Expecting ',' delimiter: line 1910 column 6 (char 60669)
2025-12-21 14:05:36,192 - INFO - Attempting to repair incomplete JSON...
2025-12-21 14:05:36,231 - WARNING - Repair method returned None
2025-12-21 14:05:36,231 - ERROR - All JSON extraction methods failed
2025-12-21 14:05:36,232 - WARNING - Failed to extract JSON from response
2025-12-21 14:05:36,233 - INFO - Trying to extract Part 2 JSON from text...
2025-12-21 14:05:36,234 - WARNING - No closing markdown marker found, JSON may be incomplete
2025-12-21 14:05:36,235 - WARNING - Direct JSON parse failed: Unterminated string starting at: line 1914 column 18 (char 60784). Trying fallback extraction...
2025-12-21 14:05:36,236 - WARNING - Object extraction parse failed: Expecting ',' delimiter: line 1910 column 6 (char 60669)
2025-12-21 14:05:36,245 - INFO - Attempting to repair incomplete JSON...
2025-12-21 14:05:36,278 - WARNING - Repair method returned None
2025-12-21 14:05:36,279 - ERROR - All JSON extraction methods failed
2025-12-21 14:05:36,279 - INFO - Combining JSON from both parts...
2025-12-21 14:05:36,279 - ERROR - Failed to extract JSON from model responses
2025-12-21 14:05:36,280 - INFO - Trying to load JSON from TXT file as fallback...
2025-12-21 14:05:36,283 - WARNING - Direct JSON parse failed: Unterminated string starting at: line 1962 column 18 (char 64039). Trying fallback extraction...
2025-12-21 14:05:36,284 - WARNING - Object extraction parse failed: Expecting ',' delimiter: line 1955 column 6 (char 63814)
2025-12-21 14:05:36,299 - INFO - Attempting to repair incomplete JSON...
2025-12-21 14:05:36,338 - WARNING - Repair method returned None
2025-12-21 14:05:36,338 - ERROR - All JSON extraction methods failed
2025-12-21 14:05:36,338 - INFO - Falling back to manual JSON extraction for /home/mohammadbagher/Downloads/a105030_stage_h.txt
2025-12-21 14:05:36,368 - INFO - Extracted 217 complete objects from incomplete JSON array for /home/mohammadbagher/Downloads/a105030_stage_h.txt
2025-12-21 14:05:36,368 - INFO - Successfully loaded JSON from TXT: /home/mohammadbagher/Downloads/a105030_stage_h.txt
2025-12-21 14:05:36,368 - ERROR - Error in Stage H processing: name 'part3_data_list' is not defined
Traceback (most recent call last):
  File "/home/mohammadbagher/Desktop/tts app bagher/content_automation_project/main_gui.py", line 3147, in worker
    output_path = self.stage_h_processor.process_stage_h(
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/mohammadbagher/Desktop/tts app bagher/content_automation_project/stage_h_processor.py", line 276, in process_stage_h
    _progress(f"Extracted {len(model_data)} records from combined model output (Part 1: {len(part1_data_list)}, Part 2: {len(part2_data_list)}, Part 3: {len(part3_data_list)})")
                                                                                                                                                             ^^^^^^^^^^^^^^^
NameError: name 'part3_data_list' is not defined
2025-12-21 14:08:32,178 - INFO - Loaded 6 predefined prompts
2025-12-21 14:08:32,178 - WARNING - python-docx not available. Will try alternative methods.
2025-12-21 14:09:00,694 - INFO - Loaded 3 API keys
2025-12-21 14:09:51,933 - INFO - Starting Stage H processing...
2025-12-21 14:09:51,933 - INFO - Loading Stage J JSON...
2025-12-21 14:09:51,938 - INFO - Successfully loaded JSON: /home/mohammadbagher/Downloads/a105030.json
2025-12-21 14:09:51,939 - INFO - Loaded 747 records from Stage J
2025-12-21 14:09:51,941 - INFO - Prepared 747 records from Stage J for prompt (without Imp column)
2025-12-21 14:09:51,941 - INFO - Detected Book ID: 105, Chapter ID: 30
2025-12-21 14:09:51,942 - INFO - Loading Stage F JSON...
2025-12-21 14:09:51,942 - INFO - Successfully loaded JSON: /home/mohammadbagher/Downloads/f.json
2025-12-21 14:09:51,943 - INFO - Loaded 39 records from Stage F
2025-12-21 14:09:51,943 - INFO - Splitting Stage J data into 3 parts: Part 1 (249 records), Part 2 (249 records), Part 3 (249 records)
2025-12-21 14:09:51,944 - INFO - Processing Part 1...
2025-12-21 14:13:26,853 - INFO - Text processed successfully with gemini-2.5-pro
2025-12-21 14:13:26,855 - INFO - Part 1 response received (68112 characters)
2025-12-21 14:13:26,857 - INFO - Processing Part 2...
2025-12-21 14:17:03,023 - INFO - Text processed successfully with gemini-2.5-pro
2025-12-21 14:17:03,027 - INFO - Part 2 response received (67480 characters)
2025-12-21 14:17:03,029 - INFO - Processing Part 3...
2025-12-21 14:20:39,656 - INFO - Text processed successfully with gemini-2.5-pro
2025-12-21 14:20:39,657 - INFO - Part 3 response received (67317 characters)
2025-12-21 14:20:39,667 - INFO - Saved raw model responses to: /home/mohammadbagher/Downloads/a105030_stage_h.txt
2025-12-21 14:20:39,671 - INFO - Extracting JSON from Part 1 response...
2025-12-21 14:20:39,672 - WARNING - No closing markdown marker found, JSON may be incomplete
2025-12-21 14:20:39,679 - WARNING - Direct JSON parse failed: Unterminated string starting at: line 2094 column 18 (char 68091). Trying fallback extraction...
2025-12-21 14:20:39,683 - WARNING - Object extraction parse failed: Expecting ',' delimiter: line 2090 column 6 (char 67975)
2025-12-21 14:20:39,714 - INFO - Attempting to repair incomplete JSON...
2025-12-21 14:20:39,750 - WARNING - Repair method returned None
2025-12-21 14:20:39,750 - ERROR - All JSON extraction methods failed
2025-12-21 14:20:39,750 - WARNING - Failed to extract JSON from response
2025-12-21 14:20:39,751 - INFO - Trying to extract Part 1 JSON from text...
2025-12-21 14:20:39,752 - WARNING - No closing markdown marker found, JSON may be incomplete
2025-12-21 14:20:39,753 - WARNING - Direct JSON parse failed: Unterminated string starting at: line 2094 column 18 (char 68091). Trying fallback extraction...
2025-12-21 14:20:39,754 - WARNING - Object extraction parse failed: Expecting ',' delimiter: line 2090 column 6 (char 67975)
2025-12-21 14:20:39,771 - INFO - Attempting to repair incomplete JSON...
2025-12-21 14:20:39,823 - WARNING - Repair method returned None
2025-12-21 14:20:39,823 - ERROR - All JSON extraction methods failed
2025-12-21 14:20:39,824 - INFO - Extracting JSON from Part 2 response...
2025-12-21 14:20:39,824 - WARNING - No closing markdown marker found, JSON may be incomplete
2025-12-21 14:20:39,825 - WARNING - Direct JSON parse failed: Unterminated string starting at: line 2085 column 18 (char 67464). Trying fallback extraction...
2025-12-21 14:20:39,826 - WARNING - Object extraction parse failed: Expecting ',' delimiter: line 2081 column 6 (char 67355)
2025-12-21 14:20:39,842 - INFO - Attempting to repair incomplete JSON...
2025-12-21 14:20:39,892 - WARNING - Repair method returned None
2025-12-21 14:20:39,892 - ERROR - All JSON extraction methods failed
2025-12-21 14:20:39,892 - WARNING - Failed to extract JSON from response
2025-12-21 14:20:39,892 - INFO - Trying to extract Part 2 JSON from text...
2025-12-21 14:20:39,893 - WARNING - No closing markdown marker found, JSON may be incomplete
2025-12-21 14:20:39,894 - WARNING - Direct JSON parse failed: Unterminated string starting at: line 2085 column 18 (char 67464). Trying fallback extraction...
2025-12-21 14:20:39,895 - WARNING - Object extraction parse failed: Expecting ',' delimiter: line 2081 column 6 (char 67355)
2025-12-21 14:20:39,910 - INFO - Attempting to repair incomplete JSON...
2025-12-21 14:20:39,963 - WARNING - Repair method returned None
2025-12-21 14:20:39,964 - ERROR - All JSON extraction methods failed
2025-12-21 14:20:39,968 - INFO - Extracting JSON from Part 3 response...
2025-12-21 14:20:39,969 - WARNING - No closing markdown marker found, JSON may be incomplete
2025-12-21 14:20:39,970 - WARNING - Direct JSON parse failed: Expecting value: line 1923 column 17 (char 67309). Trying fallback extraction...
2025-12-21 14:20:39,973 - WARNING - Object extraction parse failed: Expecting ',' delimiter: line 1919 column 6 (char 67145)
2025-12-21 14:20:39,990 - INFO - Attempting to repair incomplete JSON...
2025-12-21 14:20:40,044 - WARNING - Repair method returned None
2025-12-21 14:20:40,045 - ERROR - All JSON extraction methods failed
2025-12-21 14:20:40,045 - WARNING - Failed to extract JSON from response
2025-12-21 14:20:40,046 - INFO - Trying to extract Part 3 JSON from text...
2025-12-21 14:20:40,046 - WARNING - No closing markdown marker found, JSON may be incomplete
2025-12-21 14:20:40,048 - WARNING - Direct JSON parse failed: Expecting value: line 1923 column 17 (char 67309). Trying fallback extraction...
2025-12-21 14:20:40,049 - WARNING - Object extraction parse failed: Expecting ',' delimiter: line 1919 column 6 (char 67145)
2025-12-21 14:20:40,063 - INFO - Attempting to repair incomplete JSON...
2025-12-21 14:20:40,114 - WARNING - Repair method returned None
2025-12-21 14:20:40,114 - ERROR - All JSON extraction methods failed
2025-12-21 14:20:40,114 - INFO - Combining JSON from all three parts...
2025-12-21 14:20:40,115 - ERROR - Failed to extract JSON from model responses
2025-12-21 14:20:40,115 - INFO - Trying to load JSON from TXT file as fallback...
2025-12-21 14:20:40,120 - WARNING - Direct JSON parse failed: Unterminated string starting at: line 2094 column 18 (char 68091). Trying fallback extraction...
2025-12-21 14:20:40,121 - WARNING - Object extraction parse failed: Expecting ',' delimiter: line 2090 column 6 (char 67975)
2025-12-21 14:20:40,134 - INFO - Attempting to repair incomplete JSON...
2025-12-21 14:20:40,174 - WARNING - Repair method returned None
2025-12-21 14:20:40,174 - ERROR - All JSON extraction methods failed
2025-12-21 14:20:40,175 - INFO - Falling back to manual JSON extraction for /home/mohammadbagher/Downloads/a105030_stage_h.txt
2025-12-21 14:20:40,255 - INFO - Extracted 232 complete objects from incomplete JSON array for /home/mohammadbagher/Downloads/a105030_stage_h.txt
2025-12-21 14:20:40,255 - INFO - Successfully loaded JSON from TXT: /home/mohammadbagher/Downloads/a105030_stage_h.txt
2025-12-21 14:20:40,255 - INFO - Extracted 232 records from combined model output (Part 1: 0, Part 2: 0, Part 3: 0)
2025-12-21 14:20:40,256 - INFO - Created mapping for 232 PointIds from model output
2025-12-21 14:20:40,256 - INFO - Merging Stage J data with model output...
2025-12-21 14:20:40,261 - INFO - Generated 747 flashcard records
2025-12-21 14:20:40,261 - INFO - Matched 232 records with flashcard data from model
2025-12-21 14:20:40,262 - INFO - Saving Stage H output to: /home/mohammadbagher/Downloads/ac105030.json
2025-12-21 14:20:40,302 - INFO - Successfully saved JSON: /home/mohammadbagher/Downloads/ac105030.json (747 records)
2025-12-21 14:20:40,303 - INFO - Stage H completed successfully: /home/mohammadbagher/Downloads/ac105030.json
2025-12-22 08:33:09,193 - INFO - Loaded 6 predefined prompts
2025-12-22 08:33:09,193 - WARNING - python-docx not available. Will try alternative methods.
2025-12-22 08:33:59,453 - INFO - Loaded 3 API keys
2025-12-22 08:34:52,708 - INFO - Starting Stage H processing...
2025-12-22 08:34:52,709 - INFO - Loading Stage J JSON...
2025-12-22 08:34:52,713 - INFO - Successfully loaded JSON: /home/mohammadbagher/Downloads/a105030.json
2025-12-22 08:34:52,714 - INFO - Loaded 747 records from Stage J
2025-12-22 08:34:52,717 - INFO - Prepared 747 records from Stage J for prompt (without Imp column)
2025-12-22 08:34:52,717 - INFO - Detected Book ID: 105, Chapter ID: 30
2025-12-22 08:34:52,718 - INFO - Loading Stage F JSON...
2025-12-22 08:34:52,719 - INFO - Successfully loaded JSON: /home/mohammadbagher/Downloads/f.json
2025-12-22 08:34:52,719 - INFO - Loaded 39 records from Stage F
2025-12-22 08:34:52,720 - INFO - Splitting Stage J data into 5 parts: Part 1 (149 records), Part 2 (149 records), Part 3 (149 records), Part 4 (149 records), Part 5 (151 records)
2025-12-22 08:34:52,721 - INFO - Processing Part 1...
2025-12-22 08:38:11,212 - INFO - Text processed successfully with gemini-2.5-pro
2025-12-22 08:38:11,214 - INFO - Part 1 response received (55858 characters)
2025-12-22 08:38:11,216 - INFO - Processing Part 2...
2025-12-22 08:41:08,033 - INFO - Text processed successfully with gemini-2.5-pro
2025-12-22 08:41:08,035 - INFO - Part 2 response received (50743 characters)
2025-12-22 08:41:08,037 - INFO - Processing Part 3...
2025-12-22 08:43:57,461 - INFO - Text processed successfully with gemini-2.5-pro
2025-12-22 08:43:57,462 - INFO - Part 3 response received (43179 characters)
2025-12-22 08:43:57,465 - INFO - Processing Part 4...
2025-12-22 08:46:38,161 - INFO - Text processed successfully with gemini-2.5-pro
2025-12-22 08:46:38,163 - INFO - Part 4 response received (42108 characters)
2025-12-22 08:46:38,165 - INFO - Processing Part 5...
2025-12-22 08:49:39,202 - INFO - Text processed successfully with gemini-2.5-pro
2025-12-22 08:49:39,203 - INFO - Part 5 response received (45448 characters)
2025-12-22 08:49:39,217 - INFO - Saved raw model responses to: /home/mohammadbagher/Downloads/a105030_stage_h.txt
2025-12-22 08:49:39,220 - INFO - Extracting JSON from Part 1 response...
2025-12-22 08:49:39,224 - INFO - Successfully extracted JSON from response
2025-12-22 08:49:39,225 - INFO - Extracting JSON from Part 2 response...
2025-12-22 08:49:39,228 - INFO - Successfully extracted JSON from response
2025-12-22 08:49:39,229 - INFO - Extracting JSON from Part 3 response...
2025-12-22 08:49:39,231 - INFO - Successfully extracted JSON from response
2025-12-22 08:49:39,233 - INFO - Extracting JSON from Part 4 response...
2025-12-22 08:49:39,234 - INFO - Successfully extracted JSON from response
2025-12-22 08:49:39,235 - INFO - Extracting JSON from Part 5 response...
2025-12-22 08:49:39,237 - INFO - Successfully extracted JSON from response
2025-12-22 08:49:39,239 - INFO - Combining JSON from all five parts...
2025-12-22 08:49:39,240 - INFO - Extracted 804 records from combined model output (Part 1: 188, Part 2: 167, Part 3: 149, Part 4: 149, Part 5: 151)
2025-12-22 08:49:39,242 - INFO - Created mapping for 747 PointIds from model output
2025-12-22 08:49:39,243 - INFO - Merging Stage J data with model output...
2025-12-22 08:49:39,251 - INFO - Generated 747 flashcard records
2025-12-22 08:49:39,253 - INFO - Matched 747 records with flashcard data from model
2025-12-22 08:49:39,253 - INFO - Saving Stage H output to: /home/mohammadbagher/Downloads/ac105030.json
2025-12-22 08:49:39,291 - INFO - Successfully saved JSON: /home/mohammadbagher/Downloads/ac105030.json (747 records)
2025-12-22 08:49:39,291 - INFO - Stage H completed successfully: /home/mohammadbagher/Downloads/ac105030.json
2025-12-22 09:13:02,181 - INFO - Loaded 6 predefined prompts
2025-12-22 09:13:02,182 - WARNING - python-docx not available. Will try alternative methods.
2025-12-22 09:13:02,182 - WARNING - python-docx not available. Will try alternative methods.
2025-12-22 09:14:21,850 - INFO - Loaded 3 API keys
2025-12-22 10:04:08,723 - INFO - Loaded 6 predefined prompts
2025-12-22 10:04:08,724 - WARNING - python-docx not available. Will try alternative methods.
2025-12-22 10:04:08,724 - WARNING - python-docx not available. Will try alternative methods.
2025-12-22 10:04:51,929 - INFO - Loaded 3 API keys
2025-12-22 10:12:35,037 - INFO - Starting Stage V processing...
2025-12-22 10:12:35,065 - INFO - Successfully loaded JSON: /home/mohammadbagher/Downloads/a105030.json
2025-12-22 10:12:35,070 - INFO - Detected Book ID: 105, Chapter ID: 30
2025-12-22 10:12:35,073 - INFO - ============================================================
2025-12-22 10:12:35,075 - INFO - STEP 1: Generating initial test questions...
2025-12-22 10:12:35,076 - INFO - ============================================================
2025-12-22 10:12:35,078 - INFO - Loading Stage J JSON for Step 1...
2025-12-22 10:12:35,089 - INFO - Successfully loaded JSON: /home/mohammadbagher/Downloads/a105030.json
2025-12-22 10:12:35,089 - INFO - Loaded 747 records from Stage J
2025-12-22 10:12:35,093 - INFO - Loading Word document...
2025-12-22 10:12:35,100 - INFO - Read file as plain text (latin-1): /home/mohammadbagher/Downloads/تست های پمفیگوس.docx
2025-12-22 10:12:35,100 - INFO - Splitting Stage J data into 5 parts: [149, 149, 149, 149, 151]
2025-12-22 10:12:35,102 - INFO - Processing Part 1 of Step 1...
2025-12-22 10:14:08,928 - INFO - Text processed successfully with gemini-2.5-pro
2025-12-22 10:14:08,929 - INFO - Part 1 response received (19441 characters)
2025-12-22 10:14:08,932 - INFO - Successfully extracted JSON from response
2025-12-22 10:14:08,932 - WARNING - No data/points/rows found in JSON, returning empty list
2025-12-22 10:14:08,935 - INFO - Processing Part 2 of Step 1...
2025-12-22 10:16:33,223 - INFO - Text processed successfully with gemini-2.5-pro
2025-12-22 10:16:33,225 - INFO - Part 2 response received (35781 characters)
2025-12-22 10:16:33,228 - INFO - Successfully extracted JSON from response
2025-12-22 10:16:33,229 - WARNING - No data/points/rows found in JSON, returning empty list
2025-12-22 10:16:33,234 - INFO - Processing Part 3 of Step 1...
2025-12-22 10:18:35,673 - INFO - Text processed successfully with gemini-2.5-pro
2025-12-22 10:18:35,674 - INFO - Part 3 response received (25490 characters)
2025-12-22 10:18:35,676 - INFO - Successfully extracted JSON from response
2025-12-22 10:18:35,677 - WARNING - No data/points/rows found in JSON, returning empty list
2025-12-22 10:18:35,678 - INFO - Processing Part 4 of Step 1...
2025-12-22 10:21:00,633 - INFO - Text processed successfully with gemini-2.5-pro
2025-12-22 10:21:00,635 - INFO - Part 4 response received (19130 characters)
2025-12-22 10:21:00,637 - INFO - Successfully extracted JSON from response
2025-12-22 10:21:00,638 - WARNING - No data/points/rows found in JSON, returning empty list
2025-12-22 10:21:00,640 - INFO - Processing Part 5 of Step 1...
2025-12-22 10:22:40,588 - INFO - Text processed successfully with gemini-2.5-pro
2025-12-22 10:22:40,590 - INFO - Part 5 response received (17933 characters)
2025-12-22 10:22:40,593 - INFO - Successfully extracted JSON from response
2025-12-22 10:22:40,594 - WARNING - No data/points/rows found in JSON, returning empty list
2025-12-22 10:22:40,594 - ERROR - No questions generated in Step 1
2025-12-22 10:22:40,596 - ERROR - Step 1 failed
2025-12-22 10:22:55,390 - INFO - Loaded 6 predefined prompts
2025-12-22 10:22:55,390 - WARNING - python-docx not available. Will try alternative methods.
2025-12-22 10:22:55,390 - WARNING - python-docx not available. Will try alternative methods.
2025-12-22 10:23:26,130 - INFO - Loaded 3 API keys
2025-12-22 10:24:25,314 - INFO - Starting Stage V processing...
2025-12-22 10:24:25,321 - INFO - Successfully loaded JSON: /home/mohammadbagher/Downloads/a105030.json
2025-12-22 10:24:25,322 - INFO - Detected Book ID: 105, Chapter ID: 30
2025-12-22 10:24:25,323 - INFO - ============================================================
2025-12-22 10:24:25,324 - INFO - STEP 1: Generating initial test questions...
2025-12-22 10:24:25,324 - INFO - ============================================================
2025-12-22 10:24:25,325 - INFO - Loading Stage J JSON for Step 1...
2025-12-22 10:24:25,330 - INFO - Successfully loaded JSON: /home/mohammadbagher/Downloads/a105030.json
2025-12-22 10:24:25,331 - INFO - Loaded 747 records from Stage J
2025-12-22 10:24:25,333 - INFO - Loading Word document...
2025-12-22 10:24:25,334 - INFO - Read file as plain text (latin-1): /home/mohammadbagher/Downloads/تست های پمفیگوس.docx
2025-12-22 10:24:25,335 - INFO - Splitting Stage J data into 5 parts: [149, 149, 149, 149, 151]
2025-12-22 10:24:25,336 - INFO - Processing Part 1 of Step 1...
2025-12-22 10:28:10,356 - INFO - Text processed successfully with gemini-2.5-pro
2025-12-22 10:28:10,358 - INFO - Part 1 response received (70285 characters)
2025-12-22 10:28:10,360 - INFO - Processing Part 2 of Step 1...
2025-12-22 10:31:03,028 - INFO - Text processed successfully with gemini-2.5-pro
2025-12-22 10:31:03,029 - INFO - Part 2 response received (29952 characters)
2025-12-22 10:31:03,033 - INFO - Processing Part 3 of Step 1...
2025-12-22 10:33:06,690 - INFO - Text processed successfully with gemini-2.5-pro
2025-12-22 10:33:06,691 - INFO - Part 3 response received (19137 characters)
2025-12-22 10:33:06,692 - INFO - Processing Part 4 of Step 1...
2025-12-22 10:34:48,232 - INFO - Text processed successfully with gemini-2.5-pro
2025-12-22 10:34:48,233 - INFO - Part 4 response received (23649 characters)
2025-12-22 10:34:48,236 - INFO - Processing Part 5 of Step 1...
2025-12-22 10:38:05,412 - INFO - Text processed successfully with gemini-2.5-pro
2025-12-22 10:38:05,413 - INFO - Part 5 response received (60378 characters)
2025-12-22 10:38:05,428 - INFO - Saved raw model responses to: /home/mohammadbagher/Downloads/a105030_stage_v_step1.txt
2025-12-22 10:38:05,430 - INFO - Extracting JSON from Part 1 response...
2025-12-22 10:38:05,434 - INFO - Successfully extracted JSON from response
2025-12-22 10:38:05,435 - WARNING - No data/points/rows found in JSON, returning empty list
2025-12-22 10:38:05,435 - INFO - Extracting JSON from Part 2 response...
2025-12-22 10:38:05,437 - INFO - Successfully extracted JSON from response
2025-12-22 10:38:05,438 - WARNING - No data/points/rows found in JSON, returning empty list
2025-12-22 10:38:05,439 - INFO - Extracting JSON from Part 3 response...
2025-12-22 10:38:05,439 - INFO - Successfully extracted JSON from response
2025-12-22 10:38:05,440 - WARNING - No data/points/rows found in JSON, returning empty list
2025-12-22 10:38:05,441 - INFO - Extracting JSON from Part 4 response...
2025-12-22 10:38:05,442 - INFO - Successfully extracted JSON from response
2025-12-22 10:38:05,442 - WARNING - No data/points/rows found in JSON, returning empty list
2025-12-22 10:38:05,447 - INFO - Extracting JSON from Part 5 response...
2025-12-22 10:38:05,448 - INFO - Successfully extracted JSON from response
2025-12-22 10:38:05,448 - WARNING - No data/points/rows found in JSON, returning empty list
2025-12-22 10:38:05,448 - ERROR - Failed to extract JSON from model responses
2025-12-22 10:38:05,450 - INFO - Trying to load JSON from TXT file as fallback...
2025-12-22 10:38:05,455 - INFO - Successfully extracted JSON from TXT using ThirdStageConverter for /home/mohammadbagher/Downloads/a105030_stage_v_step1.txt
2025-12-22 10:38:05,455 - INFO - Successfully loaded JSON from TXT: /home/mohammadbagher/Downloads/a105030_stage_v_step1.txt
2025-12-22 10:38:05,456 - WARNING - No data/points/rows found in JSON, returning empty list
2025-12-22 10:38:05,456 - ERROR - No questions generated in Step 1
2025-12-22 10:38:05,457 - ERROR - Step 1 failed
2025-12-22 10:45:55,961 - INFO - Loaded 6 predefined prompts
2025-12-22 10:45:55,962 - WARNING - python-docx not available. Will try alternative methods.
2025-12-22 10:45:55,962 - WARNING - python-docx not available. Will try alternative methods.
2025-12-22 10:46:24,108 - INFO - Loaded 3 API keys
2025-12-22 10:47:19,045 - INFO - Starting Stage V processing...
2025-12-22 10:47:19,051 - INFO - Successfully loaded JSON: /home/mohammadbagher/Downloads/a105030.json
2025-12-22 10:47:19,052 - INFO - Detected Book ID: 105, Chapter ID: 30
2025-12-22 10:47:19,052 - INFO - ============================================================
2025-12-22 10:47:19,053 - INFO - STEP 1: Generating initial test questions...
2025-12-22 10:47:19,054 - INFO - ============================================================
2025-12-22 10:47:19,054 - INFO - Loading Stage J JSON for Step 1...
2025-12-22 10:47:19,060 - INFO - Successfully loaded JSON: /home/mohammadbagher/Downloads/a105030.json
2025-12-22 10:47:19,061 - INFO - Loaded 747 records from Stage J
2025-12-22 10:47:19,064 - INFO - Loading Word document...
2025-12-22 10:47:19,066 - INFO - Read file as plain text (latin-1): /home/mohammadbagher/Downloads/تست های پمفیگوس.docx
2025-12-22 10:47:19,067 - INFO - Splitting Stage J data into 5 parts: [149, 149, 149, 149, 151]
2025-12-22 10:47:19,070 - INFO - Processing Part 1 of Step 1...
2025-12-22 10:49:25,443 - INFO - Text processed successfully with gemini-2.5-pro
2025-12-22 10:49:25,444 - INFO - Part 1 response received (16023 characters)
2025-12-22 10:49:25,447 - INFO - Processing Part 2 of Step 1...
2025-12-22 10:51:35,768 - INFO - Text processed successfully with gemini-2.5-pro
2025-12-22 10:51:35,770 - INFO - Part 2 response received (25997 characters)
2025-12-22 10:51:35,772 - INFO - Processing Part 3 of Step 1...
2025-12-22 10:53:31,063 - INFO - Text processed successfully with gemini-2.5-pro
2025-12-22 10:53:31,064 - INFO - Part 3 response received (20618 characters)
2025-12-22 10:53:31,067 - INFO - Processing Part 4 of Step 1...
2025-12-22 10:55:35,677 - INFO - Text processed successfully with gemini-2.5-pro
2025-12-22 10:55:35,679 - INFO - Part 4 response received (25107 characters)
2025-12-22 10:55:35,682 - INFO - Processing Part 5 of Step 1...
2025-12-22 10:57:14,149 - INFO - Text processed successfully with gemini-2.5-pro
2025-12-22 10:57:14,150 - INFO - Part 5 response received (19494 characters)
2025-12-22 10:57:14,162 - INFO - Saved raw model responses to: /home/mohammadbagher/Downloads/a105030_stage_v_step1.txt
2025-12-22 10:57:14,165 - INFO - Extracting JSON from Part 1 response...
2025-12-22 10:57:14,167 - INFO - Successfully extracted JSON from response
2025-12-22 10:57:14,171 - INFO - Extracted 14 questions from Part 1
2025-12-22 10:57:14,175 - INFO - Extracting JSON from Part 2 response...
2025-12-22 10:57:14,177 - INFO - Successfully extracted JSON from response
2025-12-22 10:57:14,181 - INFO - Extracted 23 questions from Part 2
2025-12-22 10:57:14,183 - INFO - Extracting JSON from Part 3 response...
2025-12-22 10:57:14,185 - INFO - Successfully extracted JSON from response
2025-12-22 10:57:14,192 - INFO - Extracted 18 questions from Part 3
2025-12-22 10:57:14,194 - INFO - Extracting JSON from Part 4 response...
2025-12-22 10:57:14,196 - INFO - Successfully extracted JSON from response
2025-12-22 10:57:14,202 - INFO - Extracted 22 questions from Part 4
2025-12-22 10:57:14,203 - INFO - Extracting JSON from Part 5 response...
2025-12-22 10:57:14,205 - INFO - Successfully extracted JSON from response
2025-12-22 10:57:14,208 - INFO - Extracted 18 questions from Part 5
2025-12-22 10:57:14,211 - INFO - Total questions generated in Step 1: 95
2025-12-22 10:57:14,248 - INFO - Successfully saved JSON: /home/mohammadbagher/Downloads/a105030_stage_v_step1.json (95 records)
2025-12-22 10:57:14,250 - INFO - Step 1 output saved to: /home/mohammadbagher/Downloads/a105030_stage_v_step1.json
2025-12-22 10:57:14,256 - INFO - Step 1 completed. Output saved to: /home/mohammadbagher/Downloads/a105030_stage_v_step1.json
2025-12-22 10:57:14,257 - INFO - ============================================================
2025-12-22 10:57:14,257 - INFO - STEP 2: Refining questions and adding QId mapping...
2025-12-22 10:57:14,259 - INFO - ============================================================
2025-12-22 10:57:14,259 - INFO - Loading Step 1 output...
2025-12-22 10:57:14,263 - INFO - Successfully loaded JSON: /home/mohammadbagher/Downloads/a105030_stage_v_step1.json
2025-12-22 10:57:14,266 - INFO - Loaded 95 questions from Step 1
2025-12-22 10:57:14,268 - INFO - Loading Stage J JSON for PointId mapping...
2025-12-22 10:57:14,279 - INFO - Successfully loaded JSON: /home/mohammadbagher/Downloads/a105030.json
2025-12-22 10:57:14,283 - INFO - Created mapping for 747 PointIds
2025-12-22 10:57:14,284 - INFO - Splitting questions into 5 parts: [19, 19, 19, 19, 19]
2025-12-22 10:57:14,285 - ERROR - Error in Stage V processing: name 'sequential_number' is not defined
Traceback (most recent call last):
  File "/home/mohammadbagher/Desktop/tts app bagher/content_automation_project/main_gui.py", line 3546, in worker
    output_path = self.stage_v_processor.process_stage_v(
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/mohammadbagher/Desktop/tts app bagher/content_automation_project/stage_v_processor.py", line 108, in process_stage_v
    step2_output = self._step2_refine_with_qid_mapping(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/mohammadbagher/Desktop/tts app bagher/content_automation_project/stage_v_processor.py", line 488, in _step2_refine_with_qid_mapping
    - QId: Generate a unique question ID (format: q{book_id}{chapter_id}{sequential_number}, e.g., q1050300001)
                                                                         ^^^^^^^^^^^^^^^^^
NameError: name 'sequential_number' is not defined
2025-12-22 11:06:11,380 - INFO - Loaded 6 predefined prompts
2025-12-22 11:06:11,382 - WARNING - python-docx not available. Will try alternative methods.
2025-12-22 11:06:11,382 - WARNING - python-docx not available. Will try alternative methods.
2025-12-22 11:06:41,850 - INFO - Loaded 3 API keys
2025-12-22 11:07:31,388 - INFO - Starting Stage V processing...
2025-12-22 11:07:31,394 - INFO - Successfully loaded JSON: /home/mohammadbagher/Downloads/a105030.json
2025-12-22 11:07:31,395 - INFO - Detected Book ID: 105, Chapter ID: 30
2025-12-22 11:07:31,396 - INFO - ============================================================
2025-12-22 11:07:31,397 - INFO - STEP 1: Generating initial test questions...
2025-12-22 11:07:31,398 - INFO - ============================================================
2025-12-22 11:07:31,398 - INFO - Loading Stage J JSON for Step 1...
2025-12-22 11:07:31,404 - INFO - Successfully loaded JSON: /home/mohammadbagher/Downloads/a105030.json
2025-12-22 11:07:31,405 - INFO - Loaded 747 records from Stage J
2025-12-22 11:07:31,408 - INFO - Loading Word document...
2025-12-22 11:07:31,409 - INFO - Read file as plain text (latin-1): /home/mohammadbagher/Downloads/تست های پمفیگوس.docx
2025-12-22 11:07:31,410 - INFO - Splitting Stage J data into 5 parts: [149, 149, 149, 149, 151]
2025-12-22 11:07:31,411 - INFO - Processing Part 1 of Step 1...
2025-12-22 11:09:54,342 - INFO - Text processed successfully with gemini-2.5-pro
2025-12-22 11:09:54,343 - INFO - Part 1 response received (35856 characters)
2025-12-22 11:09:54,346 - INFO - Processing Part 2 of Step 1...
2025-12-22 11:12:14,476 - INFO - Text processed successfully with gemini-2.5-pro
2025-12-22 11:12:14,477 - INFO - Part 2 response received (33532 characters)
2025-12-22 11:12:14,479 - INFO - Processing Part 3 of Step 1...
2025-12-22 11:14:12,461 - INFO - Text processed successfully with gemini-2.5-pro
2025-12-22 11:14:12,462 - INFO - Part 3 response received (18685 characters)
2025-12-22 11:14:12,465 - INFO - Processing Part 4 of Step 1...
2025-12-22 11:15:56,827 - INFO - Text processed successfully with gemini-2.5-pro
2025-12-22 11:15:56,828 - INFO - Part 4 response received (18346 characters)
2025-12-22 11:15:56,831 - INFO - Processing Part 5 of Step 1...
2025-12-22 11:18:14,552 - INFO - Text processed successfully with gemini-2.5-pro
2025-12-22 11:18:14,553 - INFO - Part 5 response received (23264 characters)
2025-12-22 11:18:14,569 - INFO - Saved raw model responses to: /home/mohammadbagher/Downloads/a105030_stage_v_step1.txt
2025-12-22 11:18:14,573 - INFO - Extracting JSON from Part 1 response...
2025-12-22 11:18:14,575 - INFO - Successfully extracted JSON from response
2025-12-22 11:18:14,576 - INFO - Extracted 35 questions from Part 1
2025-12-22 11:18:14,577 - INFO - Extracting JSON from Part 2 response...
2025-12-22 11:18:14,579 - INFO - Successfully extracted JSON from response
2025-12-22 11:18:14,579 - INFO - Extracted 30 questions from Part 2
2025-12-22 11:18:14,580 - INFO - Extracting JSON from Part 3 response...
2025-12-22 11:18:14,581 - INFO - Successfully extracted JSON from response
2025-12-22 11:18:14,581 - INFO - Extracted 14 questions from Part 3
2025-12-22 11:18:14,582 - INFO - Extracting JSON from Part 4 response...
2025-12-22 11:18:14,583 - INFO - Successfully extracted JSON from response
2025-12-22 11:18:14,584 - INFO - Extracted 16 questions from Part 4
2025-12-22 11:18:14,584 - INFO - Extracting JSON from Part 5 response...
2025-12-22 11:18:14,585 - INFO - Successfully extracted JSON from response
2025-12-22 11:18:14,586 - INFO - Extracted 22 questions from Part 5
2025-12-22 11:18:14,588 - INFO - Total questions generated in Step 1: 117
2025-12-22 11:18:14,600 - INFO - Successfully saved JSON: /home/mohammadbagher/Downloads/a105030_stage_v_step1.json (117 records)
2025-12-22 11:18:14,600 - INFO - Step 1 output saved to: /home/mohammadbagher/Downloads/a105030_stage_v_step1.json
2025-12-22 11:18:14,602 - INFO - Step 1 completed. Output saved to: /home/mohammadbagher/Downloads/a105030_stage_v_step1.json
2025-12-22 11:18:14,603 - INFO - ============================================================
2025-12-22 11:18:14,603 - INFO - STEP 2: Refining questions and adding QId mapping...
2025-12-22 11:18:14,604 - INFO - ============================================================
2025-12-22 11:18:14,604 - INFO - Loading Step 1 output...
2025-12-22 11:18:14,608 - INFO - Successfully loaded JSON: /home/mohammadbagher/Downloads/a105030_stage_v_step1.json
2025-12-22 11:18:14,608 - INFO - Loaded 117 questions from Step 1
2025-12-22 11:18:14,609 - INFO - Loading Stage J JSON for PointId mapping...
2025-12-22 11:18:14,615 - INFO - Successfully loaded JSON: /home/mohammadbagher/Downloads/a105030.json
2025-12-22 11:18:14,618 - INFO - Created mapping for 747 PointIds
2025-12-22 11:18:14,619 - INFO - Splitting questions into 5 parts: [23, 23, 23, 23, 25]
2025-12-22 11:18:14,620 - INFO - Processing Part 1 of Step 2...
2025-12-22 11:18:51,563 - INFO - Text processed successfully with gemini-2.5-pro
2025-12-22 11:18:51,564 - INFO - Part 1 response received (1319 characters)
2025-12-22 11:18:51,567 - INFO - Processing Part 2 of Step 2...
2025-12-22 11:19:40,564 - INFO - Text processed successfully with gemini-2.5-pro
2025-12-22 11:19:40,566 - INFO - Part 2 response received (4258 characters)
2025-12-22 11:19:40,568 - INFO - Processing Part 3 of Step 2...
2025-12-22 11:20:56,051 - INFO - Text processed successfully with gemini-2.5-pro
2025-12-22 11:20:56,054 - INFO - Part 3 response received (6625 characters)
2025-12-22 11:20:56,058 - INFO - Processing Part 4 of Step 2...
2025-12-22 11:21:57,613 - INFO - Text processed successfully with gemini-2.5-pro
2025-12-22 11:21:57,614 - INFO - Part 4 response received (6719 characters)
2025-12-22 11:21:57,617 - INFO - Processing Part 5 of Step 2...
2025-12-22 11:22:42,378 - INFO - Text processed successfully with gemini-2.5-pro
2025-12-22 11:22:42,379 - INFO - Part 5 response received (3216 characters)
2025-12-22 11:22:42,386 - INFO - Saved raw model responses to: /home/mohammadbagher/Downloads/a105030_stage_v_step2.txt
2025-12-22 11:22:42,390 - INFO - Extracting JSON from Part 1 response...
2025-12-22 11:22:42,391 - INFO - Successfully extracted JSON from response
2025-12-22 11:22:42,396 - INFO - Extracted 1 refined questions from Part 1
2025-12-22 11:22:42,407 - INFO - Extracting JSON from Part 2 response...
2025-12-22 11:22:42,408 - INFO - Successfully extracted JSON from response
2025-12-22 11:22:42,412 - INFO - Extracted 4 refined questions from Part 2
2025-12-22 11:22:42,418 - INFO - Extracting JSON from Part 3 response...
2025-12-22 11:22:42,421 - INFO - Successfully extracted JSON from response
2025-12-22 11:22:42,425 - INFO - Extracted 7 refined questions from Part 3
2025-12-22 11:22:42,428 - INFO - Extracting JSON from Part 4 response...
2025-12-22 11:22:42,430 - INFO - Successfully extracted JSON from response
2025-12-22 11:22:42,432 - INFO - Extracted 6 refined questions from Part 4
2025-12-22 11:22:42,434 - INFO - Extracting JSON from Part 5 response...
2025-12-22 11:22:42,435 - INFO - Successfully extracted JSON from response
2025-12-22 11:22:42,436 - INFO - Extracted 3 refined questions from Part 5
2025-12-22 11:22:42,437 - INFO - Total refined questions: 21
2025-12-22 11:22:42,438 - INFO - Generating QIds for questions...
2025-12-22 11:22:42,444 - INFO - Successfully saved JSON: /home/mohammadbagher/Downloads/b105030.json (21 records)
2025-12-22 11:22:42,448 - INFO - Final output saved to: /home/mohammadbagher/Downloads/b105030.json
2025-12-22 11:22:42,449 - INFO - Stage V completed successfully: /home/mohammadbagher/Downloads/b105030.json
2025-12-22 11:43:39,926 - INFO - Loaded 6 predefined prompts
2025-12-22 11:43:39,927 - WARNING - python-docx not available. Will try alternative methods.
2025-12-22 11:43:39,927 - WARNING - python-docx not available. Will try alternative methods.
2025-12-22 11:44:07,121 - INFO - Loaded 3 API keys
2025-12-22 11:44:56,781 - INFO - Starting Stage V processing...
2025-12-22 11:44:56,805 - INFO - Successfully loaded JSON: /home/mohammadbagher/Downloads/a105030.json
2025-12-22 11:44:56,806 - INFO - Detected Book ID: 105, Chapter ID: 30
2025-12-22 11:44:56,807 - INFO - ============================================================
2025-12-22 11:44:56,808 - INFO - STEP 1: Generating initial test questions...
2025-12-22 11:44:56,809 - INFO - ============================================================
2025-12-22 11:44:56,810 - INFO - Loading Stage J JSON for Step 1...
2025-12-22 11:44:56,818 - INFO - Successfully loaded JSON: /home/mohammadbagher/Downloads/a105030.json
2025-12-22 11:44:56,820 - INFO - Loaded 747 records from Stage J
2025-12-22 11:44:56,823 - INFO - Loading Word document...
2025-12-22 11:44:56,824 - INFO - Read file as plain text (latin-1): /home/mohammadbagher/Downloads/تست های پمفیگوس.docx
2025-12-22 11:44:56,844 - INFO - Processing Stage V - Step 1 (single part)...
2025-12-22 11:48:58,101 - INFO - Text processed successfully with gemini-2.5-pro
2025-12-22 11:48:58,104 - INFO - Step 1 response received (56145 characters)
2025-12-22 11:48:58,114 - INFO - Saved raw model responses to: /home/mohammadbagher/Downloads/a105030_stage_v_step1.txt
2025-12-22 11:48:58,118 - INFO - Extracting JSON from Part 1 response...
2025-12-22 11:48:58,123 - WARNING - No closing markdown marker found, JSON may be incomplete
2025-12-22 11:48:58,131 - WARNING - Direct JSON parse failed: Unterminated string starting at: line 805 column 16 (char 56076). Trying fallback extraction...
2025-12-22 11:48:58,132 - ERROR - All JSON extraction methods failed
2025-12-22 11:48:58,132 - WARNING - Failed to extract JSON from response
2025-12-22 11:48:58,135 - INFO - Trying to extract Part 1 JSON from text...
2025-12-22 11:48:58,136 - WARNING - No closing markdown marker found, JSON may be incomplete
2025-12-22 11:48:58,143 - WARNING - Direct JSON parse failed: Unterminated string starting at: line 805 column 16 (char 56076). Trying fallback extraction...
2025-12-22 11:48:58,144 - ERROR - All JSON extraction methods failed
2025-12-22 11:48:58,147 - ERROR - Failed to extract JSON from model responses
2025-12-22 11:48:58,150 - INFO - Trying to load JSON from TXT file as fallback...
2025-12-22 11:48:58,156 - WARNING - No closing markdown marker found, JSON may be incomplete
2025-12-22 11:48:58,161 - WARNING - Direct JSON parse failed: Unterminated string starting at: line 805 column 16 (char 56076). Trying fallback extraction...
2025-12-22 11:48:58,163 - ERROR - All JSON extraction methods failed
2025-12-22 11:48:58,163 - INFO - Falling back to manual JSON extraction for /home/mohammadbagher/Downloads/a105030_stage_v_step1.txt
2025-12-22 11:48:58,199 - INFO - Extracted 47 complete objects from incomplete JSON array for /home/mohammadbagher/Downloads/a105030_stage_v_step1.txt
2025-12-22 11:48:58,200 - INFO - Successfully loaded JSON from TXT: /home/mohammadbagher/Downloads/a105030_stage_v_step1.txt
2025-12-22 11:48:58,201 - INFO - Total questions generated in Step 1: 47
2025-12-22 11:48:58,212 - INFO - Successfully saved JSON: /home/mohammadbagher/Downloads/a105030_stage_v_step1.json (47 records)
2025-12-22 11:48:58,213 - INFO - Step 1 output saved to: /home/mohammadbagher/Downloads/a105030_stage_v_step1.json
2025-12-22 11:48:58,216 - INFO - Step 1 completed. Output saved to: /home/mohammadbagher/Downloads/a105030_stage_v_step1.json
2025-12-22 11:48:58,217 - INFO - ============================================================
2025-12-22 11:48:58,218 - INFO - STEP 2: Refining questions and adding QId mapping...
2025-12-22 11:48:58,218 - INFO - ============================================================
2025-12-22 11:48:58,219 - INFO - Loading Step 1 output...
2025-12-22 11:48:58,221 - INFO - Successfully loaded JSON: /home/mohammadbagher/Downloads/a105030_stage_v_step1.json
2025-12-22 11:48:58,221 - INFO - Loaded 47 questions from Step 1
2025-12-22 11:48:58,222 - INFO - Loading Stage J JSON for PointId mapping...
2025-12-22 11:48:58,229 - INFO - Successfully loaded JSON: /home/mohammadbagher/Downloads/a105030.json
2025-12-22 11:48:58,232 - INFO - Created mapping for 747 PointIds
2025-12-22 11:48:58,235 - INFO - Processing Stage V - Step 2 (single part)...
2025-12-22 11:49:52,783 - INFO - Text processed successfully with gemini-2.5-pro
2025-12-22 11:49:52,783 - INFO - Step 2 response received (4485 characters)
2025-12-22 11:49:52,786 - INFO - Saved raw model responses to: /home/mohammadbagher/Downloads/a105030_stage_v_step2.txt
2025-12-22 11:49:52,788 - INFO - Extracting JSON from Part 1 response...
2025-12-22 11:49:52,788 - INFO - Successfully extracted JSON from response
2025-12-22 11:49:52,792 - INFO - Extracted 4 refined questions from Part 1
2025-12-22 11:49:52,794 - INFO - Total refined questions: 4
2025-12-22 11:49:52,796 - INFO - Generating QIds for questions...
2025-12-22 11:49:52,798 - INFO - Successfully saved JSON: /home/mohammadbagher/Downloads/b105030.json (4 records)
2025-12-22 11:49:52,801 - INFO - Final output saved to: /home/mohammadbagher/Downloads/b105030.json
2025-12-22 11:49:52,803 - INFO - Stage V completed successfully: /home/mohammadbagher/Downloads/b105030.json
2025-12-22 11:50:53,891 - INFO - Loaded 6 predefined prompts
2025-12-22 11:50:53,892 - WARNING - python-docx not available. Will try alternative methods.
2025-12-22 11:50:53,892 - WARNING - python-docx not available. Will try alternative methods.
2025-12-22 11:52:31,028 - INFO - Loaded 6 predefined prompts
2025-12-22 11:52:31,029 - WARNING - python-docx not available. Will try alternative methods.
2025-12-22 11:52:31,029 - WARNING - python-docx not available. Will try alternative methods.
2025-12-22 11:52:57,600 - INFO - Loaded 3 API keys
2025-12-22 11:54:00,438 - INFO - Starting Stage V processing...
2025-12-22 11:54:00,445 - INFO - Successfully loaded JSON: /home/mohammadbagher/Downloads/a105030.json
2025-12-22 11:54:00,446 - INFO - Detected Book ID: 105, Chapter ID: 30
2025-12-22 11:54:00,447 - INFO - ============================================================
2025-12-22 11:54:00,447 - INFO - STEP 1: Generating initial test questions...
2025-12-22 11:54:00,448 - INFO - ============================================================
2025-12-22 11:54:00,448 - INFO - Loading Stage J JSON for Step 1...
2025-12-22 11:54:00,454 - INFO - Successfully loaded JSON: /home/mohammadbagher/Downloads/a105030.json
2025-12-22 11:54:00,455 - INFO - Loaded 747 records from Stage J
2025-12-22 11:54:00,457 - INFO - Loading Word document...
2025-12-22 11:54:00,458 - INFO - Read file as plain text (latin-1): /home/mohammadbagher/Downloads/تست های پمفیگوس.docx
2025-12-22 11:54:00,474 - INFO - Processing Stage V - Step 1 (single part)...
2025-12-22 11:56:44,558 - INFO - Text processed successfully with gemini-2.5-pro
2025-12-22 11:56:44,559 - INFO - Step 1 response received (33969 characters)
2025-12-22 11:56:44,564 - INFO - Saved raw model responses to: /home/mohammadbagher/Downloads/a105030_stage_v_step1.txt
2025-12-22 11:56:44,570 - INFO - Extracting JSON from Part 1 response...
2025-12-22 11:56:44,574 - INFO - Successfully extracted JSON from response
2025-12-22 11:56:44,576 - INFO - Extracted 30 questions from Part 1
2025-12-22 11:56:44,579 - INFO - Total questions generated in Step 1: 30
2025-12-22 11:56:44,595 - INFO - Successfully saved JSON: /home/mohammadbagher/Downloads/a105030_stage_v_step1.json (30 records)
2025-12-22 11:56:44,600 - INFO - Step 1 output saved to: /home/mohammadbagher/Downloads/a105030_stage_v_step1.json
2025-12-22 11:56:44,604 - INFO - Step 1 completed. Output saved to: /home/mohammadbagher/Downloads/a105030_stage_v_step1.json
2025-12-22 11:56:44,606 - INFO - ============================================================
2025-12-22 11:56:44,609 - INFO - STEP 2: Refining questions and adding QId mapping...
2025-12-22 11:56:44,610 - INFO - ============================================================
2025-12-22 11:56:44,611 - INFO - Loading Step 1 output...
2025-12-22 11:56:44,617 - INFO - Successfully loaded JSON: /home/mohammadbagher/Downloads/a105030_stage_v_step1.json
2025-12-22 11:56:44,619 - INFO - Loaded 30 questions from Step 1
2025-12-22 11:56:44,619 - INFO - Loading Stage J JSON for PointId mapping...
2025-12-22 11:56:44,630 - INFO - Successfully loaded JSON: /home/mohammadbagher/Downloads/a105030.json
2025-12-22 11:56:44,635 - INFO - Created mapping for 747 PointIds
2025-12-22 11:56:44,639 - INFO - Processing Stage V - Step 2 (single part)...
2025-12-22 11:57:43,992 - INFO - Text processed successfully with gemini-2.5-pro
2025-12-22 11:57:43,993 - INFO - Step 2 response received (5554 characters)
2025-12-22 11:57:43,997 - INFO - Saved raw model responses to: /home/mohammadbagher/Downloads/a105030_stage_v_step2.txt
2025-12-22 11:57:44,000 - INFO - Extracting JSON from Part 1 response...
2025-12-22 11:57:44,002 - INFO - Successfully extracted JSON from response
2025-12-22 11:57:44,007 - INFO - Extracted 4 refined questions from Part 1
2025-12-22 11:57:44,012 - INFO - Total refined questions: 4
2025-12-22 11:57:44,017 - INFO - Combining Step 1 and Step 2 questions...
2025-12-22 11:57:44,020 - INFO - Generating QIds for combined questions...
2025-12-22 11:57:44,054 - INFO - Successfully saved JSON: /home/mohammadbagher/Downloads/b105030.json (34 records)
2025-12-22 11:57:44,055 - INFO - Final output saved to: /home/mohammadbagher/Downloads/b105030.json
2025-12-22 11:57:44,060 - INFO - Stage V completed successfully: /home/mohammadbagher/Downloads/b105030.json
2025-12-22 12:25:21,414 - INFO - Loaded 6 predefined prompts
2025-12-22 12:25:21,414 - WARNING - python-docx not available. Will try alternative methods.
2025-12-22 12:25:21,415 - WARNING - python-docx not available. Will try alternative methods.
2025-12-22 12:26:25,428 - INFO - Loaded 3 API keys
2025-12-22 12:26:54,615 - INFO - Starting Stage M processing...
2025-12-22 12:26:54,619 - INFO - Loading Stage H JSON...
2025-12-22 12:26:54,648 - INFO - Successfully loaded JSON: /home/mohammadbagher/Downloads/ac105030.json
2025-12-22 12:26:54,649 - INFO - Loaded 747 records from Stage H
2025-12-22 12:26:54,650 - INFO - Detected Book ID: 105, Chapter ID: 30
2025-12-22 12:26:54,651 - INFO - Extracting unique (chapter, subchapter, topic) combinations...
2025-12-22 12:26:54,653 - INFO - Extracted 23 unique topics
2025-12-22 12:26:54,654 - INFO - Saving Stage M output to: /home/mohammadbagher/Downloads/i105030.json
2025-12-22 12:26:54,655 - INFO - Successfully saved JSON: /home/mohammadbagher/Downloads/i105030.json (23 records)
2025-12-22 12:26:54,656 - INFO - Stage M completed successfully: /home/mohammadbagher/Downloads/i105030.json
2025-12-22 12:41:22,759 - INFO - Loaded 6 predefined prompts
2025-12-22 12:41:22,759 - WARNING - python-docx not available. Will try alternative methods.
2025-12-22 12:41:22,759 - WARNING - python-docx not available. Will try alternative methods.
2025-12-22 12:45:53,021 - INFO - Loaded 6 predefined prompts
2025-12-22 12:45:53,021 - WARNING - python-docx not available. Will try alternative methods.
2025-12-22 12:45:53,022 - WARNING - python-docx not available. Will try alternative methods.
2025-12-22 14:05:16,707 - INFO - Loaded 6 predefined prompts
2025-12-22 14:05:16,708 - WARNING - python-docx not available. Will try alternative methods.
2025-12-22 14:05:16,709 - WARNING - python-docx not available. Will try alternative methods.
2025-12-22 14:05:46,085 - INFO - Loaded 3 API keys
2025-12-22 14:06:20,487 - INFO - Starting Stage L processing...
2025-12-22 14:06:20,491 - INFO - Loading Stage J JSON...
2025-12-22 14:06:20,511 - INFO - Successfully loaded JSON: /home/mohammadbagher/Downloads/a105030.json
2025-12-22 14:06:20,512 - INFO - Loaded 747 records from Stage J
2025-12-22 14:06:20,513 - INFO - Detected Book ID: 105, Chapter ID: 30
2025-12-22 14:06:20,514 - INFO - Loading Stage V JSON...
2025-12-22 14:06:20,516 - INFO - Successfully loaded JSON: /home/mohammadbagher/Downloads/b105030.json
2025-12-22 14:06:20,519 - INFO - Loaded 34 records from Stage V
2025-12-22 14:06:20,519 - INFO - Building overview context from Stage J and Stage V...
2025-12-22 14:06:20,524 - INFO - Calling model for Stage L overview...
2025-12-22 14:06:59,250 - INFO - Text processed successfully with gemini-2.5-pro
2025-12-22 14:06:59,251 - INFO - Model response received (4048 characters)
2025-12-22 14:06:59,256 - INFO - Saved raw model response to: /home/mohammadbagher/Downloads/a105030_stage_l.txt
2025-12-22 14:06:59,257 - INFO - Extracting JSON from model response...
2025-12-22 14:06:59,257 - INFO - Successfully extracted JSON from response
2025-12-22 14:06:59,257 - WARNING - No data/points/rows found in JSON, returning empty list
2025-12-22 14:06:59,257 - ERROR - No data found in Stage L JSON output
2025-12-23 08:34:08,168 - INFO - Loaded 6 predefined prompts
2025-12-23 08:34:08,169 - WARNING - python-docx not available. Will try alternative methods.
2025-12-23 08:34:08,169 - WARNING - python-docx not available. Will try alternative methods.
2025-12-23 08:34:42,803 - INFO - Loaded 3 API keys
2025-12-23 08:35:32,936 - INFO - Starting Stage L processing...
2025-12-23 08:35:32,938 - INFO - Loading Stage J JSON...
2025-12-23 08:35:32,957 - INFO - Successfully loaded JSON: /home/mohammadbagher/Downloads/a105030.json
2025-12-23 08:35:32,958 - INFO - Loaded 747 records from Stage J
2025-12-23 08:35:32,959 - INFO - Detected Book ID: 105, Chapter ID: 30
2025-12-23 08:35:32,961 - INFO - Loading Stage V JSON...
2025-12-23 08:35:32,964 - INFO - Successfully loaded JSON: /home/mohammadbagher/Downloads/b105030.json
2025-12-23 08:35:32,966 - INFO - Loaded 34 records from Stage V
2025-12-23 08:35:32,967 - INFO - Building overview context from Stage J and Stage V...
2025-12-23 08:35:32,973 - INFO - Calling model for Stage L overview...
2025-12-23 08:36:15,139 - INFO - Text processed successfully with gemini-2.5-pro
2025-12-23 08:36:15,141 - INFO - Model response received (4237 characters)
2025-12-23 08:36:15,148 - INFO - Saved raw model response to: /home/mohammadbagher/Downloads/a105030_stage_l.txt
2025-12-23 08:36:15,152 - INFO - Extracting JSON from model response...
2025-12-23 08:36:15,154 - INFO - Successfully extracted JSON from response
2025-12-23 08:36:15,155 - WARNING - No data/points/rows found in JSON, returning empty list
2025-12-23 08:36:15,156 - INFO - Detected direct chapter overview structure, wrapping as single record
2025-12-23 08:36:15,159 - INFO - Extracted 1 overview record(s) from model
2025-12-23 08:36:15,162 - INFO - Saving Stage L output to: /home/mohammadbagher/Downloads/o105030.json
2025-12-23 08:36:15,166 - INFO - Successfully saved JSON: /home/mohammadbagher/Downloads/o105030.json (1 records)
2025-12-23 08:36:15,177 - INFO - Stage L completed successfully: /home/mohammadbagher/Downloads/o105030.json
2025-12-23 08:53:14,525 - INFO - Loaded 6 predefined prompts
2025-12-23 08:53:14,527 - WARNING - python-docx not available. Will try alternative methods.
2025-12-23 08:53:14,527 - WARNING - python-docx not available. Will try alternative methods.
2025-12-23 08:53:43,557 - INFO - Loaded 3 API keys
2025-12-23 09:03:13,742 - INFO - Loaded 6 predefined prompts
2025-12-23 09:03:13,745 - WARNING - python-docx not available. Will try alternative methods.
2025-12-23 09:03:13,745 - WARNING - python-docx not available. Will try alternative methods.
2025-12-23 09:03:48,655 - INFO - Loaded 3 API keys
2025-12-23 09:05:15,516 - INFO - Starting Stage V processing...
2025-12-23 09:05:15,527 - INFO - Successfully loaded JSON: /home/mohammadbagher/Downloads/a105030.json
2025-12-23 09:05:15,527 - INFO - Detected Book ID: 105, Chapter ID: 30
2025-12-23 09:05:15,527 - INFO - ============================================================
2025-12-23 09:05:15,528 - INFO - STEP 1: Generating initial test questions...
2025-12-23 09:05:15,528 - INFO - ============================================================
2025-12-23 09:05:15,529 - INFO - Loading Stage J JSON for Step 1...
2025-12-23 09:05:15,534 - INFO - Successfully loaded JSON: /home/mohammadbagher/Downloads/a105030.json
2025-12-23 09:05:15,534 - INFO - Loaded 747 records from Stage J
2025-12-23 09:05:15,536 - INFO - Loading Word document...
2025-12-23 09:05:15,538 - INFO - Read file as plain text (latin-1): /home/mohammadbagher/Downloads/استپ سوم تست ها.docx
2025-12-23 09:05:15,550 - INFO - Processing Stage V - Step 1 (single part)...
2025-12-23 09:07:27,515 - INFO - Text processed successfully with gemini-2.5-flash
2025-12-23 09:07:27,515 - INFO - Step 1 response received (3432 characters)
2025-12-23 09:07:27,516 - INFO - Saved raw model responses to: /home/mohammadbagher/Downloads/a105030_stage_v_step1.txt
2025-12-23 09:07:27,516 - INFO - Extracting JSON from Part 1 response...
2025-12-23 09:07:27,516 - WARNING - No closing markdown marker found, JSON may be incomplete
2025-12-23 09:07:27,517 - WARNING - Direct JSON parse failed: Unterminated string starting at: line 51 column 18 (char 3135). Trying fallback extraction...
2025-12-23 09:07:27,517 - ERROR - All JSON extraction methods failed
2025-12-23 09:07:27,517 - WARNING - Failed to extract JSON from response
2025-12-23 09:07:27,517 - INFO - Trying to extract Part 1 JSON from text...
2025-12-23 09:07:27,518 - WARNING - No closing markdown marker found, JSON may be incomplete
2025-12-23 09:07:27,518 - WARNING - Direct JSON parse failed: Unterminated string starting at: line 51 column 18 (char 3135). Trying fallback extraction...
2025-12-23 09:07:27,518 - ERROR - All JSON extraction methods failed
2025-12-23 09:07:27,518 - ERROR - Failed to extract JSON from model responses
2025-12-23 09:07:27,519 - INFO - Trying to load JSON from TXT file as fallback...
2025-12-23 09:07:27,520 - WARNING - No closing markdown marker found, JSON may be incomplete
2025-12-23 09:07:27,520 - WARNING - Direct JSON parse failed: Unterminated string starting at: line 51 column 18 (char 3135). Trying fallback extraction...
2025-12-23 09:07:27,520 - ERROR - All JSON extraction methods failed
2025-12-23 09:07:27,520 - INFO - Falling back to manual JSON extraction for /home/mohammadbagher/Downloads/a105030_stage_v_step1.txt
2025-12-23 09:07:27,522 - INFO - Extracted 2 complete objects from incomplete JSON array for /home/mohammadbagher/Downloads/a105030_stage_v_step1.txt
2025-12-23 09:07:27,523 - INFO - Successfully loaded JSON from TXT: /home/mohammadbagher/Downloads/a105030_stage_v_step1.txt
2025-12-23 09:07:27,525 - INFO - Total questions generated in Step 1: 2
2025-12-23 09:07:27,525 - INFO - Successfully saved JSON: /home/mohammadbagher/Downloads/a105030_stage_v_step1.json (2 records)
2025-12-23 09:07:27,526 - INFO - Step 1 output saved to: /home/mohammadbagher/Downloads/a105030_stage_v_step1.json
2025-12-23 09:07:27,527 - INFO - Step 1 completed. Output saved to: /home/mohammadbagher/Downloads/a105030_stage_v_step1.json
2025-12-23 09:07:27,527 - INFO - ============================================================
2025-12-23 09:07:27,528 - INFO - STEP 2: Refining questions (without QId mapping)...
2025-12-23 09:07:27,528 - INFO - ============================================================
2025-12-23 09:07:27,530 - INFO - Loading Step 1 output...
2025-12-23 09:07:27,530 - INFO - Successfully loaded JSON: /home/mohammadbagher/Downloads/a105030_stage_v_step1.json
2025-12-23 09:07:27,532 - INFO - Loaded 2 questions from Step 1
2025-12-23 09:07:27,532 - INFO - Processing Stage V - Step 2
2025-12-23 09:08:15,502 - INFO - Text processed successfully with gemini-2.5-pro
2025-12-23 09:08:15,502 - INFO - Step 2 response received (8553 characters)
2025-12-23 09:08:15,505 - INFO - Saved raw model responses to: /home/mohammadbagher/Downloads/a105030_stage_v_stage_v_step2.txt
2025-12-23 09:08:15,508 - INFO - Extracting JSON from Part 1 response...
2025-12-23 09:08:15,508 - INFO - Successfully extracted JSON from response
2025-12-23 09:08:15,509 - INFO - Extracted 7 refined questions from Part 1
2025-12-23 09:08:15,510 - INFO - Total refined questions: 7
2025-12-23 09:08:15,514 - INFO - Successfully saved JSON: /home/mohammadbagher/Downloads/a105030_stage_v_stage_v_step2.json (7 records)
2025-12-23 09:08:15,515 - INFO - Step 2 output saved to: /home/mohammadbagher/Downloads/a105030_stage_v_stage_v_step2.json
2025-12-23 09:08:15,516 - INFO - Step 2 completed. Output saved to: /home/mohammadbagher/Downloads/a105030_stage_v_stage_v_step2.json
2025-12-23 09:08:15,516 - INFO - ============================================================
2025-12-23 09:08:15,518 - INFO - STEP 3: Adding QId mapping...
2025-12-23 09:08:15,519 - INFO - ============================================================
2025-12-23 09:08:15,520 - INFO - Loading Step 2 output...
2025-12-23 09:08:15,521 - INFO - Successfully loaded JSON: /home/mohammadbagher/Downloads/a105030_stage_v_stage_v_step2.json
2025-12-23 09:08:15,523 - INFO - Loaded 7 questions from Step 2
2025-12-23 09:08:15,523 - INFO - Loading Stage J JSON for PointId reference...
2025-12-23 09:08:15,532 - INFO - Successfully loaded JSON: /home/mohammadbagher/Downloads/a105030.json
2025-12-23 09:08:15,535 - INFO - Prepared 747 Stage J records for reference
2025-12-23 09:08:15,537 - INFO - Processing Stage V - Step 3 
2025-12-23 09:08:42,173 - INFO - Text processed successfully with gemini-2.5-pro
2025-12-23 09:08:42,175 - INFO - Step 3 response received (3909 characters)
2025-12-23 09:08:42,179 - INFO - Saved raw model responses to: /home/mohammadbagher/Downloads/a105030_stage_v_step3.txt
2025-12-23 09:08:42,182 - INFO - Extracting JSON from Part 1 response...
2025-12-23 09:08:42,184 - INFO - Successfully extracted JSON from response
2025-12-23 09:08:42,188 - INFO - Extracted 3 questions with QId from Part 1
2025-12-23 09:08:42,193 - INFO - Total questions with QId: 3
2025-12-23 09:08:42,198 - INFO - Validating and fixing QIds...
2025-12-23 09:08:42,203 - INFO - Successfully saved JSON: /home/mohammadbagher/Downloads/b105030.json (3 records)
2025-12-23 09:08:42,209 - INFO - Final output saved to: /home/mohammadbagher/Downloads/b105030.json
2025-12-23 09:08:42,217 - INFO - Stage V completed successfully: /home/mohammadbagher/Downloads/b105030.json
2025-12-23 09:20:17,059 - INFO - Loaded 6 predefined prompts
2025-12-23 09:20:17,060 - WARNING - python-docx not available. Will try alternative methods.
2025-12-23 09:20:17,060 - WARNING - python-docx not available. Will try alternative methods.
2025-12-23 09:44:26,925 - INFO - Loaded 6 predefined prompts
2025-12-23 09:44:26,926 - WARNING - python-docx not available. Will try alternative methods.
2025-12-23 09:44:26,926 - WARNING - python-docx not available. Will try alternative methods.
2025-12-23 10:09:35,963 - INFO - Loaded 6 predefined prompts
2025-12-23 10:09:35,963 - WARNING - python-docx not available. Will try alternative methods.
2025-12-23 10:09:35,964 - WARNING - python-docx not available. Will try alternative methods.
2025-12-23 10:20:31,111 - INFO - Loaded 6 predefined prompts
2025-12-23 10:20:31,111 - WARNING - python-docx not available. Will try alternative methods.
2025-12-23 10:20:31,112 - WARNING - python-docx not available. Will try alternative methods.
2025-12-23 10:30:32,920 - INFO - Loaded 7 predefined prompts
2025-12-23 10:30:32,920 - WARNING - python-docx not available. Will try alternative methods.
2025-12-23 10:30:32,921 - WARNING - python-docx not available. Will try alternative methods.
2025-12-23 10:36:08,768 - INFO - Loaded 7 predefined prompts
2025-12-23 10:36:08,769 - WARNING - python-docx not available. Will try alternative methods.
2025-12-23 10:36:08,769 - WARNING - python-docx not available. Will try alternative methods.
2025-12-23 10:39:44,090 - INFO - Loaded 7 predefined prompts
2025-12-23 10:39:44,091 - WARNING - python-docx not available. Will try alternative methods.
2025-12-23 10:39:44,091 - WARNING - python-docx not available. Will try alternative methods.
2025-12-23 12:09:10,535 - INFO - Loaded 7 predefined prompts
2025-12-23 12:09:10,536 - WARNING - python-docx not available. Will try alternative methods.
2025-12-23 12:09:10,536 - WARNING - python-docx not available. Will try alternative methods.
2025-12-23 12:12:08,636 - INFO - Loaded 7 predefined prompts
2025-12-23 12:12:08,636 - WARNING - python-docx not available. Will try alternative methods.
2025-12-23 12:12:08,640 - WARNING - python-docx not available. Will try alternative methods.
2025-12-23 12:19:25,436 - INFO - Loaded 7 predefined prompts
2025-12-23 12:19:25,437 - WARNING - python-docx not available. Will try alternative methods.
2025-12-23 12:19:25,437 - WARNING - python-docx not available. Will try alternative methods.
2025-12-23 12:21:52,375 - INFO - Loaded 7 predefined prompts
2025-12-23 12:21:52,375 - WARNING - python-docx not available. Will try alternative methods.
2025-12-23 12:21:52,375 - WARNING - python-docx not available. Will try alternative methods.
2025-12-23 12:26:41,271 - INFO - Loaded 7 predefined prompts
2025-12-23 12:26:41,271 - WARNING - python-docx not available. Will try alternative methods.
2025-12-23 12:26:41,271 - WARNING - python-docx not available. Will try alternative methods.
2025-12-23 12:28:21,568 - INFO - Loaded 7 predefined prompts
2025-12-23 12:28:21,569 - WARNING - python-docx not available. Will try alternative methods.
2025-12-23 12:28:21,569 - WARNING - python-docx not available. Will try alternative methods.
2025-12-23 12:31:42,116 - INFO - Loaded 7 predefined prompts
2025-12-23 12:31:42,117 - WARNING - python-docx not available. Will try alternative methods.
2025-12-23 12:31:42,118 - WARNING - python-docx not available. Will try alternative methods.
2025-12-23 12:36:50,306 - INFO - Loaded 8 predefined prompts
2025-12-23 12:36:50,306 - WARNING - python-docx not available. Will try alternative methods.
2025-12-23 12:36:50,307 - WARNING - python-docx not available. Will try alternative methods.
2025-12-23 12:40:49,344 - INFO - Loaded 9 predefined prompts
2025-12-23 12:40:49,345 - WARNING - python-docx not available. Will try alternative methods.
2025-12-23 12:40:49,345 - WARNING - python-docx not available. Will try alternative methods.
2025-12-23 12:43:54,956 - INFO - Loaded 9 predefined prompts
2025-12-23 12:43:54,957 - WARNING - python-docx not available. Will try alternative methods.
2025-12-23 12:43:54,957 - WARNING - python-docx not available. Will try alternative methods.
2025-12-23 12:55:33,620 - ERROR - Error loading prompts file: Expecting property name enclosed in double quotes: line 6 column 2 (char 19623)
2025-12-23 12:55:33,620 - INFO - Created default predefined prompts
2025-12-23 12:55:33,621 - WARNING - python-docx not available. Will try alternative methods.
2025-12-23 12:55:33,621 - WARNING - python-docx not available. Will try alternative methods.
2025-12-23 12:57:17,595 - INFO - Loaded 4 predefined prompts
2025-12-23 12:57:17,595 - WARNING - python-docx not available. Will try alternative methods.
2025-12-23 12:57:17,596 - WARNING - python-docx not available. Will try alternative methods.
2025-12-23 12:58:23,710 - INFO - Loaded 4 predefined prompts
2025-12-23 12:58:23,711 - WARNING - python-docx not available. Will try alternative methods.
2025-12-23 12:58:23,714 - WARNING - python-docx not available. Will try alternative methods.
2025-12-23 13:02:36,198 - INFO - Loaded 4 predefined prompts
2025-12-23 13:02:36,198 - WARNING - python-docx not available. Will try alternative methods.
2025-12-23 13:02:36,198 - WARNING - python-docx not available. Will try alternative methods.
2025-12-23 13:18:46,524 - INFO - Loaded 4 predefined prompts
2025-12-23 13:18:46,524 - WARNING - python-docx not available. Will try alternative methods.
2025-12-23 13:18:46,525 - WARNING - python-docx not available. Will try alternative methods.
2025-12-23 13:25:16,605 - INFO - Loaded 4 predefined prompts
2025-12-23 13:25:16,605 - WARNING - python-docx not available. Will try alternative methods.
2025-12-23 13:25:16,606 - WARNING - python-docx not available. Will try alternative methods.
2025-12-23 13:30:28,421 - INFO - Loaded 5 predefined prompts
2025-12-23 13:30:28,422 - WARNING - python-docx not available. Will try alternative methods.
2025-12-23 13:30:28,422 - WARNING - python-docx not available. Will try alternative methods.
2025-12-23 13:35:06,838 - INFO - Loaded 5 predefined prompts
2025-12-23 13:35:06,839 - WARNING - python-docx not available. Will try alternative methods.
2025-12-23 13:35:06,839 - WARNING - python-docx not available. Will try alternative methods.
2025-12-23 13:42:17,910 - INFO - Loaded 5 predefined prompts
2025-12-23 13:42:17,910 - WARNING - python-docx not available. Will try alternative methods.
2025-12-23 13:42:17,910 - WARNING - python-docx not available. Will try alternative methods.
2025-12-23 13:49:15,999 - INFO - Loaded 5 predefined prompts
2025-12-23 13:49:16,000 - WARNING - python-docx not available. Will try alternative methods.
2025-12-23 13:49:16,000 - WARNING - python-docx not available. Will try alternative methods.
2025-12-23 13:51:33,945 - INFO - Loaded 6 predefined prompts
2025-12-23 13:51:33,945 - WARNING - python-docx not available. Will try alternative methods.
2025-12-23 13:51:33,946 - WARNING - python-docx not available. Will try alternative methods.
2025-12-23 14:01:46,491 - INFO - Loaded 7 predefined prompts
2025-12-23 14:01:46,491 - WARNING - python-docx not available. Will try alternative methods.
2025-12-23 14:01:46,492 - WARNING - python-docx not available. Will try alternative methods.
2025-12-23 14:34:01,708 - INFO - Loaded 7 predefined prompts
2025-12-23 14:34:01,708 - WARNING - python-docx not available. Will try alternative methods.
2025-12-23 14:34:01,708 - WARNING - python-docx not available. Will try alternative methods.
2025-12-23 14:35:05,400 - INFO - Loaded 7 predefined prompts
2025-12-23 14:35:05,400 - WARNING - python-docx not available. Will try alternative methods.
2025-12-23 14:35:05,400 - WARNING - python-docx not available. Will try alternative methods.
2025-12-23 14:35:48,430 - INFO - Loaded 10 predefined prompts
2025-12-23 14:35:48,430 - WARNING - python-docx not available. Will try alternative methods.
2025-12-23 14:35:48,430 - WARNING - python-docx not available. Will try alternative methods.
2025-12-24 08:26:23,638 - INFO - Loaded 10 predefined prompts
2025-12-24 08:26:23,639 - WARNING - python-docx not available. Will try alternative methods.
2025-12-24 08:26:23,639 - WARNING - python-docx not available. Will try alternative methods.
2025-12-24 08:36:37,776 - INFO - Loaded 11 predefined prompts
2025-12-24 08:36:37,776 - WARNING - python-docx not available. Will try alternative methods.
2025-12-24 08:36:37,777 - WARNING - python-docx not available. Will try alternative methods.
2025-12-24 08:42:53,586 - INFO - Loaded 11 predefined prompts
2025-12-24 08:42:53,587 - WARNING - python-docx not available. Will try alternative methods.
2025-12-24 08:42:53,588 - WARNING - python-docx not available. Will try alternative methods.
2025-12-24 08:47:10,000 - INFO - Loaded 11 predefined prompts
2025-12-24 08:47:10,000 - WARNING - python-docx not available. Will try alternative methods.
2025-12-24 08:47:10,002 - WARNING - python-docx not available. Will try alternative methods.
2025-12-24 08:48:14,309 - INFO - Loaded 11 predefined prompts
2025-12-24 08:48:14,310 - WARNING - python-docx not available. Will try alternative methods.
2025-12-24 08:48:14,312 - WARNING - python-docx not available. Will try alternative methods.
2025-12-24 09:09:38,080 - INFO - Loaded 11 predefined prompts
2025-12-24 09:09:38,081 - WARNING - python-docx not available. Will try alternative methods.
2025-12-24 09:09:38,081 - WARNING - python-docx not available. Will try alternative methods.
2025-12-24 09:12:50,268 - INFO - Loaded 3 API keys
2025-12-24 09:13:00,845 - INFO - Starting Stage V processing...
2025-12-24 09:13:00,866 - INFO - Successfully loaded JSON: /home/mohammadbagher/Downloads/a105030.json
2025-12-24 09:13:00,867 - INFO - Detected Book ID: 105, Chapter ID: 30
2025-12-24 09:13:00,870 - INFO - ============================================================
2025-12-24 09:13:00,871 - INFO - STEP 1: Generating initial test questions...
2025-12-24 09:13:00,872 - INFO - ============================================================
2025-12-24 09:13:00,873 - INFO - Loading Stage J JSON for Step 1...
2025-12-24 09:13:00,887 - INFO - Successfully loaded JSON: /home/mohammadbagher/Downloads/a105030.json
2025-12-24 09:13:00,888 - INFO - Loaded 747 records from Stage J
2025-12-24 09:13:00,890 - INFO - Loading Word document...
2025-12-24 09:13:00,892 - INFO - Read file as plain text (latin-1): /home/mohammadbagher/Downloads/استپ سوم تست ها.docx
2025-12-24 09:13:00,918 - INFO - Processing Stage V - Step 1 (single part)...
2025-12-24 09:15:16,469 - INFO - Text processed successfully with gemini-2.5-pro
2025-12-24 09:15:16,471 - INFO - Step 1 response received (26172 characters)
2025-12-24 09:15:16,476 - INFO - Saved raw model responses to: /home/mohammadbagher/Downloads/a105030_stage_v_step1.txt
2025-12-24 09:15:16,482 - INFO - Extracting JSON from Part 1 response...
2025-12-24 09:15:16,486 - INFO - Successfully extracted JSON from response
2025-12-24 09:15:16,489 - INFO - Extracted 25 questions from Part 1
2025-12-24 09:15:16,492 - INFO - Total questions generated in Step 1: 25
2025-12-24 09:15:16,504 - INFO - Successfully saved JSON: /home/mohammadbagher/Downloads/a105030_stage_v_step1.json (25 records)
2025-12-24 09:15:16,507 - INFO - Step 1 output saved to: /home/mohammadbagher/Downloads/a105030_stage_v_step1.json
2025-12-24 09:15:16,509 - INFO - Step 1 completed. Output saved to: /home/mohammadbagher/Downloads/a105030_stage_v_step1.json
2025-12-24 09:15:16,511 - INFO - ============================================================
2025-12-24 09:15:16,511 - INFO - STEP 2: Refining questions (without QId mapping)...
2025-12-24 09:15:16,512 - INFO - ============================================================
2025-12-24 09:15:16,515 - INFO - Loading Stage J JSON for Step 2...
2025-12-24 09:15:16,525 - INFO - Successfully loaded JSON: /home/mohammadbagher/Downloads/a105030.json
2025-12-24 09:15:16,527 - INFO - Prepared 747 Stage J records (without Type column)
2025-12-24 09:15:16,528 - INFO - Loading Word document...
2025-12-24 09:15:16,529 - INFO - Read file as plain text (latin-1): /home/mohammadbagher/Downloads/استپ سوم تست ها.docx
2025-12-24 09:15:16,531 - INFO - Loading Step 1 output to include in Step 2 output...
2025-12-24 09:15:16,533 - INFO - Successfully loaded JSON: /home/mohammadbagher/Downloads/a105030_stage_v_step1.json
2025-12-24 09:15:16,534 - INFO - Loaded 25 questions from Step 1
2025-12-24 09:15:16,550 - INFO - Processing Stage V - Step 2
2025-12-24 09:19:03,752 - INFO - Text processed successfully with gemini-2.5-pro
2025-12-24 09:19:03,758 - INFO - Step 2 response received (57432 characters)
2025-12-24 09:19:03,768 - INFO - Saved raw model responses to: /home/mohammadbagher/Downloads/a105030_stage_v_step2.txt
2025-12-24 09:19:03,770 - INFO - Extracting JSON from Part 1 response...
2025-12-24 09:19:03,773 - INFO - Successfully extracted JSON from response
2025-12-24 09:19:03,774 - INFO - Extracted 60 refined questions from Part 1
2025-12-24 09:19:03,775 - INFO - Total refined questions from Step 2: 60
2025-12-24 09:19:03,777 - INFO - Total combined questions (Step 1 + Step 2): 85
2025-12-24 09:19:03,787 - INFO - Successfully saved JSON: /home/mohammadbagher/Downloads/a105030_stage_v_step2.json (85 records)
2025-12-24 09:19:03,789 - INFO - Step 2 output saved to: /home/mohammadbagher/Downloads/a105030_stage_v_step2.json
2025-12-24 09:19:03,791 - INFO - Step 2 completed. Output saved to: /home/mohammadbagher/Downloads/a105030_stage_v_step2.json
2025-12-24 09:19:03,791 - INFO - ============================================================
2025-12-24 09:19:03,792 - INFO - STEP 3: Adding QId mapping...
2025-12-24 09:19:03,793 - INFO - ============================================================
2025-12-24 09:19:03,795 - INFO - Loading Step 1 output...
2025-12-24 09:19:03,797 - INFO - Successfully loaded JSON: /home/mohammadbagher/Downloads/a105030_stage_v_step1.json
2025-12-24 09:19:03,800 - INFO - Loaded 25 questions from Step 1
2025-12-24 09:19:03,800 - INFO - Loading Step 2 output (contains Step 1 + Step 2)...
2025-12-24 09:19:03,803 - INFO - Successfully loaded JSON: /home/mohammadbagher/Downloads/a105030_stage_v_step2.json
2025-12-24 09:19:03,803 - INFO - Loaded 85 questions from Step 2 (combined)
2025-12-24 09:19:03,804 - INFO - Total questions to process (from Step 2 combined output): 85
2025-12-24 09:19:03,804 - INFO - Loading Stage J JSON for PointId reference...
2025-12-24 09:19:03,810 - INFO - Successfully loaded JSON: /home/mohammadbagher/Downloads/a105030.json
2025-12-24 09:19:03,814 - INFO - Prepared 747 Stage J records for reference
2025-12-24 09:19:03,822 - INFO - Processing Stage V - Step 3 
2025-12-24 09:20:48,398 - INFO - Text processed successfully with gemini-2.5-pro
2025-12-24 09:20:48,400 - INFO - Step 3 response received (7696 characters)
2025-12-24 09:20:48,404 - INFO - Saved raw model responses to: /home/mohammadbagher/Downloads/a105030_stage_v_step3.txt
2025-12-24 09:20:48,410 - INFO - Extracting JSON from Part 1 response...
2025-12-24 09:20:48,413 - INFO - Successfully extracted JSON from response
2025-12-24 09:20:48,421 - INFO - Extracted 7 questions with QId from Part 1
2025-12-24 09:20:48,423 - INFO - Total questions with QId: 7
2025-12-24 09:20:48,424 - INFO - Validating and fixing QIds...
2025-12-24 09:20:48,427 - INFO - Successfully saved JSON: /home/mohammadbagher/Downloads/b105030.json (7 records)
2025-12-24 09:20:48,429 - INFO - Final output saved to: /home/mohammadbagher/Downloads/b105030.json
2025-12-24 09:20:48,432 - INFO - Stage V completed successfully: /home/mohammadbagher/Downloads/b105030.json
2025-12-24 09:23:56,074 - INFO - Starting Stage L processing...
2025-12-24 09:23:56,074 - INFO - Loading Stage J JSON...
2025-12-24 09:23:56,079 - INFO - Successfully loaded JSON: /home/mohammadbagher/Downloads/a105030.json
2025-12-24 09:23:56,080 - INFO - Loaded 747 records from Stage J
2025-12-24 09:23:56,081 - INFO - Detected Book ID: 105, Chapter ID: 30
2025-12-24 09:23:56,083 - INFO - Loading Stage V JSON...
2025-12-24 09:23:56,083 - INFO - Successfully loaded JSON: /home/mohammadbagher/Downloads/b105030.json
2025-12-24 09:23:56,084 - INFO - Loaded 7 records from Stage V
2025-12-24 09:23:56,084 - INFO - Building overview context from Stage J and Stage V...
2025-12-24 09:23:56,086 - INFO - Calling model for Stage L overview...
2025-12-24 09:24:58,233 - INFO - Text processed successfully with gemini-2.5-pro
2025-12-24 09:24:58,234 - INFO - Model response received (4157 characters)
2025-12-24 09:24:58,237 - INFO - Saved raw model response to: /home/mohammadbagher/Downloads/a105030_stage_l.txt
2025-12-24 09:24:58,240 - INFO - Extracting JSON from model response...
2025-12-24 09:24:58,241 - INFO - Successfully extracted JSON from response
2025-12-24 09:24:58,247 - INFO - Extracted 1 overview record(s) from model
2025-12-24 09:24:58,248 - INFO - Saving Stage L output to: /home/mohammadbagher/Downloads/o105030.json
2025-12-24 09:24:58,249 - INFO - Successfully saved JSON: /home/mohammadbagher/Downloads/o105030.json (1 records)
2025-12-24 09:24:58,250 - INFO - Stage L completed successfully: /home/mohammadbagher/Downloads/o105030.json
2025-12-24 09:30:56,089 - INFO - Loaded 11 predefined prompts
2025-12-24 09:30:56,090 - WARNING - python-docx not available. Will try alternative methods.
2025-12-24 09:30:56,090 - WARNING - python-docx not available. Will try alternative methods.
2025-12-24 09:32:35,593 - INFO - Loaded 3 API keys
2025-12-24 09:33:45,707 - INFO - Starting Stage V processing...
2025-12-24 09:33:45,729 - INFO - Successfully loaded JSON: /home/mohammadbagher/Downloads/a105030.json
2025-12-24 09:33:45,730 - INFO - Detected Book ID: 105, Chapter ID: 30
2025-12-24 09:33:45,731 - INFO - ============================================================
2025-12-24 09:33:45,734 - INFO - STEP 1: Generating initial test questions...
2025-12-24 09:33:45,735 - INFO - ============================================================
2025-12-24 09:33:45,736 - INFO - Loading Stage J JSON for Step 1...
2025-12-24 09:33:45,746 - INFO - Successfully loaded JSON: /home/mohammadbagher/Downloads/a105030.json
2025-12-24 09:33:45,747 - INFO - Loaded 747 records from Stage J
2025-12-24 09:33:45,751 - INFO - Loading Word document...
2025-12-24 09:33:45,757 - INFO - Read file as plain text (latin-1): /home/mohammadbagher/Downloads/تست های پمفیگوس.docx
2025-12-24 09:33:45,778 - INFO - Processing Stage V - Step 1 (single part)...
2025-12-24 09:35:59,502 - INFO - Text processed successfully with gemini-2.5-pro
2025-12-24 09:35:59,504 - INFO - Step 1 response received (32180 characters)
2025-12-24 09:35:59,507 - INFO - Saved raw model responses to: /home/mohammadbagher/Downloads/a105030_stage_v_step1.txt
2025-12-24 09:35:59,511 - INFO - Extracting JSON from Part 1 response...
2025-12-24 09:35:59,514 - INFO - Successfully extracted JSON from response
2025-12-24 09:35:59,520 - INFO - Extracted 24 questions from Part 1
2025-12-24 09:35:59,523 - INFO - Total questions generated in Step 1: 24
2025-12-24 09:35:59,546 - INFO - Successfully saved JSON: /home/mohammadbagher/Downloads/a105030_stage_v_step1.json (24 records)
2025-12-24 09:35:59,548 - INFO - Step 1 output saved to: /home/mohammadbagher/Downloads/a105030_stage_v_step1.json
2025-12-24 09:35:59,553 - INFO - Step 1 completed. Output saved to: /home/mohammadbagher/Downloads/a105030_stage_v_step1.json
2025-12-24 09:35:59,557 - INFO - ============================================================
2025-12-24 09:35:59,559 - INFO - STEP 2: Refining questions (without QId mapping)...
2025-12-24 09:35:59,562 - INFO - ============================================================
2025-12-24 09:35:59,565 - INFO - Loading Stage J JSON for Step 2...
2025-12-24 09:35:59,591 - INFO - Successfully loaded JSON: /home/mohammadbagher/Downloads/a105030.json
2025-12-24 09:35:59,595 - INFO - Prepared 747 Stage J records (without Type column)
2025-12-24 09:35:59,596 - INFO - Loading Word document...
2025-12-24 09:35:59,598 - INFO - Read file as plain text (latin-1): /home/mohammadbagher/Downloads/تست های پمفیگوس.docx
2025-12-24 09:35:59,599 - INFO - Loading Step 1 output to include in Step 2 output...
2025-12-24 09:35:59,603 - INFO - Successfully loaded JSON: /home/mohammadbagher/Downloads/a105030_stage_v_step1.json
2025-12-24 09:35:59,604 - INFO - Loaded 24 questions from Step 1
2025-12-24 09:35:59,626 - INFO - Processing Stage V - Step 2
2025-12-24 09:39:06,677 - INFO - Text processed successfully with gemini-2.5-pro
2025-12-24 09:39:06,678 - INFO - Step 2 response received (47008 characters)
2025-12-24 09:39:06,685 - INFO - Saved raw model responses to: /home/mohammadbagher/Downloads/a105030_stage_v_step2.txt
2025-12-24 09:39:06,691 - INFO - Extracting JSON from Part 1 response...
2025-12-24 09:39:06,696 - INFO - Successfully extracted JSON from response
2025-12-24 09:39:06,701 - INFO - Extracted 45 refined questions from Part 1
2025-12-24 09:39:06,706 - INFO - Total refined questions from Step 2: 45
2025-12-24 09:39:06,707 - INFO - Total combined questions (Step 1 + Step 2): 69
2025-12-24 09:39:06,719 - INFO - Successfully saved JSON: /home/mohammadbagher/Downloads/a105030_stage_v_step2.json (69 records)
2025-12-24 09:39:06,720 - INFO - Step 2 output saved to: /home/mohammadbagher/Downloads/a105030_stage_v_step2.json
2025-12-24 09:39:06,723 - INFO - Step 2 completed. Output saved to: /home/mohammadbagher/Downloads/a105030_stage_v_step2.json
2025-12-24 09:39:06,723 - INFO - ============================================================
2025-12-24 09:39:06,724 - INFO - STEP 3: Adding QId mapping...
2025-12-24 09:39:06,724 - INFO - ============================================================
2025-12-24 09:39:06,725 - INFO - Loading Step 1 output...
2025-12-24 09:39:06,726 - INFO - Successfully loaded JSON: /home/mohammadbagher/Downloads/a105030_stage_v_step1.json
2025-12-24 09:39:06,728 - INFO - Loaded 24 questions from Step 1
2025-12-24 09:39:06,728 - INFO - Loading Step 2 output (contains Step 1 + Step 2)...
2025-12-24 09:39:06,730 - INFO - Successfully loaded JSON: /home/mohammadbagher/Downloads/a105030_stage_v_step2.json
2025-12-24 09:39:06,733 - INFO - Loaded 69 questions from Step 2 (combined)
2025-12-24 09:39:06,734 - INFO - Total questions to process (from Step 2 combined output): 69
2025-12-24 09:39:06,734 - INFO - Loading Stage J JSON for PointId reference...
2025-12-24 09:39:06,738 - INFO - Successfully loaded JSON: /home/mohammadbagher/Downloads/a105030.json
2025-12-24 09:39:06,739 - INFO - Prepared 747 Stage J records for reference
2025-12-24 09:39:06,745 - INFO - Processing Stage V - Step 3 
2025-12-24 09:42:04,480 - INFO - Text processed successfully with gemini-2.5-pro
2025-12-24 09:42:04,482 - INFO - Step 3 response received (47008 characters)
2025-12-24 09:42:04,487 - INFO - Saved raw model responses to: /home/mohammadbagher/Downloads/a105030_stage_v_step3.txt
2025-12-24 09:42:04,492 - INFO - Extracting JSON from Part 1 response...
2025-12-24 09:42:04,497 - INFO - Successfully extracted JSON from response
2025-12-24 09:42:04,500 - INFO - Extracted 45 new questions from Step 3 Part 1
2025-12-24 09:42:04,505 - INFO - New questions from Step 3: 45
2025-12-24 09:42:04,506 - INFO - Total questions to process (Step 1 + Step 2 + Step 3): 114
2025-12-24 09:42:04,510 - INFO - Validating and fixing QIds for all questions...
2025-12-24 09:42:04,584 - INFO - Successfully saved JSON: /home/mohammadbagher/Downloads/b105030.json (114 records)
2025-12-24 09:42:04,586 - INFO - Final output saved to: /home/mohammadbagher/Downloads/b105030.json
2025-12-24 09:42:04,590 - INFO - Stage V completed successfully: /home/mohammadbagher/Downloads/b105030.json
2025-12-24 09:48:29,669 - INFO - Loaded 11 predefined prompts
2025-12-24 09:48:29,670 - WARNING - python-docx not available. Will try alternative methods.
2025-12-24 09:48:29,670 - WARNING - python-docx not available. Will try alternative methods.
2025-12-24 09:49:02,149 - INFO - Loaded 3 API keys
2025-12-24 09:49:54,382 - INFO - Starting Stage V processing...
2025-12-24 09:49:54,393 - INFO - Successfully loaded JSON: /home/mohammadbagher/Downloads/a105030.json
2025-12-24 09:49:54,394 - INFO - Detected Book ID: 105, Chapter ID: 30
2025-12-24 09:49:54,395 - INFO - ============================================================
2025-12-24 09:49:54,396 - INFO - STEP 1: Generating initial test questions...
2025-12-24 09:49:54,396 - INFO - ============================================================
2025-12-24 09:49:54,397 - INFO - Loading Stage J JSON for Step 1...
2025-12-24 09:49:54,407 - INFO - Successfully loaded JSON: /home/mohammadbagher/Downloads/a105030.json
2025-12-24 09:49:54,408 - INFO - Loaded 747 records from Stage J
2025-12-24 09:49:54,411 - INFO - Loading Word document...
2025-12-24 09:49:54,413 - INFO - Read file as plain text (latin-1): /home/mohammadbagher/Downloads/تست های پمفیگوس.docx
2025-12-24 09:49:54,433 - INFO - Processing Stage V - Step 1 (single part)...
2025-12-24 09:52:55,541 - INFO - Text processed successfully with gemini-2.5-pro
2025-12-24 09:52:55,543 - INFO - Step 1 response received (45309 characters)
2025-12-24 09:52:55,548 - INFO - Saved raw model responses to: /home/mohammadbagher/Downloads/a105030_stage_v_step1.txt
2025-12-24 09:52:55,552 - INFO - Extracting JSON from Part 1 response...
2025-12-24 09:52:55,556 - INFO - Successfully extracted JSON from response
2025-12-24 09:52:55,561 - INFO - Extracted 42 questions from Part 1
2025-12-24 09:52:55,563 - INFO - Total questions generated in Step 1: 42
2025-12-24 09:52:55,571 - INFO - Successfully saved JSON: /home/mohammadbagher/Downloads/a105030_stage_v_step1.json (42 records)
2025-12-24 09:52:55,572 - INFO - Step 1 output saved to: /home/mohammadbagher/Downloads/a105030_stage_v_step1.json
2025-12-24 09:52:55,573 - INFO - Step 1 completed. Output saved to: /home/mohammadbagher/Downloads/a105030_stage_v_step1.json
2025-12-24 09:52:55,574 - INFO - ============================================================
2025-12-24 09:52:55,575 - INFO - STEP 2: Refining questions (without QId mapping)...
2025-12-24 09:52:55,576 - INFO - ============================================================
2025-12-24 09:52:55,577 - INFO - Loading Stage J JSON for Step 2...
2025-12-24 09:52:55,676 - INFO - Successfully loaded JSON: /home/mohammadbagher/Downloads/a105030.json
2025-12-24 09:52:55,678 - INFO - Prepared 747 Stage J records (without Type column)
2025-12-24 09:52:55,679 - INFO - Loading Word document...
2025-12-24 09:52:55,680 - INFO - Read file as plain text (latin-1): /home/mohammadbagher/Downloads/تست های پمفیگوس.docx
2025-12-24 09:52:55,680 - INFO - Loading Step 1 output to include in Step 2 output...
2025-12-24 09:52:55,681 - INFO - Successfully loaded JSON: /home/mohammadbagher/Downloads/a105030_stage_v_step1.json
2025-12-24 09:52:55,682 - INFO - Loaded 42 questions from Step 1
2025-12-24 09:52:55,707 - INFO - Processing Stage V - Step 2
2025-12-24 09:56:47,935 - INFO - Text processed successfully with gemini-2.5-pro
2025-12-24 09:56:47,941 - INFO - Step 2 response received (60731 characters)
2025-12-24 09:56:47,949 - INFO - Saved raw model responses to: /home/mohammadbagher/Downloads/a105030_stage_v_step2.txt
2025-12-24 09:56:47,950 - INFO - Extracting JSON from Part 1 response...
2025-12-24 09:56:47,953 - INFO - Successfully extracted JSON from response
2025-12-24 09:56:47,955 - INFO - Extracted 59 refined questions from Part 1
2025-12-24 09:56:47,956 - INFO - Total refined questions from Step 2: 59
2025-12-24 09:56:47,959 - INFO - Total combined questions (Step 1 + Step 2): 101
2025-12-24 09:56:47,975 - INFO - Successfully saved JSON: /home/mohammadbagher/Downloads/a105030_stage_v_step2.json (101 records)
2025-12-24 09:56:47,976 - INFO - Step 2 output saved to: /home/mohammadbagher/Downloads/a105030_stage_v_step2.json
2025-12-24 09:56:47,977 - INFO - Step 2 completed. Output saved to: /home/mohammadbagher/Downloads/a105030_stage_v_step2.json
2025-12-24 09:56:47,978 - INFO - ============================================================
2025-12-24 09:56:47,979 - INFO - STEP 3: Adding QId mapping...
2025-12-24 09:56:47,980 - INFO - ============================================================
2025-12-24 09:56:47,981 - INFO - Loading Step 1 output...
2025-12-24 09:56:47,983 - INFO - Successfully loaded JSON: /home/mohammadbagher/Downloads/a105030_stage_v_step1.json
2025-12-24 09:56:47,985 - INFO - Loaded 42 questions from Step 1
2025-12-24 09:56:47,986 - INFO - Loading Step 2 output (contains Step 1 + Step 2)...
2025-12-24 09:56:47,991 - INFO - Successfully loaded JSON: /home/mohammadbagher/Downloads/a105030_stage_v_step2.json
2025-12-24 09:56:47,992 - INFO - Loaded 101 questions from Step 2 (combined)
2025-12-24 09:56:47,993 - INFO - Total questions to process (from Step 2 combined output): 101
2025-12-24 09:56:47,995 - INFO - Loading Stage J JSON for PointId reference...
2025-12-24 09:56:48,003 - INFO - Successfully loaded JSON: /home/mohammadbagher/Downloads/a105030.json
2025-12-24 09:56:48,004 - INFO - Prepared 747 Stage J records for reference
2025-12-24 09:56:48,009 - INFO - Processing Stage V - Step 3 
2025-12-24 10:00:29,768 - INFO - Text processed successfully with gemini-2.5-pro
2025-12-24 10:00:29,769 - INFO - Step 3 response received (60731 characters)
2025-12-24 10:00:29,779 - INFO - Saved raw model responses to: /home/mohammadbagher/Downloads/a105030_stage_v_step3.txt
2025-12-24 10:00:29,783 - INFO - Extracting JSON from Part 1 response...
2025-12-24 10:00:29,787 - INFO - Successfully extracted JSON from response
2025-12-24 10:00:29,791 - INFO - Extracted 59 questions from Step 3 Part 1
2025-12-24 10:00:29,793 - INFO - Questions from Step 3 model: 59
2025-12-24 10:00:29,796 - INFO - Questions from Step 2 (Step 1 + Step 2): 101
2025-12-24 10:00:29,797 - INFO - Model returned new Step 3 questions only, combining with Step 2 output
2025-12-24 10:00:29,801 - INFO - Total questions to process (Step 1 + Step 2 + Step 3): 160
2025-12-24 10:00:29,804 - INFO - Validating and fixing QIds for all questions...
2025-12-24 10:00:29,857 - INFO - Successfully saved JSON: /home/mohammadbagher/Downloads/b105030.json (160 records)
2025-12-24 10:00:29,857 - INFO - Final output saved to: /home/mohammadbagher/Downloads/b105030.json
2025-12-24 10:00:29,859 - INFO - Stage V completed successfully: /home/mohammadbagher/Downloads/b105030.json
2025-12-24 10:06:28,504 - INFO - Loaded 11 predefined prompts
2025-12-24 10:06:28,504 - WARNING - python-docx not available. Will try alternative methods.
2025-12-24 10:06:28,505 - WARNING - python-docx not available. Will try alternative methods.
2025-12-24 10:07:06,871 - INFO - Loaded 3 API keys
2025-12-24 10:07:41,590 - INFO - Starting Stage V processing...
2025-12-24 10:07:41,595 - INFO - Successfully loaded JSON: /home/mohammadbagher/Downloads/a105030.json
2025-12-24 10:07:41,596 - INFO - Detected Book ID: 105, Chapter ID: 30
2025-12-24 10:07:41,597 - INFO - ============================================================
2025-12-24 10:07:41,597 - INFO - STEP 1: Generating initial test questions...
2025-12-24 10:07:41,598 - INFO - ============================================================
2025-12-24 10:07:41,598 - INFO - Loading Stage J JSON for Step 1...
2025-12-24 10:07:41,603 - INFO - Successfully loaded JSON: /home/mohammadbagher/Downloads/a105030.json
2025-12-24 10:07:41,603 - INFO - Loaded 747 records from Stage J
2025-12-24 10:07:41,605 - INFO - Loading Word document...
2025-12-24 10:07:41,606 - INFO - Read file as plain text (latin-1): /home/mohammadbagher/Downloads/تست های پمفیگوس.docx
2025-12-24 10:07:41,629 - INFO - Processing Stage V - Step 1 (single part)...
2025-12-24 10:10:30,779 - INFO - Text processed successfully with gemini-2.5-pro
2025-12-24 10:10:30,781 - INFO - Step 1 response received (32972 characters)
2025-12-24 10:10:30,786 - INFO - Saved raw model responses to: /home/mohammadbagher/Downloads/a105030_stage_v_step1.txt
2025-12-24 10:10:30,789 - INFO - Extracting JSON from Part 1 response...
2025-12-24 10:10:30,795 - INFO - Successfully extracted JSON from response
2025-12-24 10:10:30,801 - INFO - Extracted 25 questions from Part 1
2025-12-24 10:10:30,804 - INFO - Total questions generated in Step 1: 25
2025-12-24 10:10:30,811 - INFO - Successfully saved JSON: /home/mohammadbagher/Downloads/a105030_stage_v_step1.json (25 records)
2025-12-24 10:10:30,813 - INFO - Step 1 output saved to: /home/mohammadbagher/Downloads/a105030_stage_v_step1.json
2025-12-24 10:10:30,817 - INFO - Step 1 completed. Output saved to: /home/mohammadbagher/Downloads/a105030_stage_v_step1.json
2025-12-24 10:10:30,818 - INFO - ============================================================
2025-12-24 10:10:30,820 - INFO - STEP 2: Refining questions (without QId mapping)...
2025-12-24 10:10:30,821 - INFO - ============================================================
2025-12-24 10:10:30,823 - INFO - Loading Stage J JSON for Step 2...
2025-12-24 10:10:30,832 - INFO - Successfully loaded JSON: /home/mohammadbagher/Downloads/a105030.json
2025-12-24 10:10:30,928 - INFO - Prepared 747 Stage J records (without Type column)
2025-12-24 10:10:30,931 - INFO - Loading Word document...
2025-12-24 10:10:30,932 - INFO - Read file as plain text (latin-1): /home/mohammadbagher/Downloads/تست های پمفیگوس.docx
2025-12-24 10:10:30,932 - INFO - Loading Step 1 output to include in Step 2 output...
2025-12-24 10:10:30,933 - INFO - Successfully loaded JSON: /home/mohammadbagher/Downloads/a105030_stage_v_step1.json
2025-12-24 10:10:30,934 - INFO - Loaded 25 questions from Step 1
2025-12-24 10:10:30,948 - INFO - Processing Stage V - Step 2
2025-12-24 10:14:00,448 - INFO - Text processed successfully with gemini-2.5-pro
2025-12-24 10:14:00,454 - INFO - Step 2 response received (53226 characters)
2025-12-24 10:14:00,460 - INFO - Saved raw model responses to: /home/mohammadbagher/Downloads/a105030_stage_v_step2.txt
2025-12-24 10:14:00,461 - INFO - Extracting JSON from Part 1 response...
2025-12-24 10:14:00,463 - INFO - Successfully extracted JSON from response
2025-12-24 10:14:00,464 - INFO - Extracted 52 refined questions from Part 1
2025-12-24 10:14:00,465 - INFO - Total refined questions from Step 2: 52
2025-12-24 10:14:00,466 - INFO - Total combined questions (Step 1 + Step 2): 77
2025-12-24 10:14:00,476 - INFO - Successfully saved JSON: /home/mohammadbagher/Downloads/a105030_stage_v_step2.json (77 records)
2025-12-24 10:14:00,477 - INFO - Step 2 output saved to: /home/mohammadbagher/Downloads/a105030_stage_v_step2.json
2025-12-24 10:14:00,479 - INFO - Step 2 completed. Output saved to: /home/mohammadbagher/Downloads/a105030_stage_v_step2.json
2025-12-24 10:14:00,480 - INFO - ============================================================
2025-12-24 10:14:00,481 - INFO - STEP 3: Adding QId mapping...
2025-12-24 10:14:00,482 - INFO - ============================================================
2025-12-24 10:14:00,484 - INFO - Loading Stage J JSON for PointId reference...
2025-12-24 10:14:00,490 - INFO - Successfully loaded JSON: /home/mohammadbagher/Downloads/a105030.json
2025-12-24 10:14:00,492 - INFO - Prepared 747 Stage J records for reference
2025-12-24 10:14:00,493 - INFO - Processing Stage V - Step 3
2025-12-24 10:14:49,589 - INFO - Text processed successfully with gemini-2.5-pro
2025-12-24 10:14:49,590 - INFO - Step 3 response received (8434 characters)
2025-12-24 10:14:49,596 - INFO - Saved raw model responses to: /home/mohammadbagher/Downloads/a105030_stage_v_step3.txt
2025-12-24 10:14:49,599 - INFO - ============================================================
2025-12-24 10:14:49,602 - INFO - Loading and extracting JSON from all three TXT files...
2025-12-24 10:14:49,605 - INFO - ============================================================
2025-12-24 10:14:49,609 - INFO - Loading Step 1 TXT: /home/mohammadbagher/Downloads/a105030_stage_v_step1.txt
2025-12-24 10:14:49,615 - INFO - Successfully extracted JSON from TXT using ThirdStageConverter for /home/mohammadbagher/Downloads/a105030_stage_v_step1.txt
2025-12-24 10:14:49,617 - INFO - Successfully loaded JSON from TXT: /home/mohammadbagher/Downloads/a105030_stage_v_step1.txt
2025-12-24 10:14:49,619 - INFO - Extracted 25 questions from Step 1 TXT
2025-12-24 10:14:49,621 - INFO - Loading Step 2 TXT: /home/mohammadbagher/Downloads/a105030_stage_v_step2.txt
2025-12-24 10:14:49,625 - INFO - Successfully extracted JSON from TXT using ThirdStageConverter for /home/mohammadbagher/Downloads/a105030_stage_v_step2.txt
2025-12-24 10:14:49,626 - INFO - Successfully loaded JSON from TXT: /home/mohammadbagher/Downloads/a105030_stage_v_step2.txt
2025-12-24 10:14:49,627 - INFO - Extracted 52 questions from Step 2 TXT
2025-12-24 10:14:49,629 - INFO - Loading Step 3 TXT: /home/mohammadbagher/Downloads/a105030_stage_v_step3.txt
2025-12-24 10:14:49,630 - INFO - Successfully extracted JSON from TXT using ThirdStageConverter for /home/mohammadbagher/Downloads/a105030_stage_v_step3.txt
2025-12-24 10:14:49,634 - INFO - Successfully loaded JSON from TXT: /home/mohammadbagher/Downloads/a105030_stage_v_step3.txt
2025-12-24 10:14:49,636 - INFO - Extracted 6 questions from Step 3 TXT
2025-12-24 10:14:49,637 - INFO - Total questions combined (Step 1: 25, Step 2: 52, Step 3: 6): 83
2025-12-24 10:14:49,638 - INFO - Validating and fixing QIds for all questions...
2025-12-24 10:14:49,649 - INFO - Successfully saved JSON: /home/mohammadbagher/Downloads/b105030.json (83 records)
2025-12-24 10:14:49,650 - INFO - Final output saved to: /home/mohammadbagher/Downloads/b105030.json
2025-12-24 10:14:49,652 - INFO - Stage V completed successfully: /home/mohammadbagher/Downloads/b105030.json
2025-12-24 10:23:24,132 - INFO - Loaded 11 predefined prompts
2025-12-24 10:23:24,133 - WARNING - python-docx not available. Will try alternative methods.
2025-12-24 10:23:24,133 - WARNING - python-docx not available. Will try alternative methods.
2025-12-24 10:24:00,614 - INFO - Loaded 3 API keys
2025-12-24 10:24:54,480 - INFO - Starting Stage V processing...
2025-12-24 10:24:54,486 - INFO - Successfully loaded JSON: /home/mohammadbagher/Downloads/a105030.json
2025-12-24 10:24:54,486 - INFO - Detected Book ID: 105, Chapter ID: 30
2025-12-24 10:24:54,487 - INFO - ============================================================
2025-12-24 10:24:54,488 - INFO - STEP 1: Generating initial test questions...
2025-12-24 10:24:54,488 - INFO - ============================================================
2025-12-24 10:24:54,489 - INFO - Loading Stage J JSON for Step 1...
2025-12-24 10:24:54,495 - INFO - Successfully loaded JSON: /home/mohammadbagher/Downloads/a105030.json
2025-12-24 10:24:54,496 - INFO - Loaded 747 records from Stage J
2025-12-24 10:24:54,498 - INFO - Loading Word document...
2025-12-24 10:24:54,500 - INFO - Read file as plain text (latin-1): /home/mohammadbagher/Downloads/تست های پمفیگوس.docx
2025-12-24 10:24:54,511 - INFO - Processing Stage V - Step 1 (single part)...
2025-12-24 10:27:27,281 - INFO - Text processed successfully with gemini-2.5-pro
2025-12-24 10:27:27,282 - INFO - Step 1 response received (30641 characters)
2025-12-24 10:27:27,287 - INFO - Saved raw model responses to: /home/mohammadbagher/Downloads/a105030_stage_v_step1.txt
2025-12-24 10:27:27,292 - INFO - Extracting JSON from Part 1 response...
2025-12-24 10:27:27,298 - INFO - Successfully extracted JSON from response
2025-12-24 10:27:27,304 - INFO - Extracted 27 questions from Part 1
2025-12-24 10:27:27,308 - INFO - Total questions generated in Step 1: 27
2025-12-24 10:27:27,318 - INFO - Successfully saved JSON: /home/mohammadbagher/Downloads/a105030_stage_v_step1.json (27 records)
2025-12-24 10:27:27,318 - INFO - Step 1 output saved to: /home/mohammadbagher/Downloads/a105030_stage_v_step1.json
2025-12-24 10:27:27,321 - INFO - Step 1 completed. Output saved to: /home/mohammadbagher/Downloads/a105030_stage_v_step1.json
2025-12-24 10:27:27,324 - INFO - ============================================================
2025-12-24 10:27:27,325 - INFO - STEP 2: Refining questions (without QId mapping)...
2025-12-24 10:27:27,326 - INFO - ============================================================
2025-12-24 10:27:27,327 - INFO - Loading Stage J JSON for Step 2...
2025-12-24 10:27:27,333 - INFO - Successfully loaded JSON: /home/mohammadbagher/Downloads/a105030.json
2025-12-24 10:27:27,336 - INFO - Prepared 747 Stage J records (without Type column)
2025-12-24 10:27:27,336 - INFO - Loading Word document...
2025-12-24 10:27:27,336 - INFO - Read file as plain text (latin-1): /home/mohammadbagher/Downloads/تست های پمفیگوس.docx
2025-12-24 10:27:27,338 - INFO - Loading Step 1 output to include in Step 2 output...
2025-12-24 10:27:27,339 - INFO - Successfully loaded JSON: /home/mohammadbagher/Downloads/a105030_stage_v_step1.json
2025-12-24 10:27:27,340 - INFO - Loaded 27 questions from Step 1
2025-12-24 10:27:27,361 - INFO - Processing Stage V - Step 2
2025-12-24 10:31:08,940 - INFO - Text processed successfully with gemini-2.5-pro
2025-12-24 10:31:08,942 - INFO - Step 2 response received (56147 characters)
2025-12-24 10:31:08,951 - INFO - Saved raw model responses to: /home/mohammadbagher/Downloads/a105030_stage_v_step2.txt
2025-12-24 10:31:08,953 - INFO - Extracting JSON from Part 1 response...
2025-12-24 10:31:08,958 - INFO - Successfully extracted JSON from response
2025-12-24 10:31:08,961 - INFO - Extracted 60 refined questions from Part 1
2025-12-24 10:31:08,964 - INFO - Total refined questions from Step 2: 60
2025-12-24 10:31:08,968 - INFO - Total combined questions (Step 1 + Step 2): 87
2025-12-24 10:31:08,983 - INFO - Successfully saved JSON: /home/mohammadbagher/Downloads/a105030_stage_v_step2.json (87 records)
2025-12-24 10:31:08,984 - INFO - Step 2 output saved to: /home/mohammadbagher/Downloads/a105030_stage_v_step2.json
2025-12-24 10:31:08,986 - INFO - Step 2 completed. Output saved to: /home/mohammadbagher/Downloads/a105030_stage_v_step2.json
2025-12-24 10:31:08,988 - INFO - ============================================================
2025-12-24 10:31:08,990 - INFO - STEP 3: Adding QId mapping...
2025-12-24 10:31:08,992 - INFO - ============================================================
2025-12-24 10:31:08,993 - INFO - Loading Stage J JSON for PointId reference...
2025-12-24 10:31:08,999 - INFO - Successfully loaded JSON: /home/mohammadbagher/Downloads/a105030.json
2025-12-24 10:31:09,001 - INFO - Prepared 747 Stage J records for reference
2025-12-24 10:31:09,003 - INFO - Processing Stage V - Step 3
2025-12-24 10:32:05,422 - INFO - Text processed successfully with gemini-2.5-pro
2025-12-24 10:32:05,424 - INFO - Step 3 response received (7533 characters)
2025-12-24 10:32:05,429 - INFO - Saved raw model responses to: /home/mohammadbagher/Downloads/a105030_stage_v_step3.txt
2025-12-24 10:32:05,434 - INFO - ============================================================
2025-12-24 10:32:05,443 - INFO - Loading and extracting JSON from all three TXT files...
2025-12-24 10:32:05,445 - INFO - ============================================================
2025-12-24 10:32:05,448 - INFO - Loading Step 1 TXT: /home/mohammadbagher/Downloads/a105030_stage_v_step1.txt
2025-12-24 10:32:05,452 - INFO - Successfully extracted JSON from TXT using ThirdStageConverter for /home/mohammadbagher/Downloads/a105030_stage_v_step1.txt
2025-12-24 10:32:05,456 - INFO - Successfully loaded JSON from TXT: /home/mohammadbagher/Downloads/a105030_stage_v_step1.txt
2025-12-24 10:32:05,458 - INFO - Extracted 27 questions from Step 1 TXT
2025-12-24 10:32:05,459 - INFO - Loading Step 2 TXT: /home/mohammadbagher/Downloads/a105030_stage_v_step2.txt
2025-12-24 10:32:05,462 - INFO - Successfully extracted JSON from TXT using ThirdStageConverter for /home/mohammadbagher/Downloads/a105030_stage_v_step2.txt
2025-12-24 10:32:05,462 - INFO - Successfully loaded JSON from TXT: /home/mohammadbagher/Downloads/a105030_stage_v_step2.txt
2025-12-24 10:32:05,463 - INFO - Extracted 60 questions from Step 2 TXT
2025-12-24 10:32:05,464 - INFO - Loading Step 3 TXT: /home/mohammadbagher/Downloads/a105030_stage_v_step3.txt
2025-12-24 10:32:05,464 - INFO - Successfully extracted JSON from TXT using ThirdStageConverter for /home/mohammadbagher/Downloads/a105030_stage_v_step3.txt
2025-12-24 10:32:05,465 - INFO - Successfully loaded JSON from TXT: /home/mohammadbagher/Downloads/a105030_stage_v_step3.txt
2025-12-24 10:32:05,466 - INFO - Extracted 6 questions from Step 3 TXT
2025-12-24 10:32:05,469 - INFO - Combining questions and removing duplicate TestIDs (priority: Step 3 > Step 2 > Step 1)...
2025-12-24 10:32:05,471 - INFO - Added 27 questions from Step 1
2025-12-24 10:32:05,474 - INFO - Added 60 questions from Step 2 (27 overwrote Step 1)
2025-12-24 10:32:05,477 - INFO - Added 6 questions from Step 3 (6 overwrote previous steps)
2025-12-24 10:32:05,478 - INFO - Total unique questions after removing duplicates: 60 (Step 1: 27, Step 2: 60, Step 3: 6)
2025-12-24 10:32:05,479 - INFO - Reassigning TestIDs sequentially and fixing QIds...
2025-12-24 10:32:05,486 - INFO - Successfully saved JSON: /home/mohammadbagher/Downloads/b105030.json (60 records)
2025-12-24 10:32:05,488 - INFO - Final output saved to: /home/mohammadbagher/Downloads/b105030.json
2025-12-24 10:32:05,491 - INFO - Stage V completed successfully: /home/mohammadbagher/Downloads/b105030.json
2025-12-24 10:33:30,290 - INFO - Starting Stage L processing...
2025-12-24 10:33:30,291 - INFO - Loading Stage J JSON...
2025-12-24 10:33:30,296 - INFO - Successfully loaded JSON: /home/mohammadbagher/Downloads/a105030.json
2025-12-24 10:33:30,297 - INFO - Loaded 747 records from Stage J
2025-12-24 10:33:30,298 - INFO - Detected Book ID: 105, Chapter ID: 30
2025-12-24 10:33:30,298 - INFO - Loading Stage V JSON...
2025-12-24 10:33:30,299 - INFO - Successfully loaded JSON: /home/mohammadbagher/Downloads/b105030.json
2025-12-24 10:33:30,299 - INFO - Loaded 60 records from Stage V
2025-12-24 10:33:30,300 - INFO - Building overview context from Stage J and Stage V...
2025-12-24 10:33:30,302 - INFO - Calling model for Stage L overview...
2025-12-24 10:34:20,026 - INFO - Text processed successfully with gemini-2.5-pro
2025-12-24 10:34:20,028 - INFO - Model response received (4236 characters)
2025-12-24 10:34:20,032 - INFO - Saved raw model response to: /home/mohammadbagher/Downloads/a105030_stage_l.txt
2025-12-24 10:34:20,034 - INFO - Extracting JSON from model response...
2025-12-24 10:34:20,036 - INFO - Successfully extracted JSON from response
2025-12-24 10:34:20,036 - WARNING - No data/points/rows found in JSON, returning empty list
2025-12-24 10:34:20,039 - INFO - Detected direct chapter overview structure, wrapping as single record
2025-12-24 10:34:20,042 - INFO - Extracted 1 overview record(s) from model
2025-12-24 10:34:20,047 - INFO - Saving Stage L output to: /home/mohammadbagher/Downloads/o105030.json
2025-12-24 10:34:20,053 - INFO - Successfully saved JSON: /home/mohammadbagher/Downloads/o105030.json (1 records)
2025-12-24 10:34:20,060 - INFO - Stage L completed successfully: /home/mohammadbagher/Downloads/o105030.json
2026-01-01 10:32:53,757 - INFO - Loaded 14 predefined prompts
2026-01-01 10:32:53,773 - INFO - python-docx library is available
2026-01-01 10:32:53,773 - INFO - python-docx library is available
2026-01-01 10:33:22,430 - INFO - Loaded 3 API keys
2026-01-01 10:34:29,094 - INFO - [get_default_model] ComboBox value: gemini-2.5-pro, StringVar value: gemini-2.5-pro
2026-01-01 10:34:29,095 - INFO - [get_default_model] Returning model from ComboBox: gemini-2.5-pro
2026-01-01 10:34:29,095 - INFO - Starting Stage E processing...
2026-01-01 10:34:29,096 - INFO - Loading Stage 4 JSON...
2026-01-01 10:34:29,101 - INFO - Successfully loaded JSON: /media/shahmir/Shahmir/ee/Lesson_file_105_3.json
2026-01-01 10:34:29,102 - INFO - Detected Book ID: 105, Chapter ID: 3
2026-01-01 10:34:29,103 - INFO - Last PointId in Stage 4: 1050030845, Starting image notes from index: 846
2026-01-01 10:34:29,103 - INFO - Preparing Stage 4 JSON (complete)...
2026-01-01 10:34:29,110 - INFO - ============================================================
2026-01-01 10:34:29,110 - INFO - Processing Stage 4 as complete file (no subchapter division)...
2026-01-01 10:34:29,110 - INFO - ============================================================
2026-01-01 10:34:29,110 - INFO - Calling model gemini-2.5-pro for complete Stage 4...
2026-01-01 10:34:29,110 - INFO - Initialized/recreated text client with model: gemini-2.5-pro
2026-01-01 10:35:30,863 - INFO - Text processed successfully with gemini-2.5-pro
2026-01-01 10:35:30,864 - INFO - Saving model response as TXT file...
2026-01-01 10:35:30,864 - INFO - Stage E raw text saved: /media/shahmir/Shahmir/ee/Lesson_file_105_3_stage_e.txt
2026-01-01 10:35:30,865 - INFO - Converting TXT to JSON...
2026-01-01 10:35:30,865 - INFO - Successfully extracted JSON from TXT using ThirdStageConverter for /media/shahmir/Shahmir/ee/Lesson_file_105_3_stage_e.txt
2026-01-01 10:35:30,867 - INFO - JSON extraction failed (attempt 1), retrying...
2026-01-01 10:35:30,868 - WARNING - Failed to extract JSON from response (attempt 1)
2026-01-01 10:35:30,868 - INFO - Retrying model call (attempt 2/3)...
2026-01-01 10:36:08,115 - INFO - Text processed successfully with gemini-2.5-pro
2026-01-01 10:36:08,116 - INFO - Saving model response as TXT file...
2026-01-01 10:36:08,116 - INFO - Stage E raw text saved: /media/shahmir/Shahmir/ee/Lesson_file_105_3_stage_e.txt
2026-01-01 10:36:08,116 - INFO - Converting TXT to JSON...
2026-01-01 10:36:08,117 - INFO - Successfully extracted JSON from TXT using ThirdStageConverter for /media/shahmir/Shahmir/ee/Lesson_file_105_3_stage_e.txt
2026-01-01 10:36:08,117 - INFO - JSON extraction failed (attempt 2), retrying...
2026-01-01 10:36:08,117 - WARNING - Failed to extract JSON from response (attempt 2)
2026-01-01 10:36:08,118 - INFO - Retrying model call (attempt 3/3)...
2026-01-01 10:36:28,006 - INFO - Text processed successfully with gemini-2.5-pro
2026-01-01 10:36:28,007 - INFO - Saving model response as TXT file...
2026-01-01 10:36:28,008 - INFO - Stage E raw text saved: /media/shahmir/Shahmir/ee/Lesson_file_105_3_stage_e.txt
2026-01-01 10:36:28,009 - INFO - Converting TXT to JSON...
2026-01-01 10:36:28,010 - INFO - Successfully extracted JSON from TXT using ThirdStageConverter for /media/shahmir/Shahmir/ee/Lesson_file_105_3_stage_e.txt
2026-01-01 10:36:28,010 - INFO - JSON extraction failed (attempt 3), retrying...
2026-01-01 10:36:28,010 - WARNING - Failed to extract JSON from response (attempt 3)
2026-01-01 10:36:28,010 - ERROR - Failed to extract JSON from TXT file after retries
2026-01-01 10:36:28,011 - INFO - Error: Failed to extract JSON from model response.
2026-01-01 10:38:00,059 - INFO - [get_default_model] ComboBox value: gemini-2.5-pro, StringVar value: gemini-2.5-pro
2026-01-01 10:38:00,060 - INFO - [get_default_model] Returning model from ComboBox: gemini-2.5-pro
2026-01-01 10:38:00,060 - INFO - Starting Stage E processing...
2026-01-01 10:38:00,061 - INFO - Loading Stage 4 JSON...
2026-01-01 10:38:00,065 - INFO - Successfully loaded JSON: /media/shahmir/Shahmir/ee/Lesson_file_105_3.json
2026-01-01 10:38:00,066 - INFO - Detected Book ID: 105, Chapter ID: 3
2026-01-01 10:38:00,067 - INFO - Last PointId in Stage 4: 1050030845, Starting image notes from index: 846
2026-01-01 10:38:00,068 - INFO - Preparing Stage 4 JSON (complete)...
2026-01-01 10:38:00,075 - INFO - ============================================================
2026-01-01 10:38:00,075 - INFO - Processing Stage 4 as complete file (no subchapter division)...
2026-01-01 10:38:00,076 - INFO - ============================================================
2026-01-01 10:38:00,076 - INFO - Calling model gemini-2.5-pro for complete Stage 4...
2026-01-01 10:38:40,784 - INFO - Text processed successfully with gemini-2.5-pro
2026-01-01 10:38:40,786 - INFO - Saving model response as TXT file...
2026-01-01 10:38:40,786 - INFO - Stage E raw text saved: /media/shahmir/Shahmir/ee/Lesson_file_105_3_stage_e.txt
2026-01-01 10:38:40,788 - INFO - Converting TXT to JSON...
2026-01-01 10:38:40,788 - WARNING - Direct JSON parse failed: Expecting property name enclosed in double quotes: line 2 column 3 (char 4). Trying fallback extraction...
2026-01-01 10:38:40,789 - WARNING - Object extraction parse failed: Expecting property name enclosed in double quotes: line 2 column 3 (char 4)
2026-01-01 10:38:40,789 - INFO - Attempting to repair incomplete JSON...
2026-01-01 10:38:40,790 - WARNING - Repair method returned None
2026-01-01 10:38:40,790 - ERROR - All JSON extraction methods failed
2026-01-01 10:38:40,791 - INFO - Falling back to manual JSON extraction for /media/shahmir/Shahmir/ee/Lesson_file_105_3_stage_e.txt
2026-01-01 10:38:40,792 - ERROR - Failed to parse JSON from cleaned TXT content for /media/shahmir/Shahmir/ee/Lesson_file_105_3_stage_e.txt: Expecting property name enclosed in double quotes: line 2 column 3 (char 4)
2026-01-01 10:38:40,793 - INFO - JSON extraction failed (attempt 1), retrying...
2026-01-01 10:38:40,793 - WARNING - Failed to extract JSON from response (attempt 1)
2026-01-01 10:38:40,793 - INFO - Retrying model call (attempt 2/3)...
2026-01-01 10:39:28,293 - INFO - Text processed successfully with gemini-2.5-pro
2026-01-01 10:39:28,293 - INFO - Saving model response as TXT file...
2026-01-01 10:39:28,294 - INFO - Stage E raw text saved: /media/shahmir/Shahmir/ee/Lesson_file_105_3_stage_e.txt
2026-01-01 10:39:28,295 - INFO - Converting TXT to JSON...
2026-01-01 10:39:28,296 - WARNING - Direct JSON parse failed: Expecting value: line 1 column 1 (char 0). Trying fallback extraction...
2026-01-01 10:39:28,296 - ERROR - All JSON extraction methods failed
2026-01-01 10:39:28,297 - INFO - Falling back to manual JSON extraction for /media/shahmir/Shahmir/ee/Lesson_file_105_3_stage_e.txt
2026-01-01 10:39:28,297 - ERROR - No JSON object boundaries found in TXT file: /media/shahmir/Shahmir/ee/Lesson_file_105_3_stage_e.txt
2026-01-01 10:39:28,298 - INFO - JSON extraction failed (attempt 2), retrying...
2026-01-01 10:39:28,299 - WARNING - Failed to extract JSON from response (attempt 2)
2026-01-01 10:39:28,300 - INFO - Retrying model call (attempt 3/3)...
2026-01-01 10:40:02,090 - INFO - Text processed successfully with gemini-2.5-pro
2026-01-01 10:40:02,091 - INFO - Saving model response as TXT file...
2026-01-01 10:40:02,092 - INFO - Stage E raw text saved: /media/shahmir/Shahmir/ee/Lesson_file_105_3_stage_e.txt
2026-01-01 10:40:02,093 - INFO - Converting TXT to JSON...
2026-01-01 10:40:02,093 - INFO - Successfully extracted JSON from TXT using ThirdStageConverter for /media/shahmir/Shahmir/ee/Lesson_file_105_3_stage_e.txt
2026-01-01 10:40:02,095 - INFO - JSON extraction failed (attempt 3), retrying...
2026-01-01 10:40:02,095 - WARNING - Failed to extract JSON from response (attempt 3)
2026-01-01 10:40:02,095 - ERROR - Failed to extract JSON from TXT file after retries
2026-01-01 10:40:02,096 - INFO - Error: Failed to extract JSON from model response.
2026-01-01 10:41:11,533 - INFO - Loaded 14 predefined prompts
2026-01-01 10:41:11,552 - INFO - python-docx library is available
2026-01-01 10:41:11,552 - INFO - python-docx library is available
2026-01-01 10:41:35,355 - INFO - Loaded 3 API keys
2026-01-01 10:42:21,080 - INFO - [get_default_model] ComboBox value: gemini-2.5-pro, StringVar value: gemini-2.5-pro
2026-01-01 10:42:21,081 - INFO - [get_default_model] Returning model from ComboBox: gemini-2.5-pro
2026-01-01 10:42:21,082 - INFO - Starting Stage E processing...
2026-01-01 10:42:21,083 - INFO - Loading OCR Extraction JSON (Stage 1)...
2026-01-01 10:42:21,084 - INFO - Successfully loaded JSON: /media/shahmir/Shahmir/ee/OCR Extraction.json
2026-01-01 10:42:21,085 - INFO - Loading Stage 4 JSON...
2026-01-01 10:42:21,090 - INFO - Successfully loaded JSON: /media/shahmir/Shahmir/ee/Lesson_file_105_3.json
2026-01-01 10:42:21,091 - INFO - Detected Book ID: 105, Chapter ID: 3
2026-01-01 10:42:21,092 - INFO - Last PointId in Stage 4: 1050030845, Starting image notes from index: 846
2026-01-01 10:42:21,092 - INFO - Preparing OCR Extraction JSON (Stage 1)...
2026-01-01 10:42:21,095 - INFO - Preparing Stage 4 JSON (complete)...
2026-01-01 10:42:21,103 - INFO - ============================================================
2026-01-01 10:42:21,103 - INFO - Processing Stage 4 as complete file (no subchapter division)...
2026-01-01 10:42:21,103 - INFO - ============================================================
2026-01-01 10:42:21,104 - INFO - Calling model gemini-2.5-pro for complete Stage 4...
2026-01-01 10:42:21,104 - INFO - Initialized/recreated text client with model: gemini-2.5-pro
2026-01-01 10:44:21,486 - INFO - Text processed successfully with gemini-2.5-pro
2026-01-01 10:44:21,487 - INFO - Saving model response as TXT file...
2026-01-01 10:44:21,488 - INFO - Stage E raw text saved: /media/shahmir/Shahmir/ee/Lesson_file_105_3_stage_e.txt
2026-01-01 10:44:21,489 - INFO - Converting TXT to JSON...
2026-01-01 10:44:21,492 - INFO - Successfully extracted JSON from TXT using ThirdStageConverter for /media/shahmir/Shahmir/ee/Lesson_file_105_3_stage_e.txt
2026-01-01 10:44:21,493 - INFO - Successfully loaded JSON from TXT: /media/shahmir/Shahmir/ee/Lesson_file_105_3_stage_e.txt
2026-01-01 10:44:21,493 - INFO - Successfully extracted JSON (attempt 1)
2026-01-01 10:44:21,494 - INFO - Extracted 42 image note records
2026-01-01 10:44:21,495 - INFO - Extracted 42 image note records
2026-01-01 10:44:21,496 - INFO - Processing image notes...
2026-01-01 10:44:21,496 - INFO - Processed 42 image notes
2026-01-01 10:44:21,497 - INFO - First image PointId: 1050030846
2026-01-01 10:44:21,498 - INFO - Saving filepic JSON for Stage F...
2026-01-01 10:44:21,499 - INFO - Found 42 records with caption out of 42
2026-01-01 10:44:21,502 - INFO - Successfully saved JSON: /media/shahmir/Shahmir/ee/Lesson_file_105_3_filepic.json (42 records)
2026-01-01 10:44:21,503 - INFO - Filepic saved to: /media/shahmir/Shahmir/ee/Lesson_file_105_3_filepic.json
2026-01-01 10:44:21,505 - INFO - Verified: filepic contains caption field (first caption: 696 chars)
2026-01-01 10:44:21,506 - INFO - Stage 4 points already contain chapter/subchapter fields
2026-01-01 10:44:21,507 - INFO - Merging Stage 4 points with image notes...
2026-01-01 10:44:21,508 - INFO - Saving merged JSON to: /media/shahmir/Shahmir/ee/e105003.json
2026-01-01 10:44:21,517 - INFO - Successfully saved JSON: /media/shahmir/Shahmir/ee/e105003.json (888 records)
2026-01-01 10:44:21,518 - INFO - Stage E completed successfully: /media/shahmir/Shahmir/ee/e105003.json
2026-01-01 10:55:29,491 - INFO - Starting Stage F processing...
2026-01-01 10:55:29,492 - INFO - Loading Stage E JSON...
2026-01-01 10:55:29,497 - INFO - Successfully loaded JSON: /media/shahmir/Shahmir/ee/e105003.json
2026-01-01 10:55:29,499 - INFO - First image PointId: 1050030846
2026-01-01 10:55:29,501 - INFO - Found 42 image records starting from index 846
2026-01-01 10:55:29,502 - INFO - Using filepic path from metadata: /media/shahmir/Shahmir/ee/Lesson_file_105_3_filepic.json
2026-01-01 10:55:29,503 - INFO - Loading descriptions from filepic JSON...
2026-01-01 10:55:29,504 - INFO - Successfully loaded JSON: /media/shahmir/Shahmir/ee/Lesson_file_105_3_filepic.json
2026-01-01 10:55:29,505 - INFO - Found 42 records in filepic JSON
2026-01-01 10:55:29,506 - INFO - Loaded 42 descriptions from filepic JSON
2026-01-01 10:55:29,506 - INFO - Found 42 non-empty captions out of 42
2026-01-01 10:55:29,507 - INFO - Processing image records...
2026-01-01 10:55:29,508 - INFO - Generated 42 image records
2026-01-01 10:55:29,508 - INFO - Saving image file JSON to: /media/shahmir/Shahmir/ee/f.json
2026-01-01 10:55:29,510 - INFO - Successfully saved JSON: /media/shahmir/Shahmir/ee/f.json (42 records)
2026-01-01 10:55:29,510 - INFO - Stage F completed successfully: /media/shahmir/Shahmir/ee/f.json
2026-01-01 10:57:16,138 - INFO - [get_default_model] ComboBox value: gemini-2.5-pro, StringVar value: gemini-2.5-pro
2026-01-01 10:57:16,138 - INFO - [get_default_model] Returning model from ComboBox: gemini-2.5-pro
2026-01-01 10:57:16,138 - INFO - Starting Stage J processing...
2026-01-01 10:57:16,138 - INFO - Loading Stage E JSON...
2026-01-01 10:57:16,140 - INFO - Successfully loaded JSON: /media/shahmir/Shahmir/ee/e105003.json
2026-01-01 10:57:16,140 - INFO - Loaded 888 records from Stage E
2026-01-01 10:57:16,140 - INFO - Detected Book ID: 105, Chapter ID: 3
2026-01-01 10:57:16,140 - INFO - Reading Word file...
2026-01-01 10:57:16,164 - INFO - Successfully read Word file using python-docx: /home/shahmir/Downloads/تست های پمفیگوس.docx (8412 chars)
2026-01-01 10:57:16,164 - INFO - Read Word file: 8412 characters
2026-01-01 10:57:16,164 - INFO - Loading Stage F JSON...
2026-01-01 10:57:16,164 - INFO - Successfully loaded JSON: /media/shahmir/Shahmir/ee/f.json
2026-01-01 10:57:16,165 - INFO - Loaded 42 records from Stage F
2026-01-01 10:57:16,166 - INFO - Splitting Stage E data into 4 parts: Part 1 (222 records), Part 2 (222 records), Part 3 (222 records), Part 4 (222 records)
2026-01-01 10:57:16,166 - INFO - Processing Part 1...
2026-01-01 10:59:19,719 - INFO - Text processed successfully with gemini-2.5-pro
2026-01-01 10:59:19,720 - INFO - Part 1 response received (21140 characters)
2026-01-01 10:59:19,720 - INFO - Processing Part 2...
2026-01-01 11:02:01,670 - INFO - Text processed successfully with gemini-2.5-pro
2026-01-01 11:02:01,670 - INFO - Part 2 response received (21745 characters)
2026-01-01 11:02:01,671 - INFO - Processing Part 3...
2026-01-01 11:03:50,199 - INFO - Text processed successfully with gemini-2.5-pro
2026-01-01 11:03:50,199 - INFO - Part 3 response received (17777 characters)
2026-01-01 11:03:50,199 - INFO - Processing Part 4...
2026-01-01 11:05:37,308 - INFO - Text processed successfully with gemini-2.5-pro
2026-01-01 11:05:37,308 - INFO - Part 4 response received (17774 characters)
2026-01-01 11:05:37,309 - INFO - Combining responses from all parts...
2026-01-01 11:05:37,309 - INFO - Saved combined response to: /media/shahmir/Shahmir/ee/e105003_stage_j.txt
2026-01-01 11:05:37,310 - INFO - Extracting JSON from Part 1 response...
2026-01-01 11:05:37,310 - INFO - Successfully extracted JSON from response
2026-01-01 11:05:37,310 - INFO - Extracting JSON from Part 2 response...
2026-01-01 11:05:37,310 - INFO - Successfully extracted JSON from response
2026-01-01 11:05:37,310 - INFO - Extracting JSON from Part 3 response...
2026-01-01 11:05:37,311 - INFO - Successfully extracted JSON from response
2026-01-01 11:05:37,311 - INFO - Extracting JSON from Part 4 response...
2026-01-01 11:05:37,311 - INFO - Successfully extracted JSON from response
2026-01-01 11:05:37,311 - INFO - Combining JSON from all four parts...
2026-01-01 11:05:37,311 - INFO - Extracted 972 records from combined model output (Part 1: 264, Part 2: 264, Part 3: 222, Part 4: 222)
2026-01-01 11:05:37,312 - INFO - Created mapping for 888 PointIds
2026-01-01 11:05:37,312 - INFO - Merging Stage E data with Imp and Type columns...
2026-01-01 11:05:37,313 - INFO - Merged 888 records
2026-01-01 11:05:37,313 - INFO - Matched 888 records with Imp/Type data
2026-01-01 11:05:37,313 - INFO - Saving Stage J output to: /media/shahmir/Shahmir/ee/a105003.json
2026-01-01 11:05:37,318 - INFO - Successfully saved JSON: /media/shahmir/Shahmir/ee/a105003.json (888 records)
2026-01-01 11:05:37,318 - INFO - Stage J completed successfully: /media/shahmir/Shahmir/ee/a105003.json
2026-01-01 11:07:59,207 - INFO - [get_default_model] ComboBox value: gemini-2.5-pro, StringVar value: gemini-2.5-pro
2026-01-01 11:07:59,207 - INFO - [get_default_model] Returning model from ComboBox: gemini-2.5-pro
2026-01-01 11:07:59,207 - INFO - Starting Stage H processing...
2026-01-01 11:07:59,207 - INFO - Loading Stage J JSON...
2026-01-01 11:07:59,208 - INFO - Successfully loaded JSON: /media/shahmir/Shahmir/ee/a105003.json
2026-01-01 11:07:59,208 - INFO - Loaded 888 records from Stage J
2026-01-01 11:07:59,209 - INFO - Prepared 888 records from Stage J for prompt (without Imp column)
2026-01-01 11:07:59,209 - INFO - Detected Book ID: 105, Chapter ID: 3
2026-01-01 11:07:59,209 - INFO - Loading Stage F JSON...
2026-01-01 11:07:59,209 - INFO - Successfully loaded JSON: /media/shahmir/Shahmir/ee/f.json
2026-01-01 11:07:59,210 - INFO - Loaded 42 records from Stage F
2026-01-01 11:07:59,210 - INFO - Splitting Stage J data into 5 parts: Part 1 (177 records), Part 2 (177 records), Part 3 (177 records), Part 4 (177 records), Part 5 (180 records)
2026-01-01 11:07:59,210 - INFO - Processing Part 1...
2026-01-01 11:11:40,314 - INFO - Text processed successfully with gemini-2.5-pro
2026-01-01 11:11:40,314 - INFO - Part 1 response received (61607 characters)
2026-01-01 11:11:40,315 - INFO - Processing Part 2...
2026-01-01 11:14:35,587 - INFO - Text processed successfully with gemini-2.5-pro
2026-01-01 11:14:35,588 - INFO - Part 2 response received (53814 characters)
2026-01-01 11:14:35,588 - INFO - Processing Part 3...
2026-01-01 11:17:57,084 - INFO - Text processed successfully with gemini-2.5-pro
2026-01-01 11:17:57,085 - INFO - Part 3 response received (53306 characters)
2026-01-01 11:17:57,085 - INFO - Processing Part 4...
2026-01-01 11:21:03,696 - INFO - Text processed successfully with gemini-2.5-pro
2026-01-01 11:21:03,696 - INFO - Part 4 response received (53418 characters)
2026-01-01 11:21:03,697 - INFO - Processing Part 5...
2026-01-01 11:24:36,280 - INFO - Text processed successfully with gemini-2.5-pro
2026-01-01 11:24:36,281 - INFO - Part 5 response received (55044 characters)
2026-01-01 11:24:36,282 - INFO - Saved raw model responses to: /media/shahmir/Shahmir/ee/a105003_stage_h.txt
2026-01-01 11:24:36,282 - INFO - Extracting JSON from Part 1 response...
2026-01-01 11:24:36,282 - WARNING - No closing markdown marker found, JSON may be incomplete
2026-01-01 11:24:36,283 - WARNING - Direct JSON parse failed: Unterminated string starting at: line 1850 column 16 (char 61538). Trying fallback extraction...
2026-01-01 11:24:36,283 - WARNING - Object extraction parse failed: Expecting ',' delimiter: line 1847 column 6 (char 61484)
2026-01-01 11:24:36,285 - INFO - Attempting to repair incomplete JSON...
2026-01-01 11:24:36,291 - WARNING - Repair method returned None
2026-01-01 11:24:36,291 - ERROR - All JSON extraction methods failed
2026-01-01 11:24:36,291 - WARNING - Failed to extract JSON from response
2026-01-01 11:24:36,291 - INFO - Trying to extract Part 1 JSON from text...
2026-01-01 11:24:36,291 - WARNING - No closing markdown marker found, JSON may be incomplete
2026-01-01 11:24:36,291 - WARNING - Direct JSON parse failed: Unterminated string starting at: line 1850 column 16 (char 61538). Trying fallback extraction...
2026-01-01 11:24:36,292 - WARNING - Object extraction parse failed: Expecting ',' delimiter: line 1847 column 6 (char 61484)
2026-01-01 11:24:36,294 - INFO - Attempting to repair incomplete JSON...
2026-01-01 11:24:36,302 - WARNING - Repair method returned None
2026-01-01 11:24:36,302 - ERROR - All JSON extraction methods failed
2026-01-01 11:24:36,302 - INFO - Extracting JSON from Part 2 response...
2026-01-01 11:24:36,302 - INFO - Successfully extracted JSON from response
2026-01-01 11:24:36,303 - INFO - Extracting JSON from Part 3 response...
2026-01-01 11:24:36,303 - INFO - Successfully extracted JSON from response
2026-01-01 11:24:36,303 - INFO - Extracting JSON from Part 4 response...
2026-01-01 11:24:36,304 - INFO - Successfully extracted JSON from response
2026-01-01 11:24:36,304 - INFO - Extracting JSON from Part 5 response...
2026-01-01 11:24:36,304 - INFO - Successfully extracted JSON from response
2026-01-01 11:24:36,304 - INFO - Combining JSON from all five parts...
2026-01-01 11:24:36,305 - INFO - Extracted 711 records from combined model output (Part 1: 0, Part 2: 177, Part 3: 177, Part 4: 177, Part 5: 180)
2026-01-01 11:24:36,305 - INFO - Created mapping for 711 PointIds from model output
2026-01-01 11:24:36,305 - INFO - Merging Stage J data with model output...
2026-01-01 11:24:36,306 - INFO - Generated 888 flashcard records
2026-01-01 11:24:36,306 - INFO - Matched 711 records with flashcard data from model
2026-01-01 11:24:36,306 - INFO - Saving Stage H output to: /media/shahmir/Shahmir/ee/ac105003.json
2026-01-01 11:24:36,312 - INFO - Successfully saved JSON: /media/shahmir/Shahmir/ee/ac105003.json (888 records)
2026-01-01 11:24:36,313 - INFO - Stage H completed successfully: /media/shahmir/Shahmir/ee/ac105003.json
2026-01-01 11:31:12,621 - INFO - Loaded 14 predefined prompts
2026-01-01 11:31:12,641 - INFO - python-docx library is available
2026-01-01 11:31:12,641 - INFO - python-docx library is available
2026-01-01 11:31:42,848 - INFO - Loaded 3 API keys
2026-01-01 11:32:11,775 - INFO - [get_default_model] ComboBox value: gemini-2.5-pro, StringVar value: gemini-2.5-pro
2026-01-01 11:32:11,776 - INFO - [get_default_model] Returning model from ComboBox: gemini-2.5-pro
2026-01-01 11:32:11,777 - INFO - Starting Stage H processing...
2026-01-01 11:32:11,778 - INFO - Loading Stage J JSON...
2026-01-01 11:32:11,785 - INFO - Successfully loaded JSON: /media/shahmir/Shahmir/ee/a105003.json
2026-01-01 11:32:11,786 - INFO - Loaded 888 records from Stage J
2026-01-01 11:32:11,788 - INFO - Prepared 888 records from Stage J for prompt (without Imp column)
2026-01-01 11:32:11,788 - INFO - Detected Book ID: 105, Chapter ID: 3
2026-01-01 11:32:11,788 - INFO - Loading Stage F JSON...
2026-01-01 11:32:11,789 - INFO - Successfully loaded JSON: /media/shahmir/Shahmir/ee/f.json
2026-01-01 11:32:11,790 - INFO - Loaded 42 records from Stage F
2026-01-01 11:32:11,790 - INFO - Splitting Stage J data into 5 parts: Part 1 (177 records), Part 2 (177 records), Part 3 (177 records), Part 4 (177 records), Part 5 (180 records)
2026-01-01 11:32:11,791 - INFO - Processing Part 1...
2026-01-01 11:32:11,794 - INFO - Initialized/recreated text client with model: gemini-2.5-pro
2026-01-01 11:35:21,098 - INFO - Text processed successfully with gemini-2.5-pro
2026-01-01 11:35:21,098 - INFO - Part 1 response received (50963 characters)
2026-01-01 11:35:21,098 - INFO - Processing Part 2...
2026-01-01 11:38:59,482 - INFO - Text processed successfully with gemini-2.5-pro
2026-01-01 11:38:59,483 - INFO - Part 2 response received (65767 characters)
2026-01-01 11:38:59,484 - INFO - Processing Part 3...
2026-01-01 11:42:26,464 - INFO - Text processed successfully with gemini-2.5-pro
2026-01-01 11:42:26,465 - INFO - Part 3 response received (53014 characters)
2026-01-01 11:42:26,466 - INFO - Processing Part 4...
2026-01-01 11:45:34,272 - INFO - Text processed successfully with gemini-2.5-pro
2026-01-01 11:45:34,273 - INFO - Part 4 response received (52424 characters)
2026-01-01 11:45:34,273 - INFO - Processing Part 5...
2026-01-01 11:48:51,205 - INFO - Text processed successfully with gemini-2.5-pro
2026-01-01 11:48:51,205 - INFO - Part 5 response received (51614 characters)
2026-01-01 11:48:51,206 - INFO - Saved raw model responses to: /media/shahmir/Shahmir/ee/a105003_stage_h.txt
2026-01-01 11:48:51,206 - INFO - Extracting JSON from Part 1 response...
2026-01-01 11:48:51,206 - INFO - Successfully extracted JSON from response
2026-01-01 11:48:51,207 - INFO - Extracting JSON from Part 2 response...
2026-01-01 11:48:51,207 - WARNING - No closing markdown marker found, JSON may be incomplete
2026-01-01 11:48:51,207 - WARNING - Direct JSON parse failed: Unterminated string starting at: line 1897 column 18 (char 65758). Trying fallback extraction...
2026-01-01 11:48:51,208 - WARNING - Object extraction parse failed: Expecting ',' delimiter: line 1892 column 6 (char 65575)
2026-01-01 11:48:51,211 - INFO - Attempting to repair incomplete JSON...
2026-01-01 11:48:51,223 - WARNING - Repair method returned None
2026-01-01 11:48:51,223 - ERROR - All JSON extraction methods failed
2026-01-01 11:48:51,223 - WARNING - Failed to extract JSON from response
2026-01-01 11:48:51,224 - INFO - Trying to extract Part 2 JSON from text...
2026-01-01 11:48:51,224 - WARNING - No closing markdown marker found, JSON may be incomplete
2026-01-01 11:48:51,224 - WARNING - Direct JSON parse failed: Unterminated string starting at: line 1897 column 18 (char 65758). Trying fallback extraction...
2026-01-01 11:48:51,224 - WARNING - Object extraction parse failed: Expecting ',' delimiter: line 1892 column 6 (char 65575)
2026-01-01 11:48:51,228 - INFO - Attempting to repair incomplete JSON...
2026-01-01 11:48:51,236 - WARNING - Repair method returned None
2026-01-01 11:48:51,236 - ERROR - All JSON extraction methods failed
2026-01-01 11:48:51,236 - INFO - Extracting JSON from Part 3 response...
2026-01-01 11:48:51,236 - INFO - Successfully extracted JSON from response
2026-01-01 11:48:51,237 - INFO - Extracting JSON from Part 4 response...
2026-01-01 11:48:51,237 - INFO - Successfully extracted JSON from response
2026-01-01 11:48:51,237 - INFO - Extracting JSON from Part 5 response...
2026-01-01 11:48:51,237 - INFO - Successfully extracted JSON from response
2026-01-01 11:48:51,237 - INFO - Combining JSON from all five parts...
2026-01-01 11:48:51,237 - INFO - Extracted 711 records from combined model output (Part 1: 177, Part 2: 0, Part 3: 177, Part 4: 177, Part 5: 180)
2026-01-01 11:48:51,237 - INFO - Created mapping for 711 PointIds from model output
2026-01-01 11:48:51,238 - INFO - Merging Stage J data with model output...
2026-01-01 11:48:51,238 - INFO - Generated 888 flashcard records
2026-01-01 11:48:51,238 - INFO - Matched 711 records with flashcard data from model
2026-01-01 11:48:51,238 - INFO - Saving Stage H output to: /media/shahmir/Shahmir/ee/ac105003.json
2026-01-01 11:48:51,244 - INFO - Successfully saved JSON: /media/shahmir/Shahmir/ee/ac105003.json (888 records)
2026-01-01 11:48:51,245 - INFO - Stage H completed successfully: /media/shahmir/Shahmir/ee/ac105003.json
2026-01-01 11:58:24,294 - INFO - Starting Stage V processing...
2026-01-01 11:58:24,300 - INFO - Successfully loaded JSON: /media/shahmir/Shahmir/ee/a105003.json
2026-01-01 11:58:24,301 - INFO - Detected Book ID: 105, Chapter ID: 3
2026-01-01 11:58:24,302 - INFO - Loading OCR Extraction JSON for topic structure...
2026-01-01 11:58:24,303 - INFO - Chapter name from OCR Extraction JSON: گروه پمفیگوئید
2026-01-01 11:58:24,303 - INFO - ================================================================================
2026-01-01 11:58:24,304 - INFO - DOCUMENT PROCESSING - PROCESSING BY TOPIC
2026-01-01 11:58:24,304 - INFO - ================================================================================
2026-01-01 11:58:24,304 - INFO - Found 21 topics to process
2026-01-01 11:58:24,304 - INFO - Found 3 unique subchapters
2026-01-01 11:58:24,304 - INFO - 
2026-01-01 11:58:24,304 - INFO -   Subchapter 1: 'اپیدرمولیز بولوزا اکتسابی' - 5 topics
2026-01-01 11:58:24,305 - INFO -     Topic 1: 'مقدمه، تاریخچه و اپیدمیولوژی'
2026-01-01 11:58:24,305 - INFO -     Topic 2: 'پاتوژنز'
2026-01-01 11:58:24,305 - INFO -     Topic 3: 'ویژگی‌های بالینی'
2026-01-01 11:58:24,305 - INFO -     Topic 4: 'تشخیص و تشخیص افتراقی'
2026-01-01 11:58:24,305 - INFO -     Topic 5: 'درمان'
2026-01-01 11:58:24,305 - INFO -   Subchapter 2: 'پمفیگوئید بولوز' - 9 topics
2026-01-01 11:58:24,305 - INFO -     Topic 1: 'مقدمه و تاریخچه'
2026-01-01 11:58:24,306 - INFO -     Topic 2: 'اپیدمیولوژی'
2026-01-01 11:58:24,306 - INFO -     Topic 3: 'پاتوژنز'
2026-01-01 11:58:24,306 - INFO -     Topic 4: 'ویژگی‌های بالینی'
2026-01-01 11:58:24,306 - INFO -     Topic 5: 'بیماری‌های همراه'
2026-01-01 11:58:24,306 - INFO -     Topic 6: 'تشخیص'
2026-01-01 11:58:24,306 - INFO -     Topic 7: 'تشخیص افتراقی'
2026-01-01 11:58:24,306 - INFO -     Topic 8: 'پروگنوز و پایش'
2026-01-01 11:58:24,306 - INFO -     Topic 9: 'درمان'
2026-01-01 11:58:24,307 - INFO -   Subchapter 3: 'پمفیگوئید غشاء مخاطی' - 7 topics
2026-01-01 11:58:24,307 - INFO -     Topic 1: 'مقدمه'
2026-01-01 11:58:24,307 - INFO -     Topic 2: 'تاریخچه و اپیدمیولوژی'
2026-01-01 11:58:24,307 - INFO -     Topic 3: 'پاتوژنز'
2026-01-01 11:58:24,307 - INFO -     Topic 4: 'ویژگی‌های بالینی'
2026-01-01 11:58:24,307 - INFO -     Topic 5: 'تشخیص و تشخیص افتراقی'
2026-01-01 11:58:24,308 - INFO -     Topic 6: 'پیش‌آگهی'
2026-01-01 11:58:24,308 - INFO -     Topic 7: 'درمان'
2026-01-01 11:58:24,308 - INFO - ================================================================================
2026-01-01 11:58:24,322 - INFO - ============================================================
2026-01-01 11:58:24,323 - INFO - STEP 1: Generating initial test questions (per Topic, with full Stage J)...
2026-01-01 11:58:24,323 - INFO - ============================================================
2026-01-01 11:58:24,324 - INFO - [1/21] Processing Step 1 for Topic 'مقدمه و تاریخچه' (Subchapter: 'پمفیگوئید بولوز')...
2026-01-01 11:58:24,324 - INFO - 
2026-01-01 11:58:24,324 - INFO - ================================================================================
2026-01-01 11:58:24,324 - INFO - PROCESSING TOPIC 1/21: 'مقدمه و تاریخچه'
2026-01-01 11:58:24,324 - INFO - ================================================================================
2026-01-01 11:58:24,324 - INFO -   Subchapter: 'پمفیگوئید بولوز'
2026-01-01 11:58:24,324 - INFO -   Topic: 'مقدمه و تاریخچه'
2026-01-01 11:58:24,325 - INFO -   Total Stage J records: 888
2026-01-01 11:58:24,344 - INFO - Loading Word document for Topic 1/21...
2026-01-01 11:58:24,364 - INFO - Successfully read Word file using python-docx: /home/shahmir/Downloads/راهنمای_پایپ_لاین_ارتقا_و_بورد_پوست.docx (2737 chars)
2026-01-01 11:58:24,364 - INFO - Processing Stage V - Step 1 for Topic 1/21 (full file)...
2026-01-01 11:59:54,354 - INFO - Text processed successfully with gemini-2.5-pro
2026-01-01 11:59:54,355 - INFO - Step 1 response received for Topic 1 (9454 characters)
2026-01-01 11:59:54,357 - INFO - Saved raw model responses to: /media/shahmir/Shahmir/ee/a105003_stage_v_step1_topic_1_مقدمه_و_تاریخچه.txt
2026-01-01 11:59:54,357 - INFO - Extracting JSON from Part 1 response...
2026-01-01 11:59:54,358 - INFO - Successfully extracted JSON from response
2026-01-01 11:59:54,358 - INFO - Extracted 9 questions from Part 1
2026-01-01 11:59:54,359 - INFO - Total questions generated in Step 1 for Topic 1: 9
2026-01-01 11:59:54,360 - INFO - Successfully saved JSON: /media/shahmir/Shahmir/ee/a105003_stage_v_step1_topic_1_مقدمه_و_تاریخچه.json (9 records)
2026-01-01 11:59:54,360 - INFO - Step 1 output saved to: /media/shahmir/Shahmir/ee/a105003_stage_v_step1_topic_1_مقدمه_و_تاریخچه.json
2026-01-01 11:59:54,361 - INFO - Step 1 completed for Topic 'مقدمه و تاریخچه': /media/shahmir/Shahmir/ee/a105003_stage_v_step1_topic_1_مقدمه_و_تاریخچه.json
2026-01-01 11:59:54,362 - INFO -   ✓ Step 1 completed for Topic 'مقدمه و تاریخچه'
2026-01-01 11:59:54,362 - INFO - [2/21] Processing Step 1 for Topic 'اپیدمیولوژی' (Subchapter: 'پمفیگوئید بولوز')...
2026-01-01 11:59:54,362 - INFO - 
2026-01-01 11:59:54,363 - INFO - ================================================================================
2026-01-01 11:59:54,363 - INFO - PROCESSING TOPIC 2/21: 'اپیدمیولوژی'
2026-01-01 11:59:54,363 - INFO - ================================================================================
2026-01-01 11:59:54,364 - INFO -   Subchapter: 'پمفیگوئید بولوز'
2026-01-01 11:59:54,364 - INFO -   Topic: 'اپیدمیولوژی'
2026-01-01 11:59:54,365 - INFO -   Total Stage J records: 888
2026-01-01 11:59:54,365 - INFO - Loading Word document for Topic 2/21...
2026-01-01 11:59:54,387 - INFO - Successfully read Word file using python-docx: /home/shahmir/Downloads/راهنمای_پایپ_لاین_ارتقا_و_بورد_پوست.docx (2737 chars)
2026-01-01 11:59:54,387 - INFO - Processing Stage V - Step 1 for Topic 2/21 (full file)...
2026-01-01 12:01:43,027 - INFO - Text processed successfully with gemini-2.5-pro
2026-01-01 12:01:43,027 - INFO - Step 1 response received for Topic 2 (11669 characters)
2026-01-01 12:01:43,027 - INFO - Saved raw model responses to: /media/shahmir/Shahmir/ee/a105003_stage_v_step1_topic_2_اپیدمیولوژی.txt
2026-01-01 12:01:43,028 - INFO - Extracting JSON from Part 1 response...
2026-01-01 12:01:43,028 - INFO - Successfully extracted JSON from response
2026-01-01 12:01:43,028 - INFO - Extracted 12 questions from Part 1
2026-01-01 12:01:43,028 - INFO - Total questions generated in Step 1 for Topic 2: 12
2026-01-01 12:01:43,028 - INFO - Successfully saved JSON: /media/shahmir/Shahmir/ee/a105003_stage_v_step1_topic_2_اپیدمیولوژی.json (12 records)
2026-01-01 12:01:43,028 - INFO - Step 1 output saved to: /media/shahmir/Shahmir/ee/a105003_stage_v_step1_topic_2_اپیدمیولوژی.json
2026-01-01 12:01:43,029 - INFO - Step 1 completed for Topic 'اپیدمیولوژی': /media/shahmir/Shahmir/ee/a105003_stage_v_step1_topic_2_اپیدمیولوژی.json
2026-01-01 12:01:43,029 - INFO -   ✓ Step 1 completed for Topic 'اپیدمیولوژی'
2026-01-01 12:01:43,029 - INFO - [3/21] Processing Step 1 for Topic 'پاتوژنز' (Subchapter: 'پمفیگوئید بولوز')...
2026-01-01 12:01:43,029 - INFO - 
2026-01-01 12:01:43,029 - INFO - ================================================================================
2026-01-01 12:01:43,029 - INFO - PROCESSING TOPIC 3/21: 'پاتوژنز'
2026-01-01 12:01:43,029 - INFO - ================================================================================
2026-01-01 12:01:43,029 - INFO -   Subchapter: 'پمفیگوئید بولوز'
2026-01-01 12:01:43,029 - INFO -   Topic: 'پاتوژنز'
2026-01-01 12:01:43,029 - INFO -   Total Stage J records: 888
2026-01-01 12:01:43,029 - INFO - Loading Word document for Topic 3/21...
2026-01-01 12:01:43,038 - INFO - Successfully read Word file using python-docx: /home/shahmir/Downloads/راهنمای_پایپ_لاین_ارتقا_و_بورد_پوست.docx (2737 chars)
2026-01-01 12:01:43,038 - INFO - Processing Stage V - Step 1 for Topic 3/21 (full file)...
2026-01-01 12:03:48,353 - INFO - Text processed successfully with gemini-2.5-pro
2026-01-01 12:03:48,354 - INFO - Step 1 response received for Topic 3 (6169 characters)
2026-01-01 12:03:48,355 - INFO - Saved raw model responses to: /media/shahmir/Shahmir/ee/a105003_stage_v_step1_topic_3_پاتوژنز.txt
2026-01-01 12:03:48,355 - INFO - Extracting JSON from Part 1 response...
2026-01-01 12:03:48,355 - INFO - Successfully extracted JSON from response
2026-01-01 12:03:48,355 - INFO - Extracted 5 questions from Part 1
2026-01-01 12:03:48,356 - INFO - Total questions generated in Step 1 for Topic 3: 5
2026-01-01 12:03:48,356 - INFO - Successfully saved JSON: /media/shahmir/Shahmir/ee/a105003_stage_v_step1_topic_3_پاتوژنز.json (5 records)
2026-01-01 12:03:48,356 - INFO - Step 1 output saved to: /media/shahmir/Shahmir/ee/a105003_stage_v_step1_topic_3_پاتوژنز.json
2026-01-01 12:03:48,356 - INFO - Step 1 completed for Topic 'پاتوژنز': /media/shahmir/Shahmir/ee/a105003_stage_v_step1_topic_3_پاتوژنز.json
2026-01-01 12:03:48,356 - INFO -   ✓ Step 1 completed for Topic 'پاتوژنز'
2026-01-01 12:03:48,356 - INFO - [4/21] Processing Step 1 for Topic 'ویژگی‌های بالینی' (Subchapter: 'پمفیگوئید بولوز')...
2026-01-01 12:03:48,356 - INFO - 
2026-01-01 12:03:48,356 - INFO - ================================================================================
2026-01-01 12:03:48,357 - INFO - PROCESSING TOPIC 4/21: 'ویژگی‌های بالینی'
2026-01-01 12:03:48,357 - INFO - ================================================================================
2026-01-01 12:03:48,357 - INFO -   Subchapter: 'پمفیگوئید بولوز'
2026-01-01 12:03:48,357 - INFO -   Topic: 'ویژگی‌های بالینی'
2026-01-01 12:03:48,357 - INFO -   Total Stage J records: 888
2026-01-01 12:03:48,357 - INFO - Loading Word document for Topic 4/21...
2026-01-01 12:03:48,365 - INFO - Successfully read Word file using python-docx: /home/shahmir/Downloads/راهنمای_پایپ_لاین_ارتقا_و_بورد_پوست.docx (2737 chars)
2026-01-01 12:03:48,365 - INFO - Processing Stage V - Step 1 for Topic 4/21 (full file)...
2026-01-01 12:04:52,448 - INFO - Text processed successfully with gemini-2.5-pro
2026-01-01 12:04:52,449 - INFO - Step 1 response received for Topic 4 (5772 characters)
2026-01-01 12:04:52,451 - INFO - Saved raw model responses to: /media/shahmir/Shahmir/ee/a105003_stage_v_step1_topic_4_ویژگیهای_بالینی.txt
2026-01-01 12:04:52,453 - INFO - Extracting JSON from Part 1 response...
2026-01-01 12:04:52,453 - INFO - Successfully extracted JSON from response
2026-01-01 12:04:52,454 - INFO - Extracted 6 questions from Part 1
2026-01-01 12:04:52,455 - INFO - Total questions generated in Step 1 for Topic 4: 6
2026-01-01 12:04:52,456 - INFO - Successfully saved JSON: /media/shahmir/Shahmir/ee/a105003_stage_v_step1_topic_4_ویژگیهای_بالینی.json (6 records)
2026-01-01 12:04:52,457 - INFO - Step 1 output saved to: /media/shahmir/Shahmir/ee/a105003_stage_v_step1_topic_4_ویژگیهای_بالینی.json
2026-01-01 12:04:52,457 - INFO - Step 1 completed for Topic 'ویژگی‌های بالینی': /media/shahmir/Shahmir/ee/a105003_stage_v_step1_topic_4_ویژگیهای_بالینی.json
2026-01-01 12:04:52,457 - INFO -   ✓ Step 1 completed for Topic 'ویژگی‌های بالینی'
2026-01-01 12:04:52,458 - INFO - [5/21] Processing Step 1 for Topic 'بیماری‌های همراه' (Subchapter: 'پمفیگوئید بولوز')...
2026-01-01 12:04:52,458 - INFO - 
2026-01-01 12:04:52,458 - INFO - ================================================================================
2026-01-01 12:04:52,458 - INFO - PROCESSING TOPIC 5/21: 'بیماری‌های همراه'
2026-01-01 12:04:52,458 - INFO - ================================================================================
2026-01-01 12:04:52,458 - INFO -   Subchapter: 'پمفیگوئید بولوز'
2026-01-01 12:04:52,459 - INFO -   Topic: 'بیماری‌های همراه'
2026-01-01 12:04:52,459 - INFO -   Total Stage J records: 888
2026-01-01 12:04:52,459 - INFO - Loading Word document for Topic 5/21...
2026-01-01 12:04:52,479 - INFO - Successfully read Word file using python-docx: /home/shahmir/Downloads/راهنمای_پایپ_لاین_ارتقا_و_بورد_پوست.docx (2737 chars)
2026-01-01 12:04:52,479 - INFO - Processing Stage V - Step 1 for Topic 5/21 (full file)...
2026-01-01 12:06:26,485 - INFO - Text processed successfully with gemini-2.5-pro
2026-01-01 12:06:26,487 - INFO - Step 1 response received for Topic 5 (5949 characters)
2026-01-01 12:06:26,488 - INFO - Saved raw model responses to: /media/shahmir/Shahmir/ee/a105003_stage_v_step1_topic_5_بیماریهای_همراه.txt
2026-01-01 12:06:26,489 - INFO - Extracting JSON from Part 1 response...
2026-01-01 12:06:26,489 - INFO - Successfully extracted JSON from response
2026-01-01 12:06:26,489 - INFO - Extracted 6 questions from Part 1
2026-01-01 12:06:26,490 - INFO - Total questions generated in Step 1 for Topic 5: 6
2026-01-01 12:06:26,491 - INFO - Successfully saved JSON: /media/shahmir/Shahmir/ee/a105003_stage_v_step1_topic_5_بیماریهای_همراه.json (6 records)
2026-01-01 12:06:26,491 - INFO - Step 1 output saved to: /media/shahmir/Shahmir/ee/a105003_stage_v_step1_topic_5_بیماریهای_همراه.json
2026-01-01 12:06:26,493 - INFO - Step 1 completed for Topic 'بیماری‌های همراه': /media/shahmir/Shahmir/ee/a105003_stage_v_step1_topic_5_بیماریهای_همراه.json
2026-01-01 12:06:26,493 - INFO -   ✓ Step 1 completed for Topic 'بیماری‌های همراه'
2026-01-01 12:06:26,494 - INFO - [6/21] Processing Step 1 for Topic 'تشخیص' (Subchapter: 'پمفیگوئید بولوز')...
2026-01-01 12:06:26,494 - INFO - 
2026-01-01 12:06:26,494 - INFO - ================================================================================
2026-01-01 12:06:26,495 - INFO - PROCESSING TOPIC 6/21: 'تشخیص'
2026-01-01 12:06:26,495 - INFO - ================================================================================
2026-01-01 12:06:26,495 - INFO -   Subchapter: 'پمفیگوئید بولوز'
2026-01-01 12:06:26,495 - INFO -   Topic: 'تشخیص'
2026-01-01 12:06:26,495 - INFO -   Total Stage J records: 888
2026-01-01 12:06:26,496 - INFO - Loading Word document for Topic 6/21...
2026-01-01 12:06:26,518 - INFO - Successfully read Word file using python-docx: /home/shahmir/Downloads/راهنمای_پایپ_لاین_ارتقا_و_بورد_پوست.docx (2737 chars)
2026-01-01 12:06:26,519 - INFO - Processing Stage V - Step 1 for Topic 6/21 (full file)...
2026-01-01 12:07:35,399 - INFO - Text processed successfully with gemini-2.5-pro
2026-01-01 12:07:35,399 - INFO - Step 1 response received for Topic 6 (6049 characters)
2026-01-01 12:07:35,399 - INFO - Saved raw model responses to: /media/shahmir/Shahmir/ee/a105003_stage_v_step1_topic_6_تشخیص.txt
2026-01-01 12:07:35,399 - INFO - Extracting JSON from Part 1 response...
2026-01-01 12:07:35,399 - INFO - Successfully extracted JSON from response
2026-01-01 12:07:35,399 - INFO - Extracted 5 questions from Part 1
2026-01-01 12:07:35,400 - INFO - Total questions generated in Step 1 for Topic 6: 5
2026-01-01 12:07:35,400 - INFO - Successfully saved JSON: /media/shahmir/Shahmir/ee/a105003_stage_v_step1_topic_6_تشخیص.json (5 records)
2026-01-01 12:07:35,400 - INFO - Step 1 output saved to: /media/shahmir/Shahmir/ee/a105003_stage_v_step1_topic_6_تشخیص.json
2026-01-01 12:07:35,400 - INFO - Step 1 completed for Topic 'تشخیص': /media/shahmir/Shahmir/ee/a105003_stage_v_step1_topic_6_تشخیص.json
2026-01-01 12:07:35,400 - INFO -   ✓ Step 1 completed for Topic 'تشخیص'
2026-01-01 12:07:35,400 - INFO - [7/21] Processing Step 1 for Topic 'تشخیص افتراقی' (Subchapter: 'پمفیگوئید بولوز')...
2026-01-01 12:07:35,401 - INFO - 
2026-01-01 12:07:35,401 - INFO - ================================================================================
2026-01-01 12:07:35,401 - INFO - PROCESSING TOPIC 7/21: 'تشخیص افتراقی'
2026-01-01 12:07:35,401 - INFO - ================================================================================
2026-01-01 12:07:35,401 - INFO -   Subchapter: 'پمفیگوئید بولوز'
2026-01-01 12:07:35,401 - INFO -   Topic: 'تشخیص افتراقی'
2026-01-01 12:07:35,401 - INFO -   Total Stage J records: 888
2026-01-01 12:07:35,401 - INFO - Loading Word document for Topic 7/21...
2026-01-01 12:07:35,408 - INFO - Successfully read Word file using python-docx: /home/shahmir/Downloads/راهنمای_پایپ_لاین_ارتقا_و_بورد_پوست.docx (2737 chars)
2026-01-01 12:07:35,408 - INFO - Processing Stage V - Step 1 for Topic 7/21 (full file)...
2026-01-01 12:08:58,499 - INFO - Text processed successfully with gemini-2.5-pro
2026-01-01 12:08:58,500 - INFO - Step 1 response received for Topic 7 (8220 characters)
2026-01-01 12:08:58,501 - INFO - Saved raw model responses to: /media/shahmir/Shahmir/ee/a105003_stage_v_step1_topic_7_تشخیص_افتراقی.txt
2026-01-01 12:08:58,502 - INFO - Extracting JSON from Part 1 response...
2026-01-01 12:08:58,503 - INFO - Successfully extracted JSON from response
2026-01-01 12:08:58,504 - INFO - Extracted 6 questions from Part 1
2026-01-01 12:08:58,504 - INFO - Total questions generated in Step 1 for Topic 7: 6
2026-01-01 12:08:58,505 - INFO - Successfully saved JSON: /media/shahmir/Shahmir/ee/a105003_stage_v_step1_topic_7_تشخیص_افتراقی.json (6 records)
2026-01-01 12:08:58,506 - INFO - Step 1 output saved to: /media/shahmir/Shahmir/ee/a105003_stage_v_step1_topic_7_تشخیص_افتراقی.json
2026-01-01 12:08:58,506 - INFO - Step 1 completed for Topic 'تشخیص افتراقی': /media/shahmir/Shahmir/ee/a105003_stage_v_step1_topic_7_تشخیص_افتراقی.json
2026-01-01 12:08:58,506 - INFO -   ✓ Step 1 completed for Topic 'تشخیص افتراقی'
2026-01-01 12:08:58,507 - INFO - [8/21] Processing Step 1 for Topic 'پروگنوز و پایش' (Subchapter: 'پمفیگوئید بولوز')...
2026-01-01 12:08:58,507 - INFO - 
2026-01-01 12:08:58,507 - INFO - ================================================================================
2026-01-01 12:08:58,508 - INFO - PROCESSING TOPIC 8/21: 'پروگنوز و پایش'
2026-01-01 12:08:58,508 - INFO - ================================================================================
2026-01-01 12:08:58,508 - INFO -   Subchapter: 'پمفیگوئید بولوز'
2026-01-01 12:08:58,508 - INFO -   Topic: 'پروگنوز و پایش'
2026-01-01 12:08:58,508 - INFO -   Total Stage J records: 888
2026-01-01 12:08:58,508 - INFO - Loading Word document for Topic 8/21...
2026-01-01 12:08:58,525 - INFO - Successfully read Word file using python-docx: /home/shahmir/Downloads/راهنمای_پایپ_لاین_ارتقا_و_بورد_پوست.docx (2737 chars)
2026-01-01 12:08:58,525 - INFO - Processing Stage V - Step 1 for Topic 8/21 (full file)...
2026-01-01 12:09:58,102 - INFO - Text processed successfully with gemini-2.5-pro
2026-01-01 12:09:58,103 - INFO - Step 1 response received for Topic 8 (3754 characters)
2026-01-01 12:09:58,104 - INFO - Saved raw model responses to: /media/shahmir/Shahmir/ee/a105003_stage_v_step1_topic_8_پروگنوز_و_پایش.txt
2026-01-01 12:09:58,105 - INFO - Extracting JSON from Part 1 response...
2026-01-01 12:09:58,105 - INFO - Successfully extracted JSON from response
2026-01-01 12:09:58,105 - INFO - Extracted 3 questions from Part 1
2026-01-01 12:09:58,106 - INFO - Total questions generated in Step 1 for Topic 8: 3
2026-01-01 12:09:58,106 - INFO - Successfully saved JSON: /media/shahmir/Shahmir/ee/a105003_stage_v_step1_topic_8_پروگنوز_و_پایش.json (3 records)
2026-01-01 12:09:58,107 - INFO - Step 1 output saved to: /media/shahmir/Shahmir/ee/a105003_stage_v_step1_topic_8_پروگنوز_و_پایش.json
2026-01-01 12:09:58,108 - INFO - Step 1 completed for Topic 'پروگنوز و پایش': /media/shahmir/Shahmir/ee/a105003_stage_v_step1_topic_8_پروگنوز_و_پایش.json
2026-01-01 12:09:58,108 - INFO -   ✓ Step 1 completed for Topic 'پروگنوز و پایش'
2026-01-01 12:09:58,109 - INFO - [9/21] Processing Step 1 for Topic 'درمان' (Subchapter: 'پمفیگوئید بولوز')...
2026-01-01 12:09:58,109 - INFO - 
2026-01-01 12:09:58,109 - INFO - ================================================================================
2026-01-01 12:09:58,109 - INFO - PROCESSING TOPIC 9/21: 'درمان'
2026-01-01 12:09:58,110 - INFO - ================================================================================
2026-01-01 12:09:58,110 - INFO -   Subchapter: 'پمفیگوئید بولوز'
2026-01-01 12:09:58,110 - INFO -   Topic: 'درمان'
2026-01-01 12:09:58,110 - INFO -   Total Stage J records: 888
2026-01-01 12:09:58,110 - INFO - Loading Word document for Topic 9/21...
2026-01-01 12:09:58,130 - INFO - Successfully read Word file using python-docx: /home/shahmir/Downloads/راهنمای_پایپ_لاین_ارتقا_و_بورد_پوست.docx (2737 chars)
2026-01-01 12:09:58,130 - INFO - Processing Stage V - Step 1 for Topic 9/21 (full file)...
2026-01-01 12:11:01,430 - INFO - Text processed successfully with gemini-2.5-pro
2026-01-01 12:11:01,431 - INFO - Step 1 response received for Topic 9 (5134 characters)
2026-01-01 12:11:01,431 - INFO - Saved raw model responses to: /media/shahmir/Shahmir/ee/a105003_stage_v_step1_topic_9_درمان.txt
2026-01-01 12:11:01,432 - INFO - Extracting JSON from Part 1 response...
2026-01-01 12:11:01,433 - INFO - Successfully extracted JSON from response
2026-01-01 12:11:01,433 - INFO - Extracted 4 questions from Part 1
2026-01-01 12:11:01,433 - INFO - Total questions generated in Step 1 for Topic 9: 4
2026-01-01 12:11:01,434 - INFO - Successfully saved JSON: /media/shahmir/Shahmir/ee/a105003_stage_v_step1_topic_9_درمان.json (4 records)
2026-01-01 12:11:01,434 - INFO - Step 1 output saved to: /media/shahmir/Shahmir/ee/a105003_stage_v_step1_topic_9_درمان.json
2026-01-01 12:11:01,435 - INFO - Step 1 completed for Topic 'درمان': /media/shahmir/Shahmir/ee/a105003_stage_v_step1_topic_9_درمان.json
2026-01-01 12:11:01,435 - INFO -   ✓ Step 1 completed for Topic 'درمان'
2026-01-01 12:11:01,435 - INFO - [10/21] Processing Step 1 for Topic 'مقدمه' (Subchapter: 'پمفیگوئید غشاء مخاطی')...
2026-01-01 12:11:01,436 - INFO - 
2026-01-01 12:11:01,436 - INFO - ================================================================================
2026-01-01 12:11:01,436 - INFO - PROCESSING TOPIC 10/21: 'مقدمه'
2026-01-01 12:11:01,436 - INFO - ================================================================================
2026-01-01 12:11:01,436 - INFO -   Subchapter: 'پمفیگوئید غشاء مخاطی'
2026-01-01 12:11:01,436 - INFO -   Topic: 'مقدمه'
2026-01-01 12:11:01,436 - INFO -   Total Stage J records: 888
2026-01-01 12:11:01,437 - INFO - Loading Word document for Topic 10/21...
2026-01-01 12:11:01,458 - INFO - Successfully read Word file using python-docx: /home/shahmir/Downloads/راهنمای_پایپ_لاین_ارتقا_و_بورد_پوست.docx (2737 chars)
2026-01-01 12:11:01,458 - INFO - Processing Stage V - Step 1 for Topic 10/21 (full file)...
2026-01-01 12:13:06,286 - INFO - Text processed successfully with gemini-2.5-pro
2026-01-01 12:13:06,287 - INFO - Step 1 response received for Topic 10 (9201 characters)
2026-01-01 12:13:06,287 - INFO - Saved raw model responses to: /media/shahmir/Shahmir/ee/a105003_stage_v_step1_topic_10_مقدمه.txt
2026-01-01 12:13:06,287 - INFO - Extracting JSON from Part 1 response...
2026-01-01 12:13:06,287 - INFO - Successfully extracted JSON from response
2026-01-01 12:13:06,288 - INFO - Extracted 10 questions from Part 1
2026-01-01 12:13:06,288 - INFO - Total questions generated in Step 1 for Topic 10: 10
2026-01-01 12:13:06,288 - INFO - Successfully saved JSON: /media/shahmir/Shahmir/ee/a105003_stage_v_step1_topic_10_مقدمه.json (10 records)
2026-01-01 12:13:06,288 - INFO - Step 1 output saved to: /media/shahmir/Shahmir/ee/a105003_stage_v_step1_topic_10_مقدمه.json
2026-01-01 12:13:06,288 - INFO - Step 1 completed for Topic 'مقدمه': /media/shahmir/Shahmir/ee/a105003_stage_v_step1_topic_10_مقدمه.json
2026-01-01 12:13:06,288 - INFO -   ✓ Step 1 completed for Topic 'مقدمه'
2026-01-01 12:13:06,288 - INFO - [11/21] Processing Step 1 for Topic 'تاریخچه و اپیدمیولوژی' (Subchapter: 'پمفیگوئید غشاء مخاطی')...
2026-01-01 12:13:06,288 - INFO - 
2026-01-01 12:13:06,288 - INFO - ================================================================================
2026-01-01 12:13:06,288 - INFO - PROCESSING TOPIC 11/21: 'تاریخچه و اپیدمیولوژی'
2026-01-01 12:13:06,288 - INFO - ================================================================================
2026-01-01 12:13:06,288 - INFO -   Subchapter: 'پمفیگوئید غشاء مخاطی'
2026-01-01 12:13:06,288 - INFO -   Topic: 'تاریخچه و اپیدمیولوژی'
2026-01-01 12:13:06,288 - INFO -   Total Stage J records: 888
2026-01-01 12:13:06,289 - INFO - Loading Word document for Topic 11/21...
2026-01-01 12:13:06,298 - INFO - Successfully read Word file using python-docx: /home/shahmir/Downloads/راهنمای_پایپ_لاین_ارتقا_و_بورد_پوست.docx (2737 chars)
2026-01-01 12:13:06,299 - INFO - Processing Stage V - Step 1 for Topic 11/21 (full file)...
2026-01-01 12:13:49,330 - INFO - Text processed successfully with gemini-2.5-pro
2026-01-01 12:13:49,330 - INFO - Step 1 response received for Topic 11 (2893 characters)
2026-01-01 12:13:49,331 - INFO - Saved raw model responses to: /media/shahmir/Shahmir/ee/a105003_stage_v_step1_topic_11_تاریخچه_و_اپیدمیولوژی.txt
2026-01-01 12:13:49,331 - INFO - Extracting JSON from Part 1 response...
2026-01-01 12:13:49,331 - INFO - Successfully extracted JSON from response
2026-01-01 12:13:49,331 - INFO - Extracted 3 questions from Part 1
2026-01-01 12:13:49,331 - INFO - Total questions generated in Step 1 for Topic 11: 3
2026-01-01 12:13:49,331 - INFO - Successfully saved JSON: /media/shahmir/Shahmir/ee/a105003_stage_v_step1_topic_11_تاریخچه_و_اپیدمیولوژی.json (3 records)
2026-01-01 12:13:49,331 - INFO - Step 1 output saved to: /media/shahmir/Shahmir/ee/a105003_stage_v_step1_topic_11_تاریخچه_و_اپیدمیولوژی.json
2026-01-01 12:13:49,331 - INFO - Step 1 completed for Topic 'تاریخچه و اپیدمیولوژی': /media/shahmir/Shahmir/ee/a105003_stage_v_step1_topic_11_تاریخچه_و_اپیدمیولوژی.json
2026-01-01 12:13:49,331 - INFO -   ✓ Step 1 completed for Topic 'تاریخچه و اپیدمیولوژی'
2026-01-01 12:13:49,331 - INFO - [12/21] Processing Step 1 for Topic 'پاتوژنز' (Subchapter: 'پمفیگوئید غشاء مخاطی')...
2026-01-01 12:13:49,331 - INFO - 
2026-01-01 12:13:49,331 - INFO - ================================================================================
2026-01-01 12:13:49,331 - INFO - PROCESSING TOPIC 12/21: 'پاتوژنز'
2026-01-01 12:13:49,332 - INFO - ================================================================================
2026-01-01 12:13:49,332 - INFO -   Subchapter: 'پمفیگوئید غشاء مخاطی'
2026-01-01 12:13:49,332 - INFO -   Topic: 'پاتوژنز'
2026-01-01 12:13:49,332 - INFO -   Total Stage J records: 888
2026-01-01 12:13:49,332 - INFO - Loading Word document for Topic 12/21...
2026-01-01 12:13:49,342 - INFO - Successfully read Word file using python-docx: /home/shahmir/Downloads/راهنمای_پایپ_لاین_ارتقا_و_بورد_پوست.docx (2737 chars)
2026-01-01 12:13:49,342 - INFO - Processing Stage V - Step 1 for Topic 12/21 (full file)...
2026-01-01 12:15:23,823 - INFO - Text processed successfully with gemini-2.5-pro
2026-01-01 12:15:23,824 - INFO - Step 1 response received for Topic 12 (10488 characters)
2026-01-01 12:15:23,825 - INFO - Saved raw model responses to: /media/shahmir/Shahmir/ee/a105003_stage_v_step1_topic_12_پاتوژنز.txt
2026-01-01 12:15:23,826 - INFO - Extracting JSON from Part 1 response...
2026-01-01 12:15:23,826 - INFO - Successfully extracted JSON from response
2026-01-01 12:15:23,826 - INFO - Extracted 11 questions from Part 1
2026-01-01 12:15:23,827 - INFO - Total questions generated in Step 1 for Topic 12: 11
2026-01-01 12:15:23,829 - INFO - Successfully saved JSON: /media/shahmir/Shahmir/ee/a105003_stage_v_step1_topic_12_پاتوژنز.json (11 records)
2026-01-01 12:15:23,829 - INFO - Step 1 output saved to: /media/shahmir/Shahmir/ee/a105003_stage_v_step1_topic_12_پاتوژنز.json
2026-01-01 12:15:23,830 - INFO - Step 1 completed for Topic 'پاتوژنز': /media/shahmir/Shahmir/ee/a105003_stage_v_step1_topic_12_پاتوژنز.json
2026-01-01 12:15:23,830 - INFO -   ✓ Step 1 completed for Topic 'پاتوژنز'
2026-01-01 12:15:23,830 - INFO - [13/21] Processing Step 1 for Topic 'ویژگی‌های بالینی' (Subchapter: 'پمفیگوئید غشاء مخاطی')...
2026-01-01 12:15:23,831 - INFO - 
2026-01-01 12:15:23,831 - INFO - ================================================================================
2026-01-01 12:15:23,831 - INFO - PROCESSING TOPIC 13/21: 'ویژگی‌های بالینی'
2026-01-01 12:15:23,831 - INFO - ================================================================================
2026-01-01 12:15:23,831 - INFO -   Subchapter: 'پمفیگوئید غشاء مخاطی'
2026-01-01 12:15:23,831 - INFO -   Topic: 'ویژگی‌های بالینی'
2026-01-01 12:15:23,832 - INFO -   Total Stage J records: 888
2026-01-01 12:15:23,832 - INFO - Loading Word document for Topic 13/21...
2026-01-01 12:15:23,855 - INFO - Successfully read Word file using python-docx: /home/shahmir/Downloads/راهنمای_پایپ_لاین_ارتقا_و_بورد_پوست.docx (2737 chars)
2026-01-01 12:15:23,856 - INFO - Processing Stage V - Step 1 for Topic 13/21 (full file)...
2026-01-01 12:16:26,105 - INFO - Text processed successfully with gemini-2.5-pro
2026-01-01 12:16:26,106 - INFO - Step 1 response received for Topic 13 (5637 characters)
2026-01-01 12:16:26,107 - INFO - Saved raw model responses to: /media/shahmir/Shahmir/ee/a105003_stage_v_step1_topic_13_ویژگیهای_بالینی.txt
2026-01-01 12:16:26,108 - INFO - Extracting JSON from Part 1 response...
2026-01-01 12:16:26,108 - INFO - Successfully extracted JSON from response
2026-01-01 12:16:26,109 - INFO - Extracted 5 questions from Part 1
2026-01-01 12:16:26,110 - INFO - Total questions generated in Step 1 for Topic 13: 5
2026-01-01 12:16:26,111 - INFO - Successfully saved JSON: /media/shahmir/Shahmir/ee/a105003_stage_v_step1_topic_13_ویژگیهای_بالینی.json (5 records)
2026-01-01 12:16:26,111 - INFO - Step 1 output saved to: /media/shahmir/Shahmir/ee/a105003_stage_v_step1_topic_13_ویژگیهای_بالینی.json
2026-01-01 12:16:26,111 - INFO - Step 1 completed for Topic 'ویژگی‌های بالینی': /media/shahmir/Shahmir/ee/a105003_stage_v_step1_topic_13_ویژگیهای_بالینی.json
2026-01-01 12:16:26,111 - INFO -   ✓ Step 1 completed for Topic 'ویژگی‌های بالینی'
2026-01-01 12:16:26,111 - INFO - [14/21] Processing Step 1 for Topic 'تشخیص و تشخیص افتراقی' (Subchapter: 'پمفیگوئید غشاء مخاطی')...
2026-01-01 12:16:26,111 - INFO - 
2026-01-01 12:16:26,111 - INFO - ================================================================================
2026-01-01 12:16:26,111 - INFO - PROCESSING TOPIC 14/21: 'تشخیص و تشخیص افتراقی'
2026-01-01 12:16:26,112 - INFO - ================================================================================
2026-01-01 12:16:26,112 - INFO -   Subchapter: 'پمفیگوئید غشاء مخاطی'
2026-01-01 12:16:26,112 - INFO -   Topic: 'تشخیص و تشخیص افتراقی'
2026-01-01 12:16:26,112 - INFO -   Total Stage J records: 888
2026-01-01 12:16:26,112 - INFO - Loading Word document for Topic 14/21...
2026-01-01 12:16:26,121 - INFO - Successfully read Word file using python-docx: /home/shahmir/Downloads/راهنمای_پایپ_لاین_ارتقا_و_بورد_پوست.docx (2737 chars)
2026-01-01 12:16:26,122 - INFO - Processing Stage V - Step 1 for Topic 14/21 (full file)...
2026-01-01 12:17:29,047 - INFO - Text processed successfully with gemini-2.5-pro
2026-01-01 12:17:29,048 - INFO - Step 1 response received for Topic 14 (5526 characters)
2026-01-01 12:17:29,049 - INFO - Saved raw model responses to: /media/shahmir/Shahmir/ee/a105003_stage_v_step1_topic_14_تشخیص_و_تشخیص_افتراقی.txt
2026-01-01 12:17:29,050 - INFO - Extracting JSON from Part 1 response...
2026-01-01 12:17:29,050 - INFO - Successfully extracted JSON from response
2026-01-01 12:17:29,051 - INFO - Extracted 5 questions from Part 1
2026-01-01 12:17:29,051 - INFO - Total questions generated in Step 1 for Topic 14: 5
2026-01-01 12:17:29,052 - INFO - Successfully saved JSON: /media/shahmir/Shahmir/ee/a105003_stage_v_step1_topic_14_تشخیص_و_تشخیص_افتراقی.json (5 records)
2026-01-01 12:17:29,053 - INFO - Step 1 output saved to: /media/shahmir/Shahmir/ee/a105003_stage_v_step1_topic_14_تشخیص_و_تشخیص_افتراقی.json
2026-01-01 12:17:29,053 - INFO - Step 1 completed for Topic 'تشخیص و تشخیص افتراقی': /media/shahmir/Shahmir/ee/a105003_stage_v_step1_topic_14_تشخیص_و_تشخیص_افتراقی.json
2026-01-01 12:17:29,054 - INFO -   ✓ Step 1 completed for Topic 'تشخیص و تشخیص افتراقی'
2026-01-01 12:17:29,055 - INFO - [15/21] Processing Step 1 for Topic 'پیش‌آگهی' (Subchapter: 'پمفیگوئید غشاء مخاطی')...
2026-01-01 12:17:29,056 - INFO - 
2026-01-01 12:17:29,056 - INFO - ================================================================================
2026-01-01 12:17:29,056 - INFO - PROCESSING TOPIC 15/21: 'پیش‌آگهی'
2026-01-01 12:17:29,056 - INFO - ================================================================================
2026-01-01 12:17:29,057 - INFO -   Subchapter: 'پمفیگوئید غشاء مخاطی'
2026-01-01 12:17:29,057 - INFO -   Topic: 'پیش‌آگهی'
2026-01-01 12:17:29,057 - INFO -   Total Stage J records: 888
2026-01-01 12:17:29,057 - INFO - Loading Word document for Topic 15/21...
2026-01-01 12:17:29,078 - INFO - Successfully read Word file using python-docx: /home/shahmir/Downloads/راهنمای_پایپ_لاین_ارتقا_و_بورد_پوست.docx (2737 chars)
2026-01-01 12:17:29,078 - INFO - Processing Stage V - Step 1 for Topic 15/21 (full file)...
2026-01-01 12:19:19,296 - INFO - Text processed successfully with gemini-2.5-pro
2026-01-01 12:19:19,297 - INFO - Step 1 response received for Topic 15 (7530 characters)
2026-01-01 12:19:19,299 - INFO - Saved raw model responses to: /media/shahmir/Shahmir/ee/a105003_stage_v_step1_topic_15_پیشآگهی.txt
2026-01-01 12:19:19,300 - INFO - Extracting JSON from Part 1 response...
2026-01-01 12:19:19,301 - INFO - Successfully extracted JSON from response
2026-01-01 12:19:19,302 - INFO - Extracted 7 questions from Part 1
2026-01-01 12:19:19,303 - INFO - Total questions generated in Step 1 for Topic 15: 7
2026-01-01 12:19:19,305 - INFO - Successfully saved JSON: /media/shahmir/Shahmir/ee/a105003_stage_v_step1_topic_15_پیشآگهی.json (7 records)
2026-01-01 12:19:19,305 - INFO - Step 1 output saved to: /media/shahmir/Shahmir/ee/a105003_stage_v_step1_topic_15_پیشآگهی.json
2026-01-01 12:19:19,306 - INFO - Step 1 completed for Topic 'پیش‌آگهی': /media/shahmir/Shahmir/ee/a105003_stage_v_step1_topic_15_پیشآگهی.json
2026-01-01 12:19:19,306 - INFO -   ✓ Step 1 completed for Topic 'پیش‌آگهی'
2026-01-01 12:19:19,307 - INFO - [16/21] Processing Step 1 for Topic 'درمان' (Subchapter: 'پمفیگوئید غشاء مخاطی')...
2026-01-01 12:19:19,307 - INFO - 
2026-01-01 12:19:19,308 - INFO - ================================================================================
2026-01-01 12:19:19,308 - INFO - PROCESSING TOPIC 16/21: 'درمان'
2026-01-01 12:19:19,308 - INFO - ================================================================================
2026-01-01 12:19:19,309 - INFO -   Subchapter: 'پمفیگوئید غشاء مخاطی'
2026-01-01 12:19:19,309 - INFO -   Topic: 'درمان'
2026-01-01 12:19:19,309 - INFO -   Total Stage J records: 888
2026-01-01 12:19:19,310 - INFO - Loading Word document for Topic 16/21...
2026-01-01 12:19:19,338 - INFO - Successfully read Word file using python-docx: /home/shahmir/Downloads/راهنمای_پایپ_لاین_ارتقا_و_بورد_پوست.docx (2737 chars)
2026-01-01 12:19:19,339 - INFO - Processing Stage V - Step 1 for Topic 16/21 (full file)...
2026-01-01 12:20:10,725 - INFO - Text processed successfully with gemini-2.5-pro
2026-01-01 12:20:10,725 - INFO - Step 1 response received for Topic 16 (4213 characters)
2026-01-01 12:20:10,727 - INFO - Saved raw model responses to: /media/shahmir/Shahmir/ee/a105003_stage_v_step1_topic_16_درمان.txt
2026-01-01 12:20:10,727 - INFO - Extracting JSON from Part 1 response...
2026-01-01 12:20:10,727 - INFO - Successfully extracted JSON from response
2026-01-01 12:20:10,728 - INFO - Extracted 4 questions from Part 1
2026-01-01 12:20:10,728 - INFO - Total questions generated in Step 1 for Topic 16: 4
2026-01-01 12:20:10,729 - INFO - Successfully saved JSON: /media/shahmir/Shahmir/ee/a105003_stage_v_step1_topic_16_درمان.json (4 records)
2026-01-01 12:20:10,730 - INFO - Step 1 output saved to: /media/shahmir/Shahmir/ee/a105003_stage_v_step1_topic_16_درمان.json
2026-01-01 12:20:10,731 - INFO - Step 1 completed for Topic 'درمان': /media/shahmir/Shahmir/ee/a105003_stage_v_step1_topic_16_درمان.json
2026-01-01 12:20:10,731 - INFO -   ✓ Step 1 completed for Topic 'درمان'
2026-01-01 12:20:10,732 - INFO - [17/21] Processing Step 1 for Topic 'مقدمه، تاریخچه و اپیدمیولوژی' (Subchapter: 'اپیدرمولیز بولوزا اکتسابی')...
2026-01-01 12:20:10,732 - INFO - 
2026-01-01 12:20:10,732 - INFO - ================================================================================
2026-01-01 12:20:10,733 - INFO - PROCESSING TOPIC 17/21: 'مقدمه، تاریخچه و اپیدمیولوژی'
2026-01-01 12:20:10,733 - INFO - ================================================================================
2026-01-01 12:20:10,733 - INFO -   Subchapter: 'اپیدرمولیز بولوزا اکتسابی'
2026-01-01 12:20:10,734 - INFO -   Topic: 'مقدمه، تاریخچه و اپیدمیولوژی'
2026-01-01 12:20:10,734 - INFO -   Total Stage J records: 888
2026-01-01 12:20:10,734 - INFO - Loading Word document for Topic 17/21...
2026-01-01 12:20:10,755 - INFO - Successfully read Word file using python-docx: /home/shahmir/Downloads/راهنمای_پایپ_لاین_ارتقا_و_بورد_پوست.docx (2737 chars)
2026-01-01 12:20:10,755 - INFO - Processing Stage V - Step 1 for Topic 17/21 (full file)...
2026-01-01 12:21:16,383 - INFO - Text processed successfully with gemini-2.5-pro
2026-01-01 12:21:16,383 - INFO - Step 1 response received for Topic 17 (5030 characters)
2026-01-01 12:21:16,384 - INFO - Saved raw model responses to: /media/shahmir/Shahmir/ee/a105003_stage_v_step1_topic_17_مقدمه_تاریخچه_و_اپیدمیولوژی.txt
2026-01-01 12:21:16,384 - INFO - Extracting JSON from Part 1 response...
2026-01-01 12:21:16,384 - INFO - Successfully extracted JSON from response
2026-01-01 12:21:16,384 - INFO - Extracted 4 questions from Part 1
2026-01-01 12:21:16,385 - INFO - Total questions generated in Step 1 for Topic 17: 4
2026-01-01 12:21:16,385 - INFO - Successfully saved JSON: /media/shahmir/Shahmir/ee/a105003_stage_v_step1_topic_17_مقدمه_تاریخچه_و_اپیدمیولوژی.json (4 records)
2026-01-01 12:21:16,385 - INFO - Step 1 output saved to: /media/shahmir/Shahmir/ee/a105003_stage_v_step1_topic_17_مقدمه_تاریخچه_و_اپیدمیولوژی.json
2026-01-01 12:21:16,385 - INFO - Step 1 completed for Topic 'مقدمه، تاریخچه و اپیدمیولوژی': /media/shahmir/Shahmir/ee/a105003_stage_v_step1_topic_17_مقدمه_تاریخچه_و_اپیدمیولوژی.json
2026-01-01 12:21:16,385 - INFO -   ✓ Step 1 completed for Topic 'مقدمه، تاریخچه و اپیدمیولوژی'
2026-01-01 12:21:16,385 - INFO - [18/21] Processing Step 1 for Topic 'پاتوژنز' (Subchapter: 'اپیدرمولیز بولوزا اکتسابی')...
2026-01-01 12:21:16,385 - INFO - 
2026-01-01 12:21:16,386 - INFO - ================================================================================
2026-01-01 12:21:16,386 - INFO - PROCESSING TOPIC 18/21: 'پاتوژنز'
2026-01-01 12:21:16,386 - INFO - ================================================================================
2026-01-01 12:21:16,386 - INFO -   Subchapter: 'اپیدرمولیز بولوزا اکتسابی'
2026-01-01 12:21:16,386 - INFO -   Topic: 'پاتوژنز'
2026-01-01 12:21:16,386 - INFO -   Total Stage J records: 888
2026-01-01 12:21:16,386 - INFO - Loading Word document for Topic 18/21...
2026-01-01 12:21:16,396 - INFO - Successfully read Word file using python-docx: /home/shahmir/Downloads/راهنمای_پایپ_لاین_ارتقا_و_بورد_پوست.docx (2737 chars)
2026-01-01 12:21:16,397 - INFO - Processing Stage V - Step 1 for Topic 18/21 (full file)...
2026-01-01 12:22:29,478 - INFO - Text processed successfully with gemini-2.5-pro
2026-01-01 12:22:29,478 - INFO - Step 1 response received for Topic 18 (6005 characters)
2026-01-01 12:22:29,479 - INFO - Saved raw model responses to: /media/shahmir/Shahmir/ee/a105003_stage_v_step1_topic_18_پاتوژنز.txt
2026-01-01 12:22:29,479 - INFO - Extracting JSON from Part 1 response...
2026-01-01 12:22:29,479 - INFO - Successfully extracted JSON from response
2026-01-01 12:22:29,479 - INFO - Extracted 5 questions from Part 1
2026-01-01 12:22:29,479 - INFO - Total questions generated in Step 1 for Topic 18: 5
2026-01-01 12:22:29,480 - INFO - Successfully saved JSON: /media/shahmir/Shahmir/ee/a105003_stage_v_step1_topic_18_پاتوژنز.json (5 records)
2026-01-01 12:22:29,480 - INFO - Step 1 output saved to: /media/shahmir/Shahmir/ee/a105003_stage_v_step1_topic_18_پاتوژنز.json
2026-01-01 12:22:29,480 - INFO - Step 1 completed for Topic 'پاتوژنز': /media/shahmir/Shahmir/ee/a105003_stage_v_step1_topic_18_پاتوژنز.json
2026-01-01 12:22:29,480 - INFO -   ✓ Step 1 completed for Topic 'پاتوژنز'
2026-01-01 12:22:29,480 - INFO - [19/21] Processing Step 1 for Topic 'ویژگی‌های بالینی' (Subchapter: 'اپیدرمولیز بولوزا اکتسابی')...
2026-01-01 12:22:29,480 - INFO - 
2026-01-01 12:22:29,480 - INFO - ================================================================================
2026-01-01 12:22:29,480 - INFO - PROCESSING TOPIC 19/21: 'ویژگی‌های بالینی'
2026-01-01 12:22:29,481 - INFO - ================================================================================
2026-01-01 12:22:29,481 - INFO -   Subchapter: 'اپیدرمولیز بولوزا اکتسابی'
2026-01-01 12:22:29,481 - INFO -   Topic: 'ویژگی‌های بالینی'
2026-01-01 12:22:29,481 - INFO -   Total Stage J records: 888
2026-01-01 12:22:29,481 - INFO - Loading Word document for Topic 19/21...
2026-01-01 12:22:29,490 - INFO - Successfully read Word file using python-docx: /home/shahmir/Downloads/راهنمای_پایپ_لاین_ارتقا_و_بورد_پوست.docx (2737 chars)
2026-01-01 12:22:29,490 - INFO - Processing Stage V - Step 1 for Topic 19/21 (full file)...
2026-01-01 12:23:30,757 - INFO - Text processed successfully with gemini-2.5-pro
2026-01-01 12:23:30,759 - INFO - Step 1 response received for Topic 19 (5880 characters)
2026-01-01 12:23:30,761 - INFO - Saved raw model responses to: /media/shahmir/Shahmir/ee/a105003_stage_v_step1_topic_19_ویژگیهای_بالینی.txt
2026-01-01 12:23:30,762 - INFO - Extracting JSON from Part 1 response...
2026-01-01 12:23:30,762 - INFO - Successfully extracted JSON from response
2026-01-01 12:23:30,763 - INFO - Extracted 5 questions from Part 1
2026-01-01 12:23:30,763 - INFO - Total questions generated in Step 1 for Topic 19: 5
2026-01-01 12:23:30,764 - INFO - Successfully saved JSON: /media/shahmir/Shahmir/ee/a105003_stage_v_step1_topic_19_ویژگیهای_بالینی.json (5 records)
2026-01-01 12:23:30,764 - INFO - Step 1 output saved to: /media/shahmir/Shahmir/ee/a105003_stage_v_step1_topic_19_ویژگیهای_بالینی.json
2026-01-01 12:23:30,765 - INFO - Step 1 completed for Topic 'ویژگی‌های بالینی': /media/shahmir/Shahmir/ee/a105003_stage_v_step1_topic_19_ویژگیهای_بالینی.json
2026-01-01 12:23:30,766 - INFO -   ✓ Step 1 completed for Topic 'ویژگی‌های بالینی'
2026-01-01 12:23:30,766 - INFO - [20/21] Processing Step 1 for Topic 'تشخیص و تشخیص افتراقی' (Subchapter: 'اپیدرمولیز بولوزا اکتسابی')...
2026-01-01 12:23:30,766 - INFO - 
2026-01-01 12:23:30,766 - INFO - ================================================================================
2026-01-01 12:23:30,766 - INFO - PROCESSING TOPIC 20/21: 'تشخیص و تشخیص افتراقی'
2026-01-01 12:23:30,767 - INFO - ================================================================================
2026-01-01 12:23:30,767 - INFO -   Subchapter: 'اپیدرمولیز بولوزا اکتسابی'
2026-01-01 12:23:30,767 - INFO -   Topic: 'تشخیص و تشخیص افتراقی'
2026-01-01 12:23:30,767 - INFO -   Total Stage J records: 888
2026-01-01 12:23:30,767 - INFO - Loading Word document for Topic 20/21...
2026-01-01 12:23:30,789 - INFO - Successfully read Word file using python-docx: /home/shahmir/Downloads/راهنمای_پایپ_لاین_ارتقا_و_بورد_پوست.docx (2737 chars)
2026-01-01 12:23:30,789 - INFO - Processing Stage V - Step 1 for Topic 20/21 (full file)...
2026-01-01 12:24:36,284 - INFO - Text processed successfully with gemini-2.5-pro
2026-01-01 12:24:36,284 - INFO - Step 1 response received for Topic 20 (6515 characters)
2026-01-01 12:24:36,286 - INFO - Saved raw model responses to: /media/shahmir/Shahmir/ee/a105003_stage_v_step1_topic_20_تشخیص_و_تشخیص_افتراقی.txt
2026-01-01 12:24:36,287 - INFO - Extracting JSON from Part 1 response...
2026-01-01 12:24:36,287 - INFO - Successfully extracted JSON from response
2026-01-01 12:24:36,287 - INFO - Extracted 6 questions from Part 1
2026-01-01 12:24:36,288 - INFO - Total questions generated in Step 1 for Topic 20: 6
2026-01-01 12:24:36,289 - INFO - Successfully saved JSON: /media/shahmir/Shahmir/ee/a105003_stage_v_step1_topic_20_تشخیص_و_تشخیص_افتراقی.json (6 records)
2026-01-01 12:24:36,290 - INFO - Step 1 output saved to: /media/shahmir/Shahmir/ee/a105003_stage_v_step1_topic_20_تشخیص_و_تشخیص_افتراقی.json
2026-01-01 12:24:36,290 - INFO - Step 1 completed for Topic 'تشخیص و تشخیص افتراقی': /media/shahmir/Shahmir/ee/a105003_stage_v_step1_topic_20_تشخیص_و_تشخیص_افتراقی.json
2026-01-01 12:24:36,291 - INFO -   ✓ Step 1 completed for Topic 'تشخیص و تشخیص افتراقی'
2026-01-01 12:24:36,291 - INFO - [21/21] Processing Step 1 for Topic 'درمان' (Subchapter: 'اپیدرمولیز بولوزا اکتسابی')...
2026-01-01 12:24:36,291 - INFO - 
2026-01-01 12:24:36,292 - INFO - ================================================================================
2026-01-01 12:24:36,292 - INFO - PROCESSING TOPIC 21/21: 'درمان'
2026-01-01 12:24:36,292 - INFO - ================================================================================
2026-01-01 12:24:36,292 - INFO -   Subchapter: 'اپیدرمولیز بولوزا اکتسابی'
2026-01-01 12:24:36,292 - INFO -   Topic: 'درمان'
2026-01-01 12:24:36,293 - INFO -   Total Stage J records: 888
2026-01-01 12:24:36,293 - INFO - Loading Word document for Topic 21/21...
2026-01-01 12:24:36,316 - INFO - Successfully read Word file using python-docx: /home/shahmir/Downloads/راهنمای_پایپ_لاین_ارتقا_و_بورد_پوست.docx (2737 chars)
2026-01-01 12:24:36,316 - INFO - Processing Stage V - Step 1 for Topic 21/21 (full file)...
2026-01-01 12:25:32,855 - INFO - Text processed successfully with gemini-2.5-pro
2026-01-01 12:25:32,856 - INFO - Step 1 response received for Topic 21 (4642 characters)
2026-01-01 12:25:32,857 - INFO - Saved raw model responses to: /media/shahmir/Shahmir/ee/a105003_stage_v_step1_topic_21_درمان.txt
2026-01-01 12:25:32,858 - INFO - Extracting JSON from Part 1 response...
2026-01-01 12:25:32,859 - INFO - Successfully extracted JSON from response
2026-01-01 12:25:32,860 - INFO - Extracted 4 questions from Part 1
2026-01-01 12:25:32,861 - INFO - Total questions generated in Step 1 for Topic 21: 4
2026-01-01 12:25:32,861 - INFO - Successfully saved JSON: /media/shahmir/Shahmir/ee/a105003_stage_v_step1_topic_21_درمان.json (4 records)
2026-01-01 12:25:32,862 - INFO - Step 1 output saved to: /media/shahmir/Shahmir/ee/a105003_stage_v_step1_topic_21_درمان.json
2026-01-01 12:25:32,863 - INFO - Step 1 completed for Topic 'درمان': /media/shahmir/Shahmir/ee/a105003_stage_v_step1_topic_21_درمان.json
2026-01-01 12:25:32,863 - INFO -   ✓ Step 1 completed for Topic 'درمان'
2026-01-01 12:25:32,863 - INFO - Combining Step 1 outputs from all topics...
2026-01-01 12:25:32,864 - INFO - Combining Step 1 outputs from 21 topics...
2026-01-01 12:25:32,864 - INFO - Successfully loaded JSON: /media/shahmir/Shahmir/ee/a105003_stage_v_step1_topic_1_مقدمه_و_تاریخچه.json
2026-01-01 12:25:32,864 - INFO -   Added 9 questions from Topic 'مقدمه و تاریخچه' (Subchapter: 'پمفیگوئید بولوز')
2026-01-01 12:25:32,865 - INFO - Successfully loaded JSON: /media/shahmir/Shahmir/ee/a105003_stage_v_step1_topic_2_اپیدمیولوژی.json
2026-01-01 12:25:32,865 - INFO -   Added 12 questions from Topic 'اپیدمیولوژی' (Subchapter: 'پمفیگوئید بولوز')
2026-01-01 12:25:32,866 - INFO - Successfully loaded JSON: /media/shahmir/Shahmir/ee/a105003_stage_v_step1_topic_3_پاتوژنز.json
2026-01-01 12:25:32,866 - INFO -   Added 5 questions from Topic 'پاتوژنز' (Subchapter: 'پمفیگوئید بولوز')
2026-01-01 12:25:32,866 - INFO - Successfully loaded JSON: /media/shahmir/Shahmir/ee/a105003_stage_v_step1_topic_4_ویژگیهای_بالینی.json
2026-01-01 12:25:32,866 - INFO -   Added 6 questions from Topic 'ویژگی‌های بالینی' (Subchapter: 'پمفیگوئید بولوز')
2026-01-01 12:25:32,866 - INFO - Successfully loaded JSON: /media/shahmir/Shahmir/ee/a105003_stage_v_step1_topic_5_بیماریهای_همراه.json
2026-01-01 12:25:32,867 - INFO -   Added 6 questions from Topic 'بیماری‌های همراه' (Subchapter: 'پمفیگوئید بولوز')
2026-01-01 12:25:32,867 - INFO - Successfully loaded JSON: /media/shahmir/Shahmir/ee/a105003_stage_v_step1_topic_6_تشخیص.json
2026-01-01 12:25:32,867 - INFO -   Added 5 questions from Topic 'تشخیص' (Subchapter: 'پمفیگوئید بولوز')
2026-01-01 12:25:32,868 - INFO - Successfully loaded JSON: /media/shahmir/Shahmir/ee/a105003_stage_v_step1_topic_7_تشخیص_افتراقی.json
2026-01-01 12:25:32,868 - INFO -   Added 6 questions from Topic 'تشخیص افتراقی' (Subchapter: 'پمفیگوئید بولوز')
2026-01-01 12:25:32,869 - INFO - Successfully loaded JSON: /media/shahmir/Shahmir/ee/a105003_stage_v_step1_topic_8_پروگنوز_و_پایش.json
2026-01-01 12:25:32,869 - INFO -   Added 3 questions from Topic 'پروگنوز و پایش' (Subchapter: 'پمفیگوئید بولوز')
2026-01-01 12:25:32,869 - INFO - Successfully loaded JSON: /media/shahmir/Shahmir/ee/a105003_stage_v_step1_topic_9_درمان.json
2026-01-01 12:25:32,870 - INFO -   Added 4 questions from Topic 'درمان' (Subchapter: 'پمفیگوئید بولوز')
2026-01-01 12:25:32,870 - INFO - Successfully loaded JSON: /media/shahmir/Shahmir/ee/a105003_stage_v_step1_topic_10_مقدمه.json
2026-01-01 12:25:32,870 - INFO -   Added 10 questions from Topic 'مقدمه' (Subchapter: 'پمفیگوئید غشاء مخاطی')
2026-01-01 12:25:32,871 - INFO - Successfully loaded JSON: /media/shahmir/Shahmir/ee/a105003_stage_v_step1_topic_11_تاریخچه_و_اپیدمیولوژی.json
2026-01-01 12:25:32,871 - INFO -   Added 3 questions from Topic 'تاریخچه و اپیدمیولوژی' (Subchapter: 'پمفیگوئید غشاء مخاطی')
2026-01-01 12:25:32,872 - INFO - Successfully loaded JSON: /media/shahmir/Shahmir/ee/a105003_stage_v_step1_topic_12_پاتوژنز.json
2026-01-01 12:25:32,872 - INFO -   Added 11 questions from Topic 'پاتوژنز' (Subchapter: 'پمفیگوئید غشاء مخاطی')
2026-01-01 12:25:32,872 - INFO - Successfully loaded JSON: /media/shahmir/Shahmir/ee/a105003_stage_v_step1_topic_13_ویژگیهای_بالینی.json
2026-01-01 12:25:32,873 - INFO -   Added 5 questions from Topic 'ویژگی‌های بالینی' (Subchapter: 'پمفیگوئید غشاء مخاطی')
2026-01-01 12:25:32,873 - INFO - Successfully loaded JSON: /media/shahmir/Shahmir/ee/a105003_stage_v_step1_topic_14_تشخیص_و_تشخیص_افتراقی.json
2026-01-01 12:25:32,873 - INFO -   Added 5 questions from Topic 'تشخیص و تشخیص افتراقی' (Subchapter: 'پمفیگوئید غشاء مخاطی')
2026-01-01 12:25:32,874 - INFO - Successfully loaded JSON: /media/shahmir/Shahmir/ee/a105003_stage_v_step1_topic_15_پیشآگهی.json
2026-01-01 12:25:32,874 - INFO -   Added 7 questions from Topic 'پیش‌آگهی' (Subchapter: 'پمفیگوئید غشاء مخاطی')
2026-01-01 12:25:32,874 - INFO - Successfully loaded JSON: /media/shahmir/Shahmir/ee/a105003_stage_v_step1_topic_16_درمان.json
2026-01-01 12:25:32,875 - INFO -   Added 4 questions from Topic 'درمان' (Subchapter: 'پمفیگوئید غشاء مخاطی')
2026-01-01 12:25:32,875 - INFO - Successfully loaded JSON: /media/shahmir/Shahmir/ee/a105003_stage_v_step1_topic_17_مقدمه_تاریخچه_و_اپیدمیولوژی.json
2026-01-01 12:25:32,875 - INFO -   Added 4 questions from Topic 'مقدمه، تاریخچه و اپیدمیولوژی' (Subchapter: 'اپیدرمولیز بولوزا اکتسابی')
2026-01-01 12:25:32,875 - INFO - Successfully loaded JSON: /media/shahmir/Shahmir/ee/a105003_stage_v_step1_topic_18_پاتوژنز.json
2026-01-01 12:25:32,875 - INFO -   Added 5 questions from Topic 'پاتوژنز' (Subchapter: 'اپیدرمولیز بولوزا اکتسابی')
2026-01-01 12:25:32,876 - INFO - Successfully loaded JSON: /media/shahmir/Shahmir/ee/a105003_stage_v_step1_topic_19_ویژگیهای_بالینی.json
2026-01-01 12:25:32,876 - INFO -   Added 5 questions from Topic 'ویژگی‌های بالینی' (Subchapter: 'اپیدرمولیز بولوزا اکتسابی')
2026-01-01 12:25:32,876 - INFO - Successfully loaded JSON: /media/shahmir/Shahmir/ee/a105003_stage_v_step1_topic_20_تشخیص_و_تشخیص_افتراقی.json
2026-01-01 12:25:32,876 - INFO -   Added 6 questions from Topic 'تشخیص و تشخیص افتراقی' (Subchapter: 'اپیدرمولیز بولوزا اکتسابی')
2026-01-01 12:25:32,876 - INFO - Successfully loaded JSON: /media/shahmir/Shahmir/ee/a105003_stage_v_step1_topic_21_درمان.json
2026-01-01 12:25:32,877 - INFO -   Added 4 questions from Topic 'درمان' (Subchapter: 'اپیدرمولیز بولوزا اکتسابی')
2026-01-01 12:25:32,881 - INFO - Step 1 combined output saved to: /media/shahmir/Shahmir/ee/step1_combined_105003.json
2026-01-01 12:25:32,881 - INFO - ============================================================
2026-01-01 12:25:32,881 - INFO - STEP 2: Refining questions and adding QId (per Topic, with full Stage J)...
2026-01-01 12:25:32,882 - INFO - ============================================================
2026-01-01 12:25:32,882 - INFO - [1/21] Processing Step 2 for Topic 'مقدمه و تاریخچه' (Subchapter: 'پمفیگوئید بولوز')...
2026-01-01 12:25:32,882 - INFO - 
2026-01-01 12:25:32,882 - INFO - ================================================================================
2026-01-01 12:25:32,882 - INFO - PROCESSING TOPIC 1/21: 'مقدمه و تاریخچه'
2026-01-01 12:25:32,883 - INFO - ================================================================================
2026-01-01 12:25:32,883 - INFO -   Subchapter: 'پمفیگوئید بولوز'
2026-01-01 12:25:32,883 - INFO -   Topic: 'مقدمه و تاریخچه'
2026-01-01 12:25:32,883 - INFO -   Total Stage J records: 888
2026-01-01 12:25:32,883 - INFO - Loading Word document for Topic 1/21...
2026-01-01 12:25:32,893 - INFO - Successfully read Word file using python-docx: /home/shahmir/Downloads/راهنمای_پایپ_لاین_ارتقا_و_بورد_پوست.docx (2737 chars)
2026-01-01 12:25:32,893 - INFO - Loading Step 1 output...
2026-01-01 12:25:32,893 - INFO - Successfully loaded JSON: /media/shahmir/Shahmir/ee/a105003_stage_v_step1_topic_1_مقدمه_و_تاریخچه.json
2026-01-01 12:25:32,893 - INFO - Loaded 9 questions from Step 1
2026-01-01 12:25:32,894 - INFO - Processing Stage V - Step 2 for Topic 1/21 (full file)...
2026-01-01 12:27:13,843 - INFO - Text processed successfully with gemini-2.5-pro
2026-01-01 12:27:13,844 - INFO - Step 2 response received for Topic 1 (11490 characters)
2026-01-01 12:27:13,845 - INFO - Saved raw model responses to: /media/shahmir/Shahmir/ee/a105003_stage_v_step2_topic_1_مقدمه_و_تاریخچه.txt
2026-01-01 12:27:13,845 - INFO - Extracting JSON from Part 1 response...
2026-01-01 12:27:13,846 - INFO - Successfully extracted JSON from response
2026-01-01 12:27:13,847 - INFO - Extracted 9 refined questions from Part 1
2026-01-01 12:27:13,847 - INFO - Total refined questions from Step 2 for Topic 1: 9
2026-01-01 12:27:13,848 - INFO - Total combined questions (Step 1 + Step 2) for Topic 1: 18
2026-01-01 12:27:13,849 - INFO - Adding QId to all questions for Topic 1 (starting from QId counter 1)...
2026-01-01 12:27:13,849 - INFO - Added QId to 18 questions for Topic 1 (QId range: 1 to 18)
2026-01-01 12:27:13,853 - INFO - Successfully saved JSON: /media/shahmir/Shahmir/ee/a105003_stage_v_step2_topic_1_مقدمه_و_تاریخچه.json (18 records)
2026-01-01 12:27:13,854 - INFO - Step 2 output saved to: /media/shahmir/Shahmir/ee/a105003_stage_v_step2_topic_1_مقدمه_و_تاریخچه.json
2026-01-01 12:27:13,855 - INFO - Step 2 completed for Topic 'مقدمه و تاریخچه': /media/shahmir/Shahmir/ee/a105003_stage_v_step2_topic_1_مقدمه_و_تاریخچه.json
2026-01-01 12:27:13,856 - INFO -   ✓ Step 2 completed for Topic 'مقدمه و تاریخچه' (18 questions, QId range: 1 to 18)
2026-01-01 12:27:13,857 - INFO - [2/21] Processing Step 2 for Topic 'اپیدمیولوژی' (Subchapter: 'پمفیگوئید بولوز')...
2026-01-01 12:27:13,857 - INFO - 
2026-01-01 12:27:13,857 - INFO - ================================================================================
2026-01-01 12:27:13,857 - INFO - PROCESSING TOPIC 2/21: 'اپیدمیولوژی'
2026-01-01 12:27:13,857 - INFO - ================================================================================
2026-01-01 12:27:13,858 - INFO -   Subchapter: 'پمفیگوئید بولوز'
2026-01-01 12:27:13,858 - INFO -   Topic: 'اپیدمیولوژی'
2026-01-01 12:27:13,858 - INFO -   Total Stage J records: 888
2026-01-01 12:27:13,859 - INFO - Loading Word document for Topic 2/21...
2026-01-01 12:27:13,894 - INFO - Successfully read Word file using python-docx: /home/shahmir/Downloads/راهنمای_پایپ_لاین_ارتقا_و_بورد_پوست.docx (2737 chars)
2026-01-01 12:27:13,894 - INFO - Loading Step 1 output...
2026-01-01 12:27:13,895 - INFO - Successfully loaded JSON: /media/shahmir/Shahmir/ee/a105003_stage_v_step1_topic_2_اپیدمیولوژی.json
2026-01-01 12:27:13,895 - INFO - Loaded 12 questions from Step 1
2026-01-01 12:27:13,895 - INFO - Processing Stage V - Step 2 for Topic 2/21 (full file)...
2026-01-01 12:28:09,114 - INFO - Text processed successfully with gemini-2.5-pro
2026-01-01 12:28:09,115 - INFO - Step 2 response received for Topic 2 (5095 characters)
2026-01-01 12:28:09,116 - INFO - Saved raw model responses to: /media/shahmir/Shahmir/ee/a105003_stage_v_step2_topic_2_اپیدمیولوژی.txt
2026-01-01 12:28:09,117 - INFO - Extracting JSON from Part 1 response...
2026-01-01 12:28:09,117 - INFO - Successfully extracted JSON from response
2026-01-01 12:28:09,117 - INFO - Extracted 4 refined questions from Part 1
2026-01-01 12:28:09,118 - INFO - Total refined questions from Step 2 for Topic 2: 4
2026-01-01 12:28:09,118 - INFO - Total combined questions (Step 1 + Step 2) for Topic 2: 16
2026-01-01 12:28:09,119 - INFO - Adding QId to all questions for Topic 2 (starting from QId counter 19)...
2026-01-01 12:28:09,119 - INFO - Added QId to 16 questions for Topic 2 (QId range: 19 to 34)
2026-01-01 12:28:09,121 - INFO - Successfully saved JSON: /media/shahmir/Shahmir/ee/a105003_stage_v_step2_topic_2_اپیدمیولوژی.json (16 records)
2026-01-01 12:28:09,122 - INFO - Step 2 output saved to: /media/shahmir/Shahmir/ee/a105003_stage_v_step2_topic_2_اپیدمیولوژی.json
2026-01-01 12:28:09,123 - INFO - Step 2 completed for Topic 'اپیدمیولوژی': /media/shahmir/Shahmir/ee/a105003_stage_v_step2_topic_2_اپیدمیولوژی.json
2026-01-01 12:28:09,123 - INFO -   ✓ Step 2 completed for Topic 'اپیدمیولوژی' (16 questions, QId range: 19 to 34)
2026-01-01 12:28:09,124 - INFO - [3/21] Processing Step 2 for Topic 'پاتوژنز' (Subchapter: 'پمفیگوئید بولوز')...
2026-01-01 12:28:09,125 - INFO - 
2026-01-01 12:28:09,125 - INFO - ================================================================================
2026-01-01 12:28:09,125 - INFO - PROCESSING TOPIC 3/21: 'پاتوژنز'
2026-01-01 12:28:09,126 - INFO - ================================================================================
2026-01-01 12:28:09,126 - INFO -   Subchapter: 'پمفیگوئید بولوز'
2026-01-01 12:28:09,126 - INFO -   Topic: 'پاتوژنز'
2026-01-01 12:28:09,127 - INFO -   Total Stage J records: 888
2026-01-01 12:28:09,128 - INFO - Loading Word document for Topic 3/21...
2026-01-01 12:28:09,158 - INFO - Successfully read Word file using python-docx: /home/shahmir/Downloads/راهنمای_پایپ_لاین_ارتقا_و_بورد_پوست.docx (2737 chars)
2026-01-01 12:28:09,159 - INFO - Loading Step 1 output...
2026-01-01 12:28:09,160 - INFO - Successfully loaded JSON: /media/shahmir/Shahmir/ee/a105003_stage_v_step1_topic_3_پاتوژنز.json
2026-01-01 12:28:09,160 - INFO - Loaded 5 questions from Step 1
2026-01-01 12:28:09,160 - INFO - Processing Stage V - Step 2 for Topic 3/21 (full file)...
2026-01-01 12:29:17,514 - INFO - Text processed successfully with gemini-2.5-pro
2026-01-01 12:29:17,515 - INFO - Step 2 response received for Topic 3 (11130 characters)
2026-01-01 12:29:17,517 - INFO - Saved raw model responses to: /media/shahmir/Shahmir/ee/a105003_stage_v_step2_topic_3_پاتوژنز.txt
2026-01-01 12:29:17,518 - INFO - Extracting JSON from Part 1 response...
2026-01-01 12:29:17,518 - INFO - Successfully extracted JSON from response
2026-01-01 12:29:17,519 - INFO - Extracted 9 refined questions from Part 1
2026-01-01 12:29:17,520 - INFO - Total refined questions from Step 2 for Topic 3: 9
2026-01-01 12:29:17,521 - INFO - Total combined questions (Step 1 + Step 2) for Topic 3: 14
2026-01-01 12:29:17,521 - INFO - Adding QId to all questions for Topic 3 (starting from QId counter 35)...
2026-01-01 12:29:17,522 - INFO - Added QId to 14 questions for Topic 3 (QId range: 35 to 48)
2026-01-01 12:29:17,525 - INFO - Successfully saved JSON: /media/shahmir/Shahmir/ee/a105003_stage_v_step2_topic_3_پاتوژنز.json (14 records)
2026-01-01 12:29:17,526 - INFO - Step 2 output saved to: /media/shahmir/Shahmir/ee/a105003_stage_v_step2_topic_3_پاتوژنز.json
2026-01-01 12:29:17,527 - INFO - Step 2 completed for Topic 'پاتوژنز': /media/shahmir/Shahmir/ee/a105003_stage_v_step2_topic_3_پاتوژنز.json
2026-01-01 12:29:17,528 - INFO -   ✓ Step 2 completed for Topic 'پاتوژنز' (14 questions, QId range: 35 to 48)
2026-01-01 12:29:17,528 - INFO - [4/21] Processing Step 2 for Topic 'ویژگی‌های بالینی' (Subchapter: 'پمفیگوئید بولوز')...
2026-01-01 12:29:17,529 - INFO - 
2026-01-01 12:29:17,529 - INFO - ================================================================================
2026-01-01 12:29:17,529 - INFO - PROCESSING TOPIC 4/21: 'ویژگی‌های بالینی'
2026-01-01 12:29:17,530 - INFO - ================================================================================
2026-01-01 12:29:17,530 - INFO -   Subchapter: 'پمفیگوئید بولوز'
2026-01-01 12:29:17,530 - INFO -   Topic: 'ویژگی‌های بالینی'
2026-01-01 12:29:17,531 - INFO -   Total Stage J records: 888
2026-01-01 12:29:17,531 - INFO - Loading Word document for Topic 4/21...
2026-01-01 12:29:17,556 - INFO - Successfully read Word file using python-docx: /home/shahmir/Downloads/راهنمای_پایپ_لاین_ارتقا_و_بورد_پوست.docx (2737 chars)
2026-01-01 12:29:17,556 - INFO - Loading Step 1 output...
2026-01-01 12:29:17,556 - INFO - Successfully loaded JSON: /media/shahmir/Shahmir/ee/a105003_stage_v_step1_topic_4_ویژگیهای_بالینی.json
2026-01-01 12:29:17,556 - INFO - Loaded 6 questions from Step 1
2026-01-01 12:29:17,557 - INFO - Processing Stage V - Step 2 for Topic 4/21 (full file)...
2026-01-01 12:30:36,345 - INFO - Text processed successfully with gemini-2.5-pro
2026-01-01 12:30:36,345 - INFO - Step 2 response received for Topic 4 (11843 characters)
2026-01-01 12:30:36,346 - INFO - Saved raw model responses to: /media/shahmir/Shahmir/ee/a105003_stage_v_step2_topic_4_ویژگیهای_بالینی.txt
2026-01-01 12:30:36,346 - INFO - Extracting JSON from Part 1 response...
2026-01-01 12:30:36,347 - INFO - Successfully extracted JSON from response
2026-01-01 12:30:36,347 - INFO - Extracted 10 refined questions from Part 1
2026-01-01 12:30:36,347 - INFO - Total refined questions from Step 2 for Topic 4: 10
2026-01-01 12:30:36,347 - INFO - Total combined questions (Step 1 + Step 2) for Topic 4: 16
2026-01-01 12:30:36,348 - INFO - Adding QId to all questions for Topic 4 (starting from QId counter 49)...
2026-01-01 12:30:36,348 - INFO - Added QId to 16 questions for Topic 4 (QId range: 49 to 64)
2026-01-01 12:30:36,349 - INFO - Successfully saved JSON: /media/shahmir/Shahmir/ee/a105003_stage_v_step2_topic_4_ویژگیهای_بالینی.json (16 records)
2026-01-01 12:30:36,349 - INFO - Step 2 output saved to: /media/shahmir/Shahmir/ee/a105003_stage_v_step2_topic_4_ویژگیهای_بالینی.json
2026-01-01 12:30:36,349 - INFO - Step 2 completed for Topic 'ویژگی‌های بالینی': /media/shahmir/Shahmir/ee/a105003_stage_v_step2_topic_4_ویژگیهای_بالینی.json
2026-01-01 12:30:36,349 - INFO -   ✓ Step 2 completed for Topic 'ویژگی‌های بالینی' (16 questions, QId range: 49 to 64)
2026-01-01 12:30:36,349 - INFO - [5/21] Processing Step 2 for Topic 'بیماری‌های همراه' (Subchapter: 'پمفیگوئید بولوز')...
2026-01-01 12:30:36,350 - INFO - 
2026-01-01 12:30:36,350 - INFO - ================================================================================
2026-01-01 12:30:36,350 - INFO - PROCESSING TOPIC 5/21: 'بیماری‌های همراه'
2026-01-01 12:30:36,350 - INFO - ================================================================================
2026-01-01 12:30:36,350 - INFO -   Subchapter: 'پمفیگوئید بولوز'
2026-01-01 12:30:36,350 - INFO -   Topic: 'بیماری‌های همراه'
2026-01-01 12:30:36,350 - INFO -   Total Stage J records: 888
2026-01-01 12:30:36,350 - INFO - Loading Word document for Topic 5/21...
2026-01-01 12:30:36,360 - INFO - Successfully read Word file using python-docx: /home/shahmir/Downloads/راهنمای_پایپ_لاین_ارتقا_و_بورد_پوست.docx (2737 chars)
2026-01-01 12:30:36,360 - INFO - Loading Step 1 output...
2026-01-01 12:30:36,360 - INFO - Successfully loaded JSON: /media/shahmir/Shahmir/ee/a105003_stage_v_step1_topic_5_بیماریهای_همراه.json
2026-01-01 12:30:36,360 - INFO - Loaded 6 questions from Step 1
2026-01-01 12:30:36,361 - INFO - Processing Stage V - Step 2 for Topic 5/21 (full file)...
2026-01-01 12:32:30,302 - INFO - Text processed successfully with gemini-2.5-pro
2026-01-01 12:32:30,303 - INFO - Step 2 response received for Topic 5 (20834 characters)
2026-01-01 12:32:30,305 - INFO - Saved raw model responses to: /media/shahmir/Shahmir/ee/a105003_stage_v_step2_topic_5_بیماریهای_همراه.txt
2026-01-01 12:32:30,306 - INFO - Extracting JSON from Part 1 response...
2026-01-01 12:32:30,307 - INFO - Successfully extracted JSON from response
2026-01-01 12:32:30,308 - INFO - Extracted 18 refined questions from Part 1
2026-01-01 12:32:30,308 - INFO - Total refined questions from Step 2 for Topic 5: 18
2026-01-01 12:32:30,309 - INFO - Total combined questions (Step 1 + Step 2) for Topic 5: 24
2026-01-01 12:32:30,310 - INFO - Adding QId to all questions for Topic 5 (starting from QId counter 65)...
2026-01-01 12:32:30,310 - INFO - Added QId to 24 questions for Topic 5 (QId range: 65 to 88)
2026-01-01 12:32:30,314 - INFO - Successfully saved JSON: /media/shahmir/Shahmir/ee/a105003_stage_v_step2_topic_5_بیماریهای_همراه.json (24 records)
2026-01-01 12:32:30,315 - INFO - Step 2 output saved to: /media/shahmir/Shahmir/ee/a105003_stage_v_step2_topic_5_بیماریهای_همراه.json
2026-01-01 12:32:30,315 - INFO - Step 2 completed for Topic 'بیماری‌های همراه': /media/shahmir/Shahmir/ee/a105003_stage_v_step2_topic_5_بیماریهای_همراه.json
2026-01-01 12:32:30,316 - INFO -   ✓ Step 2 completed for Topic 'بیماری‌های همراه' (24 questions, QId range: 65 to 88)
2026-01-01 12:32:30,317 - INFO - [6/21] Processing Step 2 for Topic 'تشخیص' (Subchapter: 'پمفیگوئید بولوز')...
2026-01-01 12:32:30,317 - INFO - 
2026-01-01 12:32:30,317 - INFO - ================================================================================
2026-01-01 12:32:30,318 - INFO - PROCESSING TOPIC 6/21: 'تشخیص'
2026-01-01 12:32:30,318 - INFO - ================================================================================
2026-01-01 12:32:30,318 - INFO -   Subchapter: 'پمفیگوئید بولوز'
2026-01-01 12:32:30,319 - INFO -   Topic: 'تشخیص'
2026-01-01 12:32:30,319 - INFO -   Total Stage J records: 888
2026-01-01 12:32:30,319 - INFO - Loading Word document for Topic 6/21...
2026-01-01 12:32:30,337 - INFO - Successfully read Word file using python-docx: /home/shahmir/Downloads/راهنمای_پایپ_لاین_ارتقا_و_بورد_پوست.docx (2737 chars)
2026-01-01 12:32:30,337 - INFO - Loading Step 1 output...
2026-01-01 12:32:30,337 - INFO - Successfully loaded JSON: /media/shahmir/Shahmir/ee/a105003_stage_v_step1_topic_6_تشخیص.json
2026-01-01 12:32:30,337 - INFO - Loaded 5 questions from Step 1
2026-01-01 12:32:30,337 - INFO - Processing Stage V - Step 2 for Topic 6/21 (full file)...
2026-01-01 12:35:01,711 - INFO - Text processed successfully with gemini-2.5-pro
2026-01-01 12:35:01,712 - INFO - Step 2 response received for Topic 6 (19512 characters)
2026-01-01 12:35:01,714 - INFO - Saved raw model responses to: /media/shahmir/Shahmir/ee/a105003_stage_v_step2_topic_6_تشخیص.txt
2026-01-01 12:35:01,715 - INFO - Extracting JSON from Part 1 response...
2026-01-01 12:35:01,716 - INFO - Successfully extracted JSON from response
2026-01-01 12:35:01,717 - INFO - Extracted 17 refined questions from Part 1
2026-01-01 12:35:01,719 - INFO - Total refined questions from Step 2 for Topic 6: 17
2026-01-01 12:35:01,719 - INFO - Total combined questions (Step 1 + Step 2) for Topic 6: 22
2026-01-01 12:35:01,722 - INFO - Adding QId to all questions for Topic 6 (starting from QId counter 89)...
2026-01-01 12:35:01,723 - INFO - Added QId to 22 questions for Topic 6 (QId range: 89 to 110)
2026-01-01 12:35:01,727 - INFO - Successfully saved JSON: /media/shahmir/Shahmir/ee/a105003_stage_v_step2_topic_6_تشخیص.json (22 records)
2026-01-01 12:35:01,727 - INFO - Step 2 output saved to: /media/shahmir/Shahmir/ee/a105003_stage_v_step2_topic_6_تشخیص.json
2026-01-01 12:35:01,727 - INFO - Step 2 completed for Topic 'تشخیص': /media/shahmir/Shahmir/ee/a105003_stage_v_step2_topic_6_تشخیص.json
2026-01-01 12:35:01,728 - INFO -   ✓ Step 2 completed for Topic 'تشخیص' (22 questions, QId range: 89 to 110)
2026-01-01 12:35:01,728 - INFO - [7/21] Processing Step 2 for Topic 'تشخیص افتراقی' (Subchapter: 'پمفیگوئید بولوز')...
2026-01-01 12:35:01,728 - INFO - 
2026-01-01 12:35:01,729 - INFO - ================================================================================
2026-01-01 12:35:01,729 - INFO - PROCESSING TOPIC 7/21: 'تشخیص افتراقی'
2026-01-01 12:35:01,729 - INFO - ================================================================================
2026-01-01 12:35:01,729 - INFO -   Subchapter: 'پمفیگوئید بولوز'
2026-01-01 12:35:01,730 - INFO -   Topic: 'تشخیص افتراقی'
2026-01-01 12:35:01,730 - INFO -   Total Stage J records: 888
2026-01-01 12:35:01,730 - INFO - Loading Word document for Topic 7/21...
2026-01-01 12:35:01,750 - INFO - Successfully read Word file using python-docx: /home/shahmir/Downloads/راهنمای_پایپ_لاین_ارتقا_و_بورد_پوست.docx (2737 chars)
2026-01-01 12:35:01,750 - INFO - Loading Step 1 output...
2026-01-01 12:35:01,750 - INFO - Successfully loaded JSON: /media/shahmir/Shahmir/ee/a105003_stage_v_step1_topic_7_تشخیص_افتراقی.json
2026-01-01 12:35:01,751 - INFO - Loaded 6 questions from Step 1
2026-01-01 12:35:01,751 - INFO - Processing Stage V - Step 2 for Topic 7/21 (full file)...
2026-01-01 12:36:33,787 - INFO - Text processed successfully with gemini-2.5-pro
2026-01-01 12:36:33,787 - INFO - Step 2 response received for Topic 7 (12027 characters)
2026-01-01 12:36:33,788 - INFO - Saved raw model responses to: /media/shahmir/Shahmir/ee/a105003_stage_v_step2_topic_7_تشخیص_افتراقی.txt
2026-01-01 12:36:33,788 - INFO - Extracting JSON from Part 1 response...
2026-01-01 12:36:33,789 - INFO - Successfully extracted JSON from response
2026-01-01 12:36:33,789 - INFO - Extracted 8 refined questions from Part 1
2026-01-01 12:36:33,789 - INFO - Total refined questions from Step 2 for Topic 7: 8
2026-01-01 12:36:33,789 - INFO - Total combined questions (Step 1 + Step 2) for Topic 7: 14
2026-01-01 12:36:33,790 - INFO - Adding QId to all questions for Topic 7 (starting from QId counter 111)...
2026-01-01 12:36:33,790 - INFO - Added QId to 14 questions for Topic 7 (QId range: 111 to 124)
2026-01-01 12:36:33,791 - INFO - Successfully saved JSON: /media/shahmir/Shahmir/ee/a105003_stage_v_step2_topic_7_تشخیص_افتراقی.json (14 records)
2026-01-01 12:36:33,791 - INFO - Step 2 output saved to: /media/shahmir/Shahmir/ee/a105003_stage_v_step2_topic_7_تشخیص_افتراقی.json
2026-01-01 12:36:33,791 - INFO - Step 2 completed for Topic 'تشخیص افتراقی': /media/shahmir/Shahmir/ee/a105003_stage_v_step2_topic_7_تشخیص_افتراقی.json
2026-01-01 12:36:33,791 - INFO -   ✓ Step 2 completed for Topic 'تشخیص افتراقی' (14 questions, QId range: 111 to 124)
2026-01-01 12:36:33,792 - INFO - [8/21] Processing Step 2 for Topic 'پروگنوز و پایش' (Subchapter: 'پمفیگوئید بولوز')...
2026-01-01 12:36:33,792 - INFO - 
2026-01-01 12:36:33,792 - INFO - ================================================================================
2026-01-01 12:36:33,792 - INFO - PROCESSING TOPIC 8/21: 'پروگنوز و پایش'
2026-01-01 12:36:33,792 - INFO - ================================================================================
2026-01-01 12:36:33,792 - INFO -   Subchapter: 'پمفیگوئید بولوز'
2026-01-01 12:36:33,792 - INFO -   Topic: 'پروگنوز و پایش'
2026-01-01 12:36:33,792 - INFO -   Total Stage J records: 888
2026-01-01 12:36:33,793 - INFO - Loading Word document for Topic 8/21...
2026-01-01 12:36:33,806 - INFO - Successfully read Word file using python-docx: /home/shahmir/Downloads/راهنمای_پایپ_لاین_ارتقا_و_بورد_پوست.docx (2737 chars)
2026-01-01 12:36:33,806 - INFO - Loading Step 1 output...
2026-01-01 12:36:33,806 - INFO - Successfully loaded JSON: /media/shahmir/Shahmir/ee/a105003_stage_v_step1_topic_8_پروگنوز_و_پایش.json
2026-01-01 12:36:33,806 - INFO - Loaded 3 questions from Step 1
2026-01-01 12:36:33,807 - INFO - Processing Stage V - Step 2 for Topic 8/21 (full file)...
2026-01-01 12:37:41,545 - INFO - Text processed successfully with gemini-2.5-pro
2026-01-01 12:37:41,545 - INFO - Step 2 response received for Topic 8 (8137 characters)
2026-01-01 12:37:41,547 - INFO - Saved raw model responses to: /media/shahmir/Shahmir/ee/a105003_stage_v_step2_topic_8_پروگنوز_و_پایش.txt
2026-01-01 12:37:41,547 - INFO - Extracting JSON from Part 1 response...
2026-01-01 12:37:41,547 - INFO - Successfully extracted JSON from response
2026-01-01 12:37:41,548 - INFO - Extracted 5 refined questions from Part 1
2026-01-01 12:37:41,548 - INFO - Total refined questions from Step 2 for Topic 8: 5
2026-01-01 12:37:41,548 - INFO - Total combined questions (Step 1 + Step 2) for Topic 8: 8
2026-01-01 12:37:41,549 - INFO - Adding QId to all questions for Topic 8 (starting from QId counter 125)...
2026-01-01 12:37:41,549 - INFO - Added QId to 8 questions for Topic 8 (QId range: 125 to 132)
2026-01-01 12:37:41,551 - INFO - Successfully saved JSON: /media/shahmir/Shahmir/ee/a105003_stage_v_step2_topic_8_پروگنوز_و_پایش.json (8 records)
2026-01-01 12:37:41,551 - INFO - Step 2 output saved to: /media/shahmir/Shahmir/ee/a105003_stage_v_step2_topic_8_پروگنوز_و_پایش.json
2026-01-01 12:37:41,552 - INFO - Step 2 completed for Topic 'پروگنوز و پایش': /media/shahmir/Shahmir/ee/a105003_stage_v_step2_topic_8_پروگنوز_و_پایش.json
2026-01-01 12:37:41,552 - INFO -   ✓ Step 2 completed for Topic 'پروگنوز و پایش' (8 questions, QId range: 125 to 132)
2026-01-01 12:37:41,552 - INFO - [9/21] Processing Step 2 for Topic 'درمان' (Subchapter: 'پمفیگوئید بولوز')...
2026-01-01 12:37:41,553 - INFO - 
2026-01-01 12:37:41,553 - INFO - ================================================================================
2026-01-01 12:37:41,553 - INFO - PROCESSING TOPIC 9/21: 'درمان'
2026-01-01 12:37:41,553 - INFO - ================================================================================
2026-01-01 12:37:41,553 - INFO -   Subchapter: 'پمفیگوئید بولوز'
2026-01-01 12:37:41,554 - INFO -   Topic: 'درمان'
2026-01-01 12:37:41,554 - INFO -   Total Stage J records: 888
2026-01-01 12:37:41,554 - INFO - Loading Word document for Topic 9/21...
2026-01-01 12:37:41,574 - INFO - Successfully read Word file using python-docx: /home/shahmir/Downloads/راهنمای_پایپ_لاین_ارتقا_و_بورد_پوست.docx (2737 chars)
2026-01-01 12:37:41,574 - INFO - Loading Step 1 output...
2026-01-01 12:37:41,575 - INFO - Successfully loaded JSON: /media/shahmir/Shahmir/ee/a105003_stage_v_step1_topic_9_درمان.json
2026-01-01 12:37:41,575 - INFO - Loaded 4 questions from Step 1
2026-01-01 12:37:41,575 - INFO - Processing Stage V - Step 2 for Topic 9/21 (full file)...
2026-01-01 12:38:50,238 - INFO - Text processed successfully with gemini-2.5-pro
2026-01-01 12:38:50,239 - INFO - Step 2 response received for Topic 9 (11487 characters)
2026-01-01 12:38:50,240 - INFO - Saved raw model responses to: /media/shahmir/Shahmir/ee/a105003_stage_v_step2_topic_9_درمان.txt
2026-01-01 12:38:50,240 - INFO - Extracting JSON from Part 1 response...
2026-01-01 12:38:50,241 - INFO - Successfully extracted JSON from response
2026-01-01 12:38:50,241 - INFO - Extracted 8 refined questions from Part 1
2026-01-01 12:38:50,242 - INFO - Total refined questions from Step 2 for Topic 9: 8
2026-01-01 12:38:50,242 - INFO - Total combined questions (Step 1 + Step 2) for Topic 9: 12
2026-01-01 12:38:50,243 - INFO - Adding QId to all questions for Topic 9 (starting from QId counter 133)...
2026-01-01 12:38:50,243 - INFO - Added QId to 12 questions for Topic 9 (QId range: 133 to 144)
2026-01-01 12:38:50,245 - INFO - Successfully saved JSON: /media/shahmir/Shahmir/ee/a105003_stage_v_step2_topic_9_درمان.json (12 records)
2026-01-01 12:38:50,245 - INFO - Step 2 output saved to: /media/shahmir/Shahmir/ee/a105003_stage_v_step2_topic_9_درمان.json
2026-01-01 12:38:50,246 - INFO - Step 2 completed for Topic 'درمان': /media/shahmir/Shahmir/ee/a105003_stage_v_step2_topic_9_درمان.json
2026-01-01 12:38:50,246 - INFO -   ✓ Step 2 completed for Topic 'درمان' (12 questions, QId range: 133 to 144)
2026-01-01 12:38:50,246 - INFO - [10/21] Processing Step 2 for Topic 'مقدمه' (Subchapter: 'پمفیگوئید غشاء مخاطی')...
2026-01-01 12:38:50,247 - INFO - 
2026-01-01 12:38:50,247 - INFO - ================================================================================
2026-01-01 12:38:50,247 - INFO - PROCESSING TOPIC 10/21: 'مقدمه'
2026-01-01 12:38:50,247 - INFO - ================================================================================
2026-01-01 12:38:50,247 - INFO -   Subchapter: 'پمفیگوئید غشاء مخاطی'
2026-01-01 12:38:50,247 - INFO -   Topic: 'مقدمه'
2026-01-01 12:38:50,248 - INFO -   Total Stage J records: 888
2026-01-01 12:38:50,248 - INFO - Loading Word document for Topic 10/21...
2026-01-01 12:38:50,271 - INFO - Successfully read Word file using python-docx: /home/shahmir/Downloads/راهنمای_پایپ_لاین_ارتقا_و_بورد_پوست.docx (2737 chars)
2026-01-01 12:38:50,272 - INFO - Loading Step 1 output...
2026-01-01 12:38:50,272 - INFO - Successfully loaded JSON: /media/shahmir/Shahmir/ee/a105003_stage_v_step1_topic_10_مقدمه.json
2026-01-01 12:38:50,272 - INFO - Loaded 10 questions from Step 1
2026-01-01 12:38:50,272 - INFO - Processing Stage V - Step 2 for Topic 10/21 (full file)...
2026-01-01 12:40:24,071 - INFO - Text processed successfully with gemini-2.5-pro
2026-01-01 12:40:24,072 - INFO - Step 2 response received for Topic 10 (7996 characters)
2026-01-01 12:40:24,074 - INFO - Saved raw model responses to: /media/shahmir/Shahmir/ee/a105003_stage_v_step2_topic_10_مقدمه.txt
2026-01-01 12:40:24,074 - INFO - Extracting JSON from Part 1 response...
2026-01-01 12:40:24,074 - INFO - Successfully extracted JSON from response
2026-01-01 12:40:24,075 - INFO - Extracted 6 refined questions from Part 1
2026-01-01 12:40:24,075 - INFO - Total refined questions from Step 2 for Topic 10: 6
2026-01-01 12:40:24,076 - INFO - Total combined questions (Step 1 + Step 2) for Topic 10: 16
2026-01-01 12:40:24,076 - INFO - Adding QId to all questions for Topic 10 (starting from QId counter 145)...
2026-01-01 12:40:24,076 - INFO - Added QId to 16 questions for Topic 10 (QId range: 145 to 160)
2026-01-01 12:40:24,078 - INFO - Successfully saved JSON: /media/shahmir/Shahmir/ee/a105003_stage_v_step2_topic_10_مقدمه.json (16 records)
2026-01-01 12:40:24,078 - INFO - Step 2 output saved to: /media/shahmir/Shahmir/ee/a105003_stage_v_step2_topic_10_مقدمه.json
2026-01-01 12:40:24,079 - INFO - Step 2 completed for Topic 'مقدمه': /media/shahmir/Shahmir/ee/a105003_stage_v_step2_topic_10_مقدمه.json
2026-01-01 12:40:24,079 - INFO -   ✓ Step 2 completed for Topic 'مقدمه' (16 questions, QId range: 145 to 160)
2026-01-01 12:40:24,080 - INFO - [11/21] Processing Step 2 for Topic 'تاریخچه و اپیدمیولوژی' (Subchapter: 'پمفیگوئید غشاء مخاطی')...
2026-01-01 12:40:24,080 - INFO - 
2026-01-01 12:40:24,080 - INFO - ================================================================================
2026-01-01 12:40:24,080 - INFO - PROCESSING TOPIC 11/21: 'تاریخچه و اپیدمیولوژی'
2026-01-01 12:40:24,081 - INFO - ================================================================================
2026-01-01 12:40:24,081 - INFO -   Subchapter: 'پمفیگوئید غشاء مخاطی'
2026-01-01 12:40:24,081 - INFO -   Topic: 'تاریخچه و اپیدمیولوژی'
2026-01-01 12:40:24,081 - INFO -   Total Stage J records: 888
2026-01-01 12:40:24,082 - INFO - Loading Word document for Topic 11/21...
2026-01-01 12:40:24,103 - INFO - Successfully read Word file using python-docx: /home/shahmir/Downloads/راهنمای_پایپ_لاین_ارتقا_و_بورد_پوست.docx (2737 chars)
2026-01-01 12:40:24,103 - INFO - Loading Step 1 output...
2026-01-01 12:40:24,103 - INFO - Successfully loaded JSON: /media/shahmir/Shahmir/ee/a105003_stage_v_step1_topic_11_تاریخچه_و_اپیدمیولوژی.json
2026-01-01 12:40:24,103 - INFO - Loaded 3 questions from Step 1
2026-01-01 12:40:24,104 - INFO - Processing Stage V - Step 2 for Topic 11/21 (full file)...
2026-01-01 12:41:19,838 - INFO - Text processed successfully with gemini-2.5-pro
2026-01-01 12:41:19,839 - INFO - Step 2 response received for Topic 11 (5025 characters)
2026-01-01 12:41:19,840 - INFO - Saved raw model responses to: /media/shahmir/Shahmir/ee/a105003_stage_v_step2_topic_11_تاریخچه_و_اپیدمیولوژی.txt
2026-01-01 12:41:19,841 - INFO - Extracting JSON from Part 1 response...
2026-01-01 12:41:19,841 - INFO - Successfully extracted JSON from response
2026-01-01 12:41:19,841 - INFO - Extracted 5 refined questions from Part 1
2026-01-01 12:41:19,842 - INFO - Total refined questions from Step 2 for Topic 11: 5
2026-01-01 12:41:19,842 - INFO - Total combined questions (Step 1 + Step 2) for Topic 11: 8
2026-01-01 12:41:19,842 - INFO - Adding QId to all questions for Topic 11 (starting from QId counter 161)...
2026-01-01 12:41:19,843 - INFO - Added QId to 8 questions for Topic 11 (QId range: 161 to 168)
2026-01-01 12:41:19,843 - INFO - Successfully saved JSON: /media/shahmir/Shahmir/ee/a105003_stage_v_step2_topic_11_تاریخچه_و_اپیدمیولوژی.json (8 records)
2026-01-01 12:41:19,844 - INFO - Step 2 output saved to: /media/shahmir/Shahmir/ee/a105003_stage_v_step2_topic_11_تاریخچه_و_اپیدمیولوژی.json
2026-01-01 12:41:19,844 - INFO - Step 2 completed for Topic 'تاریخچه و اپیدمیولوژی': /media/shahmir/Shahmir/ee/a105003_stage_v_step2_topic_11_تاریخچه_و_اپیدمیولوژی.json
2026-01-01 12:41:19,844 - INFO -   ✓ Step 2 completed for Topic 'تاریخچه و اپیدمیولوژی' (8 questions, QId range: 161 to 168)
2026-01-01 12:41:19,844 - INFO - [12/21] Processing Step 2 for Topic 'پاتوژنز' (Subchapter: 'پمفیگوئید غشاء مخاطی')...
2026-01-01 12:41:19,844 - INFO - 
2026-01-01 12:41:19,844 - INFO - ================================================================================
2026-01-01 12:41:19,845 - INFO - PROCESSING TOPIC 12/21: 'پاتوژنز'
2026-01-01 12:41:19,845 - INFO - ================================================================================
2026-01-01 12:41:19,845 - INFO -   Subchapter: 'پمفیگوئید غشاء مخاطی'
2026-01-01 12:41:19,845 - INFO -   Topic: 'پاتوژنز'
2026-01-01 12:41:19,845 - INFO -   Total Stage J records: 888
2026-01-01 12:41:19,845 - INFO - Loading Word document for Topic 12/21...
2026-01-01 12:41:19,856 - INFO - Successfully read Word file using python-docx: /home/shahmir/Downloads/راهنمای_پایپ_لاین_ارتقا_و_بورد_پوست.docx (2737 chars)
2026-01-01 12:41:19,856 - INFO - Loading Step 1 output...
2026-01-01 12:41:19,857 - INFO - Successfully loaded JSON: /media/shahmir/Shahmir/ee/a105003_stage_v_step1_topic_12_پاتوژنز.json
2026-01-01 12:41:19,857 - INFO - Loaded 11 questions from Step 1
2026-01-01 12:41:19,857 - INFO - Processing Stage V - Step 2 for Topic 12/21 (full file)...
2026-01-01 12:42:57,586 - INFO - Text processed successfully with gemini-2.5-pro
2026-01-01 12:42:57,588 - INFO - Step 2 response received for Topic 12 (6874 characters)
2026-01-01 12:42:57,589 - INFO - Saved raw model responses to: /media/shahmir/Shahmir/ee/a105003_stage_v_step2_topic_12_پاتوژنز.txt
2026-01-01 12:42:57,590 - INFO - Extracting JSON from Part 1 response...
2026-01-01 12:42:57,590 - INFO - Successfully extracted JSON from response
2026-01-01 12:42:57,591 - INFO - Extracted 5 refined questions from Part 1
2026-01-01 12:42:57,591 - INFO - Total refined questions from Step 2 for Topic 12: 5
2026-01-01 12:42:57,591 - INFO - Total combined questions (Step 1 + Step 2) for Topic 12: 16
2026-01-01 12:42:57,592 - INFO - Adding QId to all questions for Topic 12 (starting from QId counter 169)...
2026-01-01 12:42:57,592 - INFO - Added QId to 16 questions for Topic 12 (QId range: 169 to 184)
2026-01-01 12:42:57,593 - INFO - Successfully saved JSON: /media/shahmir/Shahmir/ee/a105003_stage_v_step2_topic_12_پاتوژنز.json (16 records)
2026-01-01 12:42:57,594 - INFO - Step 2 output saved to: /media/shahmir/Shahmir/ee/a105003_stage_v_step2_topic_12_پاتوژنز.json
2026-01-01 12:42:57,595 - INFO - Step 2 completed for Topic 'پاتوژنز': /media/shahmir/Shahmir/ee/a105003_stage_v_step2_topic_12_پاتوژنز.json
2026-01-01 12:42:57,595 - INFO -   ✓ Step 2 completed for Topic 'پاتوژنز' (16 questions, QId range: 169 to 184)
2026-01-01 12:42:57,595 - INFO - [13/21] Processing Step 2 for Topic 'ویژگی‌های بالینی' (Subchapter: 'پمفیگوئید غشاء مخاطی')...
2026-01-01 12:42:57,595 - INFO - 
2026-01-01 12:42:57,596 - INFO - ================================================================================
2026-01-01 12:42:57,596 - INFO - PROCESSING TOPIC 13/21: 'ویژگی‌های بالینی'
2026-01-01 12:42:57,596 - INFO - ================================================================================
2026-01-01 12:42:57,596 - INFO -   Subchapter: 'پمفیگوئید غشاء مخاطی'
2026-01-01 12:42:57,596 - INFO -   Topic: 'ویژگی‌های بالینی'
2026-01-01 12:42:57,596 - INFO -   Total Stage J records: 888
2026-01-01 12:42:57,597 - INFO - Loading Word document for Topic 13/21...
2026-01-01 12:42:57,626 - INFO - Successfully read Word file using python-docx: /home/shahmir/Downloads/راهنمای_پایپ_لاین_ارتقا_و_بورد_پوست.docx (2737 chars)
2026-01-01 12:42:57,626 - INFO - Loading Step 1 output...
2026-01-01 12:42:57,626 - INFO - Successfully loaded JSON: /media/shahmir/Shahmir/ee/a105003_stage_v_step1_topic_13_ویژگیهای_بالینی.json
2026-01-01 12:42:57,626 - INFO - Loaded 5 questions from Step 1
2026-01-01 12:42:57,627 - INFO - Processing Stage V - Step 2 for Topic 13/21 (full file)...
2026-01-01 12:44:08,339 - INFO - Text processed successfully with gemini-2.5-pro
2026-01-01 12:44:08,341 - INFO - Step 2 response received for Topic 13 (7685 characters)
2026-01-01 12:44:08,343 - INFO - Saved raw model responses to: /media/shahmir/Shahmir/ee/a105003_stage_v_step2_topic_13_ویژگیهای_بالینی.txt
2026-01-01 12:44:08,343 - INFO - Extracting JSON from Part 1 response...
2026-01-01 12:44:08,344 - INFO - Successfully extracted JSON from response
2026-01-01 12:44:08,345 - INFO - Extracted 7 refined questions from Part 1
2026-01-01 12:44:08,345 - INFO - Total refined questions from Step 2 for Topic 13: 7
2026-01-01 12:44:08,346 - INFO - Total combined questions (Step 1 + Step 2) for Topic 13: 12
2026-01-01 12:44:08,346 - INFO - Adding QId to all questions for Topic 13 (starting from QId counter 185)...
2026-01-01 12:44:08,347 - INFO - Added QId to 12 questions for Topic 13 (QId range: 185 to 196)
2026-01-01 12:44:08,348 - INFO - Successfully saved JSON: /media/shahmir/Shahmir/ee/a105003_stage_v_step2_topic_13_ویژگیهای_بالینی.json (12 records)
2026-01-01 12:44:08,349 - INFO - Step 2 output saved to: /media/shahmir/Shahmir/ee/a105003_stage_v_step2_topic_13_ویژگیهای_بالینی.json
2026-01-01 12:44:08,349 - INFO - Step 2 completed for Topic 'ویژگی‌های بالینی': /media/shahmir/Shahmir/ee/a105003_stage_v_step2_topic_13_ویژگیهای_بالینی.json
2026-01-01 12:44:08,350 - INFO -   ✓ Step 2 completed for Topic 'ویژگی‌های بالینی' (12 questions, QId range: 185 to 196)
2026-01-01 12:44:08,350 - INFO - [14/21] Processing Step 2 for Topic 'تشخیص و تشخیص افتراقی' (Subchapter: 'پمفیگوئید غشاء مخاطی')...
2026-01-01 12:44:08,350 - INFO - 
2026-01-01 12:44:08,350 - INFO - ================================================================================
2026-01-01 12:44:08,350 - INFO - PROCESSING TOPIC 14/21: 'تشخیص و تشخیص افتراقی'
2026-01-01 12:44:08,351 - INFO - ================================================================================
2026-01-01 12:44:08,351 - INFO -   Subchapter: 'پمفیگوئید غشاء مخاطی'
2026-01-01 12:44:08,351 - INFO -   Topic: 'تشخیص و تشخیص افتراقی'
2026-01-01 12:44:08,351 - INFO -   Total Stage J records: 888
2026-01-01 12:44:08,351 - INFO - Loading Word document for Topic 14/21...
2026-01-01 12:44:08,376 - INFO - Successfully read Word file using python-docx: /home/shahmir/Downloads/راهنمای_پایپ_لاین_ارتقا_و_بورد_پوست.docx (2737 chars)
2026-01-01 12:44:08,376 - INFO - Loading Step 1 output...
2026-01-01 12:44:08,376 - INFO - Successfully loaded JSON: /media/shahmir/Shahmir/ee/a105003_stage_v_step1_topic_14_تشخیص_و_تشخیص_افتراقی.json
2026-01-01 12:44:08,376 - INFO - Loaded 5 questions from Step 1
2026-01-01 12:44:08,376 - INFO - Processing Stage V - Step 2 for Topic 14/21 (full file)...
2026-01-01 12:45:32,742 - INFO - Text processed successfully with gemini-2.5-pro
2026-01-01 12:45:32,742 - INFO - Step 2 response received for Topic 14 (11644 characters)
2026-01-01 12:45:32,743 - INFO - Saved raw model responses to: /media/shahmir/Shahmir/ee/a105003_stage_v_step2_topic_14_تشخیص_و_تشخیص_افتراقی.txt
2026-01-01 12:45:32,744 - INFO - Extracting JSON from Part 1 response...
2026-01-01 12:45:32,744 - INFO - Successfully extracted JSON from response
2026-01-01 12:45:32,745 - INFO - Extracted 8 refined questions from Part 1
2026-01-01 12:45:32,745 - INFO - Total refined questions from Step 2 for Topic 14: 8
2026-01-01 12:45:32,745 - INFO - Total combined questions (Step 1 + Step 2) for Topic 14: 13
2026-01-01 12:45:32,746 - INFO - Adding QId to all questions for Topic 14 (starting from QId counter 197)...
2026-01-01 12:45:32,746 - INFO - Added QId to 13 questions for Topic 14 (QId range: 197 to 209)
2026-01-01 12:45:32,748 - INFO - Successfully saved JSON: /media/shahmir/Shahmir/ee/a105003_stage_v_step2_topic_14_تشخیص_و_تشخیص_افتراقی.json (13 records)
2026-01-01 12:45:32,749 - INFO - Step 2 output saved to: /media/shahmir/Shahmir/ee/a105003_stage_v_step2_topic_14_تشخیص_و_تشخیص_افتراقی.json
2026-01-01 12:45:32,749 - INFO - Step 2 completed for Topic 'تشخیص و تشخیص افتراقی': /media/shahmir/Shahmir/ee/a105003_stage_v_step2_topic_14_تشخیص_و_تشخیص_افتراقی.json
2026-01-01 12:45:32,750 - INFO -   ✓ Step 2 completed for Topic 'تشخیص و تشخیص افتراقی' (13 questions, QId range: 197 to 209)
2026-01-01 12:45:32,750 - INFO - [15/21] Processing Step 2 for Topic 'پیش‌آگهی' (Subchapter: 'پمفیگوئید غشاء مخاطی')...
2026-01-01 12:45:32,751 - INFO - 
2026-01-01 12:45:32,751 - INFO - ================================================================================
2026-01-01 12:45:32,751 - INFO - PROCESSING TOPIC 15/21: 'پیش‌آگهی'
2026-01-01 12:45:32,751 - INFO - ================================================================================
2026-01-01 12:45:32,751 - INFO -   Subchapter: 'پمفیگوئید غشاء مخاطی'
2026-01-01 12:45:32,751 - INFO -   Topic: 'پیش‌آگهی'
2026-01-01 12:45:32,751 - INFO -   Total Stage J records: 888
2026-01-01 12:45:32,752 - INFO - Loading Word document for Topic 15/21...
2026-01-01 12:45:32,768 - INFO - Successfully read Word file using python-docx: /home/shahmir/Downloads/راهنمای_پایپ_لاین_ارتقا_و_بورد_پوست.docx (2737 chars)
2026-01-01 12:45:32,768 - INFO - Loading Step 1 output...
2026-01-01 12:45:32,768 - INFO - Successfully loaded JSON: /media/shahmir/Shahmir/ee/a105003_stage_v_step1_topic_15_پیشآگهی.json
2026-01-01 12:45:32,769 - INFO - Loaded 7 questions from Step 1
2026-01-01 12:45:32,769 - INFO - Processing Stage V - Step 2 for Topic 15/21 (full file)...
2026-01-01 12:46:36,352 - INFO - Text processed successfully with gemini-2.5-pro
2026-01-01 12:46:36,354 - INFO - Step 2 response received for Topic 15 (4333 characters)
2026-01-01 12:46:36,355 - INFO - Saved raw model responses to: /media/shahmir/Shahmir/ee/a105003_stage_v_step2_topic_15_پیشآگهی.txt
2026-01-01 12:46:36,356 - INFO - Extracting JSON from Part 1 response...
2026-01-01 12:46:36,356 - INFO - Successfully extracted JSON from response
2026-01-01 12:46:36,357 - INFO - Extracted 3 refined questions from Part 1
2026-01-01 12:46:36,357 - INFO - Total refined questions from Step 2 for Topic 15: 3
2026-01-01 12:46:36,358 - INFO - Total combined questions (Step 1 + Step 2) for Topic 15: 10
2026-01-01 12:46:36,358 - INFO - Adding QId to all questions for Topic 15 (starting from QId counter 210)...
2026-01-01 12:46:36,358 - INFO - Added QId to 10 questions for Topic 15 (QId range: 210 to 219)
2026-01-01 12:46:36,359 - INFO - Successfully saved JSON: /media/shahmir/Shahmir/ee/a105003_stage_v_step2_topic_15_پیشآگهی.json (10 records)
2026-01-01 12:46:36,360 - INFO - Step 2 output saved to: /media/shahmir/Shahmir/ee/a105003_stage_v_step2_topic_15_پیشآگهی.json
2026-01-01 12:46:36,360 - INFO - Step 2 completed for Topic 'پیش‌آگهی': /media/shahmir/Shahmir/ee/a105003_stage_v_step2_topic_15_پیشآگهی.json
2026-01-01 12:46:36,361 - INFO -   ✓ Step 2 completed for Topic 'پیش‌آگهی' (10 questions, QId range: 210 to 219)
2026-01-01 12:46:36,361 - INFO - [16/21] Processing Step 2 for Topic 'درمان' (Subchapter: 'پمفیگوئید غشاء مخاطی')...
2026-01-01 12:46:36,361 - INFO - 
2026-01-01 12:46:36,361 - INFO - ================================================================================
2026-01-01 12:46:36,362 - INFO - PROCESSING TOPIC 16/21: 'درمان'
2026-01-01 12:46:36,362 - INFO - ================================================================================
2026-01-01 12:46:36,362 - INFO -   Subchapter: 'پمفیگوئید غشاء مخاطی'
2026-01-01 12:46:36,362 - INFO -   Topic: 'درمان'
2026-01-01 12:46:36,363 - INFO -   Total Stage J records: 888
2026-01-01 12:46:36,363 - INFO - Loading Word document for Topic 16/21...
2026-01-01 12:46:36,389 - INFO - Successfully read Word file using python-docx: /home/shahmir/Downloads/راهنمای_پایپ_لاین_ارتقا_و_بورد_پوست.docx (2737 chars)
2026-01-01 12:46:36,389 - INFO - Loading Step 1 output...
2026-01-01 12:46:36,389 - INFO - Successfully loaded JSON: /media/shahmir/Shahmir/ee/a105003_stage_v_step1_topic_16_درمان.json
2026-01-01 12:46:36,389 - INFO - Loaded 4 questions from Step 1
2026-01-01 12:46:36,389 - INFO - Processing Stage V - Step 2 for Topic 16/21 (full file)...
2026-01-01 12:48:25,538 - INFO - Text processed successfully with gemini-2.5-pro
2026-01-01 12:48:25,539 - INFO - Step 2 response received for Topic 16 (17499 characters)
2026-01-01 12:48:25,540 - INFO - Saved raw model responses to: /media/shahmir/Shahmir/ee/a105003_stage_v_step2_topic_16_درمان.txt
2026-01-01 12:48:25,541 - INFO - Extracting JSON from Part 1 response...
2026-01-01 12:48:25,543 - INFO - Successfully extracted JSON from response
2026-01-01 12:48:25,543 - INFO - Extracted 14 refined questions from Part 1
2026-01-01 12:48:25,544 - INFO - Total refined questions from Step 2 for Topic 16: 14
2026-01-01 12:48:25,546 - INFO - Total combined questions (Step 1 + Step 2) for Topic 16: 18
2026-01-01 12:48:25,548 - INFO - Adding QId to all questions for Topic 16 (starting from QId counter 220)...
2026-01-01 12:48:25,548 - INFO - Added QId to 18 questions for Topic 16 (QId range: 220 to 237)
2026-01-01 12:48:25,552 - INFO - Successfully saved JSON: /media/shahmir/Shahmir/ee/a105003_stage_v_step2_topic_16_درمان.json (18 records)
2026-01-01 12:48:25,554 - INFO - Step 2 output saved to: /media/shahmir/Shahmir/ee/a105003_stage_v_step2_topic_16_درمان.json
2026-01-01 12:48:25,555 - INFO - Step 2 completed for Topic 'درمان': /media/shahmir/Shahmir/ee/a105003_stage_v_step2_topic_16_درمان.json
2026-01-01 12:48:25,555 - INFO -   ✓ Step 2 completed for Topic 'درمان' (18 questions, QId range: 220 to 237)
2026-01-01 12:48:25,556 - INFO - [17/21] Processing Step 2 for Topic 'مقدمه، تاریخچه و اپیدمیولوژی' (Subchapter: 'اپیدرمولیز بولوزا اکتسابی')...
2026-01-01 12:48:25,556 - INFO - 
2026-01-01 12:48:25,556 - INFO - ================================================================================
2026-01-01 12:48:25,556 - INFO - PROCESSING TOPIC 17/21: 'مقدمه، تاریخچه و اپیدمیولوژی'
2026-01-01 12:48:25,556 - INFO - ================================================================================
2026-01-01 12:48:25,557 - INFO -   Subchapter: 'اپیدرمولیز بولوزا اکتسابی'
2026-01-01 12:48:25,557 - INFO -   Topic: 'مقدمه، تاریخچه و اپیدمیولوژی'
2026-01-01 12:48:25,557 - INFO -   Total Stage J records: 888
2026-01-01 12:48:25,557 - INFO - Loading Word document for Topic 17/21...
2026-01-01 12:48:25,577 - INFO - Successfully read Word file using python-docx: /home/shahmir/Downloads/راهنمای_پایپ_لاین_ارتقا_و_بورد_پوست.docx (2737 chars)
2026-01-01 12:48:25,577 - INFO - Loading Step 1 output...
2026-01-01 12:48:25,577 - INFO - Successfully loaded JSON: /media/shahmir/Shahmir/ee/a105003_stage_v_step1_topic_17_مقدمه_تاریخچه_و_اپیدمیولوژی.json
2026-01-01 12:48:25,577 - INFO - Loaded 4 questions from Step 1
2026-01-01 12:48:25,578 - INFO - Processing Stage V - Step 2 for Topic 17/21 (full file)...
2026-01-01 12:49:45,832 - INFO - Text processed successfully with gemini-2.5-pro
2026-01-01 12:49:45,833 - INFO - Step 2 response received for Topic 17 (7166 characters)
2026-01-01 12:49:45,835 - INFO - Saved raw model responses to: /media/shahmir/Shahmir/ee/a105003_stage_v_step2_topic_17_مقدمه_تاریخچه_و_اپیدمیولوژی.txt
2026-01-01 12:49:45,835 - INFO - Extracting JSON from Part 1 response...
2026-01-01 12:49:45,836 - INFO - Successfully extracted JSON from response
2026-01-01 12:49:45,836 - INFO - Extracted 5 refined questions from Part 1
2026-01-01 12:49:45,837 - INFO - Total refined questions from Step 2 for Topic 17: 5
2026-01-01 12:49:45,838 - INFO - Total combined questions (Step 1 + Step 2) for Topic 17: 9
2026-01-01 12:49:45,839 - INFO - Adding QId to all questions for Topic 17 (starting from QId counter 238)...
2026-01-01 12:49:45,840 - INFO - Added QId to 9 questions for Topic 17 (QId range: 238 to 246)
2026-01-01 12:49:45,842 - INFO - Successfully saved JSON: /media/shahmir/Shahmir/ee/a105003_stage_v_step2_topic_17_مقدمه_تاریخچه_و_اپیدمیولوژی.json (9 records)
2026-01-01 12:49:45,843 - INFO - Step 2 output saved to: /media/shahmir/Shahmir/ee/a105003_stage_v_step2_topic_17_مقدمه_تاریخچه_و_اپیدمیولوژی.json
2026-01-01 12:49:45,843 - INFO - Step 2 completed for Topic 'مقدمه، تاریخچه و اپیدمیولوژی': /media/shahmir/Shahmir/ee/a105003_stage_v_step2_topic_17_مقدمه_تاریخچه_و_اپیدمیولوژی.json
2026-01-01 12:49:45,844 - INFO -   ✓ Step 2 completed for Topic 'مقدمه، تاریخچه و اپیدمیولوژی' (9 questions, QId range: 238 to 246)
2026-01-01 12:49:45,844 - INFO - [18/21] Processing Step 2 for Topic 'پاتوژنز' (Subchapter: 'اپیدرمولیز بولوزا اکتسابی')...
2026-01-01 12:49:45,845 - INFO - 
2026-01-01 12:49:45,845 - INFO - ================================================================================
2026-01-01 12:49:45,845 - INFO - PROCESSING TOPIC 18/21: 'پاتوژنز'
2026-01-01 12:49:45,845 - INFO - ================================================================================
2026-01-01 12:49:45,845 - INFO -   Subchapter: 'اپیدرمولیز بولوزا اکتسابی'
2026-01-01 12:49:45,846 - INFO -   Topic: 'پاتوژنز'
2026-01-01 12:49:45,846 - INFO -   Total Stage J records: 888
2026-01-01 12:49:45,847 - INFO - Loading Word document for Topic 18/21...
2026-01-01 12:49:45,869 - INFO - Successfully read Word file using python-docx: /home/shahmir/Downloads/راهنمای_پایپ_لاین_ارتقا_و_بورد_پوست.docx (2737 chars)
2026-01-01 12:49:45,869 - INFO - Loading Step 1 output...
2026-01-01 12:49:45,869 - INFO - Successfully loaded JSON: /media/shahmir/Shahmir/ee/a105003_stage_v_step1_topic_18_پاتوژنز.json
2026-01-01 12:49:45,869 - INFO - Loaded 5 questions from Step 1
2026-01-01 12:49:45,869 - INFO - Processing Stage V - Step 2 for Topic 18/21 (full file)...
2026-01-01 12:52:17,150 - INFO - Text processed successfully with gemini-2.5-pro
2026-01-01 12:52:17,151 - INFO - Step 2 response received for Topic 18 (9924 characters)
2026-01-01 12:52:17,153 - INFO - Saved raw model responses to: /media/shahmir/Shahmir/ee/a105003_stage_v_step2_topic_18_پاتوژنز.txt
2026-01-01 12:52:17,153 - INFO - Extracting JSON from Part 1 response...
2026-01-01 12:52:17,153 - INFO - Successfully extracted JSON from response
2026-01-01 12:52:17,154 - INFO - Extracted 8 refined questions from Part 1
2026-01-01 12:52:17,154 - INFO - Total refined questions from Step 2 for Topic 18: 8
2026-01-01 12:52:17,155 - INFO - Total combined questions (Step 1 + Step 2) for Topic 18: 13
2026-01-01 12:52:17,155 - INFO - Adding QId to all questions for Topic 18 (starting from QId counter 247)...
2026-01-01 12:52:17,156 - INFO - Added QId to 13 questions for Topic 18 (QId range: 247 to 259)
2026-01-01 12:52:17,158 - INFO - Successfully saved JSON: /media/shahmir/Shahmir/ee/a105003_stage_v_step2_topic_18_پاتوژنز.json (13 records)
2026-01-01 12:52:17,158 - INFO - Step 2 output saved to: /media/shahmir/Shahmir/ee/a105003_stage_v_step2_topic_18_پاتوژنز.json
2026-01-01 12:52:17,159 - INFO - Step 2 completed for Topic 'پاتوژنز': /media/shahmir/Shahmir/ee/a105003_stage_v_step2_topic_18_پاتوژنز.json
2026-01-01 12:52:17,159 - INFO -   ✓ Step 2 completed for Topic 'پاتوژنز' (13 questions, QId range: 247 to 259)
2026-01-01 12:52:17,159 - INFO - [19/21] Processing Step 2 for Topic 'ویژگی‌های بالینی' (Subchapter: 'اپیدرمولیز بولوزا اکتسابی')...
2026-01-01 12:52:17,159 - INFO - 
2026-01-01 12:52:17,160 - INFO - ================================================================================
2026-01-01 12:52:17,160 - INFO - PROCESSING TOPIC 19/21: 'ویژگی‌های بالینی'
2026-01-01 12:52:17,160 - INFO - ================================================================================
2026-01-01 12:52:17,160 - INFO -   Subchapter: 'اپیدرمولیز بولوزا اکتسابی'
2026-01-01 12:52:17,160 - INFO -   Topic: 'ویژگی‌های بالینی'
2026-01-01 12:52:17,160 - INFO -   Total Stage J records: 888
2026-01-01 12:52:17,161 - INFO - Loading Word document for Topic 19/21...
2026-01-01 12:52:17,183 - INFO - Successfully read Word file using python-docx: /home/shahmir/Downloads/راهنمای_پایپ_لاین_ارتقا_و_بورد_پوست.docx (2737 chars)
2026-01-01 12:52:17,183 - INFO - Loading Step 1 output...
2026-01-01 12:52:17,183 - INFO - Successfully loaded JSON: /media/shahmir/Shahmir/ee/a105003_stage_v_step1_topic_19_ویژگیهای_بالینی.json
2026-01-01 12:52:17,183 - INFO - Loaded 5 questions from Step 1
2026-01-01 12:52:17,183 - INFO - Processing Stage V - Step 2 for Topic 19/21 (full file)...
2026-01-01 12:54:04,102 - INFO - Text processed successfully with gemini-2.5-pro
2026-01-01 12:54:04,103 - INFO - Step 2 response received for Topic 19 (12514 characters)
2026-01-01 12:54:04,105 - INFO - Saved raw model responses to: /media/shahmir/Shahmir/ee/a105003_stage_v_step2_topic_19_ویژگیهای_بالینی.txt
2026-01-01 12:54:04,105 - INFO - Extracting JSON from Part 1 response...
2026-01-01 12:54:04,106 - INFO - Successfully extracted JSON from response
2026-01-01 12:54:04,106 - INFO - Extracted 9 refined questions from Part 1
2026-01-01 12:54:04,107 - INFO - Total refined questions from Step 2 for Topic 19: 9
2026-01-01 12:54:04,107 - INFO - Total combined questions (Step 1 + Step 2) for Topic 19: 14
2026-01-01 12:54:04,108 - INFO - Adding QId to all questions for Topic 19 (starting from QId counter 260)...
2026-01-01 12:54:04,108 - INFO - Added QId to 14 questions for Topic 19 (QId range: 260 to 273)
2026-01-01 12:54:04,110 - INFO - Successfully saved JSON: /media/shahmir/Shahmir/ee/a105003_stage_v_step2_topic_19_ویژگیهای_بالینی.json (14 records)
2026-01-01 12:54:04,111 - INFO - Step 2 output saved to: /media/shahmir/Shahmir/ee/a105003_stage_v_step2_topic_19_ویژگیهای_بالینی.json
2026-01-01 12:54:04,112 - INFO - Step 2 completed for Topic 'ویژگی‌های بالینی': /media/shahmir/Shahmir/ee/a105003_stage_v_step2_topic_19_ویژگیهای_بالینی.json
2026-01-01 12:54:04,112 - INFO -   ✓ Step 2 completed for Topic 'ویژگی‌های بالینی' (14 questions, QId range: 260 to 273)
2026-01-01 12:54:04,112 - INFO - [20/21] Processing Step 2 for Topic 'تشخیص و تشخیص افتراقی' (Subchapter: 'اپیدرمولیز بولوزا اکتسابی')...
2026-01-01 12:54:04,113 - INFO - 
2026-01-01 12:54:04,113 - INFO - ================================================================================
2026-01-01 12:54:04,113 - INFO - PROCESSING TOPIC 20/21: 'تشخیص و تشخیص افتراقی'
2026-01-01 12:54:04,113 - INFO - ================================================================================
2026-01-01 12:54:04,113 - INFO -   Subchapter: 'اپیدرمولیز بولوزا اکتسابی'
2026-01-01 12:54:04,114 - INFO -   Topic: 'تشخیص و تشخیص افتراقی'
2026-01-01 12:54:04,114 - INFO -   Total Stage J records: 888
2026-01-01 12:54:04,114 - INFO - Loading Word document for Topic 20/21...
2026-01-01 12:54:04,136 - INFO - Successfully read Word file using python-docx: /home/shahmir/Downloads/راهنمای_پایپ_لاین_ارتقا_و_بورد_پوست.docx (2737 chars)
2026-01-01 12:54:04,136 - INFO - Loading Step 1 output...
2026-01-01 12:54:04,136 - INFO - Successfully loaded JSON: /media/shahmir/Shahmir/ee/a105003_stage_v_step1_topic_20_تشخیص_و_تشخیص_افتراقی.json
2026-01-01 12:54:04,136 - INFO - Loaded 6 questions from Step 1
2026-01-01 12:54:04,136 - INFO - Processing Stage V - Step 2 for Topic 20/21 (full file)...
2026-01-01 12:55:54,563 - INFO - Text processed successfully with gemini-2.5-pro
2026-01-01 12:55:54,563 - INFO - Step 2 response received for Topic 20 (13368 characters)
2026-01-01 12:55:54,564 - INFO - Saved raw model responses to: /media/shahmir/Shahmir/ee/a105003_stage_v_step2_topic_20_تشخیص_و_تشخیص_افتراقی.txt
2026-01-01 12:55:54,564 - INFO - Extracting JSON from Part 1 response...
2026-01-01 12:55:54,564 - INFO - Successfully extracted JSON from response
2026-01-01 12:55:54,564 - INFO - Extracted 10 refined questions from Part 1
2026-01-01 12:55:54,564 - INFO - Total refined questions from Step 2 for Topic 20: 10
2026-01-01 12:55:54,564 - INFO - Total combined questions (Step 1 + Step 2) for Topic 20: 16
2026-01-01 12:55:54,564 - INFO - Adding QId to all questions for Topic 20 (starting from QId counter 274)...
2026-01-01 12:55:54,564 - INFO - Added QId to 16 questions for Topic 20 (QId range: 274 to 289)
2026-01-01 12:55:54,565 - INFO - Successfully saved JSON: /media/shahmir/Shahmir/ee/a105003_stage_v_step2_topic_20_تشخیص_و_تشخیص_افتراقی.json (16 records)
2026-01-01 12:55:54,565 - INFO - Step 2 output saved to: /media/shahmir/Shahmir/ee/a105003_stage_v_step2_topic_20_تشخیص_و_تشخیص_افتراقی.json
2026-01-01 12:55:54,565 - INFO - Step 2 completed for Topic 'تشخیص و تشخیص افتراقی': /media/shahmir/Shahmir/ee/a105003_stage_v_step2_topic_20_تشخیص_و_تشخیص_افتراقی.json
2026-01-01 12:55:54,565 - INFO -   ✓ Step 2 completed for Topic 'تشخیص و تشخیص افتراقی' (16 questions, QId range: 274 to 289)
2026-01-01 12:55:54,565 - INFO - [21/21] Processing Step 2 for Topic 'درمان' (Subchapter: 'اپیدرمولیز بولوزا اکتسابی')...
2026-01-01 12:55:54,565 - INFO - 
2026-01-01 12:55:54,565 - INFO - ================================================================================
2026-01-01 12:55:54,565 - INFO - PROCESSING TOPIC 21/21: 'درمان'
2026-01-01 12:55:54,565 - INFO - ================================================================================
2026-01-01 12:55:54,565 - INFO -   Subchapter: 'اپیدرمولیز بولوزا اکتسابی'
2026-01-01 12:55:54,565 - INFO -   Topic: 'درمان'
2026-01-01 12:55:54,565 - INFO -   Total Stage J records: 888
2026-01-01 12:55:54,565 - INFO - Loading Word document for Topic 21/21...
2026-01-01 12:55:54,574 - INFO - Successfully read Word file using python-docx: /home/shahmir/Downloads/راهنمای_پایپ_لاین_ارتقا_و_بورد_پوست.docx (2737 chars)
2026-01-01 12:55:54,574 - INFO - Loading Step 1 output...
2026-01-01 12:55:54,574 - INFO - Successfully loaded JSON: /media/shahmir/Shahmir/ee/a105003_stage_v_step1_topic_21_درمان.json
2026-01-01 12:55:54,575 - INFO - Loaded 4 questions from Step 1
2026-01-01 12:55:54,575 - INFO - Processing Stage V - Step 2 for Topic 21/21 (full file)...
2026-01-01 12:57:07,103 - INFO - Text processed successfully with gemini-2.5-pro
2026-01-01 12:57:07,104 - INFO - Step 2 response received for Topic 21 (5667 characters)
2026-01-01 12:57:07,106 - INFO - Saved raw model responses to: /media/shahmir/Shahmir/ee/a105003_stage_v_step2_topic_21_درمان.txt
2026-01-01 12:57:07,107 - INFO - Extracting JSON from Part 1 response...
2026-01-01 12:57:07,107 - INFO - Successfully extracted JSON from response
2026-01-01 12:57:07,107 - INFO - Extracted 4 refined questions from Part 1
2026-01-01 12:57:07,108 - INFO - Total refined questions from Step 2 for Topic 21: 4
2026-01-01 12:57:07,108 - INFO - Total combined questions (Step 1 + Step 2) for Topic 21: 8
2026-01-01 12:57:07,108 - INFO - Adding QId to all questions for Topic 21 (starting from QId counter 290)...
2026-01-01 12:57:07,109 - INFO - Added QId to 8 questions for Topic 21 (QId range: 290 to 297)
2026-01-01 12:57:07,110 - INFO - Successfully saved JSON: /media/shahmir/Shahmir/ee/a105003_stage_v_step2_topic_21_درمان.json (8 records)
2026-01-01 12:57:07,110 - INFO - Step 2 output saved to: /media/shahmir/Shahmir/ee/a105003_stage_v_step2_topic_21_درمان.json
2026-01-01 12:57:07,111 - INFO - Step 2 completed for Topic 'درمان': /media/shahmir/Shahmir/ee/a105003_stage_v_step2_topic_21_درمان.json
2026-01-01 12:57:07,112 - INFO -   ✓ Step 2 completed for Topic 'درمان' (8 questions, QId range: 290 to 297)
2026-01-01 12:57:07,112 - INFO - Combining Step 2 outputs from all topics...
2026-01-01 12:57:07,113 - INFO - Combining Step 2 outputs from 21 topics...
2026-01-01 12:57:07,114 - INFO - Successfully loaded JSON: /media/shahmir/Shahmir/ee/a105003_stage_v_step2_topic_1_مقدمه_و_تاریخچه.json
2026-01-01 12:57:07,114 - INFO -   Added 18 questions from Topic 'مقدمه و تاریخچه' (Subchapter: 'پمفیگوئید بولوز')
2026-01-01 12:57:07,115 - INFO - Successfully loaded JSON: /media/shahmir/Shahmir/ee/a105003_stage_v_step2_topic_2_اپیدمیولوژی.json
2026-01-01 12:57:07,115 - INFO -   Added 16 questions from Topic 'اپیدمیولوژی' (Subchapter: 'پمفیگوئید بولوز')
2026-01-01 12:57:07,116 - INFO - Successfully loaded JSON: /media/shahmir/Shahmir/ee/a105003_stage_v_step2_topic_3_پاتوژنز.json
2026-01-01 12:57:07,117 - INFO -   Added 14 questions from Topic 'پاتوژنز' (Subchapter: 'پمفیگوئید بولوز')
2026-01-01 12:57:07,117 - INFO - Successfully loaded JSON: /media/shahmir/Shahmir/ee/a105003_stage_v_step2_topic_4_ویژگیهای_بالینی.json
2026-01-01 12:57:07,118 - INFO -   Added 16 questions from Topic 'ویژگی‌های بالینی' (Subchapter: 'پمفیگوئید بولوز')
2026-01-01 12:57:07,118 - INFO - Successfully loaded JSON: /media/shahmir/Shahmir/ee/a105003_stage_v_step2_topic_5_بیماریهای_همراه.json
2026-01-01 12:57:07,119 - INFO -   Added 24 questions from Topic 'بیماری‌های همراه' (Subchapter: 'پمفیگوئید بولوز')
2026-01-01 12:57:07,119 - INFO - Successfully loaded JSON: /media/shahmir/Shahmir/ee/a105003_stage_v_step2_topic_6_تشخیص.json
2026-01-01 12:57:07,119 - INFO -   Added 22 questions from Topic 'تشخیص' (Subchapter: 'پمفیگوئید بولوز')
2026-01-01 12:57:07,120 - INFO - Successfully loaded JSON: /media/shahmir/Shahmir/ee/a105003_stage_v_step2_topic_7_تشخیص_افتراقی.json
2026-01-01 12:57:07,120 - INFO -   Added 14 questions from Topic 'تشخیص افتراقی' (Subchapter: 'پمفیگوئید بولوز')
2026-01-01 12:57:07,121 - INFO - Successfully loaded JSON: /media/shahmir/Shahmir/ee/a105003_stage_v_step2_topic_8_پروگنوز_و_پایش.json
2026-01-01 12:57:07,121 - INFO -   Added 8 questions from Topic 'پروگنوز و پایش' (Subchapter: 'پمفیگوئید بولوز')
2026-01-01 12:57:07,122 - INFO - Successfully loaded JSON: /media/shahmir/Shahmir/ee/a105003_stage_v_step2_topic_9_درمان.json
2026-01-01 12:57:07,122 - INFO -   Added 12 questions from Topic 'درمان' (Subchapter: 'پمفیگوئید بولوز')
2026-01-01 12:57:07,122 - INFO - Successfully loaded JSON: /media/shahmir/Shahmir/ee/a105003_stage_v_step2_topic_10_مقدمه.json
2026-01-01 12:57:07,123 - INFO -   Added 16 questions from Topic 'مقدمه' (Subchapter: 'پمفیگوئید غشاء مخاطی')
2026-01-01 12:57:07,123 - INFO - Successfully loaded JSON: /media/shahmir/Shahmir/ee/a105003_stage_v_step2_topic_11_تاریخچه_و_اپیدمیولوژی.json
2026-01-01 12:57:07,123 - INFO -   Added 8 questions from Topic 'تاریخچه و اپیدمیولوژی' (Subchapter: 'پمفیگوئید غشاء مخاطی')
2026-01-01 12:57:07,124 - INFO - Successfully loaded JSON: /media/shahmir/Shahmir/ee/a105003_stage_v_step2_topic_12_پاتوژنز.json
2026-01-01 12:57:07,124 - INFO -   Added 16 questions from Topic 'پاتوژنز' (Subchapter: 'پمفیگوئید غشاء مخاطی')
2026-01-01 12:57:07,124 - INFO - Successfully loaded JSON: /media/shahmir/Shahmir/ee/a105003_stage_v_step2_topic_13_ویژگیهای_بالینی.json
2026-01-01 12:57:07,124 - INFO -   Added 12 questions from Topic 'ویژگی‌های بالینی' (Subchapter: 'پمفیگوئید غشاء مخاطی')
2026-01-01 12:57:07,125 - INFO - Successfully loaded JSON: /media/shahmir/Shahmir/ee/a105003_stage_v_step2_topic_14_تشخیص_و_تشخیص_افتراقی.json
2026-01-01 12:57:07,125 - INFO -   Added 13 questions from Topic 'تشخیص و تشخیص افتراقی' (Subchapter: 'پمفیگوئید غشاء مخاطی')
2026-01-01 12:57:07,125 - INFO - Successfully loaded JSON: /media/shahmir/Shahmir/ee/a105003_stage_v_step2_topic_15_پیشآگهی.json
2026-01-01 12:57:07,125 - INFO -   Added 10 questions from Topic 'پیش‌آگهی' (Subchapter: 'پمفیگوئید غشاء مخاطی')
2026-01-01 12:57:07,126 - INFO - Successfully loaded JSON: /media/shahmir/Shahmir/ee/a105003_stage_v_step2_topic_16_درمان.json
2026-01-01 12:57:07,126 - INFO -   Added 18 questions from Topic 'درمان' (Subchapter: 'پمفیگوئید غشاء مخاطی')
2026-01-01 12:57:07,126 - INFO - Successfully loaded JSON: /media/shahmir/Shahmir/ee/a105003_stage_v_step2_topic_17_مقدمه_تاریخچه_و_اپیدمیولوژی.json
2026-01-01 12:57:07,127 - INFO -   Added 9 questions from Topic 'مقدمه، تاریخچه و اپیدمیولوژی' (Subchapter: 'اپیدرمولیز بولوزا اکتسابی')
2026-01-01 12:57:07,127 - INFO - Successfully loaded JSON: /media/shahmir/Shahmir/ee/a105003_stage_v_step2_topic_18_پاتوژنز.json
2026-01-01 12:57:07,127 - INFO -   Added 13 questions from Topic 'پاتوژنز' (Subchapter: 'اپیدرمولیز بولوزا اکتسابی')
2026-01-01 12:57:07,128 - INFO - Successfully loaded JSON: /media/shahmir/Shahmir/ee/a105003_stage_v_step2_topic_19_ویژگیهای_بالینی.json
2026-01-01 12:57:07,128 - INFO -   Added 14 questions from Topic 'ویژگی‌های بالینی' (Subchapter: 'اپیدرمولیز بولوزا اکتسابی')
2026-01-01 12:57:07,129 - INFO - Successfully loaded JSON: /media/shahmir/Shahmir/ee/a105003_stage_v_step2_topic_20_تشخیص_و_تشخیص_افتراقی.json
2026-01-01 12:57:07,129 - INFO -   Added 16 questions from Topic 'تشخیص و تشخیص افتراقی' (Subchapter: 'اپیدرمولیز بولوزا اکتسابی')
2026-01-01 12:57:07,129 - INFO - Successfully loaded JSON: /media/shahmir/Shahmir/ee/a105003_stage_v_step2_topic_21_درمان.json
2026-01-01 12:57:07,129 - INFO -   Added 8 questions from Topic 'درمان' (Subchapter: 'اپیدرمولیز بولوزا اکتسابی')
2026-01-01 12:57:07,139 - INFO - Successfully saved JSON: /media/shahmir/Shahmir/ee/b105003.json (297 records)
2026-01-01 12:57:07,139 - INFO - Final output saved to: /media/shahmir/Shahmir/ee/b105003.json
2026-01-01 13:03:37,989 - INFO - Loaded 14 predefined prompts
2026-01-01 13:03:38,006 - INFO - python-docx library is available
2026-01-01 13:03:38,006 - INFO - python-docx library is available
2026-01-01 13:04:17,261 - INFO - Loaded 3 API keys
2026-01-01 13:04:47,044 - INFO - [get_default_model] ComboBox value: gemini-2.5-pro, StringVar value: gemini-2.5-pro
2026-01-01 13:04:47,044 - INFO - [get_default_model] Returning model from ComboBox: gemini-2.5-pro
2026-01-01 13:04:47,045 - INFO - Starting Stage H processing...
2026-01-01 13:04:47,045 - INFO - Loading Stage J JSON...
2026-01-01 13:04:47,046 - INFO - Successfully loaded JSON: /media/shahmir/Shahmir/ee/a105003.json
2026-01-01 13:04:47,047 - INFO - Loaded 888 records from Stage J
2026-01-01 13:04:47,047 - INFO - Prepared 888 records from Stage J for prompt (without Imp column)
2026-01-01 13:04:47,047 - INFO - Detected Book ID: 105, Chapter ID: 3
2026-01-01 13:04:47,047 - INFO - Loading Stage F JSON...
2026-01-01 13:04:47,047 - INFO - Successfully loaded JSON: /media/shahmir/Shahmir/ee/f.json
2026-01-01 13:04:47,047 - INFO - Loaded 42 records from Stage F
2026-01-01 13:04:47,048 - INFO - Splitting Stage J data into 6 parts (160 records per part, total: 888 records)
2026-01-01 13:04:47,048 - INFO - Processing Part 1/6 (160 records, indices 0 to 159)...
2026-01-01 13:04:47,048 - INFO - Initialized/recreated text client with model: gemini-2.5-pro
2026-01-01 13:08:26,409 - INFO - Text processed successfully with gemini-2.5-pro
2026-01-01 13:08:26,409 - INFO - Part 1 response received (60283 characters)
2026-01-01 13:08:26,410 - INFO - Part 1 saved to TXT file
2026-01-01 13:08:26,411 - INFO - Extracting JSON from Part 1 response...
2026-01-01 13:08:26,411 - INFO - Successfully extracted JSON from response
2026-01-01 13:08:26,411 - INFO - Extracted 202 records from Part 1
2026-01-01 13:08:26,411 - INFO - Part 1 processed: 202 flashcards extracted and added to mapping
2026-01-01 13:08:26,411 - INFO - Processing Part 2/6 (160 records, indices 160 to 319)...
2026-01-01 13:11:29,229 - INFO - Text processed successfully with gemini-2.5-pro
2026-01-01 13:11:29,230 - INFO - Part 2 response received (47242 characters)
2026-01-01 13:11:29,231 - INFO - Part 2 saved to TXT file
2026-01-01 13:11:29,232 - INFO - Extracting JSON from Part 2 response...
2026-01-01 13:11:29,233 - INFO - Successfully extracted JSON from response
2026-01-01 13:11:29,234 - INFO - Extracted 160 records from Part 2
2026-01-01 13:11:29,235 - INFO - Part 2 processed: 160 flashcards extracted and added to mapping
2026-01-01 13:11:29,235 - INFO - Processing Part 3/6 (160 records, indices 320 to 479)...
2026-01-01 13:14:22,828 - INFO - Text processed successfully with gemini-2.5-pro
2026-01-01 13:14:22,830 - INFO - Part 3 response received (47431 characters)
2026-01-01 13:14:22,832 - INFO - Part 3 saved to TXT file
2026-01-01 13:14:22,833 - INFO - Extracting JSON from Part 3 response...
2026-01-01 13:14:22,835 - INFO - Successfully extracted JSON from response
2026-01-01 13:14:22,835 - INFO - Extracted 160 records from Part 3
2026-01-01 13:14:22,836 - INFO - Part 3 processed: 160 flashcards extracted and added to mapping
2026-01-01 13:14:22,837 - INFO - Processing Part 4/6 (160 records, indices 480 to 639)...
2026-01-01 13:17:18,447 - INFO - Text processed successfully with gemini-2.5-pro
2026-01-01 13:17:18,447 - INFO - Part 4 response received (46319 characters)
2026-01-01 13:17:18,448 - INFO - Part 4 saved to TXT file
2026-01-01 13:17:18,448 - INFO - Extracting JSON from Part 4 response...
2026-01-01 13:17:18,448 - INFO - Successfully extracted JSON from response
2026-01-01 13:17:18,448 - INFO - Extracted 160 records from Part 4
2026-01-01 13:17:18,448 - INFO - Part 4 processed: 160 flashcards extracted and added to mapping
2026-01-01 13:17:18,448 - INFO - Processing Part 5/6 (160 records, indices 640 to 799)...
2026-01-01 13:20:11,050 - INFO - Text processed successfully with gemini-2.5-pro
2026-01-01 13:20:11,050 - INFO - Part 5 response received (47017 characters)
2026-01-01 13:20:11,051 - INFO - Part 5 saved to TXT file
2026-01-01 13:20:11,052 - INFO - Extracting JSON from Part 5 response...
2026-01-01 13:20:11,053 - INFO - Successfully extracted JSON from response
2026-01-01 13:20:11,053 - INFO - Extracted 160 records from Part 5
2026-01-01 13:20:11,053 - INFO - Part 5 processed: 160 flashcards extracted and added to mapping
2026-01-01 13:20:11,054 - INFO - Processing Part 6/6 (88 records, indices 800 to 887)...
2026-01-01 13:22:37,097 - INFO - Text processed successfully with gemini-2.5-pro
2026-01-01 13:22:37,098 - INFO - Part 6 response received (27176 characters)
2026-01-01 13:22:37,099 - INFO - Part 6 saved to TXT file
2026-01-01 13:22:37,100 - INFO - Extracting JSON from Part 6 response...
2026-01-01 13:22:37,101 - INFO - Successfully extracted JSON from response
2026-01-01 13:22:37,101 - INFO - Extracted 88 records from Part 6
2026-01-01 13:22:37,102 - INFO - Part 6 processed: 88 flashcards extracted and added to mapping
2026-01-01 13:22:37,103 - INFO - Total flashcard data collected: 888 PointIds
2026-01-01 13:22:37,103 - INFO - Merging Stage J data with collected flashcard data...
2026-01-01 13:22:37,106 - INFO - Generated 888 flashcard records
2026-01-01 13:22:37,107 - INFO - Matched 888 records with flashcard data from model
2026-01-01 13:22:37,108 - INFO - Saving Stage H output to: /media/shahmir/Shahmir/ee/ac105003.json
2026-01-01 13:22:37,127 - INFO - Successfully saved JSON: /media/shahmir/Shahmir/ee/ac105003.json (888 records)
2026-01-01 13:22:37,128 - INFO - Stage H completed successfully: /media/shahmir/Shahmir/ee/ac105003.json
2026-01-01 13:26:04,502 - INFO - Starting Stage M processing...
2026-01-01 13:26:04,502 - INFO - Loading Stage H JSON...
2026-01-01 13:26:04,505 - INFO - Successfully loaded JSON: /media/shahmir/Shahmir/ee/ac105003.json
2026-01-01 13:26:04,505 - INFO - Loaded 888 records from Stage H
2026-01-01 13:26:04,506 - INFO - Detected Book ID: 105, Chapter ID: 3
2026-01-01 13:26:04,506 - INFO - Extracting unique (chapter, subchapter, topic) combinations...
2026-01-01 13:26:04,506 - INFO - Extracted 21 unique topics
2026-01-01 13:26:04,506 - INFO - Saving Stage M output to: /media/shahmir/Shahmir/ee/i105003.json
2026-01-01 13:26:04,506 - INFO - Successfully saved JSON: /media/shahmir/Shahmir/ee/i105003.json (21 records)
2026-01-01 13:26:04,506 - INFO - Stage M completed successfully: /media/shahmir/Shahmir/ee/i105003.json
2026-01-01 13:27:16,520 - INFO - [get_default_model] ComboBox value: gemini-2.5-pro, StringVar value: gemini-2.5-pro
2026-01-01 13:27:16,520 - INFO - [get_default_model] Returning model from ComboBox: gemini-2.5-pro
2026-01-01 13:27:16,520 - INFO - Starting Stage L processing...
2026-01-01 13:27:16,520 - INFO - Loading Stage J JSON...
2026-01-01 13:27:16,522 - INFO - Successfully loaded JSON: /media/shahmir/Shahmir/ee/a105003.json
2026-01-01 13:27:16,522 - INFO - Loaded 888 records from Stage J
2026-01-01 13:27:16,522 - INFO - Detected Book ID: 105, Chapter ID: 3
2026-01-01 13:27:16,522 - INFO - Loading Stage V JSON...
2026-01-01 13:27:16,524 - INFO - Successfully loaded JSON: /media/shahmir/Shahmir/ee/b105003.json
2026-01-01 13:27:16,524 - INFO - Loaded 297 records from Stage V
2026-01-01 13:27:16,524 - INFO - Building overview context from Stage J and Stage V...
2026-01-01 13:27:16,524 - INFO - Calling model for Stage L overview...
2026-01-01 13:28:12,223 - INFO - Text processed successfully with gemini-2.5-pro
2026-01-01 13:28:12,223 - INFO - Model response received (3938 characters)
2026-01-01 13:28:12,224 - INFO - Saved raw model response to: /media/shahmir/Shahmir/ee/a105003_stage_l.txt
2026-01-01 13:28:12,224 - INFO - Extracting JSON from model response...
2026-01-01 13:28:12,224 - INFO - Successfully extracted JSON from response
2026-01-01 13:28:12,224 - WARNING - No data/points/rows/chapters found in JSON, returning empty list
2026-01-01 13:28:12,224 - INFO - Detected direct chapter overview structure, wrapping as single record
2026-01-01 13:28:12,224 - INFO - Extracted 1 overview record(s) from model
2026-01-01 13:28:12,224 - INFO - Saving Stage L output to: /media/shahmir/Shahmir/ee/o105003.json
2026-01-01 13:28:12,224 - INFO - Successfully saved JSON: /media/shahmir/Shahmir/ee/o105003.json (1 records)
2026-01-01 13:28:12,225 - INFO - Stage L completed successfully: /media/shahmir/Shahmir/ee/o105003.json
2026-01-01 13:32:35,449 - INFO - [get_default_model] ComboBox value: gemini-2.5-pro, StringVar value: gemini-2.5-pro
2026-01-01 13:32:35,449 - INFO - [get_default_model] Returning model from ComboBox: gemini-2.5-pro
2026-01-01 13:32:35,449 - INFO - [get_default_model] ComboBox value: gemini-2.5-pro, StringVar value: gemini-2.5-pro
2026-01-01 13:32:35,449 - INFO - [get_default_model] Returning model from ComboBox: gemini-2.5-pro
2026-01-01 13:32:35,449 - INFO - Starting Stage X processing...
2026-01-01 13:32:35,450 - INFO - Successfully loaded JSON: /media/shahmir/Shahmir/ee/a105003.json
2026-01-01 13:32:35,450 - INFO - Part 1: Extracting text from old book PDF...
2026-01-01 13:32:35,451 - INFO - PDF has 20 pages. Part 1: pages 1-10, Part 2: pages 11-20
2026-01-01 13:32:35,452 - INFO - Text client initialized with model: gemini-2.5-pro
2026-01-01 13:32:35,452 - INFO - Extracting text from Part 1 (pages 1-10)...
2026-01-01 13:32:35,493 - INFO - Successfully extracted 42957 characters from pages 1-10 using PyMuPDF
2026-01-01 13:32:35,493 - INFO - Processing Part 1 with model...
2026-01-01 13:32:35,493 - INFO - Model: gemini-2.5-pro, Max tokens for model: 32768
2026-01-01 13:34:29,658 - INFO - Saved Part 1 TXT: Dermatology 2-Volume Set (Jean L. Bolognia MD, Julie V. Schaffer MD etc.) (Z-Library)-596-615_stage_x_part1_part1.txt
2026-01-01 13:34:29,658 - INFO - Extracting JSON from Part 1...
2026-01-01 13:34:29,658 - INFO - Successfully extracted JSON from response
2026-01-01 13:34:29,658 - INFO - Part 1: Extracted 0 rows
2026-01-01 13:34:29,659 - INFO - Extracting text from Part 2 (pages 11-20)...
2026-01-01 13:34:29,685 - INFO - Successfully extracted 56867 characters from pages 11-20 using PyMuPDF
2026-01-01 13:34:29,685 - INFO - Processing Part 2 with model...
2026-01-01 13:34:29,685 - INFO - Model: gemini-2.5-pro, Max tokens for model: 32768
2026-01-01 13:37:10,115 - INFO - Saved Part 2 TXT: Dermatology 2-Volume Set (Jean L. Bolognia MD, Julie V. Schaffer MD etc.) (Z-Library)-596-615_stage_x_part1_part2.txt
2026-01-01 13:37:10,116 - INFO - Extracting JSON from Part 2...
2026-01-01 13:37:10,116 - INFO - Successfully extracted JSON from response
2026-01-01 13:37:10,116 - INFO - Part 2: Extracted 0 rows
2026-01-01 13:37:10,116 - ERROR - No JSON data extracted from any batch
2026-01-01 13:37:10,116 - ERROR - Part 1: PDF extraction failed
2026-01-01 14:46:21,693 - INFO - [get_default_model] ComboBox value: gemini-2.5-pro, StringVar value: gemini-2.5-pro
2026-01-01 14:46:21,693 - INFO - [get_default_model] Returning model from ComboBox: gemini-2.5-pro
2026-01-01 14:46:21,693 - INFO - [get_default_model] ComboBox value: gemini-2.5-pro, StringVar value: gemini-2.5-pro
2026-01-01 14:46:21,693 - INFO - [get_default_model] Returning model from ComboBox: gemini-2.5-pro
2026-01-01 14:46:21,693 - INFO - Starting Stage X processing...
2026-01-01 14:46:21,695 - INFO - Successfully loaded JSON: /media/shahmir/Shahmir/ee/a105003.json
2026-01-01 14:46:21,695 - INFO - Part 1: Extracting text from old book PDF...
2026-01-01 14:46:21,696 - INFO - PDF has 20 pages. Part 1: pages 1-10, Part 2: pages 11-20
2026-01-01 14:46:21,696 - INFO - Text client initialized with model: gemini-2.5-pro
2026-01-01 14:46:21,696 - INFO - Extracting text from Part 1 (pages 1-10)...
2026-01-01 14:46:21,724 - INFO - Successfully extracted 42957 characters from pages 1-10 using PyMuPDF
2026-01-01 14:46:21,724 - INFO - Processing Part 1 with model...
2026-01-01 14:46:21,724 - INFO - Model: gemini-2.5-pro, Max tokens for model: 32768
2026-01-01 14:48:23,241 - INFO - Saved Part 1 TXT: Dermatology 2-Volume Set (Jean L. Bolognia MD, Julie V. Schaffer MD etc.) (Z-Library)-596-615_stage_x_part1_part1.txt
2026-01-01 14:48:23,241 - INFO - Extracting JSON from Part 1...
2026-01-01 14:48:23,242 - INFO - Successfully extracted JSON from response
2026-01-01 14:48:23,242 - INFO - Part 1: Extracted 0 rows
2026-01-01 14:48:23,242 - INFO - Extracting text from Part 2 (pages 11-20)...
2026-01-01 14:48:23,267 - INFO - Successfully extracted 56867 characters from pages 11-20 using PyMuPDF
2026-01-01 14:48:23,267 - INFO - Processing Part 2 with model...
2026-01-01 14:48:23,267 - INFO - Model: gemini-2.5-pro, Max tokens for model: 32768
2026-01-01 14:51:05,759 - INFO - Saved Part 2 TXT: Dermatology 2-Volume Set (Jean L. Bolognia MD, Julie V. Schaffer MD etc.) (Z-Library)-596-615_stage_x_part1_part2.txt
2026-01-01 14:51:05,760 - INFO - Extracting JSON from Part 2...
2026-01-01 14:51:05,760 - INFO - Successfully extracted JSON from response
2026-01-01 14:51:05,760 - INFO - Part 2: Extracted 0 rows
2026-01-01 14:51:05,760 - ERROR - No JSON data extracted from any batch
2026-01-01 14:51:05,760 - ERROR - Part 1: PDF extraction failed
2026-01-01 14:54:40,386 - INFO - Loaded 14 predefined prompts
2026-01-01 14:54:40,402 - INFO - python-docx library is available
2026-01-01 14:54:40,403 - INFO - python-docx library is available
2026-01-01 14:56:11,318 - INFO - Loaded 3 API keys
2026-01-01 14:57:11,150 - INFO - [get_default_model] ComboBox value: gemini-2.5-pro, StringVar value: gemini-2.5-pro
2026-01-01 14:57:11,150 - INFO - [get_default_model] Returning model from ComboBox: gemini-2.5-pro
2026-01-01 14:57:11,150 - INFO - [get_default_model] ComboBox value: gemini-2.5-pro, StringVar value: gemini-2.5-pro
2026-01-01 14:57:11,150 - INFO - [get_default_model] Returning model from ComboBox: gemini-2.5-pro
2026-01-01 14:57:11,150 - INFO - Starting Stage X processing...
2026-01-01 14:57:11,152 - INFO - Successfully loaded JSON: /media/shahmir/Shahmir/ee/a105003.json
2026-01-01 14:57:11,152 - INFO - Part 1: Extracting text from old book PDF...
2026-01-01 14:57:11,153 - INFO - PDF has 20 pages. Part 1: pages 1-10, Part 2: pages 11-20
2026-01-01 14:57:11,154 - INFO - Text client initialized with model: gemini-2.5-pro
2026-01-01 14:57:11,154 - INFO - Extracting text from Part 1 (pages 1-10)...
2026-01-01 14:57:11,193 - INFO - Successfully extracted 42957 characters from pages 1-10 using PyMuPDF
2026-01-01 14:57:11,194 - INFO - Processing Part 1 with model...
2026-01-01 14:57:11,194 - INFO - Model: gemini-2.5-pro, Max tokens for model: 32768
2026-01-01 14:59:07,154 - INFO - Saved Part 1 TXT: Dermatology 2-Volume Set (Jean L. Bolognia MD, Julie V. Schaffer MD etc.) (Z-Library)-596-615_stage_x_part1_part1.txt
2026-01-01 14:59:07,155 - INFO - Extracting JSON from Part 1...
2026-01-01 14:59:07,155 - INFO - Successfully extracted JSON from response
2026-01-01 14:59:07,155 - INFO - Part 1: Extracted 1 rows
2026-01-01 14:59:07,155 - INFO - Extracting text from Part 2 (pages 11-20)...
2026-01-01 14:59:07,183 - INFO - Successfully extracted 56867 characters from pages 11-20 using PyMuPDF
2026-01-01 14:59:07,183 - INFO - Processing Part 2 with model...
2026-01-01 14:59:07,183 - INFO - Model: gemini-2.5-pro, Max tokens for model: 32768
2026-01-01 15:02:03,834 - INFO - Saved Part 2 TXT: Dermatology 2-Volume Set (Jean L. Bolognia MD, Julie V. Schaffer MD etc.) (Z-Library)-596-615_stage_x_part1_part2.txt
2026-01-01 15:02:03,835 - INFO - Extracting JSON from Part 2...
2026-01-01 15:02:03,835 - INFO - Successfully extracted JSON from response
2026-01-01 15:02:03,835 - INFO - Part 2: Extracted 1 rows
2026-01-01 15:02:03,835 - INFO - Saved combined TXT file: Dermatology 2-Volume Set (Jean L. Bolognia MD, Julie V. Schaffer MD etc.) (Z-Library)-596-615_stage_x_part1_all_parts.txt
2026-01-01 15:02:03,836 - INFO - Saved extracted JSON: Dermatology 2-Volume Set (Jean L. Bolognia MD, Julie V. Schaffer MD etc.) (Z-Library)-596-615_stage_x_part1_extracted.json
2026-01-01 15:02:03,836 - INFO - Part 1 completed: Dermatology 2-Volume Set (Jean L. Bolognia MD, Julie V. Schaffer MD etc.) (Z-Library)-596-615_stage_x_part1_extracted.json
2026-01-01 15:02:03,836 - INFO - Part 2: Detecting changes...
2026-01-01 15:02:03,837 - INFO - Loaded 888 records from Stage A (Imp column removed)
2026-01-01 15:02:03,837 - INFO - Successfully loaded JSON: /media/shahmir/Shahmir/ee/Dermatology 2-Volume Set (Jean L. Bolognia MD, Julie V. Schaffer MD etc.) (Z-Library)-596-615_stage_x_part1_extracted.json
2026-01-01 15:02:03,837 - INFO - Loaded 2 rows from extracted PDF
2026-01-01 15:02:03,837 - INFO - Divided Stage A into 3 parts: Part 1 (296 records), Part 2 (296 records), Part 3 (296 records)
2026-01-01 15:02:03,837 - INFO - ============================================================
2026-01-01 15:02:03,837 - INFO - Processing Part 1 of Stage A for change detection...
2026-01-01 15:02:03,837 - INFO - ============================================================
2026-01-01 15:04:12,703 - INFO - Text processed successfully with gemini-2.5-pro
2026-01-01 15:04:12,704 - INFO - Saved Part 1 raw response to: a105003_stage_x_part2_part1.txt
2026-01-01 15:04:12,704 - INFO - Saved Stage X Part 2 Part 1 raw response to: /media/shahmir/Shahmir/ee/a105003_stage_x_part2_part1.txt
2026-01-01 15:04:12,704 - INFO - Extracting JSON from Part 1 response...
2026-01-01 15:04:12,704 - INFO - Successfully extracted JSON from response
2026-01-01 15:04:12,704 - INFO - Part 1: Extracted 296 changes
2026-01-01 15:04:12,704 - INFO - ============================================================
2026-01-01 15:04:12,704 - INFO - Processing Part 2 of Stage A for change detection...
2026-01-01 15:04:12,705 - INFO - ============================================================
2026-01-01 15:06:37,857 - INFO - Text processed successfully with gemini-2.5-pro
2026-01-01 15:06:37,857 - INFO - Saved Part 2 raw response to: a105003_stage_x_part2_part2.txt
2026-01-01 15:06:37,858 - INFO - Saved Stage X Part 2 Part 2 raw response to: /media/shahmir/Shahmir/ee/a105003_stage_x_part2_part2.txt
2026-01-01 15:06:37,858 - INFO - Extracting JSON from Part 2 response...
2026-01-01 15:06:37,858 - INFO - Successfully extracted JSON from response
2026-01-01 15:06:37,858 - INFO - Part 2: Extracted 296 changes
2026-01-01 15:06:37,859 - INFO - ============================================================
2026-01-01 15:06:37,859 - INFO - Processing Part 3 of Stage A for change detection...
2026-01-01 15:06:37,859 - INFO - ============================================================
2026-01-01 15:08:49,632 - INFO - Text processed successfully with gemini-2.5-pro
2026-01-01 15:08:49,632 - INFO - Saved Part 3 raw response to: a105003_stage_x_part2_part3.txt
2026-01-01 15:08:49,632 - INFO - Saved Stage X Part 2 Part 3 raw response to: /media/shahmir/Shahmir/ee/a105003_stage_x_part2_part3.txt
2026-01-01 15:08:49,632 - INFO - Extracting JSON from Part 3 response...
2026-01-01 15:08:49,633 - INFO - Successfully extracted JSON from response
2026-01-01 15:08:49,633 - INFO - Part 3: Extracted 296 changes
2026-01-01 15:08:49,633 - INFO - Saved combined TXT: a105003_stage_x_part2_all_parts.txt
2026-01-01 15:08:49,633 - INFO - Total validated changes: 888
2026-01-01 15:08:49,636 - INFO - Successfully saved JSON: /media/shahmir/Shahmir/ee/x105003.json (888 records)
2026-01-01 15:08:49,636 - INFO - Stage X completed: /media/shahmir/Shahmir/ee/x105003.json
2026-01-01 15:11:58,228 - INFO - [get_default_model] ComboBox value: gemini-2.5-pro, StringVar value: gemini-2.5-pro
2026-01-01 15:11:58,228 - INFO - [get_default_model] Returning model from ComboBox: gemini-2.5-pro
2026-01-01 15:11:58,228 - INFO - [get_default_model] ComboBox value: gemini-2.5-pro, StringVar value: gemini-2.5-pro
2026-01-01 15:11:58,228 - INFO - [get_default_model] Returning model from ComboBox: gemini-2.5-pro
2026-01-01 15:11:58,228 - INFO - Starting Stage Y processing...
2026-01-01 15:11:58,229 - INFO - Successfully loaded JSON: /media/shahmir/Shahmir/ee/OCR Extraction.json
2026-01-01 15:11:58,229 - INFO - ============================================================
2026-01-01 15:11:58,229 - INFO - STEP 1: Extracting PDF from old reference (2 parts)...
2026-01-01 15:11:58,229 - INFO - ============================================================
2026-01-01 15:11:58,230 - INFO - PDF has 20 pages. Part 1: pages 1-10, Part 2: pages 11-20
2026-01-01 15:11:58,230 - INFO - Text client initialized with model: gemini-2.5-pro
2026-01-01 15:11:58,230 - INFO - Extracting text from Part 1 (pages 1-10)...
2026-01-01 15:11:58,260 - INFO - Successfully extracted 42957 characters from pages 1-10 using PyMuPDF
2026-01-01 15:11:58,260 - INFO - Processing Part 1 with model...
2026-01-01 15:11:58,261 - INFO - Processing pages 1-10 with model (handling retries automatically)...
2026-01-01 15:14:12,884 - INFO - Text processed successfully with gemini-2.5-pro
2026-01-01 15:14:12,885 - INFO - Received response for pages 1-10 (48242 characters)
2026-01-01 15:14:12,887 - INFO - Saved Part 1 TXT: Dermatology 2-Volume Set (Jean L. Bolognia MD, Julie V. Schaffer MD etc.) (Z-Library)-596-615_stage_y_step1_part1.txt
2026-01-01 15:14:12,888 - INFO - Extracting JSON from Part 1...
2026-01-01 15:14:12,889 - INFO - Successfully extracted JSON from response
2026-01-01 15:14:12,890 - INFO - Part 1: Extracted 1 rows
2026-01-01 15:14:12,890 - INFO - Extracting text from Part 2 (pages 11-20)...
2026-01-01 15:14:12,935 - INFO - Successfully extracted 56867 characters from pages 11-20 using PyMuPDF
2026-01-01 15:14:12,935 - INFO - Processing Part 2 with model...
2026-01-01 15:14:12,936 - INFO - Processing pages 11-20 with model (handling retries automatically)...
2026-01-01 15:16:15,724 - INFO - Text processed successfully with gemini-2.5-pro
2026-01-01 15:16:15,725 - INFO - Received response for pages 11-20 (42749 characters)
2026-01-01 15:16:15,726 - INFO - Saved Part 2 TXT: Dermatology 2-Volume Set (Jean L. Bolognia MD, Julie V. Schaffer MD etc.) (Z-Library)-596-615_stage_y_step1_part2.txt
2026-01-01 15:16:15,727 - INFO - Extracting JSON from Part 2...
2026-01-01 15:16:15,727 - INFO - Successfully extracted JSON from response
2026-01-01 15:16:15,728 - INFO - Part 2: Extracted 1 rows
2026-01-01 15:16:15,732 - INFO - Step 1 combined output saved to: /media/shahmir/Shahmir/ee/stage_y_step1_52024.json
2026-01-01 15:16:15,733 - INFO - Step 1 completed. Output saved to: /media/shahmir/Shahmir/ee/stage_y_step1_52024.json
2026-01-01 15:16:15,733 - INFO - ============================================================
2026-01-01 15:16:15,734 - INFO - STEP 2: Detecting deletions...
2026-01-01 15:16:15,734 - INFO - ============================================================
2026-01-01 15:16:15,735 - INFO - Successfully loaded JSON: /media/shahmir/Shahmir/ee/stage_y_step1_52024.json
2026-01-01 15:16:15,736 - INFO - Loaded 2 rows from Step 1 output
2026-01-01 15:16:15,736 - INFO - Successfully loaded JSON: /media/shahmir/Shahmir/ee/OCR Extraction.json
2026-01-01 15:16:15,737 - INFO - Loaded 1 records from OCR Extraction JSON
2026-01-01 15:16:15,742 - INFO - Calling model for deletion detection...
2026-01-01 15:17:46,965 - INFO - Text processed successfully with gemini-2.5-pro
2026-01-01 15:17:46,966 - INFO - Saved Step 2 raw response to: OCR Extraction_stage_y_step2.txt
2026-01-01 15:17:46,967 - INFO - Extracting JSON from Step 2 response...
2026-01-01 15:17:46,968 - INFO - Successfully extracted JSON from response
2026-01-01 15:17:46,969 - INFO - Total validated deletions: 23
2026-01-01 15:17:46,970 - INFO - Successfully saved JSON: /media/shahmir/Shahmir/ee/y0052024.json (23 records)
2026-01-01 15:17:46,971 - INFO - Stage Y completed: /media/shahmir/Shahmir/ee/y0052024.json
2026-01-01 15:17:46,972 - INFO - Stage Y completed successfully: /media/shahmir/Shahmir/ee/y0052024.json
2026-01-01 15:19:00,263 - INFO - [get_default_model] ComboBox value: gemini-2.5-pro, StringVar value: gemini-2.5-pro
2026-01-01 15:19:00,264 - INFO - [get_default_model] Returning model from ComboBox: gemini-2.5-pro
2026-01-01 15:19:00,264 - INFO - Starting Stage Z processing...
2026-01-01 15:19:00,270 - INFO - Successfully loaded JSON: /media/shahmir/Shahmir/ee/a105003.json
2026-01-01 15:19:00,271 - INFO - Loaded 888 records from Stage A (Imp column removed)
2026-01-01 15:19:00,273 - INFO - Successfully loaded JSON: /media/shahmir/Shahmir/ee/x105003.json
2026-01-01 15:19:00,273 - INFO - Loaded 888 changes from Stage X
2026-01-01 15:19:00,274 - INFO - Successfully loaded JSON: /media/shahmir/Shahmir/ee/y0052024.json
2026-01-01 15:19:00,274 - INFO - Loaded 23 deletions from Stage Y
2026-01-01 15:19:00,275 - INFO - Processing Stage A as a whole (888 records)
2026-01-01 15:19:00,289 - INFO - Calling model for RichText generation...
2026-01-01 15:23:02,663 - ERROR - Text processing failed: 429 Resource has been exhausted (e.g. check quota).
2026-01-01 15:23:02,664 - ERROR - Model returned no response
2026-01-01 16:31:46,952 - INFO - [get_default_model] ComboBox value: gemini-2.5-pro, StringVar value: gemini-2.5-pro
2026-01-01 16:31:46,952 - INFO - [get_default_model] Returning model from ComboBox: gemini-2.5-pro
2026-01-01 16:31:46,952 - INFO - Starting Stage Z processing...
2026-01-01 16:31:46,953 - INFO - Successfully loaded JSON: /media/shahmir/Shahmir/ee/a105003.json
2026-01-01 16:31:46,953 - INFO - Loaded 888 records from Stage A (Imp column removed)
2026-01-01 16:31:46,954 - INFO - Successfully loaded JSON: /media/shahmir/Shahmir/ee/x105003.json
2026-01-01 16:31:46,954 - INFO - Loaded 888 changes from Stage X
2026-01-01 16:31:46,954 - INFO - Successfully loaded JSON: /media/shahmir/Shahmir/ee/y0052024.json
2026-01-01 16:31:46,954 - INFO - Loaded 23 deletions from Stage Y
2026-01-01 16:31:46,954 - INFO - Processing Stage A as a whole (888 records)
2026-01-01 16:31:46,958 - INFO - Calling model for RichText generation...
2026-01-01 16:32:20,032 - ERROR - Text processing failed: 429 Resource has been exhausted (e.g. check quota).
2026-01-01 16:32:20,032 - ERROR - Model returned no response
2026-01-03 09:59:22,036 - INFO - Loaded 14 predefined prompts
2026-01-03 09:59:22,068 - INFO - python-docx library is available
2026-01-03 09:59:22,068 - INFO - python-docx library is available
2026-01-03 10:00:02,248 - INFO - Loaded 3 API keys
2026-01-03 10:00:38,488 - INFO - Default output folder updated to: /home/shahmir/Desktop
2026-01-03 10:04:25,011 - INFO - Starting Pre-OCR Topic Extraction...
2026-01-03 10:04:25,012 - INFO - Extracted Book ID: 5, Chapter ID: 2024 from filename
2026-01-03 10:04:25,013 - INFO - Using Book ID: 5, Chapter ID: 2024
2026-01-03 10:04:25,013 - INFO - Extracting text from PDF...
2026-01-03 10:04:25,095 - INFO - Successfully extracted 117016 characters from 17 pages using PyMuPDF
2026-01-03 10:04:25,095 - INFO - Extracted 117,016 characters from PDF
2026-01-03 10:04:25,096 - INFO - Saved extracted text to: Bolognia 5th Edition 2024 (1)-29-6-22 (1)_extracted_text.txt
2026-01-03 10:04:25,096 - INFO - Extracted text saved to: /home/shahmir/Desktop/Bolognia 5th Edition 2024 (1)-29-6-22 (1)_extracted_text.txt
2026-01-03 10:04:25,096 - INFO - Processing PDF text to extract topics with LLM...
2026-01-03 10:04:25,096 - INFO - Text client initialized with model: gemini-2.5-pro
2026-01-03 10:04:56,788 - INFO - Received response (2058 characters)
2026-01-03 10:04:56,790 - INFO - Saved raw response to: Bolognia 5th Edition 2024 (1)-29-6-22 (1)_pre_ocr_topic.txt
2026-01-03 10:04:56,791 - INFO - Extracting JSON from response...
2026-01-03 10:04:56,791 - INFO - Successfully extracted JSON from response
2026-01-03 10:04:56,792 - INFO - Extracted 5 topics
2026-01-03 10:04:56,793 - INFO - Pre-OCR Topic Extraction completed: /home/shahmir/Desktop/t0052024.json
2026-01-03 10:04:56,793 - INFO - Pre-OCR Topic Extraction completed: /home/shahmir/Desktop/t0052024.json
2026-01-03 10:07:40,517 - INFO - [get_default_model] ComboBox value: gemini-2.5-pro, StringVar value: gemini-2.5-pro
2026-01-03 10:07:40,517 - INFO - [get_default_model] Returning model from ComboBox: gemini-2.5-pro
2026-01-03 10:07:40,518 - INFO - Using topic file: /home/shahmir/Desktop/t0052024.json, Book ID: 5, Chapter ID: 2024
2026-01-03 10:07:40,519 - INFO - Using output directory: /home/shahmir/Desktop
2026-01-03 10:07:40,590 - INFO - Successfully extracted 117016 characters from 17 pages using PyMuPDF
2026-01-03 10:07:40,591 - INFO - Text client initialized with model: gemini-2.5-pro
2026-01-03 10:11:33,264 - INFO - Saved response for Phototherapy with UVB to: /home/shahmir/Desktop/Bolognia 5th Edition 2024 (1)-29-6-22 (1)_subchapter_1_Phototherapy_with_UVB.txt
2026-01-03 10:11:33,265 - WARNING - Subchapter 'Phototherapy with the 308 nm Excimer Laser or Lamp' has no Topics, skipping
2026-01-03 10:15:26,794 - INFO - Saved response for Phototherapy with UVA1 to: /home/shahmir/Desktop/Bolognia 5th Edition 2024 (1)-29-6-22 (1)_subchapter_3_Phototherapy_with_UVA1.txt
2026-01-03 10:18:56,901 - INFO - Saved response for Photochemotherapy with Psoralens (PUVA) to: /home/shahmir/Desktop/Bolognia 5th Edition 2024 (1)-29-6-22 (1)_subchapter_4_Photochemotherapy_with_Psoralens_(PUVA).txt
2026-01-03 10:22:25,365 - INFO - Saved response for Extracorporeal Photochemotherapy (Photopheresis) to: /home/shahmir/Desktop/Bolognia 5th Edition 2024 (1)-29-6-22 (1)_subchapter_5_Extracorporeal_Photochemotherapy_(Photopheresis).txt
2026-01-03 10:22:25,367 - INFO - Successfully extracted JSON from response
2026-01-03 10:22:25,367 - INFO - Successfully extracted subchapter 'Phototherapy with UVB' from TXT file
2026-01-03 10:22:25,368 - WARNING - TXT file not found: /home/shahmir/Desktop/Bolognia 5th Edition 2024 (1)-29-6-22 (1)_subchapter_2_Phototherapy_with_the_308 nm_Excimer_Laser_or_Lamp.txt
2026-01-03 10:22:25,370 - INFO - Successfully extracted JSON from response
2026-01-03 10:22:25,370 - INFO - Successfully extracted subchapter 'Phototherapy with UVA1' from TXT file
2026-01-03 10:22:25,372 - INFO - Successfully extracted JSON from response
2026-01-03 10:22:25,372 - INFO - Successfully extracted subchapter 'Photochemotherapy with Psoralens (PUVA)' from TXT file
2026-01-03 10:22:25,373 - WARNING - Direct JSON parse failed: Expecting ',' delimiter: line 1 column 95240 (char 95239). Trying fallback extraction...
2026-01-03 10:22:25,374 - WARNING - Object extraction parse failed: Expecting ',' delimiter: line 1 column 95240 (char 95239)
2026-01-03 10:22:25,380 - INFO - Attempting to repair incomplete JSON...
2026-01-03 10:22:25,387 - WARNING - Repair method returned None
2026-01-03 10:22:25,387 - ERROR - All JSON extraction methods failed
2026-01-03 10:22:25,387 - WARNING - Failed to extract JSON from response
2026-01-03 10:22:25,387 - WARNING - Direct JSON parse failed: Expecting ',' delimiter: line 1 column 95240 (char 95239). Trying fallback extraction...
2026-01-03 10:22:25,388 - WARNING - Object extraction parse failed: Expecting ',' delimiter: line 1 column 95240 (char 95239)
2026-01-03 10:22:25,390 - INFO - Attempting to repair incomplete JSON...
2026-01-03 10:22:25,394 - WARNING - Repair method returned None
2026-01-03 10:22:25,395 - ERROR - All JSON extraction methods failed
2026-01-03 10:22:25,398 - INFO - Successfully parsed JSON after balancing
2026-01-03 10:22:25,398 - INFO - Successfully extracted subchapter 'Extracorporeal Photochemotherapy (Photopheresis)' from TXT file
2026-01-03 10:22:25,398 - INFO - Successfully extracted JSON from response
2026-01-03 10:22:25,399 - INFO - Extracted chapter name from first TXT file: Ultraviolet Therapy
2026-01-03 10:22:25,399 - INFO - OCR Extraction JSON saved to: /home/shahmir/Desktop/OCR Extraction.json
2026-01-03 10:56:57,570 - INFO - [get_default_model] ComboBox value: gemini-2.5-pro, StringVar value: gemini-2.5-pro
2026-01-03 10:56:57,570 - INFO - [get_default_model] Returning model from ComboBox: gemini-2.5-pro
2026-01-03 10:56:57,570 - INFO - Using topic file: /home/shahmir/Desktop/t0052024.json, Book ID: 5, Chapter ID: 2024
2026-01-03 10:56:57,571 - INFO - Using output directory: /home/shahmir/Desktop
2026-01-03 10:56:57,632 - INFO - Successfully extracted 117016 characters from 17 pages using PyMuPDF
2026-01-03 10:56:57,633 - INFO - Text client initialized with model: gemini-2.5-pro
2026-01-03 10:58:28,182 - INFO - Saved response for Phototherapy with UVB to: /home/shahmir/Desktop/Bolognia 5th Edition 2024 (1)-29-6-22 (1)_subchapter_1_Phototherapy_with_UVB.txt
2026-01-03 10:58:28,183 - WARNING - Subchapter 'Phototherapy with the 308 nm Excimer Laser or Lamp' has no Topics, skipping
2026-01-03 10:59:27,644 - INFO - Saved response for Phototherapy with UVA1 to: /home/shahmir/Desktop/Bolognia 5th Edition 2024 (1)-29-6-22 (1)_subchapter_3_Phototherapy_with_UVA1.txt
2026-01-03 11:03:20,550 - INFO - Saved response for Photochemotherapy with Psoralens (PUVA) to: /home/shahmir/Desktop/Bolognia 5th Edition 2024 (1)-29-6-22 (1)_subchapter_4_Photochemotherapy_with_Psoralens_(PUVA).txt
2026-01-03 11:04:06,278 - INFO - Saved response for Extracorporeal Photochemotherapy (Photopheresis) to: /home/shahmir/Desktop/Bolognia 5th Edition 2024 (1)-29-6-22 (1)_subchapter_5_Extracorporeal_Photochemotherapy_(Photopheresis).txt
2026-01-03 11:04:06,281 - INFO - Successfully extracted JSON from response
2026-01-03 11:04:06,282 - INFO - Successfully extracted subchapter 'Phototherapy with UVB' from TXT file
2026-01-03 11:04:06,282 - WARNING - TXT file not found: /home/shahmir/Desktop/Bolognia 5th Edition 2024 (1)-29-6-22 (1)_subchapter_2_Phototherapy_with_the_308 nm_Excimer_Laser_or_Lamp.txt
2026-01-03 11:04:06,283 - INFO - Successfully extracted JSON from response
2026-01-03 11:04:06,284 - INFO - Successfully extracted subchapter 'Phototherapy with UVA1' from TXT file
2026-01-03 11:04:06,284 - WARNING - No closing markdown marker found, JSON may be incomplete
2026-01-03 11:04:06,285 - WARNING - Direct JSON parse failed: Unterminated string starting at: line 181 column 30 (char 50187). Trying fallback extraction...
2026-01-03 11:04:06,286 - WARNING - Object extraction parse failed: Expecting ',' delimiter: line 175 column 14 (char 50000)
2026-01-03 11:04:06,292 - INFO - Attempting to repair incomplete JSON...
2026-01-03 11:04:06,294 - WARNING - Repair method returned None
2026-01-03 11:04:06,294 - ERROR - All JSON extraction methods failed
2026-01-03 11:04:06,294 - WARNING - Failed to extract JSON from response
2026-01-03 11:04:06,294 - WARNING - No closing markdown marker found, JSON may be incomplete
2026-01-03 11:04:06,294 - WARNING - Direct JSON parse failed: Unterminated string starting at: line 181 column 30 (char 50187). Trying fallback extraction...
2026-01-03 11:04:06,294 - WARNING - Object extraction parse failed: Expecting ',' delimiter: line 175 column 14 (char 50000)
2026-01-03 11:04:06,295 - INFO - Attempting to repair incomplete JSON...
2026-01-03 11:04:06,298 - WARNING - Repair method returned None
2026-01-03 11:04:06,298 - ERROR - All JSON extraction methods failed
2026-01-03 11:04:06,300 - WARNING - Failed to extract JSON from Persian text
2026-01-03 11:04:06,300 - WARNING - Failed to extract JSON from TXT file: /home/shahmir/Desktop/Bolognia 5th Edition 2024 (1)-29-6-22 (1)_subchapter_4_Photochemotherapy_with_Psoralens_(PUVA).txt
2026-01-03 11:04:06,300 - INFO - Successfully extracted JSON from response
2026-01-03 11:04:06,302 - INFO - Successfully extracted subchapter 'Extracorporeal Photochemotherapy (Photopheresis)' from TXT file
2026-01-03 11:04:06,303 - INFO - Successfully extracted JSON from response
2026-01-03 11:04:06,303 - INFO - Extracted chapter name from first TXT file: فتوتراپی با اشعه فرابنفش
2026-01-03 11:04:06,303 - INFO - OCR Extraction JSON saved to: /home/shahmir/Desktop/OCR Extraction.json
2026-01-03 11:10:36,037 - INFO - [get_default_model] ComboBox value: gemini-2.5-pro, StringVar value: gemini-2.5-pro
2026-01-03 11:10:36,038 - INFO - [get_default_model] Returning model from ComboBox: gemini-2.5-pro
2026-01-03 11:10:36,038 - INFO - Loading OCR Extraction JSON: /home/shahmir/Desktop/OCR Extraction.json
2026-01-03 11:10:36,039 - INFO - Chapter name from input JSON: فتوتراپی با اشعه فرابنفش
2026-01-03 11:10:36,040 - INFO - ================================================================================
2026-01-03 11:10:36,040 - INFO - DOCUMENT PROCESSING - PROCESSING BY TOPIC
2026-01-03 11:10:36,040 - INFO - ================================================================================
2026-01-03 11:10:36,040 - INFO - Found 14 topics to process
2026-01-03 11:10:36,040 - INFO - Found 3 unique subchapters
2026-01-03 11:10:36,041 - INFO - 
2026-01-03 11:10:36,041 - INFO -   Subchapter 1: 'فتوتراپی با UVA1' - 1 topics
2026-01-03 11:10:36,041 - INFO -     Topic 1: 'عوارض جانبی فتوتراپی با UVA1'
2026-01-03 11:10:36,041 - INFO -   Subchapter 2: 'فتوتراپی با UVB' - 11 topics
2026-01-03 11:10:36,041 - INFO -     Topic 1: 'جنبه‌های تاریخی'
2026-01-03 11:10:36,042 - INFO -     Topic 2: 'اصول و مکانیسم‌ها'
2026-01-03 11:10:36,042 - INFO -     Topic 3: 'طیف اثر و منابع تابش'
2026-01-03 11:10:36,042 - INFO -     Topic 4: 'پروتکل‌های درمانی'
2026-01-03 11:10:36,042 - INFO -     Topic 5: 'فتوتراپی برای پسوریازیس'
2026-01-03 11:10:36,043 - INFO -     Topic 6: 'فتوتراپی برای لنفوم سلول T پوستی، به‌ویژه مایcosis Fungoides'
2026-01-03 11:10:36,043 - INFO -     Topic 7: 'فتوتراپی برای ویتیلیگو'
2026-01-03 11:10:36,043 - INFO -     Topic 8: 'فتوتراپی برای درماتیت آتوپیک'
2026-01-03 11:10:36,043 - INFO -     Topic 9: 'فتوتراپی برای فتودرماتوزها و فتوتراپی برای پیتیریازیس لیکنوئیدس'
2026-01-03 11:10:36,043 - INFO -     Topic 10: 'فتوتراپی برای درماتیت سبورئیک و فتوتراپی برای خارش'
2026-01-03 11:10:36,044 - INFO -     Topic 11: 'عوارض جانبی فتوتراپی با UVB'
2026-01-03 11:10:36,044 - INFO -   Subchapter 3: 'فتوکموتراپی خارج بدنی (فتوفورزیس)' - 2 topics
2026-01-03 11:10:36,044 - INFO -     Topic 1: 'پروتکل‌های درمانی'
2026-01-03 11:10:36,044 - INFO -     Topic 2: 'مکانیسم اثر، عوارض جانبی و سایر اندیکاسیون‌ها'
2026-01-03 11:10:36,044 - INFO - ================================================================================
2026-01-03 11:10:36,045 - INFO - 
2026-01-03 11:10:36,045 - INFO - ================================================================================
2026-01-03 11:10:36,045 - INFO - PROCESSING TOPIC 1/14
2026-01-03 11:10:36,045 - INFO - ================================================================================
2026-01-03 11:10:36,046 - INFO -   Subchapter: 'فتوتراپی با UVB'
2026-01-03 11:10:36,046 - INFO -   Topic: 'جنبه‌های تاریخی'
2026-01-03 11:10:36,046 - INFO -   Number of extractions: 1
2026-01-03 11:10:36,048 - INFO -   JSON payload size: 28,517 bytes (27.85 KB)
2026-01-03 11:10:36,048 - INFO -   Sending topic JSON to model (full subchapter context with 11 topics)...
2026-01-03 11:10:36,048 - INFO -   Calling model API...
2026-01-03 11:11:01,875 - INFO - Text processed successfully with gemini-2.5-pro
2026-01-03 11:11:01,876 - INFO -   ✓ Topic 'جنبه‌های تاریخی' processed successfully
2026-01-03 11:11:01,877 - INFO -   Response size: 3,983 bytes (3.89 KB)
2026-01-03 11:11:01,878 - INFO -   Response length: 3,012 characters
2026-01-03 11:11:01,878 - INFO -   ✓ Topic 'جنبه‌های تاریخی' completed
2026-01-03 11:11:01,878 - INFO - ================================================================================
2026-01-03 11:11:01,879 - INFO - 
2026-01-03 11:11:01,879 - INFO - ================================================================================
2026-01-03 11:11:01,879 - INFO - PROCESSING TOPIC 2/14
2026-01-03 11:11:01,880 - INFO - ================================================================================
2026-01-03 11:11:01,880 - INFO -   Subchapter: 'فتوتراپی با UVB'
2026-01-03 11:11:01,880 - INFO -   Topic: 'اصول و مکانیسم‌ها'
2026-01-03 11:11:01,880 - INFO -   Number of extractions: 1
2026-01-03 11:11:01,882 - INFO -   JSON payload size: 28,517 bytes (27.85 KB)
2026-01-03 11:11:01,882 - INFO -   Sending topic JSON to model (full subchapter context with 11 topics)...
2026-01-03 11:11:01,882 - INFO -   Calling model API...
2026-01-03 11:11:51,103 - INFO - Text processed successfully with gemini-2.5-pro
2026-01-03 11:11:51,103 - INFO -   ✓ Topic 'اصول و مکانیسم‌ها' processed successfully
2026-01-03 11:11:51,104 - INFO -   Response size: 8,435 bytes (8.24 KB)
2026-01-03 11:11:51,104 - INFO -   Response length: 6,455 characters
2026-01-03 11:11:51,105 - INFO -   ✓ Topic 'اصول و مکانیسم‌ها' completed
2026-01-03 11:11:51,105 - INFO - ================================================================================
2026-01-03 11:11:51,105 - INFO - 
2026-01-03 11:11:51,105 - INFO - ================================================================================
2026-01-03 11:11:51,105 - INFO - PROCESSING TOPIC 3/14
2026-01-03 11:11:51,105 - INFO - ================================================================================
2026-01-03 11:11:51,105 - INFO -   Subchapter: 'فتوتراپی با UVB'
2026-01-03 11:11:51,106 - INFO -   Topic: 'طیف اثر و منابع تابش'
2026-01-03 11:11:51,106 - INFO -   Number of extractions: 3
2026-01-03 11:11:51,107 - INFO -   JSON payload size: 28,517 bytes (27.85 KB)
2026-01-03 11:11:51,108 - INFO -   Sending topic JSON to model (full subchapter context with 11 topics)...
2026-01-03 11:11:51,108 - INFO -   Calling model API...
2026-01-03 11:12:17,475 - INFO - Text processed successfully with gemini-2.5-pro
2026-01-03 11:12:17,475 - INFO -   ✓ Topic 'طیف اثر و منابع تابش' processed successfully
2026-01-03 11:12:17,476 - INFO -   Response size: 5,250 bytes (5.13 KB)
2026-01-03 11:12:17,477 - INFO -   Response length: 4,011 characters
2026-01-03 11:12:17,477 - INFO -   ✓ Topic 'طیف اثر و منابع تابش' completed
2026-01-03 11:12:17,477 - INFO - ================================================================================
2026-01-03 11:12:17,478 - INFO - 
2026-01-03 11:12:17,478 - INFO - ================================================================================
2026-01-03 11:12:17,478 - INFO - PROCESSING TOPIC 4/14
2026-01-03 11:12:17,479 - INFO - ================================================================================
2026-01-03 11:12:17,479 - INFO -   Subchapter: 'فتوتراپی با UVB'
2026-01-03 11:12:17,479 - INFO -   Topic: 'پروتکل‌های درمانی'
2026-01-03 11:12:17,479 - INFO -   Number of extractions: 4
2026-01-03 11:12:17,480 - INFO -   JSON payload size: 28,517 bytes (27.85 KB)
2026-01-03 11:12:17,481 - INFO -   Sending topic JSON to model (full subchapter context with 11 topics)...
2026-01-03 11:12:17,481 - INFO -   Calling model API...
2026-01-03 11:13:38,448 - INFO - Text processed successfully with gemini-2.5-pro
2026-01-03 11:13:38,449 - INFO -   ✓ Topic 'پروتکل‌های درمانی' processed successfully
2026-01-03 11:13:38,449 - INFO -   Response size: 11,181 bytes (10.92 KB)
2026-01-03 11:13:38,449 - INFO -   Response length: 8,642 characters
2026-01-03 11:13:38,450 - INFO -   ✓ Topic 'پروتکل‌های درمانی' completed
2026-01-03 11:13:38,450 - INFO - ================================================================================
2026-01-03 11:13:38,450 - INFO - 
2026-01-03 11:13:38,450 - INFO - ================================================================================
2026-01-03 11:13:38,450 - INFO - PROCESSING TOPIC 5/14
2026-01-03 11:13:38,451 - INFO - ================================================================================
2026-01-03 11:13:38,451 - INFO -   Subchapter: 'فتوتراپی با UVB'
2026-01-03 11:13:38,451 - INFO -   Topic: 'فتوتراپی برای پسوریازیس'
2026-01-03 11:13:38,451 - INFO -   Number of extractions: 1
2026-01-03 11:13:38,452 - INFO -   JSON payload size: 28,517 bytes (27.85 KB)
2026-01-03 11:13:38,452 - INFO -   Sending topic JSON to model (full subchapter context with 11 topics)...
2026-01-03 11:13:38,453 - INFO -   Calling model API...
2026-01-03 11:14:49,022 - INFO - Text processed successfully with gemini-2.5-pro
2026-01-03 11:14:49,023 - INFO -   ✓ Topic 'فتوتراپی برای پسوریازیس' processed successfully
2026-01-03 11:14:49,024 - INFO -   Response size: 11,549 bytes (11.28 KB)
2026-01-03 11:14:49,024 - INFO -   Response length: 8,381 characters
2026-01-03 11:14:49,024 - INFO -   ✓ Topic 'فتوتراپی برای پسوریازیس' completed
2026-01-03 11:14:49,024 - INFO - ================================================================================
2026-01-03 11:14:49,025 - INFO - 
2026-01-03 11:14:49,025 - INFO - ================================================================================
2026-01-03 11:14:49,025 - INFO - PROCESSING TOPIC 6/14
2026-01-03 11:14:49,025 - INFO - ================================================================================
2026-01-03 11:14:49,025 - INFO -   Subchapter: 'فتوتراپی با UVB'
2026-01-03 11:14:49,025 - INFO -   Topic: 'فتوتراپی برای لنفوم سلول T پوستی، به‌ویژه مایcosis Fungoides'
2026-01-03 11:14:49,025 - INFO -   Number of extractions: 1
2026-01-03 11:14:49,026 - INFO -   JSON payload size: 28,517 bytes (27.85 KB)
2026-01-03 11:14:49,027 - INFO -   Sending topic JSON to model (full subchapter context with 11 topics)...
2026-01-03 11:14:49,027 - INFO -   Calling model API...
2026-01-03 11:15:26,749 - INFO - Text processed successfully with gemini-2.5-pro
2026-01-03 11:15:26,750 - INFO -   ✓ Topic 'فتوتراپی برای لنفوم سلول T پوستی، به‌ویژه مایcosis Fungoides' processed successfully
2026-01-03 11:15:26,750 - INFO -   Response size: 7,078 bytes (6.91 KB)
2026-01-03 11:15:26,750 - INFO -   Response length: 5,508 characters
2026-01-03 11:15:26,750 - INFO -   ✓ Topic 'فتوتراپی برای لنفوم سلول T پوستی، به‌ویژه مایcosis Fungoides' completed
2026-01-03 11:15:26,751 - INFO - ================================================================================
2026-01-03 11:15:26,751 - INFO - 
2026-01-03 11:15:26,751 - INFO - ================================================================================
2026-01-03 11:15:26,751 - INFO - PROCESSING TOPIC 7/14
2026-01-03 11:15:26,751 - INFO - ================================================================================
2026-01-03 11:15:26,751 - INFO -   Subchapter: 'فتوتراپی با UVB'
2026-01-03 11:15:26,751 - INFO -   Topic: 'فتوتراپی برای ویتیلیگو'
2026-01-03 11:15:26,751 - INFO -   Number of extractions: 2
2026-01-03 11:15:26,753 - INFO -   JSON payload size: 28,517 bytes (27.85 KB)
2026-01-03 11:15:26,753 - INFO -   Sending topic JSON to model (full subchapter context with 11 topics)...
2026-01-03 11:15:26,753 - INFO -   Calling model API...
2026-01-03 11:16:41,946 - INFO - Text processed successfully with gemini-2.5-pro
2026-01-03 11:16:41,946 - INFO -   ✓ Topic 'فتوتراپی برای ویتیلیگو' processed successfully
2026-01-03 11:16:41,947 - INFO -   Response size: 6,634 bytes (6.48 KB)
2026-01-03 11:16:41,948 - INFO -   Response length: 4,954 characters
2026-01-03 11:16:41,948 - INFO -   ✓ Topic 'فتوتراپی برای ویتیلیگو' completed
2026-01-03 11:16:41,948 - INFO - ================================================================================
2026-01-03 11:16:41,948 - INFO - 
2026-01-03 11:16:41,948 - INFO - ================================================================================
2026-01-03 11:16:41,948 - INFO - PROCESSING TOPIC 8/14
2026-01-03 11:16:41,949 - INFO - ================================================================================
2026-01-03 11:16:41,949 - INFO -   Subchapter: 'فتوتراپی با UVB'
2026-01-03 11:16:41,949 - INFO -   Topic: 'فتوتراپی برای درماتیت آتوپیک'
2026-01-03 11:16:41,949 - INFO -   Number of extractions: 1
2026-01-03 11:16:41,951 - INFO -   JSON payload size: 28,517 bytes (27.85 KB)
2026-01-03 11:16:41,951 - INFO -   Sending topic JSON to model (full subchapter context with 11 topics)...
2026-01-03 11:16:41,951 - INFO -   Calling model API...
2026-01-03 11:17:05,282 - INFO - Text processed successfully with gemini-2.5-pro
2026-01-03 11:17:05,282 - INFO -   ✓ Topic 'فتوتراپی برای درماتیت آتوپیک' processed successfully
2026-01-03 11:17:05,282 - INFO -   Response size: 4,014 bytes (3.92 KB)
2026-01-03 11:17:05,282 - INFO -   Response length: 3,252 characters
2026-01-03 11:17:05,282 - INFO -   ✓ Topic 'فتوتراپی برای درماتیت آتوپیک' completed
2026-01-03 11:17:05,283 - INFO - ================================================================================
2026-01-03 11:17:05,283 - INFO - 
2026-01-03 11:17:05,283 - INFO - ================================================================================
2026-01-03 11:17:05,283 - INFO - PROCESSING TOPIC 9/14
2026-01-03 11:17:05,283 - INFO - ================================================================================
2026-01-03 11:17:05,283 - INFO -   Subchapter: 'فتوتراپی با UVB'
2026-01-03 11:17:05,283 - INFO -   Topic: 'فتوتراپی برای فتودرماتوزها و فتوتراپی برای پیتیریازیس لیکنوئیدس'
2026-01-03 11:17:05,283 - INFO -   Number of extractions: 1
2026-01-03 11:17:05,285 - INFO -   JSON payload size: 28,517 bytes (27.85 KB)
2026-01-03 11:17:05,285 - INFO -   Sending topic JSON to model (full subchapter context with 11 topics)...
2026-01-03 11:17:05,285 - INFO -   Calling model API...
2026-01-03 11:17:52,752 - INFO - Text processed successfully with gemini-2.5-pro
2026-01-03 11:17:52,753 - INFO -   ✓ Topic 'فتوتراپی برای فتودرماتوزها و فتوتراپی برای پیتیریازیس لیکنوئیدس' processed successfully
2026-01-03 11:17:52,753 - INFO -   Response size: 5,605 bytes (5.47 KB)
2026-01-03 11:17:52,753 - INFO -   Response length: 4,272 characters
2026-01-03 11:17:52,754 - INFO -   ✓ Topic 'فتوتراپی برای فتودرماتوزها و فتوتراپی برای پیتیریازیس لیکنوئیدس' completed
2026-01-03 11:17:52,754 - INFO - ================================================================================
2026-01-03 11:17:52,754 - INFO - 
2026-01-03 11:17:52,754 - INFO - ================================================================================
2026-01-03 11:17:52,754 - INFO - PROCESSING TOPIC 10/14
2026-01-03 11:17:52,754 - INFO - ================================================================================
2026-01-03 11:17:52,754 - INFO -   Subchapter: 'فتوتراپی با UVB'
2026-01-03 11:17:52,755 - INFO -   Topic: 'فتوتراپی برای درماتیت سبورئیک و فتوتراپی برای خارش'
2026-01-03 11:17:52,755 - INFO -   Number of extractions: 1
2026-01-03 11:17:52,756 - INFO -   JSON payload size: 28,517 bytes (27.85 KB)
2026-01-03 11:17:52,756 - INFO -   Sending topic JSON to model (full subchapter context with 11 topics)...
2026-01-03 11:17:52,756 - INFO -   Calling model API...
2026-01-03 11:18:32,103 - INFO - Text processed successfully with gemini-2.5-pro
2026-01-03 11:18:32,103 - INFO -   ✓ Topic 'فتوتراپی برای درماتیت سبورئیک و فتوتراپی برای خارش' processed successfully
2026-01-03 11:18:32,104 - INFO -   Response size: 4,219 bytes (4.12 KB)
2026-01-03 11:18:32,105 - INFO -   Response length: 3,402 characters
2026-01-03 11:18:32,105 - INFO -   ✓ Topic 'فتوتراپی برای درماتیت سبورئیک و فتوتراپی برای خارش' completed
2026-01-03 11:18:32,105 - INFO - ================================================================================
2026-01-03 11:18:32,105 - INFO - 
2026-01-03 11:18:32,106 - INFO - ================================================================================
2026-01-03 11:18:32,106 - INFO - PROCESSING TOPIC 11/14
2026-01-03 11:18:32,106 - INFO - ================================================================================
2026-01-03 11:18:32,106 - INFO -   Subchapter: 'فتوتراپی با UVB'
2026-01-03 11:18:32,106 - INFO -   Topic: 'عوارض جانبی فتوتراپی با UVB'
2026-01-03 11:18:32,106 - INFO -   Number of extractions: 2
2026-01-03 11:18:32,107 - INFO -   JSON payload size: 28,517 bytes (27.85 KB)
2026-01-03 11:18:32,108 - INFO -   Sending topic JSON to model (full subchapter context with 11 topics)...
2026-01-03 11:18:32,108 - INFO -   Calling model API...
2026-01-03 11:18:51,966 - INFO - Text processed successfully with gemini-2.5-pro
2026-01-03 11:18:51,967 - INFO -   ✓ Topic 'عوارض جانبی فتوتراپی با UVB' processed successfully
2026-01-03 11:18:51,967 - INFO -   Response size: 3,712 bytes (3.62 KB)
2026-01-03 11:18:51,968 - INFO -   Response length: 2,879 characters
2026-01-03 11:18:51,968 - INFO -   ✓ Topic 'عوارض جانبی فتوتراپی با UVB' completed
2026-01-03 11:18:51,968 - INFO - ================================================================================
2026-01-03 11:18:51,968 - INFO - 
2026-01-03 11:18:51,968 - INFO - ================================================================================
2026-01-03 11:18:51,968 - INFO - PROCESSING TOPIC 12/14
2026-01-03 11:18:51,969 - INFO - ================================================================================
2026-01-03 11:18:51,969 - INFO -   Subchapter: 'فتوتراپی با UVA1'
2026-01-03 11:18:51,969 - INFO -   Topic: 'عوارض جانبی فتوتراپی با UVA1'
2026-01-03 11:18:51,969 - INFO -   Number of extractions: 1
2026-01-03 11:18:51,970 - INFO -   JSON payload size: 1,549 bytes (1.51 KB)
2026-01-03 11:18:51,970 - INFO -   Sending topic JSON to model (full subchapter context with 1 topics)...
2026-01-03 11:18:51,970 - INFO -   Calling model API...
2026-01-03 11:19:37,886 - INFO - Text processed successfully with gemini-2.5-pro
2026-01-03 11:19:37,887 - INFO -   ✓ Topic 'عوارض جانبی فتوتراپی با UVA1' processed successfully
2026-01-03 11:19:37,887 - INFO -   Response size: 3,967 bytes (3.87 KB)
2026-01-03 11:19:37,888 - INFO -   Response length: 3,053 characters
2026-01-03 11:19:37,888 - INFO -   ✓ Topic 'عوارض جانبی فتوتراپی با UVA1' completed
2026-01-03 11:19:37,888 - INFO - ================================================================================
2026-01-03 11:19:37,889 - INFO - 
2026-01-03 11:19:37,889 - INFO - ================================================================================
2026-01-03 11:19:37,889 - INFO - PROCESSING TOPIC 13/14
2026-01-03 11:19:37,889 - INFO - ================================================================================
2026-01-03 11:19:37,889 - INFO -   Subchapter: 'فتوکموتراپی خارج بدنی (فتوفورزیس)'
2026-01-03 11:19:37,889 - INFO -   Topic: 'پروتکل‌های درمانی'
2026-01-03 11:19:37,889 - INFO -   Number of extractions: 1
2026-01-03 11:19:37,890 - INFO -   JSON payload size: 3,812 bytes (3.72 KB)
2026-01-03 11:19:37,890 - INFO -   Sending topic JSON to model (full subchapter context with 2 topics)...
2026-01-03 11:19:37,890 - INFO -   Calling model API...
2026-01-03 11:20:32,167 - INFO - Text processed successfully with gemini-2.5-pro
2026-01-03 11:20:32,168 - INFO -   ✓ Topic 'پروتکل‌های درمانی' processed successfully
2026-01-03 11:20:32,168 - INFO -   Response size: 8,488 bytes (8.29 KB)
2026-01-03 11:20:32,168 - INFO -   Response length: 6,557 characters
2026-01-03 11:20:32,168 - INFO -   ✓ Topic 'پروتکل‌های درمانی' completed
2026-01-03 11:20:32,168 - INFO - ================================================================================
2026-01-03 11:20:32,168 - INFO - 
2026-01-03 11:20:32,168 - INFO - ================================================================================
2026-01-03 11:20:32,169 - INFO - PROCESSING TOPIC 14/14
2026-01-03 11:20:32,169 - INFO - ================================================================================
2026-01-03 11:20:32,169 - INFO -   Subchapter: 'فتوکموتراپی خارج بدنی (فتوفورزیس)'
2026-01-03 11:20:32,169 - INFO -   Topic: 'مکانیسم اثر، عوارض جانبی و سایر اندیکاسیون‌ها'
2026-01-03 11:20:32,169 - INFO -   Number of extractions: 1
2026-01-03 11:20:32,170 - INFO -   JSON payload size: 3,812 bytes (3.72 KB)
2026-01-03 11:20:32,170 - INFO -   Sending topic JSON to model (full subchapter context with 2 topics)...
2026-01-03 11:20:32,170 - INFO -   Calling model API...
2026-01-03 11:21:58,248 - INFO - Text processed successfully with gemini-2.5-pro
2026-01-03 11:21:58,249 - INFO -   ✓ Topic 'مکانیسم اثر، عوارض جانبی و سایر اندیکاسیون‌ها' processed successfully
2026-01-03 11:21:58,250 - INFO -   Response size: 4,172 bytes (4.07 KB)
2026-01-03 11:21:58,250 - INFO -   Response length: 3,180 characters
2026-01-03 11:21:58,251 - INFO -   ✓ Topic 'مکانیسم اثر، عوارض جانبی و سایر اندیکاسیون‌ها' completed
2026-01-03 11:21:58,251 - INFO - ================================================================================
2026-01-03 11:21:58,251 - INFO - 
2026-01-03 11:21:58,251 - INFO - ================================================================================
2026-01-03 11:21:58,252 - INFO - SAVING TXT FILES FOR EACH SUBCHAPTER
2026-01-03 11:21:58,252 - INFO - ================================================================================
2026-01-03 11:21:58,254 - INFO - Saved subchapter 'فتوتراپی با UVB' response to: /home/shahmir/Desktop/OCR Extraction_subchapter_2_فتوتراپی_با_UVB.txt (11 topics)
2026-01-03 11:21:58,255 - INFO - Saved subchapter 'فتوتراپی با UVA1' response to: /home/shahmir/Desktop/OCR Extraction_subchapter_1_فتوتراپی_با_UVA1.txt (1 topics)
2026-01-03 11:21:58,256 - INFO - Saved subchapter 'فتوکموتراپی خارج بدنی (فتوفورزیس)' response to: /home/shahmir/Desktop/OCR Extraction_subchapter_3_فتوکموتراپی_خارج_بدنی_فتوفورزیس.txt (2 topics)
2026-01-03 11:21:58,257 - INFO - ================================================================================
2026-01-03 11:21:58,257 - INFO - ================================================================================
2026-01-03 11:21:58,257 - INFO - EXTRACTING JSON BLOCKS FROM RESPONSES
2026-01-03 11:21:58,258 - INFO - ================================================================================
2026-01-03 11:21:58,258 - INFO - Extracting JSON blocks from 14 responses (one per topic)...
2026-01-03 11:21:58,258 - INFO -   Topic 1/14: 'فتوتراپی با UVB' > 'جنبه‌های تاریخی'
2026-01-03 11:21:58,259 - INFO -     ✓ Extracted 1 JSON block(s)
2026-01-03 11:21:58,259 - INFO -   Topic 2/14: 'فتوتراپی با UVB' > 'اصول و مکانیسم‌ها'
2026-01-03 11:21:58,260 - INFO -     ✓ Extracted 1 JSON block(s)
2026-01-03 11:21:58,260 - INFO -   Topic 3/14: 'فتوتراپی با UVB' > 'طیف اثر و منابع تابش'
2026-01-03 11:21:58,261 - INFO -     ✓ Extracted 1 JSON block(s)
2026-01-03 11:21:58,261 - INFO -   Topic 4/14: 'فتوتراپی با UVB' > 'پروتکل‌های درمانی'
2026-01-03 11:21:58,262 - INFO -     ✓ Extracted 1 JSON block(s)
2026-01-03 11:21:58,262 - INFO -   Topic 5/14: 'فتوتراپی با UVB' > 'فتوتراپی برای پسوریازیس'
2026-01-03 11:21:58,263 - INFO -     ✓ Extracted 1 JSON block(s)
2026-01-03 11:21:58,263 - INFO -   Topic 6/14: 'فتوتراپی با UVB' > 'فتوتراپی برای لنفوم سلول T پوستی، به‌ویژه مایcosis Fungoides'
2026-01-03 11:21:58,263 - INFO -     ✓ Extracted 1 JSON block(s)
2026-01-03 11:21:58,263 - INFO -   Topic 7/14: 'فتوتراپی با UVB' > 'فتوتراپی برای ویتیلیگو'
2026-01-03 11:21:58,263 - INFO -     ✓ Extracted 1 JSON block(s)
2026-01-03 11:21:58,263 - INFO -   Topic 8/14: 'فتوتراپی با UVB' > 'فتوتراپی برای درماتیت آتوپیک'
2026-01-03 11:21:58,263 - INFO -     ✓ Extracted 1 JSON block(s)
2026-01-03 11:21:58,263 - INFO -   Topic 9/14: 'فتوتراپی با UVB' > 'فتوتراپی برای فتودرماتوزها و فتوتراپی برای پیتیریازیس لیکنوئیدس'
2026-01-03 11:21:58,263 - INFO -     ✓ Extracted 1 JSON block(s)
2026-01-03 11:21:58,263 - INFO -   Topic 10/14: 'فتوتراپی با UVB' > 'فتوتراپی برای درماتیت سبورئیک و فتوتراپی برای خارش'
2026-01-03 11:21:58,264 - INFO -     ✓ Extracted 1 JSON block(s)
2026-01-03 11:21:58,264 - INFO -   Topic 11/14: 'فتوتراپی با UVB' > 'عوارض جانبی فتوتراپی با UVB'
2026-01-03 11:21:58,264 - INFO -     ✓ Extracted 1 JSON block(s)
2026-01-03 11:21:58,264 - INFO -   Topic 12/14: 'فتوتراپی با UVA1' > 'عوارض جانبی فتوتراپی با UVA1'
2026-01-03 11:21:58,264 - INFO -     ✓ Extracted 1 JSON block(s)
2026-01-03 11:21:58,264 - INFO -   Topic 13/14: 'فتوکموتراپی خارج بدنی (فتوفورزیس)' > 'پروتکل‌های درمانی'
2026-01-03 11:21:58,264 - INFO -     ✓ Extracted 1 JSON block(s)
2026-01-03 11:21:58,264 - INFO -   Topic 14/14: 'فتوکموتراپی خارج بدنی (فتوفورزیس)' > 'مکانیسم اثر، عوارض جانبی و سایر اندیکاسیون‌ها'
2026-01-03 11:21:58,264 - INFO -     ✓ Extracted 1 JSON block(s)
2026-01-03 11:21:58,264 - INFO - Total JSON blocks extracted: 14
2026-01-03 11:21:58,264 - INFO - ================================================================================
2026-01-03 11:21:58,264 - INFO - ================================================================================
2026-01-03 11:21:58,265 - INFO - CALCULATING POINTS PER SUBCHAPTER
2026-01-03 11:21:58,265 - INFO - ================================================================================
2026-01-03 11:21:58,265 - INFO - Combining 11 JSON block(s) into final structure...
2026-01-03 11:21:58,265 - WARNING - Block 9: Different chapter 'فتوتراپی برای فتودرماتوزها و فتوتراپی برای پیتیریازیس لیکنوئیدس' (expected 'فتوتراپی با اشعه فرابنفش'). Keeping both.
2026-01-03 11:21:58,265 - INFO - Final structure: chapter 'فتوتراپی با اشعه فرابنفش' with 11 content items
2026-01-03 11:21:58,265 - INFO - Processing chapter: 'فتوتراپی با اشعه فرابنفش' with 11 top-level items
2026-01-03 11:21:58,266 - INFO -   Subchapter 'فتوتراپی با UVB': 334 points (11 topics)
2026-01-03 11:21:58,266 - INFO - Combining 1 JSON block(s) into final structure...
2026-01-03 11:21:58,266 - INFO - Final structure: chapter 'فتوتراپی با اشعه فرابنفش' with 1 content items
2026-01-03 11:21:58,266 - INFO - Processing chapter: 'فتوتراپی با اشعه فرابنفش' with 1 top-level items
2026-01-03 11:21:58,266 - INFO -   Subchapter 'فتوتراپی با UVA1': 15 points (1 topics)
2026-01-03 11:21:58,266 - INFO - Combining 2 JSON block(s) into final structure...
2026-01-03 11:21:58,266 - INFO - Final structure: chapter 'فتوتراپی با اشعه فرابنفش' with 2 content items
2026-01-03 11:21:58,266 - INFO - Processing chapter: 'فتوتراپی با اشعه فرابنفش' with 2 top-level items
2026-01-03 11:21:58,266 - INFO -   Subchapter 'فتوکموتراپی خارج بدنی (فتوفورزیس)': 56 points (2 topics)
2026-01-03 11:21:58,266 - INFO - ================================================================================
2026-01-03 11:21:58,266 - INFO - Combining JSON blocks into final structure...
2026-01-03 11:21:58,267 - INFO - Combining 14 JSON block(s) into final structure...
2026-01-03 11:21:58,267 - WARNING - Block 9: Different chapter 'فتوتراپی برای فتودرماتوزها و فتوتراپی برای پیتیریازیس لیکنوئیدس' (expected 'فتوتراپی با اشعه فرابنفش'). Keeping both.
2026-01-03 11:21:58,267 - INFO - Final structure: chapter 'فتوتراپی با اشعه فرابنفش' with 14 content items
2026-01-03 11:21:58,267 - INFO - Flattening hierarchical structure to points...
2026-01-03 11:21:58,267 - INFO - Processing chapter: 'فتوتراپی با اشعه فرابنفش' with 14 top-level items
2026-01-03 11:21:58,268 - INFO - Extracted 405 points from Document Processing
2026-01-03 11:21:58,268 - INFO - Assigning PointId and chapter/subchapter/topic to 405 points (starting from 1)...
2026-01-03 11:21:58,268 - INFO - ================================================================================
2026-01-03 11:21:58,268 - INFO - ASSIGNING POINT IDs AND SUBCHAPTER INFO
2026-01-03 11:21:58,268 - INFO - ================================================================================
2026-01-03 11:21:58,268 - INFO - Using tracked points per subchapter for correct mapping:
2026-01-03 11:21:58,268 - INFO -   Subchapter 'فتوتراپی با UVB': 334 points
2026-01-03 11:21:58,268 - INFO -   Subchapter 'فتوتراپی با UVA1': 15 points
2026-01-03 11:21:58,268 - INFO -   Subchapter 'فتوکموتراپی خارج بدنی (فتوفورزیس)': 56 points
2026-01-03 11:21:58,269 - INFO - Total tracked points: 405, Actual flattened points: 405
2026-01-03 11:21:58,269 - INFO -   Assigning PointIds for subchapter 'فتوتراپی با UVB' (334 points)...
2026-01-03 11:21:58,269 - INFO -     ✓ Assigned 334 PointIds for subchapter 'فتوتراپی با UVB'
2026-01-03 11:21:58,269 - INFO -   Assigning PointIds for subchapter 'فتوتراپی با UVA1' (15 points)...
2026-01-03 11:21:58,269 - INFO -     ✓ Assigned 15 PointIds for subchapter 'فتوتراپی با UVA1'
2026-01-03 11:21:58,269 - INFO -   Assigning PointIds for subchapter 'فتوکموتراپی خارج بدنی (فتوفورزیس)' (56 points)...
2026-01-03 11:21:58,269 - INFO -     ✓ Assigned 56 PointIds for subchapter 'فتوکموتراپی خارج بدنی (فتوفورزیس)'
2026-01-03 11:21:58,269 - INFO - ================================================================================
2026-01-03 11:21:58,270 - INFO - Saving Document Processing output to: /home/shahmir/Desktop/Lesson_file_120_134.json
2026-01-03 11:21:58,274 - INFO - Document Processing completed successfully: /home/shahmir/Desktop/Lesson_file_120_134.json
2026-01-03 11:39:07,638 - INFO - [get_default_model] ComboBox value: gemini-2.5-pro, StringVar value: gemini-2.5-pro
2026-01-03 11:39:07,639 - INFO - [get_default_model] Returning model from ComboBox: gemini-2.5-pro
2026-01-03 11:39:07,639 - INFO - Using topic file: /home/shahmir/Desktop/t0052024.json, Book ID: 5, Chapter ID: 2024
2026-01-03 11:39:07,639 - INFO - Using output directory: /home/shahmir/Desktop
2026-01-03 11:39:07,691 - INFO - Successfully extracted 117016 characters from 17 pages using PyMuPDF
2026-01-03 11:39:07,692 - INFO - Text client initialized with model: gemini-2.5-pro
2026-01-03 11:42:52,213 - INFO - Saved response for Phototherapy with UVB to: /home/shahmir/Desktop/Bolognia 5th Edition 2024 (1)-29-6-22 (1)_subchapter_1_Phototherapy_with_UVB.txt
2026-01-03 11:42:52,214 - WARNING - Subchapter 'Phototherapy with the 308 nm Excimer Laser or Lamp' has no Topics, skipping
2026-01-03 11:46:54,842 - INFO - Saved response for Phototherapy with UVA1 to: /home/shahmir/Desktop/Bolognia 5th Edition 2024 (1)-29-6-22 (1)_subchapter_3_Phototherapy_with_UVA1.txt
2026-01-03 11:50:26,917 - INFO - Saved response for Photochemotherapy with Psoralens (PUVA) to: /home/shahmir/Desktop/Bolognia 5th Edition 2024 (1)-29-6-22 (1)_subchapter_4_Photochemotherapy_with_Psoralens_(PUVA).txt
2026-01-03 11:54:15,832 - INFO - Saved response for Extracorporeal Photochemotherapy (Photopheresis) to: /home/shahmir/Desktop/Bolognia 5th Edition 2024 (1)-29-6-22 (1)_subchapter_5_Extracorporeal_Photochemotherapy_(Photopheresis).txt
2026-01-03 11:54:15,842 - INFO - Successfully extracted JSON from response
2026-01-03 11:54:15,843 - INFO - Successfully extracted subchapter 'Phototherapy with UVB' from TXT file
2026-01-03 11:54:15,843 - WARNING - TXT file not found: /home/shahmir/Desktop/Bolognia 5th Edition 2024 (1)-29-6-22 (1)_subchapter_2_Phototherapy_with_the_308 nm_Excimer_Laser_or_Lamp.txt
2026-01-03 11:54:15,843 - WARNING - No closing markdown marker found, JSON may be incomplete
2026-01-03 11:54:15,844 - WARNING - Direct JSON parse failed: Unterminated string starting at: line 1 column 82849 (char 82848). Trying fallback extraction...
2026-01-03 11:54:15,845 - WARNING - Object extraction parse failed: Expecting ',' delimiter: line 1 column 82754 (char 82753)
2026-01-03 11:54:15,851 - INFO - Attempting to repair incomplete JSON...
2026-01-03 11:54:15,857 - WARNING - Repair method returned None
2026-01-03 11:54:15,858 - ERROR - All JSON extraction methods failed
2026-01-03 11:54:15,858 - WARNING - Failed to extract JSON from response
2026-01-03 11:54:15,858 - WARNING - No closing markdown marker found, JSON may be incomplete
2026-01-03 11:54:15,858 - WARNING - Direct JSON parse failed: Unterminated string starting at: line 1 column 82849 (char 82848). Trying fallback extraction...
2026-01-03 11:54:15,858 - WARNING - Object extraction parse failed: Expecting ',' delimiter: line 1 column 82754 (char 82753)
2026-01-03 11:54:15,861 - INFO - Attempting to repair incomplete JSON...
2026-01-03 11:54:15,865 - WARNING - Repair method returned None
2026-01-03 11:54:15,865 - ERROR - All JSON extraction methods failed
2026-01-03 11:54:15,868 - WARNING - Failed to extract JSON from Persian text
2026-01-03 11:54:15,868 - WARNING - Failed to extract JSON from TXT file: /home/shahmir/Desktop/Bolognia 5th Edition 2024 (1)-29-6-22 (1)_subchapter_3_Phototherapy_with_UVA1.txt
2026-01-03 11:54:15,869 - INFO - Successfully extracted JSON from response
2026-01-03 11:54:15,869 - INFO - Successfully extracted subchapter 'Photochemotherapy with Psoralens (PUVA)' from TXT file
2026-01-03 11:54:15,869 - INFO - Successfully extracted JSON from response
2026-01-03 11:54:15,869 - INFO - Successfully extracted subchapter 'Extracorporeal Photochemotherapy (Photopheresis)' from TXT file
2026-01-03 11:54:15,869 - INFO - Successfully extracted JSON from response
2026-01-03 11:54:15,869 - INFO - Extracted chapter name from first TXT file: Ultraviolet Therapy
2026-01-03 11:54:15,870 - INFO - OCR Extraction JSON saved to: /home/shahmir/Desktop/OCR Extraction.json
2026-01-03 12:06:46,941 - INFO - Loaded 14 predefined prompts
2026-01-03 12:06:46,958 - INFO - python-docx library is available
2026-01-03 12:06:46,959 - INFO - python-docx library is available
2026-01-03 12:07:17,800 - INFO - Loaded 3 API keys
2026-01-03 12:07:39,475 - INFO - Default output folder updated to: /home/shahmir/Desktop/out-134
2026-01-03 12:08:55,115 - INFO - [get_default_model] ComboBox value: gemini-2.5-pro, StringVar value: gemini-2.5-pro
2026-01-03 12:08:55,116 - INFO - [get_default_model] Returning model from ComboBox: gemini-2.5-pro
2026-01-03 12:08:55,117 - INFO - Using topic file: /home/shahmir/Desktop/t0052024.json, Book ID: 5, Chapter ID: 2024
2026-01-03 12:08:55,118 - INFO - Using output directory: /home/shahmir/Desktop/out-134
2026-01-03 12:08:55,180 - INFO - Successfully extracted 117016 characters from 17 pages using PyMuPDF
2026-01-03 12:08:55,181 - INFO - Text client initialized with model: gemini-2.5-pro
2026-01-03 12:08:55,182 - INFO - Initialized OCR Extraction JSON: /home/shahmir/Desktop/out-134/OCR Extraction.json
2026-01-03 12:10:57,451 - INFO - Successfully extracted JSON from response
2026-01-03 12:10:57,454 - INFO - ✓ Subchapter 1/5 'Phototherapy with UVB' added to JSON (incremental save)
2026-01-03 12:10:57,455 - INFO - Subchapter 'Phototherapy with the 308 nm Excimer Laser or Lamp' has no Topics, will process with empty topics list
2026-01-03 12:11:26,865 - INFO - Successfully extracted JSON from response
2026-01-03 12:11:26,868 - INFO - ✓ Subchapter 2/5 'Phototherapy with the 308 nm Excimer Laser or Lamp' added to JSON (incremental save)
2026-01-03 12:11:54,734 - INFO - Successfully extracted JSON from response
2026-01-03 12:11:54,736 - INFO - ✓ Subchapter 3/5 'Phototherapy with UVA1' added to JSON (incremental save)
2026-01-03 12:14:23,992 - INFO - Successfully extracted JSON from response
2026-01-03 12:14:23,998 - INFO - ✓ Subchapter 4/5 'Photochemotherapy with Psoralens (PUVA)' added to JSON (incremental save)
2026-01-03 12:15:17,899 - INFO - Successfully extracted JSON from response
2026-01-03 12:15:17,904 - INFO - ✓ Subchapter 5/5 'Extracorporeal Photochemotherapy (Photopheresis)' added to JSON (incremental save)
2026-01-03 12:15:17,917 - INFO - OCR Extraction JSON saved to: /home/shahmir/Desktop/out-134/OCR Extraction.json
2026-01-03 12:21:51,393 - INFO - [get_default_model] ComboBox value: gemini-2.5-pro, StringVar value: gemini-2.5-pro
2026-01-03 12:21:51,394 - INFO - [get_default_model] Returning model from ComboBox: gemini-2.5-pro
2026-01-03 12:21:51,395 - INFO - Loading OCR Extraction JSON: /home/shahmir/Desktop/out-134/OCR Extraction.json
2026-01-03 12:21:51,396 - WARNING - No chapter name found in OCR JSON, will use empty string
2026-01-03 12:21:51,397 - INFO - Chapter name from input JSON: 
2026-01-03 12:21:51,397 - INFO - ================================================================================
2026-01-03 12:21:51,397 - INFO - DOCUMENT PROCESSING - PROCESSING BY TOPIC
2026-01-03 12:21:51,397 - INFO - ================================================================================
2026-01-03 12:21:51,398 - INFO - Found 31 topics to process
2026-01-03 12:21:51,398 - INFO - Found 5 unique subchapters
2026-01-03 12:21:51,398 - INFO - 
2026-01-03 12:21:51,399 - INFO -   Subchapter 1: 'فتوتراپی با UVA1' - 1 topics
2026-01-03 12:21:51,399 - INFO -     Topic 1: 'عوارض جانبی فتوتراپی با UVA1'
2026-01-03 12:21:51,399 - INFO -   Subchapter 2: 'فتوتراپی با UVB' - 10 topics
2026-01-03 12:21:51,400 - INFO -     Topic 1: 'جنبه های تاریخی'
2026-01-03 12:21:51,400 - INFO -     Topic 2: 'اصول و مکانیسم ها'
2026-01-03 12:21:51,400 - INFO -     Topic 3: 'طیف اثر و منابع تابش'
2026-01-03 12:21:51,400 - INFO -     Topic 4: 'پروتکل های درمانی'
2026-01-03 12:21:51,401 - INFO -     Topic 5: 'فتوتراپی برای پسوریازیس'
2026-01-03 12:21:51,401 - INFO -     Topic 6: 'فتوتراپی برای لنفوم سلول T پوستی، به ویژه مایکوزیز فونگوئیدس'
2026-01-03 12:21:51,401 - INFO -     Topic 7: 'فتوتراپی برای ویتیلیگو'
2026-01-03 12:21:51,401 - INFO -     Topic 8: 'فتوتراپی برای درماتیت آتوپیک'
2026-01-03 12:21:51,402 - INFO -     Topic 9: 'فتوتراپی برای فتودرماتوزها، پیتیریازیس لیکنوئیدس و درماتیت سبورئیک'
2026-01-03 12:21:51,402 - INFO -     Topic 10: 'فتوتراپی برای خارش و عوارض جانبی فتوتراپی با UVB'
2026-01-03 12:21:51,402 - INFO -   Subchapter 3: 'فتوتراپی با لیزر یا لامپ اگزایمر ۳۰۸ نانومتر' - 1 topics
2026-01-03 12:21:51,402 - INFO -     Topic 1: 'فتوتراپی با لیزر یا لامپ اگزایمر ۳۰۸ نانومتر'
2026-01-03 12:21:51,403 - INFO -   Subchapter 4: 'فتوشیمی‌درمانی با پسورالن‌ها (PUVA)' - 17 topics
2026-01-03 12:21:51,403 - INFO -     Topic 1: 'جنبه‌های تاریخی'
2026-01-03 12:21:51,403 - INFO -     Topic 2: 'پسورالن‌ها'
2026-01-03 12:21:51,403 - INFO -     Topic 3: 'فتوشیمی پسورالن و طیف اثر و منابع نوری'
2026-01-03 12:21:51,404 - INFO -     Topic 4: 'اثرات فتوبیولوژیک PUVA'
2026-01-03 12:21:51,404 - INFO -     Topic 5: 'پروتکل‌های درمانی'
2026-01-03 12:21:51,404 - INFO -     Topic 6: 'مرحله درمان اولیه (پاکسازی)'
2026-01-03 12:21:51,404 - INFO -     Topic 7: 'مرحله نگهدارنده'
2026-01-03 12:21:51,405 - INFO -     Topic 8: 'PUVA برای پسوریازیس'
2026-01-03 12:21:51,405 - INFO -     Topic 9: 'درمان‌های ترکیبی'
2026-01-03 12:21:51,405 - INFO -     Topic 10: 'PUVA برای لنفوم سلول T پوستی، به ویژه مایکوزیس فونگوئیدس'
2026-01-03 12:21:51,405 - INFO -     Topic 11: 'PUVA برای ویتیلیگو'
2026-01-03 12:21:51,406 - INFO -     Topic 12: 'PUVA برای درماتیت آتوپیک و لیکن پلان'
2026-01-03 12:21:51,406 - INFO -     Topic 13: 'PUVA برای بیماری پیوند علیه میزبان'
2026-01-03 12:21:51,406 - INFO -     Topic 14: 'PUVA برای کهیر پیگمنتوزا و درماتوزهای متفرقه'
2026-01-03 12:21:51,406 - INFO -     Topic 15: 'PUVA برای فتودرماتوزها'
2026-01-03 12:21:51,406 - INFO -     Topic 16: 'عوارض جانبی و خطرات بلندمدت PUVA'
2026-01-03 12:21:51,407 - INFO -     Topic 17: 'UVB و PUVA در بیماران آلوده به HIV'
2026-01-03 12:21:51,407 - INFO -   Subchapter 5: 'فتوکموتراپی خارج بدنی (فتوفرزیس)' - 2 topics
2026-01-03 12:21:51,407 - INFO -     Topic 1: 'پروتکل‌های درمانی و مکانیسم عمل'
2026-01-03 12:21:51,407 - INFO -     Topic 2: 'عوارض جانبی و سایر اندیکاسیون‌ها'
2026-01-03 12:21:51,407 - INFO - ================================================================================
2026-01-03 12:21:51,408 - INFO - 
2026-01-03 12:21:51,408 - INFO - ================================================================================
2026-01-03 12:21:51,408 - INFO - PROCESSING TOPIC 1/31
2026-01-03 12:21:51,408 - INFO - ================================================================================
2026-01-03 12:21:51,409 - INFO -   Subchapter: 'فتوتراپی با UVB'
2026-01-03 12:21:51,409 - INFO -   Topic: 'جنبه های تاریخی'
2026-01-03 12:21:51,409 - INFO -   Number of extractions: 1
2026-01-03 12:21:51,411 - INFO -   JSON payload size: 29,119 bytes (28.44 KB)
2026-01-03 12:21:51,411 - INFO -   Sending topic JSON to model (full subchapter context with 10 topics)...
2026-01-03 12:21:51,412 - INFO -   Calling model API...
2026-01-03 12:22:31,951 - INFO - Text processed successfully with gemini-2.5-pro
2026-01-03 12:22:31,952 - INFO -   ✓ Topic 'جنبه های تاریخی' processed successfully
2026-01-03 12:22:31,953 - INFO -   Response size: 3,912 bytes (3.82 KB)
2026-01-03 12:22:31,954 - INFO -   Response length: 2,985 characters
2026-01-03 12:22:31,954 - INFO -   ✓ Topic 'جنبه های تاریخی' completed
2026-01-03 12:22:31,955 - INFO - ================================================================================
2026-01-03 12:22:31,955 - INFO - 
2026-01-03 12:22:31,955 - INFO - ================================================================================
2026-01-03 12:22:31,956 - INFO - PROCESSING TOPIC 2/31
2026-01-03 12:22:31,956 - INFO - ================================================================================
2026-01-03 12:22:31,956 - INFO -   Subchapter: 'فتوتراپی با UVB'
2026-01-03 12:22:31,957 - INFO -   Topic: 'اصول و مکانیسم ها'
2026-01-03 12:22:31,957 - INFO -   Number of extractions: 1
2026-01-03 12:22:31,959 - INFO -   JSON payload size: 29,119 bytes (28.44 KB)
2026-01-03 12:22:31,959 - INFO -   Sending topic JSON to model (full subchapter context with 10 topics)...
2026-01-03 12:22:31,960 - INFO -   Calling model API...
2026-01-03 12:23:16,554 - INFO - Text processed successfully with gemini-2.5-pro
2026-01-03 12:23:16,555 - INFO -   ✓ Topic 'اصول و مکانیسم ها' processed successfully
2026-01-03 12:23:16,555 - INFO -   Response size: 7,987 bytes (7.80 KB)
2026-01-03 12:23:16,555 - INFO -   Response length: 6,025 characters
2026-01-03 12:23:16,556 - INFO -   ✓ Topic 'اصول و مکانیسم ها' completed
2026-01-03 12:23:16,556 - INFO - ================================================================================
2026-01-03 12:23:16,556 - INFO - 
2026-01-03 12:23:16,556 - INFO - ================================================================================
2026-01-03 12:23:16,556 - INFO - PROCESSING TOPIC 3/31
2026-01-03 12:23:16,556 - INFO - ================================================================================
2026-01-03 12:23:16,556 - INFO -   Subchapter: 'فتوتراپی با UVB'
2026-01-03 12:23:16,557 - INFO -   Topic: 'طیف اثر و منابع تابش'
2026-01-03 12:23:16,557 - INFO -   Number of extractions: 4
2026-01-03 12:23:16,558 - INFO -   JSON payload size: 29,119 bytes (28.44 KB)
2026-01-03 12:23:16,558 - INFO -   Sending topic JSON to model (full subchapter context with 10 topics)...
2026-01-03 12:23:16,558 - INFO -   Calling model API...
2026-01-03 12:23:49,242 - INFO - Text processed successfully with gemini-2.5-pro
2026-01-03 12:23:49,243 - INFO -   ✓ Topic 'طیف اثر و منابع تابش' processed successfully
2026-01-03 12:23:49,244 - INFO -   Response size: 4,630 bytes (4.52 KB)
2026-01-03 12:23:49,244 - INFO -   Response length: 3,603 characters
2026-01-03 12:23:49,245 - INFO -   ✓ Topic 'طیف اثر و منابع تابش' completed
2026-01-03 12:23:49,245 - INFO - ================================================================================
2026-01-03 12:23:49,245 - INFO - 
2026-01-03 12:23:49,246 - INFO - ================================================================================
2026-01-03 12:23:49,246 - INFO - PROCESSING TOPIC 4/31
2026-01-03 12:23:49,246 - INFO - ================================================================================
2026-01-03 12:23:49,246 - INFO -   Subchapter: 'فتوتراپی با UVB'
2026-01-03 12:23:49,246 - INFO -   Topic: 'پروتکل های درمانی'
2026-01-03 12:23:49,247 - INFO -   Number of extractions: 4
2026-01-03 12:23:49,248 - INFO -   JSON payload size: 29,119 bytes (28.44 KB)
2026-01-03 12:23:49,248 - INFO -   Sending topic JSON to model (full subchapter context with 10 topics)...
2026-01-03 12:23:49,248 - INFO -   Calling model API...
2026-01-03 12:24:53,893 - INFO - Text processed successfully with gemini-2.5-pro
2026-01-03 12:24:53,893 - INFO -   ✓ Topic 'پروتکل های درمانی' processed successfully
2026-01-03 12:24:53,893 - INFO -   Response size: 14,346 bytes (14.01 KB)
2026-01-03 12:24:53,894 - INFO -   Response length: 11,411 characters
2026-01-03 12:24:53,894 - INFO -   ✓ Topic 'پروتکل های درمانی' completed
2026-01-03 12:24:53,894 - INFO - ================================================================================
2026-01-03 12:24:53,895 - INFO - 
2026-01-03 12:24:53,895 - INFO - ================================================================================
2026-01-03 12:24:53,895 - INFO - PROCESSING TOPIC 5/31
2026-01-03 12:24:53,895 - INFO - ================================================================================
2026-01-03 12:24:53,895 - INFO -   Subchapter: 'فتوتراپی با UVB'
2026-01-03 12:24:53,895 - INFO -   Topic: 'فتوتراپی برای پسوریازیس'
2026-01-03 12:24:53,895 - INFO -   Number of extractions: 1
2026-01-03 12:24:53,897 - INFO -   JSON payload size: 29,119 bytes (28.44 KB)
2026-01-03 12:24:53,897 - INFO -   Sending topic JSON to model (full subchapter context with 10 topics)...
2026-01-03 12:24:53,897 - INFO -   Calling model API...
2026-01-03 12:25:25,420 - INFO - Text processed successfully with gemini-2.5-pro
2026-01-03 12:25:25,421 - INFO -   ✓ Topic 'فتوتراپی برای پسوریازیس' processed successfully
2026-01-03 12:25:25,422 - INFO -   Response size: 5,829 bytes (5.69 KB)
2026-01-03 12:25:25,422 - INFO -   Response length: 4,396 characters
2026-01-03 12:25:25,423 - INFO -   ✓ Topic 'فتوتراپی برای پسوریازیس' completed
2026-01-03 12:25:25,424 - INFO - ================================================================================
2026-01-03 12:25:25,424 - INFO - 
2026-01-03 12:25:25,424 - INFO - ================================================================================
2026-01-03 12:25:25,425 - INFO - PROCESSING TOPIC 6/31
2026-01-03 12:25:25,425 - INFO - ================================================================================
2026-01-03 12:25:25,425 - INFO -   Subchapter: 'فتوتراپی با UVB'
2026-01-03 12:25:25,425 - INFO -   Topic: 'فتوتراپی برای لنفوم سلول T پوستی، به ویژه مایکوزیز فونگوئیدس'
2026-01-03 12:25:25,426 - INFO -   Number of extractions: 1
2026-01-03 12:25:25,427 - INFO -   JSON payload size: 29,119 bytes (28.44 KB)
2026-01-03 12:25:25,428 - INFO -   Sending topic JSON to model (full subchapter context with 10 topics)...
2026-01-03 12:25:25,428 - INFO -   Calling model API...
2026-01-03 12:26:14,853 - INFO - Text processed successfully with gemini-2.5-pro
2026-01-03 12:26:14,854 - INFO -   ✓ Topic 'فتوتراپی برای لنفوم سلول T پوستی، به ویژه مایکوزیز فونگوئیدس' processed successfully
2026-01-03 12:26:14,854 - INFO -   Response size: 7,682 bytes (7.50 KB)
2026-01-03 12:26:14,854 - INFO -   Response length: 5,984 characters
2026-01-03 12:26:14,855 - INFO -   ✓ Topic 'فتوتراپی برای لنفوم سلول T پوستی، به ویژه مایکوزیز فونگوئیدس' completed
2026-01-03 12:26:14,855 - INFO - ================================================================================
2026-01-03 12:26:14,855 - INFO - 
2026-01-03 12:26:14,855 - INFO - ================================================================================
2026-01-03 12:26:14,855 - INFO - PROCESSING TOPIC 7/31
2026-01-03 12:26:14,856 - INFO - ================================================================================
2026-01-03 12:26:14,856 - INFO -   Subchapter: 'فتوتراپی با UVB'
2026-01-03 12:26:14,856 - INFO -   Topic: 'فتوتراپی برای ویتیلیگو'
2026-01-03 12:26:14,856 - INFO -   Number of extractions: 2
2026-01-03 12:26:14,858 - INFO -   JSON payload size: 29,119 bytes (28.44 KB)
2026-01-03 12:26:14,858 - INFO -   Sending topic JSON to model (full subchapter context with 10 topics)...
2026-01-03 12:26:14,858 - INFO -   Calling model API...
2026-01-03 12:27:04,824 - INFO - Text processed successfully with gemini-2.5-pro
2026-01-03 12:27:04,825 - INFO -   ✓ Topic 'فتوتراپی برای ویتیلیگو' processed successfully
2026-01-03 12:27:04,825 - INFO -   Response size: 6,431 bytes (6.28 KB)
2026-01-03 12:27:04,826 - INFO -   Response length: 4,747 characters
2026-01-03 12:27:04,826 - INFO -   ✓ Topic 'فتوتراپی برای ویتیلیگو' completed
2026-01-03 12:27:04,827 - INFO - ================================================================================
2026-01-03 12:27:04,827 - INFO - 
2026-01-03 12:27:04,827 - INFO - ================================================================================
2026-01-03 12:27:04,827 - INFO - PROCESSING TOPIC 8/31
2026-01-03 12:27:04,827 - INFO - ================================================================================
2026-01-03 12:27:04,827 - INFO -   Subchapter: 'فتوتراپی با UVB'
2026-01-03 12:27:04,828 - INFO -   Topic: 'فتوتراپی برای درماتیت آتوپیک'
2026-01-03 12:27:04,828 - INFO -   Number of extractions: 1
2026-01-03 12:27:04,829 - INFO -   JSON payload size: 29,119 bytes (28.44 KB)
2026-01-03 12:27:04,829 - INFO -   Sending topic JSON to model (full subchapter context with 10 topics)...
2026-01-03 12:27:04,829 - INFO -   Calling model API...
2026-01-03 12:27:26,993 - INFO - Text processed successfully with gemini-2.5-pro
2026-01-03 12:27:26,993 - INFO -   ✓ Topic 'فتوتراپی برای درماتیت آتوپیک' processed successfully
2026-01-03 12:27:26,993 - INFO -   Response size: 3,801 bytes (3.71 KB)
2026-01-03 12:27:26,993 - INFO -   Response length: 2,963 characters
2026-01-03 12:27:26,993 - INFO -   ✓ Topic 'فتوتراپی برای درماتیت آتوپیک' completed
2026-01-03 12:27:26,993 - INFO - ================================================================================
2026-01-03 12:27:26,993 - INFO - 
2026-01-03 12:27:26,993 - INFO - ================================================================================
2026-01-03 12:27:26,993 - INFO - PROCESSING TOPIC 9/31
2026-01-03 12:27:26,993 - INFO - ================================================================================
2026-01-03 12:27:26,993 - INFO -   Subchapter: 'فتوتراپی با UVB'
2026-01-03 12:27:26,993 - INFO -   Topic: 'فتوتراپی برای فتودرماتوزها، پیتیریازیس لیکنوئیدس و درماتیت سبورئیک'
2026-01-03 12:27:26,993 - INFO -   Number of extractions: 1
2026-01-03 12:27:26,994 - INFO -   JSON payload size: 29,119 bytes (28.44 KB)
2026-01-03 12:27:26,994 - INFO -   Sending topic JSON to model (full subchapter context with 10 topics)...
2026-01-03 12:27:26,994 - INFO -   Calling model API...
2026-01-03 12:28:06,668 - INFO - Text processed successfully with gemini-2.5-pro
2026-01-03 12:28:06,668 - INFO -   ✓ Topic 'فتوتراپی برای فتودرماتوزها، پیتیریازیس لیکنوئیدس و درماتیت سبورئیک' processed successfully
2026-01-03 12:28:06,669 - INFO -   Response size: 7,057 bytes (6.89 KB)
2026-01-03 12:28:06,669 - INFO -   Response length: 5,561 characters
2026-01-03 12:28:06,669 - INFO -   ✓ Topic 'فتوتراپی برای فتودرماتوزها، پیتیریازیس لیکنوئیدس و درماتیت سبورئیک' completed
2026-01-03 12:28:06,669 - INFO - ================================================================================
2026-01-03 12:28:06,669 - INFO - 
2026-01-03 12:28:06,669 - INFO - ================================================================================
2026-01-03 12:28:06,669 - INFO - PROCESSING TOPIC 10/31
2026-01-03 12:28:06,669 - INFO - ================================================================================
2026-01-03 12:28:06,669 - INFO -   Subchapter: 'فتوتراپی با UVB'
2026-01-03 12:28:06,669 - INFO -   Topic: 'فتوتراپی برای خارش و عوارض جانبی فتوتراپی با UVB'
2026-01-03 12:28:06,669 - INFO -   Number of extractions: 2
2026-01-03 12:28:06,670 - INFO -   JSON payload size: 29,119 bytes (28.44 KB)
2026-01-03 12:28:06,670 - INFO -   Sending topic JSON to model (full subchapter context with 10 topics)...
2026-01-03 12:28:06,670 - INFO -   Calling model API...
2026-01-03 12:28:52,954 - INFO - Text processed successfully with gemini-2.5-pro
2026-01-03 12:28:52,955 - INFO -   ✓ Topic 'فتوتراپی برای خارش و عوارض جانبی فتوتراپی با UVB' processed successfully
2026-01-03 12:28:52,956 - INFO -   Response size: 5,312 bytes (5.19 KB)
2026-01-03 12:28:52,956 - INFO -   Response length: 4,224 characters
2026-01-03 12:28:52,956 - INFO -   ✓ Topic 'فتوتراپی برای خارش و عوارض جانبی فتوتراپی با UVB' completed
2026-01-03 12:28:52,957 - INFO - ================================================================================
2026-01-03 12:28:52,957 - INFO - 
2026-01-03 12:28:52,957 - INFO - ================================================================================
2026-01-03 12:28:52,957 - INFO - PROCESSING TOPIC 11/31
2026-01-03 12:28:52,957 - INFO - ================================================================================
2026-01-03 12:28:52,958 - INFO -   Subchapter: 'فتوتراپی با لیزر یا لامپ اگزایمر ۳۰۸ نانومتر'
2026-01-03 12:28:52,958 - INFO -   Topic: 'فتوتراپی با لیزر یا لامپ اگزایمر ۳۰۸ نانومتر'
2026-01-03 12:28:52,958 - INFO -   Number of extractions: 1
2026-01-03 12:28:52,958 - INFO -   JSON payload size: 1,903 bytes (1.86 KB)
2026-01-03 12:28:52,959 - INFO -   Sending topic JSON to model (full subchapter context with 1 topics)...
2026-01-03 12:28:52,959 - INFO -   Calling model API...
2026-01-03 12:30:18,719 - INFO - Text processed successfully with gemini-2.5-pro
2026-01-03 12:30:18,719 - INFO -   ✓ Topic 'فتوتراپی با لیزر یا لامپ اگزایمر ۳۰۸ نانومتر' processed successfully
2026-01-03 12:30:18,720 - INFO -   Response size: 6,874 bytes (6.71 KB)
2026-01-03 12:30:18,720 - INFO -   Response length: 5,562 characters
2026-01-03 12:30:18,720 - INFO -   ✓ Topic 'فتوتراپی با لیزر یا لامپ اگزایمر ۳۰۸ نانومتر' completed
2026-01-03 12:30:18,720 - INFO - ================================================================================
2026-01-03 12:30:18,720 - INFO - 
2026-01-03 12:30:18,720 - INFO - ================================================================================
2026-01-03 12:30:18,720 - INFO - PROCESSING TOPIC 12/31
2026-01-03 12:30:18,720 - INFO - ================================================================================
2026-01-03 12:30:18,720 - INFO -   Subchapter: 'فتوتراپی با UVA1'
2026-01-03 12:30:18,720 - INFO -   Topic: 'عوارض جانبی فتوتراپی با UVA1'
2026-01-03 12:30:18,720 - INFO -   Number of extractions: 1
2026-01-03 12:30:18,720 - INFO -   JSON payload size: 1,516 bytes (1.48 KB)
2026-01-03 12:30:18,720 - INFO -   Sending topic JSON to model (full subchapter context with 1 topics)...
2026-01-03 12:30:18,720 - INFO -   Calling model API...
2026-01-03 12:30:48,781 - INFO - Text processed successfully with gemini-2.5-pro
2026-01-03 12:30:48,781 - INFO -   ✓ Topic 'عوارض جانبی فتوتراپی با UVA1' processed successfully
2026-01-03 12:30:48,781 - INFO -   Response size: 4,163 bytes (4.07 KB)
2026-01-03 12:30:48,781 - INFO -   Response length: 3,203 characters
2026-01-03 12:30:48,781 - INFO -   ✓ Topic 'عوارض جانبی فتوتراپی با UVA1' completed
2026-01-03 12:30:48,781 - INFO - ================================================================================
2026-01-03 12:30:48,781 - INFO - 
2026-01-03 12:30:48,781 - INFO - ================================================================================
2026-01-03 12:30:48,781 - INFO - PROCESSING TOPIC 13/31
2026-01-03 12:30:48,781 - INFO - ================================================================================
2026-01-03 12:30:48,781 - INFO -   Subchapter: 'فتوشیمی‌درمانی با پسورالن‌ها (PUVA)'
2026-01-03 12:30:48,781 - INFO -   Topic: 'جنبه‌های تاریخی'
2026-01-03 12:30:48,781 - INFO -   Number of extractions: 2
2026-01-03 12:30:48,782 - INFO -   JSON payload size: 58,377 bytes (57.01 KB)
2026-01-03 12:30:48,782 - INFO -   Sending topic JSON to model (full subchapter context with 17 topics)...
2026-01-03 12:30:48,782 - INFO -   Calling model API...
2026-01-03 12:31:29,439 - INFO - Text processed successfully with gemini-2.5-pro
2026-01-03 12:31:29,439 - INFO -   ✓ Topic 'جنبه‌های تاریخی' processed successfully
2026-01-03 12:31:29,440 - INFO -   Response size: 6,586 bytes (6.43 KB)
2026-01-03 12:31:29,440 - INFO -   Response length: 5,237 characters
2026-01-03 12:31:29,440 - INFO -   ✓ Topic 'جنبه‌های تاریخی' completed
2026-01-03 12:31:29,440 - INFO - ================================================================================
2026-01-03 12:31:29,440 - INFO - 
2026-01-03 12:31:29,440 - INFO - ================================================================================
2026-01-03 12:31:29,440 - INFO - PROCESSING TOPIC 14/31
2026-01-03 12:31:29,440 - INFO - ================================================================================
2026-01-03 12:31:29,440 - INFO -   Subchapter: 'فتوشیمی‌درمانی با پسورالن‌ها (PUVA)'
2026-01-03 12:31:29,440 - INFO -   Topic: 'پسورالن‌ها'
2026-01-03 12:31:29,440 - INFO -   Number of extractions: 2
2026-01-03 12:31:29,441 - INFO -   JSON payload size: 58,377 bytes (57.01 KB)
2026-01-03 12:31:29,441 - INFO -   Sending topic JSON to model (full subchapter context with 17 topics)...
2026-01-03 12:31:29,441 - INFO -   Calling model API...
2026-01-03 12:32:22,473 - INFO - Text processed successfully with gemini-2.5-pro
2026-01-03 12:32:22,474 - INFO -   ✓ Topic 'پسورالن‌ها' processed successfully
2026-01-03 12:32:22,474 - INFO -   Response size: 6,319 bytes (6.17 KB)
2026-01-03 12:32:22,474 - INFO -   Response length: 4,899 characters
2026-01-03 12:32:22,474 - INFO -   ✓ Topic 'پسورالن‌ها' completed
2026-01-03 12:32:22,474 - INFO - ================================================================================
2026-01-03 12:32:22,474 - INFO - 
2026-01-03 12:32:22,474 - INFO - ================================================================================
2026-01-03 12:32:22,474 - INFO - PROCESSING TOPIC 15/31
2026-01-03 12:32:22,474 - INFO - ================================================================================
2026-01-03 12:32:22,474 - INFO -   Subchapter: 'فتوشیمی‌درمانی با پسورالن‌ها (PUVA)'
2026-01-03 12:32:22,474 - INFO -   Topic: 'فتوشیمی پسورالن و طیف اثر و منابع نوری'
2026-01-03 12:32:22,474 - INFO -   Number of extractions: 3
2026-01-03 12:32:22,475 - INFO -   JSON payload size: 58,377 bytes (57.01 KB)
2026-01-03 12:32:22,475 - INFO -   Sending topic JSON to model (full subchapter context with 17 topics)...
2026-01-03 12:32:22,475 - INFO -   Calling model API...
2026-01-03 12:33:11,041 - INFO - Text processed successfully with gemini-2.5-pro
2026-01-03 12:33:11,041 - INFO -   ✓ Topic 'فتوشیمی پسورالن و طیف اثر و منابع نوری' processed successfully
2026-01-03 12:33:11,041 - INFO -   Response size: 10,701 bytes (10.45 KB)
2026-01-03 12:33:11,041 - INFO -   Response length: 7,720 characters
2026-01-03 12:33:11,041 - INFO -   ✓ Topic 'فتوشیمی پسورالن و طیف اثر و منابع نوری' completed
2026-01-03 12:33:11,041 - INFO - ================================================================================
2026-01-03 12:33:11,041 - INFO - 
2026-01-03 12:33:11,041 - INFO - ================================================================================
2026-01-03 12:33:11,041 - INFO - PROCESSING TOPIC 16/31
2026-01-03 12:33:11,041 - INFO - ================================================================================
2026-01-03 12:33:11,041 - INFO -   Subchapter: 'فتوشیمی‌درمانی با پسورالن‌ها (PUVA)'
2026-01-03 12:33:11,041 - INFO -   Topic: 'اثرات فتوبیولوژیک PUVA'
2026-01-03 12:33:11,041 - INFO -   Number of extractions: 1
2026-01-03 12:33:11,042 - INFO -   JSON payload size: 58,377 bytes (57.01 KB)
2026-01-03 12:33:11,042 - INFO -   Sending topic JSON to model (full subchapter context with 17 topics)...
2026-01-03 12:33:11,042 - INFO -   Calling model API...
2026-01-03 12:33:46,288 - INFO - Text processed successfully with gemini-2.5-pro
2026-01-03 12:33:46,288 - INFO -   ✓ Topic 'اثرات فتوبیولوژیک PUVA' processed successfully
2026-01-03 12:33:46,288 - INFO -   Response size: 4,901 bytes (4.79 KB)
2026-01-03 12:33:46,288 - INFO -   Response length: 3,738 characters
2026-01-03 12:33:46,289 - INFO -   ✓ Topic 'اثرات فتوبیولوژیک PUVA' completed
2026-01-03 12:33:46,289 - INFO - ================================================================================
2026-01-03 12:33:46,289 - INFO - 
2026-01-03 12:33:46,289 - INFO - ================================================================================
2026-01-03 12:33:46,289 - INFO - PROCESSING TOPIC 17/31
2026-01-03 12:33:46,289 - INFO - ================================================================================
2026-01-03 12:33:46,289 - INFO -   Subchapter: 'فتوشیمی‌درمانی با پسورالن‌ها (PUVA)'
2026-01-03 12:33:46,289 - INFO -   Topic: 'پروتکل‌های درمانی'
2026-01-03 12:33:46,289 - INFO -   Number of extractions: 2
2026-01-03 12:33:46,289 - INFO -   JSON payload size: 58,377 bytes (57.01 KB)
2026-01-03 12:33:46,289 - INFO -   Sending topic JSON to model (full subchapter context with 17 topics)...
2026-01-03 12:33:46,290 - INFO -   Calling model API...
2026-01-03 12:34:31,516 - INFO - Text processed successfully with gemini-2.5-pro
2026-01-03 12:34:31,516 - INFO -   ✓ Topic 'پروتکل‌های درمانی' processed successfully
2026-01-03 12:34:31,516 - INFO -   Response size: 10,579 bytes (10.33 KB)
2026-01-03 12:34:31,517 - INFO -   Response length: 7,839 characters
2026-01-03 12:34:31,517 - INFO -   ✓ Topic 'پروتکل‌های درمانی' completed
2026-01-03 12:34:31,517 - INFO - ================================================================================
2026-01-03 12:34:31,517 - INFO - 
2026-01-03 12:34:31,517 - INFO - ================================================================================
2026-01-03 12:34:31,517 - INFO - PROCESSING TOPIC 18/31
2026-01-03 12:34:31,517 - INFO - ================================================================================
2026-01-03 12:34:31,517 - INFO -   Subchapter: 'فتوشیمی‌درمانی با پسورالن‌ها (PUVA)'
2026-01-03 12:34:31,517 - INFO -   Topic: 'مرحله درمان اولیه (پاکسازی)'
2026-01-03 12:34:31,517 - INFO -   Number of extractions: 2
2026-01-03 12:34:31,518 - INFO -   JSON payload size: 58,377 bytes (57.01 KB)
2026-01-03 12:34:31,518 - INFO -   Sending topic JSON to model (full subchapter context with 17 topics)...
2026-01-03 12:34:31,518 - INFO -   Calling model API...
2026-01-03 12:35:48,427 - INFO - Text processed successfully with gemini-2.5-pro
2026-01-03 12:35:48,427 - INFO -   ✓ Topic 'مرحله درمان اولیه (پاکسازی)' processed successfully
2026-01-03 12:35:48,428 - INFO -   Response size: 5,729 bytes (5.59 KB)
2026-01-03 12:35:48,428 - INFO -   Response length: 4,378 characters
2026-01-03 12:35:48,428 - INFO -   ✓ Topic 'مرحله درمان اولیه (پاکسازی)' completed
2026-01-03 12:35:48,428 - INFO - ================================================================================
2026-01-03 12:35:48,428 - INFO - 
2026-01-03 12:35:48,428 - INFO - ================================================================================
2026-01-03 12:35:48,428 - INFO - PROCESSING TOPIC 19/31
2026-01-03 12:35:48,428 - INFO - ================================================================================
2026-01-03 12:35:48,428 - INFO -   Subchapter: 'فتوشیمی‌درمانی با پسورالن‌ها (PUVA)'
2026-01-03 12:35:48,428 - INFO -   Topic: 'مرحله نگهدارنده'
2026-01-03 12:35:48,428 - INFO -   Number of extractions: 1
2026-01-03 12:35:48,428 - INFO -   JSON payload size: 58,377 bytes (57.01 KB)
2026-01-03 12:35:48,428 - INFO -   Sending topic JSON to model (full subchapter context with 17 topics)...
2026-01-03 12:35:48,428 - INFO -   Calling model API...
2026-01-03 12:36:18,619 - INFO - Text processed successfully with gemini-2.5-pro
2026-01-03 12:36:18,619 - INFO -   ✓ Topic 'مرحله نگهدارنده' processed successfully
2026-01-03 12:36:18,620 - INFO -   Response size: 3,138 bytes (3.06 KB)
2026-01-03 12:36:18,620 - INFO -   Response length: 2,414 characters
2026-01-03 12:36:18,620 - INFO -   ✓ Topic 'مرحله نگهدارنده' completed
2026-01-03 12:36:18,620 - INFO - ================================================================================
2026-01-03 12:36:18,620 - INFO - 
2026-01-03 12:36:18,620 - INFO - ================================================================================
2026-01-03 12:36:18,620 - INFO - PROCESSING TOPIC 20/31
2026-01-03 12:36:18,620 - INFO - ================================================================================
2026-01-03 12:36:18,620 - INFO -   Subchapter: 'فتوشیمی‌درمانی با پسورالن‌ها (PUVA)'
2026-01-03 12:36:18,620 - INFO -   Topic: 'PUVA برای پسوریازیس'
2026-01-03 12:36:18,620 - INFO -   Number of extractions: 2
2026-01-03 12:36:18,621 - INFO -   JSON payload size: 58,377 bytes (57.01 KB)
2026-01-03 12:36:18,621 - INFO -   Sending topic JSON to model (full subchapter context with 17 topics)...
2026-01-03 12:36:18,621 - INFO -   Calling model API...
2026-01-03 12:37:18,625 - INFO - Text processed successfully with gemini-2.5-pro
2026-01-03 12:37:18,626 - INFO -   ✓ Topic 'PUVA برای پسوریازیس' processed successfully
2026-01-03 12:37:18,626 - INFO -   Response size: 20,942 bytes (20.45 KB)
2026-01-03 12:37:18,626 - INFO -   Response length: 16,244 characters
2026-01-03 12:37:18,626 - INFO -   ✓ Topic 'PUVA برای پسوریازیس' completed
2026-01-03 12:37:18,626 - INFO - ================================================================================
2026-01-03 12:37:18,626 - INFO - 
2026-01-03 12:37:18,626 - INFO - ================================================================================
2026-01-03 12:37:18,626 - INFO - PROCESSING TOPIC 21/31
2026-01-03 12:37:18,626 - INFO - ================================================================================
2026-01-03 12:37:18,626 - INFO -   Subchapter: 'فتوشیمی‌درمانی با پسورالن‌ها (PUVA)'
2026-01-03 12:37:18,626 - INFO -   Topic: 'درمان‌های ترکیبی'
2026-01-03 12:37:18,626 - INFO -   Number of extractions: 1
2026-01-03 12:37:18,627 - INFO -   JSON payload size: 58,377 bytes (57.01 KB)
2026-01-03 12:37:18,627 - INFO -   Sending topic JSON to model (full subchapter context with 17 topics)...
2026-01-03 12:37:18,627 - INFO -   Calling model API...
2026-01-03 12:37:56,346 - INFO - Text processed successfully with gemini-2.5-pro
2026-01-03 12:37:56,347 - INFO -   ✓ Topic 'درمان‌های ترکیبی' processed successfully
2026-01-03 12:37:56,347 - INFO -   Response size: 7,608 bytes (7.43 KB)
2026-01-03 12:37:56,347 - INFO -   Response length: 5,852 characters
2026-01-03 12:37:56,347 - INFO -   ✓ Topic 'درمان‌های ترکیبی' completed
2026-01-03 12:37:56,347 - INFO - ================================================================================
2026-01-03 12:37:56,347 - INFO - 
2026-01-03 12:37:56,347 - INFO - ================================================================================
2026-01-03 12:37:56,347 - INFO - PROCESSING TOPIC 22/31
2026-01-03 12:37:56,347 - INFO - ================================================================================
2026-01-03 12:37:56,347 - INFO -   Subchapter: 'فتوشیمی‌درمانی با پسورالن‌ها (PUVA)'
2026-01-03 12:37:56,347 - INFO -   Topic: 'PUVA برای لنفوم سلول T پوستی، به ویژه مایکوزیس فونگوئیدس'
2026-01-03 12:37:56,347 - INFO -   Number of extractions: 2
2026-01-03 12:37:56,348 - INFO -   JSON payload size: 58,377 bytes (57.01 KB)
2026-01-03 12:37:56,348 - INFO -   Sending topic JSON to model (full subchapter context with 17 topics)...
2026-01-03 12:37:56,348 - INFO -   Calling model API...
2026-01-03 12:38:52,619 - INFO - Text processed successfully with gemini-2.5-pro
2026-01-03 12:38:52,619 - INFO -   ✓ Topic 'PUVA برای لنفوم سلول T پوستی، به ویژه مایکوزیس فونگوئیدس' processed successfully
2026-01-03 12:38:52,619 - INFO -   Response size: 8,677 bytes (8.47 KB)
2026-01-03 12:38:52,619 - INFO -   Response length: 6,639 characters
2026-01-03 12:38:52,619 - INFO -   ✓ Topic 'PUVA برای لنفوم سلول T پوستی، به ویژه مایکوزیس فونگوئیدس' completed
2026-01-03 12:38:52,619 - INFO - ================================================================================
2026-01-03 12:38:52,619 - INFO - 
2026-01-03 12:38:52,619 - INFO - ================================================================================
2026-01-03 12:38:52,619 - INFO - PROCESSING TOPIC 23/31
2026-01-03 12:38:52,619 - INFO - ================================================================================
2026-01-03 12:38:52,619 - INFO -   Subchapter: 'فتوشیمی‌درمانی با پسورالن‌ها (PUVA)'
2026-01-03 12:38:52,620 - INFO -   Topic: 'PUVA برای ویتیلیگو'
2026-01-03 12:38:52,620 - INFO -   Number of extractions: 1
2026-01-03 12:38:52,620 - INFO -   JSON payload size: 58,377 bytes (57.01 KB)
2026-01-03 12:38:52,620 - INFO -   Sending topic JSON to model (full subchapter context with 17 topics)...
2026-01-03 12:38:52,620 - INFO -   Calling model API...
2026-01-03 12:39:48,120 - INFO - Text processed successfully with gemini-2.5-pro
2026-01-03 12:39:48,120 - INFO -   ✓ Topic 'PUVA برای ویتیلیگو' processed successfully
2026-01-03 12:39:48,121 - INFO -   Response size: 9,672 bytes (9.45 KB)
2026-01-03 12:39:48,121 - INFO -   Response length: 7,186 characters
2026-01-03 12:39:48,121 - INFO -   ✓ Topic 'PUVA برای ویتیلیگو' completed
2026-01-03 12:39:48,121 - INFO - ================================================================================
2026-01-03 12:39:48,121 - INFO - 
2026-01-03 12:39:48,121 - INFO - ================================================================================
2026-01-03 12:39:48,121 - INFO - PROCESSING TOPIC 24/31
2026-01-03 12:39:48,121 - INFO - ================================================================================
2026-01-03 12:39:48,121 - INFO -   Subchapter: 'فتوشیمی‌درمانی با پسورالن‌ها (PUVA)'
2026-01-03 12:39:48,121 - INFO -   Topic: 'PUVA برای درماتیت آتوپیک و لیکن پلان'
2026-01-03 12:39:48,121 - INFO -   Number of extractions: 1
2026-01-03 12:39:48,122 - INFO -   JSON payload size: 58,377 bytes (57.01 KB)
2026-01-03 12:39:48,122 - INFO -   Sending topic JSON to model (full subchapter context with 17 topics)...
2026-01-03 12:39:48,122 - INFO -   Calling model API...
2026-01-03 12:40:27,861 - INFO - Text processed successfully with gemini-2.5-pro
2026-01-03 12:40:27,862 - INFO -   ✓ Topic 'PUVA برای درماتیت آتوپیک و لیکن پلان' processed successfully
2026-01-03 12:40:27,862 - INFO -   Response size: 7,837 bytes (7.65 KB)
2026-01-03 12:40:27,862 - INFO -   Response length: 6,182 characters
2026-01-03 12:40:27,862 - INFO -   ✓ Topic 'PUVA برای درماتیت آتوپیک و لیکن پلان' completed
2026-01-03 12:40:27,862 - INFO - ================================================================================
2026-01-03 12:40:27,862 - INFO - 
2026-01-03 12:40:27,862 - INFO - ================================================================================
2026-01-03 12:40:27,862 - INFO - PROCESSING TOPIC 25/31
2026-01-03 12:40:27,862 - INFO - ================================================================================
2026-01-03 12:40:27,862 - INFO -   Subchapter: 'فتوشیمی‌درمانی با پسورالن‌ها (PUVA)'
2026-01-03 12:40:27,862 - INFO -   Topic: 'PUVA برای بیماری پیوند علیه میزبان'
2026-01-03 12:40:27,862 - INFO -   Number of extractions: 1
2026-01-03 12:40:27,863 - INFO -   JSON payload size: 58,377 bytes (57.01 KB)
2026-01-03 12:40:27,863 - INFO -   Sending topic JSON to model (full subchapter context with 17 topics)...
2026-01-03 12:40:27,863 - INFO -   Calling model API...
2026-01-03 12:41:09,799 - INFO - Text processed successfully with gemini-2.5-pro
2026-01-03 12:41:09,799 - INFO -   ✓ Topic 'PUVA برای بیماری پیوند علیه میزبان' processed successfully
2026-01-03 12:41:09,799 - INFO -   Response size: 5,484 bytes (5.36 KB)
2026-01-03 12:41:09,799 - INFO -   Response length: 4,092 characters
2026-01-03 12:41:09,799 - INFO -   ✓ Topic 'PUVA برای بیماری پیوند علیه میزبان' completed
2026-01-03 12:41:09,799 - INFO - ================================================================================
2026-01-03 12:41:09,799 - INFO - 
2026-01-03 12:41:09,800 - INFO - ================================================================================
2026-01-03 12:41:09,800 - INFO - PROCESSING TOPIC 26/31
2026-01-03 12:41:09,800 - INFO - ================================================================================
2026-01-03 12:41:09,800 - INFO -   Subchapter: 'فتوشیمی‌درمانی با پسورالن‌ها (PUVA)'
2026-01-03 12:41:09,800 - INFO -   Topic: 'PUVA برای کهیر پیگمنتوزا و درماتوزهای متفرقه'
2026-01-03 12:41:09,800 - INFO -   Number of extractions: 1
2026-01-03 12:41:09,800 - INFO -   JSON payload size: 58,377 bytes (57.01 KB)
2026-01-03 12:41:09,800 - INFO -   Sending topic JSON to model (full subchapter context with 17 topics)...
2026-01-03 12:41:09,800 - INFO -   Calling model API...
2026-01-03 12:41:59,147 - INFO - Text processed successfully with gemini-2.5-pro
2026-01-03 12:41:59,147 - INFO -   ✓ Topic 'PUVA برای کهیر پیگمنتوزا و درماتوزهای متفرقه' processed successfully
2026-01-03 12:41:59,147 - INFO -   Response size: 6,504 bytes (6.35 KB)
2026-01-03 12:41:59,147 - INFO -   Response length: 4,873 characters
2026-01-03 12:41:59,147 - INFO -   ✓ Topic 'PUVA برای کهیر پیگمنتوزا و درماتوزهای متفرقه' completed
2026-01-03 12:41:59,147 - INFO - ================================================================================
2026-01-03 12:41:59,147 - INFO - 
2026-01-03 12:41:59,147 - INFO - ================================================================================
2026-01-03 12:41:59,147 - INFO - PROCESSING TOPIC 27/31
2026-01-03 12:41:59,147 - INFO - ================================================================================
2026-01-03 12:41:59,147 - INFO -   Subchapter: 'فتوشیمی‌درمانی با پسورالن‌ها (PUVA)'
2026-01-03 12:41:59,147 - INFO -   Topic: 'PUVA برای فتودرماتوزها'
2026-01-03 12:41:59,147 - INFO -   Number of extractions: 1
2026-01-03 12:41:59,148 - INFO -   JSON payload size: 58,377 bytes (57.01 KB)
2026-01-03 12:41:59,148 - INFO -   Sending topic JSON to model (full subchapter context with 17 topics)...
2026-01-03 12:41:59,148 - INFO -   Calling model API...
2026-01-03 12:43:09,109 - INFO - Text processed successfully with gemini-2.5-pro
2026-01-03 12:43:09,110 - INFO -   ✓ Topic 'PUVA برای فتودرماتوزها' processed successfully
2026-01-03 12:43:09,110 - INFO -   Response size: 5,655 bytes (5.52 KB)
2026-01-03 12:43:09,110 - INFO -   Response length: 4,358 characters
2026-01-03 12:43:09,110 - INFO -   ✓ Topic 'PUVA برای فتودرماتوزها' completed
2026-01-03 12:43:09,110 - INFO - ================================================================================
2026-01-03 12:43:09,110 - INFO - 
2026-01-03 12:43:09,110 - INFO - ================================================================================
2026-01-03 12:43:09,110 - INFO - PROCESSING TOPIC 28/31
2026-01-03 12:43:09,110 - INFO - ================================================================================
2026-01-03 12:43:09,110 - INFO -   Subchapter: 'فتوشیمی‌درمانی با پسورالن‌ها (PUVA)'
2026-01-03 12:43:09,110 - INFO -   Topic: 'عوارض جانبی و خطرات بلندمدت PUVA'
2026-01-03 12:43:09,110 - INFO -   Number of extractions: 2
2026-01-03 12:43:09,110 - INFO -   JSON payload size: 58,377 bytes (57.01 KB)
2026-01-03 12:43:09,111 - INFO -   Sending topic JSON to model (full subchapter context with 17 topics)...
2026-01-03 12:43:09,111 - INFO -   Calling model API...
2026-01-03 12:44:18,833 - INFO - Text processed successfully with gemini-2.5-pro
2026-01-03 12:44:18,833 - INFO -   ✓ Topic 'عوارض جانبی و خطرات بلندمدت PUVA' processed successfully
2026-01-03 12:44:18,834 - INFO -   Response size: 15,235 bytes (14.88 KB)
2026-01-03 12:44:18,834 - INFO -   Response length: 11,231 characters
2026-01-03 12:44:18,834 - INFO -   ✓ Topic 'عوارض جانبی و خطرات بلندمدت PUVA' completed
2026-01-03 12:44:18,834 - INFO - ================================================================================
2026-01-03 12:44:18,834 - INFO - 
2026-01-03 12:44:18,834 - INFO - ================================================================================
2026-01-03 12:44:18,834 - INFO - PROCESSING TOPIC 29/31
2026-01-03 12:44:18,834 - INFO - ================================================================================
2026-01-03 12:44:18,834 - INFO -   Subchapter: 'فتوشیمی‌درمانی با پسورالن‌ها (PUVA)'
2026-01-03 12:44:18,834 - INFO -   Topic: 'UVB و PUVA در بیماران آلوده به HIV'
2026-01-03 12:44:18,834 - INFO -   Number of extractions: 1
2026-01-03 12:44:18,834 - INFO -   JSON payload size: 58,377 bytes (57.01 KB)
2026-01-03 12:44:18,834 - INFO -   Sending topic JSON to model (full subchapter context with 17 topics)...
2026-01-03 12:44:18,834 - INFO -   Calling model API...
2026-01-03 12:44:39,554 - INFO - Text processed successfully with gemini-2.5-pro
2026-01-03 12:44:39,555 - INFO -   ✓ Topic 'UVB و PUVA در بیماران آلوده به HIV' processed successfully
2026-01-03 12:44:39,555 - INFO -   Response size: 2,069 bytes (2.02 KB)
2026-01-03 12:44:39,555 - INFO -   Response length: 1,608 characters
2026-01-03 12:44:39,555 - INFO -   ✓ Topic 'UVB و PUVA در بیماران آلوده به HIV' completed
2026-01-03 12:44:39,555 - INFO - ================================================================================
2026-01-03 12:44:39,555 - INFO - 
2026-01-03 12:44:39,555 - INFO - ================================================================================
2026-01-03 12:44:39,555 - INFO - PROCESSING TOPIC 30/31
2026-01-03 12:44:39,555 - INFO - ================================================================================
2026-01-03 12:44:39,555 - INFO -   Subchapter: 'فتوکموتراپی خارج بدنی (فتوفرزیس)'
2026-01-03 12:44:39,555 - INFO -   Topic: 'پروتکل‌های درمانی و مکانیسم عمل'
2026-01-03 12:44:39,555 - INFO -   Number of extractions: 1
2026-01-03 12:44:39,555 - INFO -   JSON payload size: 3,766 bytes (3.68 KB)
2026-01-03 12:44:39,556 - INFO -   Sending topic JSON to model (full subchapter context with 2 topics)...
2026-01-03 12:44:39,556 - INFO -   Calling model API...
2026-01-03 12:45:31,167 - INFO - Text processed successfully with gemini-2.5-pro
2026-01-03 12:45:31,167 - INFO -   ✓ Topic 'پروتکل‌های درمانی و مکانیسم عمل' processed successfully
2026-01-03 12:45:31,167 - INFO -   Response size: 10,490 bytes (10.24 KB)
2026-01-03 12:45:31,167 - INFO -   Response length: 8,315 characters
2026-01-03 12:45:31,167 - INFO -   ✓ Topic 'پروتکل‌های درمانی و مکانیسم عمل' completed
2026-01-03 12:45:31,167 - INFO - ================================================================================
2026-01-03 12:45:31,167 - INFO - 
2026-01-03 12:45:31,167 - INFO - ================================================================================
2026-01-03 12:45:31,167 - INFO - PROCESSING TOPIC 31/31
2026-01-03 12:45:31,167 - INFO - ================================================================================
2026-01-03 12:45:31,167 - INFO -   Subchapter: 'فتوکموتراپی خارج بدنی (فتوفرزیس)'
2026-01-03 12:45:31,168 - INFO -   Topic: 'عوارض جانبی و سایر اندیکاسیون‌ها'
2026-01-03 12:45:31,168 - INFO -   Number of extractions: 1
2026-01-03 12:45:31,168 - INFO -   JSON payload size: 3,766 bytes (3.68 KB)
2026-01-03 12:45:31,168 - INFO -   Sending topic JSON to model (full subchapter context with 2 topics)...
2026-01-03 12:45:31,168 - INFO -   Calling model API...
2026-01-03 12:46:19,516 - INFO - Text processed successfully with gemini-2.5-pro
2026-01-03 12:46:19,517 - INFO -   ✓ Topic 'عوارض جانبی و سایر اندیکاسیون‌ها' processed successfully
2026-01-03 12:46:19,517 - INFO -   Response size: 3,514 bytes (3.43 KB)
2026-01-03 12:46:19,517 - INFO -   Response length: 2,888 characters
2026-01-03 12:46:19,517 - INFO -   ✓ Topic 'عوارض جانبی و سایر اندیکاسیون‌ها' completed
2026-01-03 12:46:19,517 - INFO - ================================================================================
2026-01-03 12:46:19,517 - INFO - 
2026-01-03 12:46:19,517 - INFO - ================================================================================
2026-01-03 12:46:19,517 - INFO - SAVING TXT FILES FOR EACH SUBCHAPTER
2026-01-03 12:46:19,517 - INFO - ================================================================================
2026-01-03 12:46:19,518 - INFO - Saved subchapter 'فتوتراپی با UVB' response to: /home/shahmir/Desktop/out-134/OCR Extraction_subchapter_2_فتوتراپی_با_UVB.txt (10 topics)
2026-01-03 12:46:19,518 - INFO - Saved subchapter 'فتوتراپی با لیزر یا لامپ اگزایمر ۳۰۸ نانومتر' response to: /home/shahmir/Desktop/out-134/OCR Extraction_subchapter_3_فتوتراپی_با_لیزر_یا_لامپ_اگزایمر_۳۰۸_نانومتر.txt (1 topics)
2026-01-03 12:46:19,518 - INFO - Saved subchapter 'فتوتراپی با UVA1' response to: /home/shahmir/Desktop/out-134/OCR Extraction_subchapter_1_فتوتراپی_با_UVA1.txt (1 topics)
2026-01-03 12:46:19,518 - INFO - Saved subchapter 'فتوشیمی‌درمانی با پسورالن‌ها (PUVA)' response to: /home/shahmir/Desktop/out-134/OCR Extraction_subchapter_4_فتوشیمیدرمانی_با_پسورالنها_PUVA.txt (17 topics)
2026-01-03 12:46:19,518 - INFO - Saved subchapter 'فتوکموتراپی خارج بدنی (فتوفرزیس)' response to: /home/shahmir/Desktop/out-134/OCR Extraction_subchapter_5_فتوکموتراپی_خارج_بدنی_فتوفرزیس.txt (2 topics)
2026-01-03 12:46:19,518 - INFO - ================================================================================
2026-01-03 12:46:19,518 - INFO - ================================================================================
2026-01-03 12:46:19,518 - INFO - EXTRACTING JSON BLOCKS FROM RESPONSES
2026-01-03 12:46:19,518 - INFO - ================================================================================
2026-01-03 12:46:19,518 - INFO - Extracting JSON blocks from 31 responses (one per topic)...
2026-01-03 12:46:19,519 - INFO -   Topic 1/31: 'فتوتراپی با UVB' > 'جنبه های تاریخی'
2026-01-03 12:46:19,519 - INFO -     ✓ Extracted 1 JSON block(s)
2026-01-03 12:46:19,519 - INFO -   Topic 2/31: 'فتوتراپی با UVB' > 'اصول و مکانیسم ها'
2026-01-03 12:46:19,519 - INFO -     ✓ Extracted 1 JSON block(s)
2026-01-03 12:46:19,519 - INFO -   Topic 3/31: 'فتوتراپی با UVB' > 'طیف اثر و منابع تابش'
2026-01-03 12:46:19,519 - INFO -     ✓ Extracted 1 JSON block(s)
2026-01-03 12:46:19,519 - INFO -   Topic 4/31: 'فتوتراپی با UVB' > 'پروتکل های درمانی'
2026-01-03 12:46:19,520 - INFO -     ✓ Extracted 1 JSON block(s)
2026-01-03 12:46:19,520 - INFO -   Topic 5/31: 'فتوتراپی با UVB' > 'فتوتراپی برای پسوریازیس'
2026-01-03 12:46:19,520 - INFO -     ✓ Extracted 1 JSON block(s)
2026-01-03 12:46:19,520 - INFO -   Topic 6/31: 'فتوتراپی با UVB' > 'فتوتراپی برای لنفوم سلول T پوستی، به ویژه مایکوزیز فونگوئیدس'
2026-01-03 12:46:19,520 - INFO -     ✓ Extracted 1 JSON block(s)
2026-01-03 12:46:19,520 - INFO -   Topic 7/31: 'فتوتراپی با UVB' > 'فتوتراپی برای ویتیلیگو'
2026-01-03 12:46:19,520 - INFO -     ✓ Extracted 1 JSON block(s)
2026-01-03 12:46:19,520 - INFO -   Topic 8/31: 'فتوتراپی با UVB' > 'فتوتراپی برای درماتیت آتوپیک'
2026-01-03 12:46:19,520 - INFO -     ✓ Extracted 1 JSON block(s)
2026-01-03 12:46:19,521 - INFO -   Topic 9/31: 'فتوتراپی با UVB' > 'فتوتراپی برای فتودرماتوزها، پیتیریازیس لیکنوئیدس و درماتیت سبورئیک'
2026-01-03 12:46:19,521 - INFO -     ✓ Extracted 1 JSON block(s)
2026-01-03 12:46:19,521 - INFO -   Topic 10/31: 'فتوتراپی با UVB' > 'فتوتراپی برای خارش و عوارض جانبی فتوتراپی با UVB'
2026-01-03 12:46:19,521 - INFO -     ✓ Extracted 1 JSON block(s)
2026-01-03 12:46:19,521 - INFO -   Topic 11/31: 'فتوتراپی با لیزر یا لامپ اگزایمر ۳۰۸ نانومتر' > 'فتوتراپی با لیزر یا لامپ اگزایمر ۳۰۸ نانومتر'
2026-01-03 12:46:19,521 - INFO -     ✓ Extracted 1 JSON block(s)
2026-01-03 12:46:19,521 - INFO -   Topic 12/31: 'فتوتراپی با UVA1' > 'عوارض جانبی فتوتراپی با UVA1'
2026-01-03 12:46:19,521 - INFO -     ✓ Extracted 1 JSON block(s)
2026-01-03 12:46:19,521 - INFO -   Topic 13/31: 'فتوشیمی‌درمانی با پسورالن‌ها (PUVA)' > 'جنبه‌های تاریخی'
2026-01-03 12:46:19,522 - INFO -     ✓ Extracted 1 JSON block(s)
2026-01-03 12:46:19,522 - INFO -   Topic 14/31: 'فتوشیمی‌درمانی با پسورالن‌ها (PUVA)' > 'پسورالن‌ها'
2026-01-03 12:46:19,522 - INFO -     ✓ Extracted 1 JSON block(s)
2026-01-03 12:46:19,522 - INFO -   Topic 15/31: 'فتوشیمی‌درمانی با پسورالن‌ها (PUVA)' > 'فتوشیمی پسورالن و طیف اثر و منابع نوری'
2026-01-03 12:46:19,523 - INFO -     ✓ Extracted 1 JSON block(s)
2026-01-03 12:46:19,523 - INFO -   Topic 16/31: 'فتوشیمی‌درمانی با پسورالن‌ها (PUVA)' > 'اثرات فتوبیولوژیک PUVA'
2026-01-03 12:46:19,523 - INFO -     ✓ Extracted 1 JSON block(s)
2026-01-03 12:46:19,523 - INFO -   Topic 17/31: 'فتوشیمی‌درمانی با پسورالن‌ها (PUVA)' > 'پروتکل‌های درمانی'
2026-01-03 12:46:19,523 - INFO -     ✓ Extracted 1 JSON block(s)
2026-01-03 12:46:19,523 - INFO -   Topic 18/31: 'فتوشیمی‌درمانی با پسورالن‌ها (PUVA)' > 'مرحله درمان اولیه (پاکسازی)'
2026-01-03 12:46:19,523 - INFO -     ✓ Extracted 1 JSON block(s)
2026-01-03 12:46:19,523 - INFO -   Topic 19/31: 'فتوشیمی‌درمانی با پسورالن‌ها (PUVA)' > 'مرحله نگهدارنده'
2026-01-03 12:46:19,523 - INFO -     ✓ Extracted 1 JSON block(s)
2026-01-03 12:46:19,523 - INFO -   Topic 20/31: 'فتوشیمی‌درمانی با پسورالن‌ها (PUVA)' > 'PUVA برای پسوریازیس'
2026-01-03 12:46:19,524 - INFO -     ✓ Extracted 1 JSON block(s)
2026-01-03 12:46:19,524 - INFO -   Topic 21/31: 'فتوشیمی‌درمانی با پسورالن‌ها (PUVA)' > 'درمان‌های ترکیبی'
2026-01-03 12:46:19,524 - INFO -     ✓ Extracted 1 JSON block(s)
2026-01-03 12:46:19,524 - INFO -   Topic 22/31: 'فتوشیمی‌درمانی با پسورالن‌ها (PUVA)' > 'PUVA برای لنفوم سلول T پوستی، به ویژه مایکوزیس فونگوئیدس'
2026-01-03 12:46:19,525 - INFO -     ✓ Extracted 1 JSON block(s)
2026-01-03 12:46:19,525 - INFO -   Topic 23/31: 'فتوشیمی‌درمانی با پسورالن‌ها (PUVA)' > 'PUVA برای ویتیلیگو'
2026-01-03 12:46:19,525 - INFO -     ✓ Extracted 1 JSON block(s)
2026-01-03 12:46:19,525 - INFO -   Topic 24/31: 'فتوشیمی‌درمانی با پسورالن‌ها (PUVA)' > 'PUVA برای درماتیت آتوپیک و لیکن پلان'
2026-01-03 12:46:19,526 - INFO -     ✓ Extracted 1 JSON block(s)
2026-01-03 12:46:19,526 - INFO -   Topic 25/31: 'فتوشیمی‌درمانی با پسورالن‌ها (PUVA)' > 'PUVA برای بیماری پیوند علیه میزبان'
2026-01-03 12:46:19,526 - INFO -     ✓ Extracted 1 JSON block(s)
2026-01-03 12:46:19,526 - INFO -   Topic 26/31: 'فتوشیمی‌درمانی با پسورالن‌ها (PUVA)' > 'PUVA برای کهیر پیگمنتوزا و درماتوزهای متفرقه'
2026-01-03 12:46:19,526 - INFO -     ✓ Extracted 1 JSON block(s)
2026-01-03 12:46:19,527 - INFO -   Topic 27/31: 'فتوشیمی‌درمانی با پسورالن‌ها (PUVA)' > 'PUVA برای فتودرماتوزها'
2026-01-03 12:46:19,527 - INFO -     ✓ Extracted 1 JSON block(s)
2026-01-03 12:46:19,527 - INFO -   Topic 28/31: 'فتوشیمی‌درمانی با پسورالن‌ها (PUVA)' > 'عوارض جانبی و خطرات بلندمدت PUVA'
2026-01-03 12:46:19,528 - INFO -     ✓ Extracted 1 JSON block(s)
2026-01-03 12:46:19,528 - INFO -   Topic 29/31: 'فتوشیمی‌درمانی با پسورالن‌ها (PUVA)' > 'UVB و PUVA در بیماران آلوده به HIV'
2026-01-03 12:46:19,528 - INFO -     ✓ Extracted 1 JSON block(s)
2026-01-03 12:46:19,528 - INFO -   Topic 30/31: 'فتوکموتراپی خارج بدنی (فتوفرزیس)' > 'پروتکل‌های درمانی و مکانیسم عمل'
2026-01-03 12:46:19,529 - INFO -     ✓ Extracted 1 JSON block(s)
2026-01-03 12:46:19,529 - INFO -   Topic 31/31: 'فتوکموتراپی خارج بدنی (فتوفرزیس)' > 'عوارض جانبی و سایر اندیکاسیون‌ها'
2026-01-03 12:46:19,529 - INFO -     ✓ Extracted 1 JSON block(s)
2026-01-03 12:46:19,529 - INFO - Total JSON blocks extracted: 31
2026-01-03 12:46:19,529 - INFO - ================================================================================
2026-01-03 12:46:19,529 - INFO - ================================================================================
2026-01-03 12:46:19,529 - INFO - CALCULATING POINTS PER SUBCHAPTER
2026-01-03 12:46:19,529 - INFO - ================================================================================
2026-01-03 12:46:19,529 - INFO - Combining 10 JSON block(s) into final structure...
2026-01-03 12:46:19,529 - WARNING - Block 2: Different chapter 'فتوتراپی با UVB' (expected 'فتوتراپی'). Keeping both.
2026-01-03 12:46:19,529 - WARNING - Block 4: Different chapter 'پروتکل های درمانی' (expected 'فتوتراپی'). Keeping both.
2026-01-03 12:46:19,529 - WARNING - Block 6: Different chapter 'فتوتراپی برای لنفوم سلول T پوستی، به ویژه مایکوزیز فونگوئیدس' (expected 'فتوتراپی'). Keeping both.
2026-01-03 12:46:19,530 - WARNING - Block 8: Different chapter 'فتوتراپی برای درماتیت آتوپیک' (expected 'فتوتراپی'). Keeping both.
2026-01-03 12:46:19,530 - INFO - Final structure: chapter 'فتوتراپی' with 10 content items
2026-01-03 12:46:19,530 - INFO - Processing chapter: 'فتوتراپی' with 10 top-level items
2026-01-03 12:46:19,530 - INFO -   Subchapter 'فتوتراپی با UVB': 299 points (10 topics)
2026-01-03 12:46:19,530 - INFO - Combining 1 JSON block(s) into final structure...
2026-01-03 12:46:19,530 - INFO - Final structure: chapter 'فتوتراپی و فتوشیمی‌تراپی' with 1 content items
2026-01-03 12:46:19,530 - INFO - Processing chapter: 'فتوتراپی و فتوشیمی‌تراپی' with 1 top-level items
2026-01-03 12:46:19,530 - INFO -   Subchapter 'فتوتراپی با لیزر یا لامپ اگزایمر ۳۰۸ نانومتر': 29 points (1 topics)
2026-01-03 12:46:19,530 - INFO - Combining 1 JSON block(s) into final structure...
2026-01-03 12:46:19,530 - INFO - Final structure: chapter 'فتوتراپی' with 1 content items
2026-01-03 12:46:19,530 - INFO - Processing chapter: 'فتوتراپی' with 1 top-level items
2026-01-03 12:46:19,531 - INFO -   Subchapter 'فتوتراپی با UVA1': 14 points (1 topics)
2026-01-03 12:46:19,531 - INFO - Combining 17 JSON block(s) into final structure...
2026-01-03 12:46:19,531 - WARNING - Block 2: Different chapter 'فتوتراپی و فتوشیمی‌درمانی' (expected 'فتوتراپی'). Keeping both.
2026-01-03 12:46:19,531 - WARNING - Block 6: Different chapter 'فتوتراپی و فتوشیمی‌درمانی' (expected 'فتوتراپی'). Keeping both.
2026-01-03 12:46:19,531 - WARNING - Block 7: Different chapter 'فتوشیمی‌درمانی با پسورالن‌ها (PUVA)' (expected 'فتوتراپی'). Keeping both.
2026-01-03 12:46:19,531 - WARNING - Block 8: Different chapter 'فتوتراپی و فتوشیمی‌درمانی' (expected 'فتوتراپی'). Keeping both.
2026-01-03 12:46:19,531 - WARNING - Block 10: Different chapter 'فتوتراپی و فتوشیمی‌درمانی' (expected 'فتوتراپی'). Keeping both.
2026-01-03 12:46:19,531 - WARNING - Block 11: Different chapter 'فتوتراپی و فتوشیمی‌درمانی' (expected 'فتوتراپی'). Keeping both.
2026-01-03 12:46:19,531 - WARNING - Block 12: Different chapter 'PUVA برای درماتیت آتوپیک و لیکن پلان' (expected 'فتوتراپی'). Keeping both.
2026-01-03 12:46:19,531 - WARNING - Block 14: Different chapter 'فتوتراپی و فتوشیمی‌درمانی' (expected 'فتوتراپی'). Keeping both.
2026-01-03 12:46:19,531 - WARNING - Block 17: Different chapter 'فتوتراپی و فتوشیمی‌درمانی' (expected 'فتوتراپی'). Keeping both.
2026-01-03 12:46:19,531 - INFO - Final structure: chapter 'فتوتراپی' with 17 content items
2026-01-03 12:46:19,531 - INFO - Processing chapter: 'فتوتراپی' with 17 top-level items
2026-01-03 12:46:19,532 - INFO -   Subchapter 'فتوشیمی‌درمانی با پسورالن‌ها (PUVA)': 652 points (17 topics)
2026-01-03 12:46:19,532 - INFO - Combining 2 JSON block(s) into final structure...
2026-01-03 12:46:19,532 - INFO - Final structure: chapter 'فتوتراپی و فتوکموتراپی' with 2 content items
2026-01-03 12:46:19,532 - INFO - Processing chapter: 'فتوتراپی و فتوکموتراپی' with 2 top-level items
2026-01-03 12:46:19,532 - INFO -   Subchapter 'فتوکموتراپی خارج بدنی (فتوفرزیس)': 54 points (2 topics)
2026-01-03 12:46:19,532 - INFO - ================================================================================
2026-01-03 12:46:19,532 - INFO - Combining JSON blocks into final structure...
2026-01-03 12:46:19,532 - INFO - Combining 31 JSON block(s) into final structure...
2026-01-03 12:46:19,532 - WARNING - Block 2: Different chapter 'فتوتراپی با UVB' (expected 'فتوتراپی'). Keeping both.
2026-01-03 12:46:19,532 - WARNING - Block 4: Different chapter 'پروتکل های درمانی' (expected 'فتوتراپی'). Keeping both.
2026-01-03 12:46:19,532 - WARNING - Block 6: Different chapter 'فتوتراپی برای لنفوم سلول T پوستی، به ویژه مایکوزیز فونگوئیدس' (expected 'فتوتراپی'). Keeping both.
2026-01-03 12:46:19,532 - WARNING - Block 8: Different chapter 'فتوتراپی برای درماتیت آتوپیک' (expected 'فتوتراپی'). Keeping both.
2026-01-03 12:46:19,532 - WARNING - Block 11: Different chapter 'فتوتراپی و فتوشیمی‌تراپی' (expected 'فتوتراپی'). Keeping both.
2026-01-03 12:46:19,532 - WARNING - Block 14: Different chapter 'فتوتراپی و فتوشیمی‌درمانی' (expected 'فتوتراپی'). Keeping both.
2026-01-03 12:46:19,532 - WARNING - Block 18: Different chapter 'فتوتراپی و فتوشیمی‌درمانی' (expected 'فتوتراپی'). Keeping both.
2026-01-03 12:46:19,532 - WARNING - Block 19: Different chapter 'فتوشیمی‌درمانی با پسورالن‌ها (PUVA)' (expected 'فتوتراپی'). Keeping both.
2026-01-03 12:46:19,532 - WARNING - Block 20: Different chapter 'فتوتراپی و فتوشیمی‌درمانی' (expected 'فتوتراپی'). Keeping both.
2026-01-03 12:46:19,532 - WARNING - Block 22: Different chapter 'فتوتراپی و فتوشیمی‌درمانی' (expected 'فتوتراپی'). Keeping both.
2026-01-03 12:46:19,532 - WARNING - Block 23: Different chapter 'فتوتراپی و فتوشیمی‌درمانی' (expected 'فتوتراپی'). Keeping both.
2026-01-03 12:46:19,532 - WARNING - Block 24: Different chapter 'PUVA برای درماتیت آتوپیک و لیکن پلان' (expected 'فتوتراپی'). Keeping both.
2026-01-03 12:46:19,532 - WARNING - Block 26: Different chapter 'فتوتراپی و فتوشیمی‌درمانی' (expected 'فتوتراپی'). Keeping both.
2026-01-03 12:46:19,532 - WARNING - Block 29: Different chapter 'فتوتراپی و فتوشیمی‌درمانی' (expected 'فتوتراپی'). Keeping both.
2026-01-03 12:46:19,532 - WARNING - Block 30: Different chapter 'فتوتراپی و فتوکموتراپی' (expected 'فتوتراپی'). Keeping both.
2026-01-03 12:46:19,532 - WARNING - Block 31: Different chapter 'فتوتراپی و فتوکموتراپی' (expected 'فتوتراپی'). Keeping both.
2026-01-03 12:46:19,532 - INFO - Final structure: chapter 'فتوتراپی' with 31 content items
2026-01-03 12:46:19,532 - INFO - Flattening hierarchical structure to points...
2026-01-03 12:46:19,532 - INFO - Processing chapter: 'فتوتراپی' with 31 top-level items
2026-01-03 12:46:19,534 - INFO - Extracted 1048 points from Document Processing
2026-01-03 12:46:19,534 - INFO - Assigning PointId and chapter/subchapter/topic to 1048 points (starting from 1)...
2026-01-03 12:46:19,534 - INFO - ================================================================================
2026-01-03 12:46:19,534 - INFO - ASSIGNING POINT IDs AND SUBCHAPTER INFO
2026-01-03 12:46:19,534 - INFO - ================================================================================
2026-01-03 12:46:19,534 - INFO - Using tracked points per subchapter for correct mapping:
2026-01-03 12:46:19,534 - INFO -   Subchapter 'فتوتراپی با UVB': 299 points
2026-01-03 12:46:19,534 - INFO -   Subchapter 'فتوتراپی با لیزر یا لامپ اگزایمر ۳۰۸ نانومتر': 29 points
2026-01-03 12:46:19,534 - INFO -   Subchapter 'فتوتراپی با UVA1': 14 points
2026-01-03 12:46:19,534 - INFO -   Subchapter 'فتوشیمی‌درمانی با پسورالن‌ها (PUVA)': 652 points
2026-01-03 12:46:19,534 - INFO -   Subchapter 'فتوکموتراپی خارج بدنی (فتوفرزیس)': 54 points
2026-01-03 12:46:19,534 - INFO - Total tracked points: 1048, Actual flattened points: 1048
2026-01-03 12:46:19,534 - INFO -   Assigning PointIds for subchapter 'فتوتراپی با UVB' (299 points)...
2026-01-03 12:46:19,534 - INFO -     ✓ Assigned 299 PointIds for subchapter 'فتوتراپی با UVB'
2026-01-03 12:46:19,534 - INFO -   Assigning PointIds for subchapter 'فتوتراپی با لیزر یا لامپ اگزایمر ۳۰۸ نانومتر' (29 points)...
2026-01-03 12:46:19,534 - INFO -     ✓ Assigned 29 PointIds for subchapter 'فتوتراپی با لیزر یا لامپ اگزایمر ۳۰۸ نانومتر'
2026-01-03 12:46:19,534 - INFO -   Assigning PointIds for subchapter 'فتوتراپی با UVA1' (14 points)...
2026-01-03 12:46:19,534 - INFO -     ✓ Assigned 14 PointIds for subchapter 'فتوتراپی با UVA1'
2026-01-03 12:46:19,534 - INFO -   Assigning PointIds for subchapter 'فتوشیمی‌درمانی با پسورالن‌ها (PUVA)' (652 points)...
2026-01-03 12:46:19,534 - INFO -     ✓ Assigned 652 PointIds for subchapter 'فتوشیمی‌درمانی با پسورالن‌ها (PUVA)'
2026-01-03 12:46:19,534 - INFO -   Assigning PointIds for subchapter 'فتوکموتراپی خارج بدنی (فتوفرزیس)' (54 points)...
2026-01-03 12:46:19,535 - INFO -     ✓ Assigned 54 PointIds for subchapter 'فتوکموتراپی خارج بدنی (فتوفرزیس)'
2026-01-03 12:46:19,535 - INFO - ================================================================================
2026-01-03 12:46:19,535 - INFO - Saving Document Processing output to: /home/shahmir/Desktop/out-134/Lesson_file_120_134.json
2026-01-03 12:46:19,539 - INFO - Document Processing completed successfully: /home/shahmir/Desktop/out-134/Lesson_file_120_134.json
2026-01-03 12:48:17,193 - INFO - [get_default_model] ComboBox value: gemini-2.5-pro, StringVar value: gemini-2.5-pro
2026-01-03 12:48:17,193 - INFO - [get_default_model] Returning model from ComboBox: gemini-2.5-pro
2026-01-03 12:48:17,193 - INFO - Starting Stage E processing...
2026-01-03 12:48:17,193 - INFO - Loading OCR Extraction JSON (Stage 1)...
2026-01-03 12:48:17,194 - INFO - Successfully loaded JSON: /home/shahmir/Desktop/out-134/OCR Extraction.json
2026-01-03 12:48:17,194 - INFO - Loading Stage 4 JSON...
2026-01-03 12:48:17,195 - INFO - Successfully loaded JSON: /home/shahmir/Desktop/out-134/Lesson_file_120_134.json
2026-01-03 12:48:17,195 - INFO - Detected Book ID: 120, Chapter ID: 134
2026-01-03 12:48:17,196 - INFO - Last PointId in Stage 4: 1201341048, Starting image notes from index: 1049
2026-01-03 12:48:17,196 - INFO - Preparing OCR Extraction JSON (Stage 1)...
2026-01-03 12:48:17,197 - INFO - Preparing Stage 4 JSON (complete)...
2026-01-03 12:48:17,200 - INFO - ============================================================
2026-01-03 12:48:17,200 - INFO - Processing Stage 4 as complete file (no subchapter division)...
2026-01-03 12:48:17,200 - INFO - ============================================================
2026-01-03 12:48:17,200 - INFO - Calling model gemini-2.5-pro for complete Stage 4...
2026-01-03 12:58:17,205 - WARNING - ⚠️ Timeout error (504) - Attempt 1/3
2026-01-03 12:58:17,205 - WARNING -    Waiting 10.0s before retry...
2026-01-03 13:08:27,209 - WARNING - ⚠️ Timeout error (504) - Attempt 2/3
2026-01-03 13:08:27,210 - WARNING -    Waiting 15.0s before retry...
2026-01-03 13:08:57,311 - ERROR - Text processing failed: 429 Resource has been exhausted (e.g. check quota).
2026-01-03 13:08:57,312 - INFO - Retrying model call (attempt 2/3)...
2026-01-03 13:09:12,568 - ERROR - Text processing failed: 429 Resource has been exhausted (e.g. check quota).
2026-01-03 13:09:12,568 - INFO - Retrying model call (attempt 3/3)...
2026-01-03 13:09:27,526 - ERROR - Text processing failed: 429 Resource has been exhausted (e.g. check quota).
2026-01-03 13:09:27,526 - ERROR - No response from model after retries
2026-01-03 13:09:27,526 - INFO - Error: Failed to get response from model.
2026-01-03 13:17:09,422 - INFO - [get_default_model] ComboBox value: gemini-2.5-pro, StringVar value: gemini-2.5-pro
2026-01-03 13:17:09,423 - INFO - [get_default_model] Returning model from ComboBox: gemini-2.5-pro
2026-01-03 13:17:09,423 - INFO - Starting Stage E processing...
2026-01-03 13:17:09,423 - INFO - Loading OCR Extraction JSON (Stage 1)...
2026-01-03 13:17:09,423 - INFO - Successfully loaded JSON: /home/shahmir/Desktop/out-134/OCR Extraction.json
2026-01-03 13:17:09,423 - INFO - Loading Stage 4 JSON...
2026-01-03 13:17:09,425 - INFO - Successfully loaded JSON: /home/shahmir/Desktop/out-134/Lesson_file_120_134.json
2026-01-03 13:17:09,425 - INFO - Detected Book ID: 120, Chapter ID: 134
2026-01-03 13:17:09,425 - INFO - Last PointId in Stage 4: 1201341048, Starting image notes from index: 1049
2026-01-03 13:17:09,425 - INFO - Preparing OCR Extraction JSON (Stage 1)...
2026-01-03 13:17:09,426 - INFO - Preparing Stage 4 JSON (complete)...
2026-01-03 13:17:09,429 - INFO - ============================================================
2026-01-03 13:17:09,429 - INFO - Processing Stage 4 as complete file (no subchapter division)...
2026-01-03 13:17:09,430 - INFO - ============================================================
2026-01-03 13:17:09,430 - INFO - Calling model gemini-2.5-pro for complete Stage 4...
2026-01-03 13:18:14,439 - ERROR - Text processing failed: 429 Resource has been exhausted (e.g. check quota).
2026-01-03 13:18:14,440 - INFO - Retrying model call (attempt 2/3)...
2026-01-03 13:18:30,853 - ERROR - Text processing failed: 429 Resource has been exhausted (e.g. check quota).
2026-01-03 13:18:30,853 - INFO - Retrying model call (attempt 3/3)...
2026-01-03 13:18:47,261 - ERROR - Text processing failed: 429 Resource has been exhausted (e.g. check quota).
2026-01-03 13:18:47,262 - ERROR - No response from model after retries
2026-01-03 13:18:47,262 - INFO - Error: Failed to get response from model.
2026-01-03 17:50:15,685 - INFO - Loaded 14 predefined prompts
2026-01-03 17:50:15,715 - INFO - python-docx library is available
2026-01-03 17:50:15,716 - INFO - python-docx library is available
2026-01-03 17:56:08,788 - INFO - [_on_model_var_changed] Model variable changed to: gemini-3-pro
2026-01-03 17:56:08,789 - INFO - [sync_all_model_combos] Synced 13 model ComboBoxes to: gemini-3-pro
2026-01-03 17:56:08,789 - INFO - [_on_model_var_changed] Model variable changed to: gemini-3-pro
2026-01-03 17:56:08,790 - INFO - [on_model_changed] Model changed to: gemini-3-pro, StringVar now: gemini-3-pro
2026-01-03 17:56:58,039 - INFO - [get_default_model] ComboBox value: gemini-3-pro, StringVar value: gemini-3-pro
2026-01-03 17:56:58,039 - INFO - [get_default_model] Returning model from ComboBox: gemini-3-pro
2026-01-03 17:57:35,597 - INFO - Loaded 3 API keys
2026-01-03 17:57:46,906 - INFO - [get_default_model] ComboBox value: gemini-3-pro, StringVar value: gemini-3-pro
2026-01-03 17:57:46,906 - INFO - [get_default_model] Returning model from ComboBox: gemini-3-pro
2026-01-03 17:57:46,908 - INFO - Using topic file: /home/shahmir/Desktop/out-134/t0052024.json, Book ID: 5, Chapter ID: 2024
2026-01-03 17:57:46,909 - INFO - Using output directory: /home/shahmir/Downloads
2026-01-03 17:57:46,982 - INFO - Successfully extracted 117016 characters from 17 pages using PyMuPDF
2026-01-03 17:57:46,983 - INFO - Text client initialized with model: gemini-3-pro
2026-01-03 17:57:46,983 - INFO - Initialized OCR Extraction JSON: /home/shahmir/Downloads/OCR Extraction.json
2026-01-03 17:57:52,800 - ERROR - Error processing subchapter Phototherapy with UVB: 404 models/gemini-3-pro is not found for API version v1beta, or is not supported for generateContent. Call ListModels to see the list of available models and their supported methods.
Traceback (most recent call last):
  File "/media/shahmir/Program/automation_pileh/content_automation_project/multi_part_processor.py", line 562, in process_ocr_extraction_with_topics
    response = self.api_client.text_client.generate_content(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/shahmir/anaconda3/lib/python3.12/site-packages/google/generativeai/generative_models.py", line 331, in generate_content
    response = self._client.generate_content(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/shahmir/anaconda3/lib/python3.12/site-packages/google/ai/generativelanguage_v1beta/services/generative_service/client.py", line 835, in generate_content
    response = rpc(
               ^^^^
  File "/home/shahmir/anaconda3/lib/python3.12/site-packages/google/api_core/gapic_v1/method.py", line 131, in __call__
    return wrapped_func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/shahmir/anaconda3/lib/python3.12/site-packages/google/api_core/retry/retry_unary.py", line 294, in retry_wrapped_func
    return retry_target(
           ^^^^^^^^^^^^^
  File "/home/shahmir/anaconda3/lib/python3.12/site-packages/google/api_core/retry/retry_unary.py", line 156, in retry_target
    next_sleep = _retry_error_helper(
                 ^^^^^^^^^^^^^^^^^^^^
  File "/home/shahmir/anaconda3/lib/python3.12/site-packages/google/api_core/retry/retry_base.py", line 214, in _retry_error_helper
    raise final_exc from source_exc
  File "/home/shahmir/anaconda3/lib/python3.12/site-packages/google/api_core/retry/retry_unary.py", line 147, in retry_target
    result = target()
             ^^^^^^^^
  File "/home/shahmir/anaconda3/lib/python3.12/site-packages/google/api_core/timeout.py", line 130, in func_with_timeout
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/home/shahmir/anaconda3/lib/python3.12/site-packages/google/api_core/grpc_helpers.py", line 77, in error_remapped_callable
    raise exceptions.from_grpc_error(exc) from exc
google.api_core.exceptions.NotFound: 404 models/gemini-3-pro is not found for API version v1beta, or is not supported for generateContent. Call ListModels to see the list of available models and their supported methods.
2026-01-03 17:57:52,811 - INFO - Subchapter 'Phototherapy with the 308 nm Excimer Laser or Lamp' has no Topics, will process with empty topics list
2026-01-03 17:57:56,597 - ERROR - Error processing subchapter Phototherapy with the 308 nm Excimer Laser or Lamp: 404 models/gemini-3-pro is not found for API version v1beta, or is not supported for generateContent. Call ListModels to see the list of available models and their supported methods.
Traceback (most recent call last):
  File "/media/shahmir/Program/automation_pileh/content_automation_project/multi_part_processor.py", line 562, in process_ocr_extraction_with_topics
    response = self.api_client.text_client.generate_content(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/shahmir/anaconda3/lib/python3.12/site-packages/google/generativeai/generative_models.py", line 331, in generate_content
    response = self._client.generate_content(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/shahmir/anaconda3/lib/python3.12/site-packages/google/ai/generativelanguage_v1beta/services/generative_service/client.py", line 835, in generate_content
    response = rpc(
               ^^^^
  File "/home/shahmir/anaconda3/lib/python3.12/site-packages/google/api_core/gapic_v1/method.py", line 131, in __call__
    return wrapped_func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/shahmir/anaconda3/lib/python3.12/site-packages/google/api_core/retry/retry_unary.py", line 294, in retry_wrapped_func
    return retry_target(
           ^^^^^^^^^^^^^
  File "/home/shahmir/anaconda3/lib/python3.12/site-packages/google/api_core/retry/retry_unary.py", line 156, in retry_target
    next_sleep = _retry_error_helper(
                 ^^^^^^^^^^^^^^^^^^^^
  File "/home/shahmir/anaconda3/lib/python3.12/site-packages/google/api_core/retry/retry_base.py", line 214, in _retry_error_helper
    raise final_exc from source_exc
  File "/home/shahmir/anaconda3/lib/python3.12/site-packages/google/api_core/retry/retry_unary.py", line 147, in retry_target
    result = target()
             ^^^^^^^^
  File "/home/shahmir/anaconda3/lib/python3.12/site-packages/google/api_core/timeout.py", line 130, in func_with_timeout
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/home/shahmir/anaconda3/lib/python3.12/site-packages/google/api_core/grpc_helpers.py", line 77, in error_remapped_callable
    raise exceptions.from_grpc_error(exc) from exc
google.api_core.exceptions.NotFound: 404 models/gemini-3-pro is not found for API version v1beta, or is not supported for generateContent. Call ListModels to see the list of available models and their supported methods.
2026-01-03 17:58:00,231 - ERROR - Error processing subchapter Phototherapy with UVA1: 404 models/gemini-3-pro is not found for API version v1beta, or is not supported for generateContent. Call ListModels to see the list of available models and their supported methods.
Traceback (most recent call last):
  File "/media/shahmir/Program/automation_pileh/content_automation_project/multi_part_processor.py", line 562, in process_ocr_extraction_with_topics
    response = self.api_client.text_client.generate_content(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/shahmir/anaconda3/lib/python3.12/site-packages/google/generativeai/generative_models.py", line 331, in generate_content
    response = self._client.generate_content(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/shahmir/anaconda3/lib/python3.12/site-packages/google/ai/generativelanguage_v1beta/services/generative_service/client.py", line 835, in generate_content
    response = rpc(
               ^^^^
  File "/home/shahmir/anaconda3/lib/python3.12/site-packages/google/api_core/gapic_v1/method.py", line 131, in __call__
    return wrapped_func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/shahmir/anaconda3/lib/python3.12/site-packages/google/api_core/retry/retry_unary.py", line 294, in retry_wrapped_func
    return retry_target(
           ^^^^^^^^^^^^^
  File "/home/shahmir/anaconda3/lib/python3.12/site-packages/google/api_core/retry/retry_unary.py", line 156, in retry_target
    next_sleep = _retry_error_helper(
                 ^^^^^^^^^^^^^^^^^^^^
  File "/home/shahmir/anaconda3/lib/python3.12/site-packages/google/api_core/retry/retry_base.py", line 214, in _retry_error_helper
    raise final_exc from source_exc
  File "/home/shahmir/anaconda3/lib/python3.12/site-packages/google/api_core/retry/retry_unary.py", line 147, in retry_target
    result = target()
             ^^^^^^^^
  File "/home/shahmir/anaconda3/lib/python3.12/site-packages/google/api_core/timeout.py", line 130, in func_with_timeout
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/home/shahmir/anaconda3/lib/python3.12/site-packages/google/api_core/grpc_helpers.py", line 77, in error_remapped_callable
    raise exceptions.from_grpc_error(exc) from exc
google.api_core.exceptions.NotFound: 404 models/gemini-3-pro is not found for API version v1beta, or is not supported for generateContent. Call ListModels to see the list of available models and their supported methods.
2026-01-03 17:58:03,797 - ERROR - Error processing subchapter Photochemotherapy with Psoralens (PUVA): 404 models/gemini-3-pro is not found for API version v1beta, or is not supported for generateContent. Call ListModels to see the list of available models and their supported methods.
Traceback (most recent call last):
  File "/media/shahmir/Program/automation_pileh/content_automation_project/multi_part_processor.py", line 562, in process_ocr_extraction_with_topics
    response = self.api_client.text_client.generate_content(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/shahmir/anaconda3/lib/python3.12/site-packages/google/generativeai/generative_models.py", line 331, in generate_content
    response = self._client.generate_content(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/shahmir/anaconda3/lib/python3.12/site-packages/google/ai/generativelanguage_v1beta/services/generative_service/client.py", line 835, in generate_content
    response = rpc(
               ^^^^
  File "/home/shahmir/anaconda3/lib/python3.12/site-packages/google/api_core/gapic_v1/method.py", line 131, in __call__
    return wrapped_func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/shahmir/anaconda3/lib/python3.12/site-packages/google/api_core/retry/retry_unary.py", line 294, in retry_wrapped_func
    return retry_target(
           ^^^^^^^^^^^^^
  File "/home/shahmir/anaconda3/lib/python3.12/site-packages/google/api_core/retry/retry_unary.py", line 156, in retry_target
    next_sleep = _retry_error_helper(
                 ^^^^^^^^^^^^^^^^^^^^
  File "/home/shahmir/anaconda3/lib/python3.12/site-packages/google/api_core/retry/retry_base.py", line 214, in _retry_error_helper
    raise final_exc from source_exc
  File "/home/shahmir/anaconda3/lib/python3.12/site-packages/google/api_core/retry/retry_unary.py", line 147, in retry_target
    result = target()
             ^^^^^^^^
  File "/home/shahmir/anaconda3/lib/python3.12/site-packages/google/api_core/timeout.py", line 130, in func_with_timeout
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/home/shahmir/anaconda3/lib/python3.12/site-packages/google/api_core/grpc_helpers.py", line 77, in error_remapped_callable
    raise exceptions.from_grpc_error(exc) from exc
google.api_core.exceptions.NotFound: 404 models/gemini-3-pro is not found for API version v1beta, or is not supported for generateContent. Call ListModels to see the list of available models and their supported methods.
2026-01-03 17:58:08,623 - ERROR - Error processing subchapter Extracorporeal Photochemotherapy (Photopheresis): 404 models/gemini-3-pro is not found for API version v1beta, or is not supported for generateContent. Call ListModels to see the list of available models and their supported methods.
Traceback (most recent call last):
  File "/media/shahmir/Program/automation_pileh/content_automation_project/multi_part_processor.py", line 562, in process_ocr_extraction_with_topics
    response = self.api_client.text_client.generate_content(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/shahmir/anaconda3/lib/python3.12/site-packages/google/generativeai/generative_models.py", line 331, in generate_content
    response = self._client.generate_content(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/shahmir/anaconda3/lib/python3.12/site-packages/google/ai/generativelanguage_v1beta/services/generative_service/client.py", line 835, in generate_content
    response = rpc(
               ^^^^
  File "/home/shahmir/anaconda3/lib/python3.12/site-packages/google/api_core/gapic_v1/method.py", line 131, in __call__
    return wrapped_func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/shahmir/anaconda3/lib/python3.12/site-packages/google/api_core/retry/retry_unary.py", line 294, in retry_wrapped_func
    return retry_target(
           ^^^^^^^^^^^^^
  File "/home/shahmir/anaconda3/lib/python3.12/site-packages/google/api_core/retry/retry_unary.py", line 156, in retry_target
    next_sleep = _retry_error_helper(
                 ^^^^^^^^^^^^^^^^^^^^
  File "/home/shahmir/anaconda3/lib/python3.12/site-packages/google/api_core/retry/retry_base.py", line 214, in _retry_error_helper
    raise final_exc from source_exc
  File "/home/shahmir/anaconda3/lib/python3.12/site-packages/google/api_core/retry/retry_unary.py", line 147, in retry_target
    result = target()
             ^^^^^^^^
  File "/home/shahmir/anaconda3/lib/python3.12/site-packages/google/api_core/timeout.py", line 130, in func_with_timeout
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/home/shahmir/anaconda3/lib/python3.12/site-packages/google/api_core/grpc_helpers.py", line 77, in error_remapped_callable
    raise exceptions.from_grpc_error(exc) from exc
google.api_core.exceptions.NotFound: 404 models/gemini-3-pro is not found for API version v1beta, or is not supported for generateContent. Call ListModels to see the list of available models and their supported methods.
2026-01-03 17:58:08,627 - ERROR - No subchapters processed successfully
2026-01-03 17:59:48,964 - INFO - [get_default_model] ComboBox value: gemini-3-pro, StringVar value: gemini-3-pro
2026-01-03 17:59:48,965 - INFO - [get_default_model] Returning model from ComboBox: gemini-3-pro
2026-01-03 17:59:48,966 - INFO - Using topic file: /home/shahmir/Desktop/out-134/t0052024.json, Book ID: 5, Chapter ID: 2024
2026-01-03 17:59:48,966 - INFO - Using output directory: /home/shahmir/Downloads
2026-01-03 17:59:49,020 - INFO - Successfully extracted 117016 characters from 17 pages using PyMuPDF
2026-01-03 17:59:49,021 - INFO - Text client initialized with model: gemini-3-pro
2026-01-03 17:59:49,021 - INFO - Initialized OCR Extraction JSON: /home/shahmir/Downloads/OCR Extraction.json
2026-01-03 17:59:54,031 - ERROR - Error processing subchapter Phototherapy with UVB: 404 models/gemini-3-pro is not found for API version v1beta, or is not supported for generateContent. Call ListModels to see the list of available models and their supported methods.
Traceback (most recent call last):
  File "/media/shahmir/Program/automation_pileh/content_automation_project/multi_part_processor.py", line 562, in process_ocr_extraction_with_topics
    response = self.api_client.text_client.generate_content(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/shahmir/anaconda3/lib/python3.12/site-packages/google/generativeai/generative_models.py", line 331, in generate_content
    response = self._client.generate_content(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/shahmir/anaconda3/lib/python3.12/site-packages/google/ai/generativelanguage_v1beta/services/generative_service/client.py", line 835, in generate_content
    response = rpc(
               ^^^^
  File "/home/shahmir/anaconda3/lib/python3.12/site-packages/google/api_core/gapic_v1/method.py", line 131, in __call__
    return wrapped_func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/shahmir/anaconda3/lib/python3.12/site-packages/google/api_core/retry/retry_unary.py", line 294, in retry_wrapped_func
    return retry_target(
           ^^^^^^^^^^^^^
  File "/home/shahmir/anaconda3/lib/python3.12/site-packages/google/api_core/retry/retry_unary.py", line 156, in retry_target
    next_sleep = _retry_error_helper(
                 ^^^^^^^^^^^^^^^^^^^^
  File "/home/shahmir/anaconda3/lib/python3.12/site-packages/google/api_core/retry/retry_base.py", line 214, in _retry_error_helper
    raise final_exc from source_exc
  File "/home/shahmir/anaconda3/lib/python3.12/site-packages/google/api_core/retry/retry_unary.py", line 147, in retry_target
    result = target()
             ^^^^^^^^
  File "/home/shahmir/anaconda3/lib/python3.12/site-packages/google/api_core/timeout.py", line 130, in func_with_timeout
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/home/shahmir/anaconda3/lib/python3.12/site-packages/google/api_core/grpc_helpers.py", line 77, in error_remapped_callable
    raise exceptions.from_grpc_error(exc) from exc
google.api_core.exceptions.NotFound: 404 models/gemini-3-pro is not found for API version v1beta, or is not supported for generateContent. Call ListModels to see the list of available models and their supported methods.
2026-01-03 17:59:54,034 - INFO - Subchapter 'Phototherapy with the 308 nm Excimer Laser or Lamp' has no Topics, will process with empty topics list
2026-01-03 17:59:57,693 - ERROR - Error processing subchapter Phototherapy with the 308 nm Excimer Laser or Lamp: 404 models/gemini-3-pro is not found for API version v1beta, or is not supported for generateContent. Call ListModels to see the list of available models and their supported methods.
Traceback (most recent call last):
  File "/media/shahmir/Program/automation_pileh/content_automation_project/multi_part_processor.py", line 562, in process_ocr_extraction_with_topics
    response = self.api_client.text_client.generate_content(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/shahmir/anaconda3/lib/python3.12/site-packages/google/generativeai/generative_models.py", line 331, in generate_content
    response = self._client.generate_content(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/shahmir/anaconda3/lib/python3.12/site-packages/google/ai/generativelanguage_v1beta/services/generative_service/client.py", line 835, in generate_content
    response = rpc(
               ^^^^
  File "/home/shahmir/anaconda3/lib/python3.12/site-packages/google/api_core/gapic_v1/method.py", line 131, in __call__
    return wrapped_func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/shahmir/anaconda3/lib/python3.12/site-packages/google/api_core/retry/retry_unary.py", line 294, in retry_wrapped_func
    return retry_target(
           ^^^^^^^^^^^^^
  File "/home/shahmir/anaconda3/lib/python3.12/site-packages/google/api_core/retry/retry_unary.py", line 156, in retry_target
    next_sleep = _retry_error_helper(
                 ^^^^^^^^^^^^^^^^^^^^
  File "/home/shahmir/anaconda3/lib/python3.12/site-packages/google/api_core/retry/retry_base.py", line 214, in _retry_error_helper
    raise final_exc from source_exc
  File "/home/shahmir/anaconda3/lib/python3.12/site-packages/google/api_core/retry/retry_unary.py", line 147, in retry_target
    result = target()
             ^^^^^^^^
  File "/home/shahmir/anaconda3/lib/python3.12/site-packages/google/api_core/timeout.py", line 130, in func_with_timeout
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/home/shahmir/anaconda3/lib/python3.12/site-packages/google/api_core/grpc_helpers.py", line 77, in error_remapped_callable
    raise exceptions.from_grpc_error(exc) from exc
google.api_core.exceptions.NotFound: 404 models/gemini-3-pro is not found for API version v1beta, or is not supported for generateContent. Call ListModels to see the list of available models and their supported methods.
2026-01-03 18:00:01,298 - ERROR - Error processing subchapter Phototherapy with UVA1: 404 models/gemini-3-pro is not found for API version v1beta, or is not supported for generateContent. Call ListModels to see the list of available models and their supported methods.
Traceback (most recent call last):
  File "/media/shahmir/Program/automation_pileh/content_automation_project/multi_part_processor.py", line 562, in process_ocr_extraction_with_topics
    response = self.api_client.text_client.generate_content(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/shahmir/anaconda3/lib/python3.12/site-packages/google/generativeai/generative_models.py", line 331, in generate_content
    response = self._client.generate_content(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/shahmir/anaconda3/lib/python3.12/site-packages/google/ai/generativelanguage_v1beta/services/generative_service/client.py", line 835, in generate_content
    response = rpc(
               ^^^^
  File "/home/shahmir/anaconda3/lib/python3.12/site-packages/google/api_core/gapic_v1/method.py", line 131, in __call__
    return wrapped_func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/shahmir/anaconda3/lib/python3.12/site-packages/google/api_core/retry/retry_unary.py", line 294, in retry_wrapped_func
    return retry_target(
           ^^^^^^^^^^^^^
  File "/home/shahmir/anaconda3/lib/python3.12/site-packages/google/api_core/retry/retry_unary.py", line 156, in retry_target
    next_sleep = _retry_error_helper(
                 ^^^^^^^^^^^^^^^^^^^^
  File "/home/shahmir/anaconda3/lib/python3.12/site-packages/google/api_core/retry/retry_base.py", line 214, in _retry_error_helper
    raise final_exc from source_exc
  File "/home/shahmir/anaconda3/lib/python3.12/site-packages/google/api_core/retry/retry_unary.py", line 147, in retry_target
    result = target()
             ^^^^^^^^
  File "/home/shahmir/anaconda3/lib/python3.12/site-packages/google/api_core/timeout.py", line 130, in func_with_timeout
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/home/shahmir/anaconda3/lib/python3.12/site-packages/google/api_core/grpc_helpers.py", line 77, in error_remapped_callable
    raise exceptions.from_grpc_error(exc) from exc
google.api_core.exceptions.NotFound: 404 models/gemini-3-pro is not found for API version v1beta, or is not supported for generateContent. Call ListModels to see the list of available models and their supported methods.
2026-01-03 18:00:05,093 - ERROR - Error processing subchapter Photochemotherapy with Psoralens (PUVA): 404 models/gemini-3-pro is not found for API version v1beta, or is not supported for generateContent. Call ListModels to see the list of available models and their supported methods.
Traceback (most recent call last):
  File "/media/shahmir/Program/automation_pileh/content_automation_project/multi_part_processor.py", line 562, in process_ocr_extraction_with_topics
    response = self.api_client.text_client.generate_content(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/shahmir/anaconda3/lib/python3.12/site-packages/google/generativeai/generative_models.py", line 331, in generate_content
    response = self._client.generate_content(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/shahmir/anaconda3/lib/python3.12/site-packages/google/ai/generativelanguage_v1beta/services/generative_service/client.py", line 835, in generate_content
    response = rpc(
               ^^^^
  File "/home/shahmir/anaconda3/lib/python3.12/site-packages/google/api_core/gapic_v1/method.py", line 131, in __call__
    return wrapped_func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/shahmir/anaconda3/lib/python3.12/site-packages/google/api_core/retry/retry_unary.py", line 294, in retry_wrapped_func
    return retry_target(
           ^^^^^^^^^^^^^
  File "/home/shahmir/anaconda3/lib/python3.12/site-packages/google/api_core/retry/retry_unary.py", line 156, in retry_target
    next_sleep = _retry_error_helper(
                 ^^^^^^^^^^^^^^^^^^^^
  File "/home/shahmir/anaconda3/lib/python3.12/site-packages/google/api_core/retry/retry_base.py", line 214, in _retry_error_helper
    raise final_exc from source_exc
  File "/home/shahmir/anaconda3/lib/python3.12/site-packages/google/api_core/retry/retry_unary.py", line 147, in retry_target
    result = target()
             ^^^^^^^^
  File "/home/shahmir/anaconda3/lib/python3.12/site-packages/google/api_core/timeout.py", line 130, in func_with_timeout
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/home/shahmir/anaconda3/lib/python3.12/site-packages/google/api_core/grpc_helpers.py", line 77, in error_remapped_callable
    raise exceptions.from_grpc_error(exc) from exc
google.api_core.exceptions.NotFound: 404 models/gemini-3-pro is not found for API version v1beta, or is not supported for generateContent. Call ListModels to see the list of available models and their supported methods.
2026-01-03 18:00:08,662 - ERROR - Error processing subchapter Extracorporeal Photochemotherapy (Photopheresis): 404 models/gemini-3-pro is not found for API version v1beta, or is not supported for generateContent. Call ListModels to see the list of available models and their supported methods.
Traceback (most recent call last):
  File "/media/shahmir/Program/automation_pileh/content_automation_project/multi_part_processor.py", line 562, in process_ocr_extraction_with_topics
    response = self.api_client.text_client.generate_content(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/shahmir/anaconda3/lib/python3.12/site-packages/google/generativeai/generative_models.py", line 331, in generate_content
    response = self._client.generate_content(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/shahmir/anaconda3/lib/python3.12/site-packages/google/ai/generativelanguage_v1beta/services/generative_service/client.py", line 835, in generate_content
    response = rpc(
               ^^^^
  File "/home/shahmir/anaconda3/lib/python3.12/site-packages/google/api_core/gapic_v1/method.py", line 131, in __call__
    return wrapped_func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/shahmir/anaconda3/lib/python3.12/site-packages/google/api_core/retry/retry_unary.py", line 294, in retry_wrapped_func
    return retry_target(
           ^^^^^^^^^^^^^
  File "/home/shahmir/anaconda3/lib/python3.12/site-packages/google/api_core/retry/retry_unary.py", line 156, in retry_target
    next_sleep = _retry_error_helper(
                 ^^^^^^^^^^^^^^^^^^^^
  File "/home/shahmir/anaconda3/lib/python3.12/site-packages/google/api_core/retry/retry_base.py", line 214, in _retry_error_helper
    raise final_exc from source_exc
  File "/home/shahmir/anaconda3/lib/python3.12/site-packages/google/api_core/retry/retry_unary.py", line 147, in retry_target
    result = target()
             ^^^^^^^^
  File "/home/shahmir/anaconda3/lib/python3.12/site-packages/google/api_core/timeout.py", line 130, in func_with_timeout
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/home/shahmir/anaconda3/lib/python3.12/site-packages/google/api_core/grpc_helpers.py", line 77, in error_remapped_callable
    raise exceptions.from_grpc_error(exc) from exc
google.api_core.exceptions.NotFound: 404 models/gemini-3-pro is not found for API version v1beta, or is not supported for generateContent. Call ListModels to see the list of available models and their supported methods.
2026-01-03 18:00:08,664 - ERROR - No subchapters processed successfully
2026-01-03 18:00:15,639 - INFO - [_on_model_var_changed] Model variable changed to: gemini-2.0-flash
2026-01-03 18:00:15,640 - INFO - [sync_all_model_combos] Synced 13 model ComboBoxes to: gemini-2.0-flash
2026-01-03 18:00:15,640 - INFO - [_on_model_var_changed] Model variable changed to: gemini-2.0-flash
2026-01-03 18:00:15,641 - INFO - [on_model_changed] Model changed to: gemini-2.0-flash, StringVar now: gemini-2.0-flash
2026-01-03 18:00:17,436 - INFO - [_on_model_var_changed] Model variable changed to: gemini-2.5-pro
2026-01-03 18:00:17,437 - INFO - [sync_all_model_combos] Synced 13 model ComboBoxes to: gemini-2.5-pro
2026-01-03 18:00:17,437 - INFO - [_on_model_var_changed] Model variable changed to: gemini-2.5-pro
2026-01-03 18:00:17,438 - INFO - [on_model_changed] Model changed to: gemini-2.5-pro, StringVar now: gemini-2.5-pro
2026-01-03 18:00:26,390 - INFO - [get_default_model] ComboBox value: gemini-2.5-pro, StringVar value: gemini-2.5-pro
2026-01-03 18:00:26,391 - INFO - [get_default_model] Returning model from ComboBox: gemini-2.5-pro
2026-01-03 18:00:26,391 - INFO - Using topic file: /home/shahmir/Desktop/out-134/t0052024.json, Book ID: 5, Chapter ID: 2024
2026-01-03 18:00:26,392 - INFO - Using output directory: /home/shahmir/Downloads
2026-01-03 18:00:26,447 - INFO - Successfully extracted 117016 characters from 17 pages using PyMuPDF
2026-01-03 18:00:26,448 - INFO - Text client initialized with model: gemini-2.5-pro
2026-01-03 18:00:26,448 - INFO - Initialized OCR Extraction JSON: /home/shahmir/Downloads/OCR Extraction.json
2026-01-03 18:01:53,608 - INFO - Successfully extracted JSON from response
2026-01-03 18:01:53,611 - INFO - ✓ Subchapter 1/5 'Phototherapy with UVB' added to JSON (incremental save)
2026-01-03 18:01:53,612 - INFO - Subchapter 'Phototherapy with the 308 nm Excimer Laser or Lamp' has no Topics, will process with empty topics list
2026-01-03 18:02:15,800 - INFO - Successfully extracted JSON from response
2026-01-03 18:02:15,802 - INFO - ✓ Subchapter 2/5 'Phototherapy with the 308 nm Excimer Laser or Lamp' added to JSON (incremental save)
2026-01-03 18:02:39,443 - INFO - Successfully extracted JSON from response
2026-01-03 18:02:39,446 - INFO - ✓ Subchapter 3/5 'Phototherapy with UVA1' added to JSON (incremental save)
2026-01-03 18:06:21,035 - INFO - Successfully extracted JSON from response
2026-01-03 18:06:21,039 - INFO - ✓ Subchapter 4/5 'Photochemotherapy with Psoralens (PUVA)' added to JSON (incremental save)
2026-01-03 18:06:25,106 - ERROR - Error processing subchapter Extracorporeal Photochemotherapy (Photopheresis): 429 Resource has been exhausted (e.g. check quota).
Traceback (most recent call last):
  File "/media/shahmir/Program/automation_pileh/content_automation_project/multi_part_processor.py", line 562, in process_ocr_extraction_with_topics
    response = self.api_client.text_client.generate_content(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/shahmir/anaconda3/lib/python3.12/site-packages/google/generativeai/generative_models.py", line 331, in generate_content
    response = self._client.generate_content(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/shahmir/anaconda3/lib/python3.12/site-packages/google/ai/generativelanguage_v1beta/services/generative_service/client.py", line 835, in generate_content
    response = rpc(
               ^^^^
  File "/home/shahmir/anaconda3/lib/python3.12/site-packages/google/api_core/gapic_v1/method.py", line 131, in __call__
    return wrapped_func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/shahmir/anaconda3/lib/python3.12/site-packages/google/api_core/retry/retry_unary.py", line 294, in retry_wrapped_func
    return retry_target(
           ^^^^^^^^^^^^^
  File "/home/shahmir/anaconda3/lib/python3.12/site-packages/google/api_core/retry/retry_unary.py", line 156, in retry_target
    next_sleep = _retry_error_helper(
                 ^^^^^^^^^^^^^^^^^^^^
  File "/home/shahmir/anaconda3/lib/python3.12/site-packages/google/api_core/retry/retry_base.py", line 214, in _retry_error_helper
    raise final_exc from source_exc
  File "/home/shahmir/anaconda3/lib/python3.12/site-packages/google/api_core/retry/retry_unary.py", line 147, in retry_target
    result = target()
             ^^^^^^^^
  File "/home/shahmir/anaconda3/lib/python3.12/site-packages/google/api_core/timeout.py", line 130, in func_with_timeout
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/home/shahmir/anaconda3/lib/python3.12/site-packages/google/api_core/grpc_helpers.py", line 77, in error_remapped_callable
    raise exceptions.from_grpc_error(exc) from exc
google.api_core.exceptions.ResourceExhausted: 429 Resource has been exhausted (e.g. check quota).
2026-01-03 18:06:25,112 - INFO - OCR Extraction JSON saved to: /home/shahmir/Downloads/OCR Extraction.json
2026-01-03 18:11:31,892 - INFO - [get_default_model] ComboBox value: gemini-2.5-pro, StringVar value: gemini-2.5-pro
2026-01-03 18:11:31,893 - INFO - [get_default_model] Returning model from ComboBox: gemini-2.5-pro
2026-01-03 18:11:31,894 - INFO - Loading OCR Extraction JSON: /home/shahmir/Downloads/OCR Extraction.json
2026-01-03 18:11:31,895 - INFO - Chapter name from input JSON: درمان با اشعه ماوراء بنفش
2026-01-03 18:11:31,895 - INFO - ================================================================================
2026-01-03 18:11:31,895 - INFO - DOCUMENT PROCESSING - PROCESSING BY TOPIC
2026-01-03 18:11:31,896 - INFO - ================================================================================
2026-01-03 18:11:31,896 - INFO - Found 29 topics to process
2026-01-03 18:11:31,896 - INFO - Found 4 unique subchapters
2026-01-03 18:11:31,896 - INFO - 
2026-01-03 18:11:31,897 - INFO -   Subchapter 1: 'فتوتراپی با UVA1' - 1 topics
2026-01-03 18:11:31,897 - INFO -     Topic 1: 'عوارض جانبی فتوتراپی با UVA1'
2026-01-03 18:11:31,897 - INFO -   Subchapter 2: 'فتوتراپی با UVB' - 10 topics
2026-01-03 18:11:31,897 - INFO -     Topic 1: 'جنبه‌های تاریخی'
2026-01-03 18:11:31,897 - INFO -     Topic 2: 'اصول و مکانیسم‌ها'
2026-01-03 18:11:31,898 - INFO -     Topic 3: 'طیف اثر و منابع تابش'
2026-01-03 18:11:31,898 - INFO -     Topic 4: 'پروتکل‌های درمانی'
2026-01-03 18:11:31,898 - INFO -     Topic 5: 'فتوتراپی برای پسوریازیس'
2026-01-03 18:11:31,898 - INFO -     Topic 6: 'فتوتراپی برای لنفوم سلول T پوستی، به ویژه مایكوزیس فونگوئیدس'
2026-01-03 18:11:31,898 - INFO -     Topic 7: 'فتوتراپی برای ویتیلیگو'
2026-01-03 18:11:31,899 - INFO -     Topic 8: 'فتوتراپی برای درماتیت آتوپیک و فتوتراپی برای فتودرماتوزها'
2026-01-03 18:11:31,899 - INFO -     Topic 9: 'فتوتراپی برای پیتیریازیس لیکنوئیدس، فتوتراپی برای درماتیت سبورئیک و فتوتراپی برای خارش'
2026-01-03 18:11:31,899 - INFO -     Topic 10: 'عوارض جانبی فتوتراپی با UVB'
2026-01-03 18:11:31,899 - INFO -   Subchapter 3: 'فتوتراپی با لیزر یا لامپ اگزایمر 308 نانومتر' - 1 topics
2026-01-03 18:11:31,899 - INFO -     Topic 1: 'فتوتراپی با لیزر یا لامپ اگزایمر 308 نانومتر'
2026-01-03 18:11:31,900 - INFO -   Subchapter 4: 'فتوکموتراپی با پسورالن‌ها (PUVA)' - 17 topics
2026-01-03 18:11:31,900 - INFO -     Topic 1: 'جنبه‌های تاریخی'
2026-01-03 18:11:31,900 - INFO -     Topic 2: 'پسورالن‌ها'
2026-01-03 18:11:31,900 - INFO -     Topic 3: 'فتوشیمی پسورالن و طیف اثر و منابع نوری'
2026-01-03 18:11:31,901 - INFO -     Topic 4: 'اثرات فتوبیولوژیک PUVA'
2026-01-03 18:11:31,901 - INFO -     Topic 5: 'پروتکل‌های درمانی'
2026-01-03 18:11:31,901 - INFO -     Topic 6: 'مرحله درمان اولیه (پاکسازی)'
2026-01-03 18:11:31,901 - INFO -     Topic 7: 'مرحله نگهدارنده'
2026-01-03 18:11:31,901 - INFO -     Topic 8: 'PUVA برای پسوریازیس'
2026-01-03 18:11:31,902 - INFO -     Topic 9: 'درمان‌های ترکیبی'
2026-01-03 18:11:31,902 - INFO -     Topic 10: 'PUVA برای لنفوم سلول T پوستی، به ویژه مایکوزیس فونگوئیدس'
2026-01-03 18:11:31,902 - INFO -     Topic 11: 'PUVA برای ویتیلیگو'
2026-01-03 18:11:31,902 - INFO -     Topic 12: 'PUVA برای درماتیت آتوپیک و PUVA برای لیکن پلان'
2026-01-03 18:11:31,902 - INFO -     Topic 13: 'PUVA برای بیماری پیوند علیه میزبان'
2026-01-03 18:11:31,903 - INFO -     Topic 14: 'PUVA برای کهیر پیگمنتوزا و PUVA برای درماتوزهای متفرقه'
2026-01-03 18:11:31,903 - INFO -     Topic 15: 'PUVA برای فتودرماتوزها'
2026-01-03 18:11:31,903 - INFO -     Topic 16: 'عوارض جانبی و خطرات بلندمدت PUVA'
2026-01-03 18:11:31,903 - INFO -     Topic 17: 'UVB و PUVA در بیماران آلوده به HIV'
2026-01-03 18:11:31,903 - INFO - ================================================================================
2026-01-03 18:11:31,904 - INFO - 
2026-01-03 18:11:31,904 - INFO - ================================================================================
2026-01-03 18:11:31,904 - INFO - PROCESSING TOPIC 1/29
2026-01-03 18:11:31,904 - INFO - ================================================================================
2026-01-03 18:11:31,905 - INFO -   Subchapter: 'فتوتراپی با UVB'
2026-01-03 18:11:31,905 - INFO -   Topic: 'جنبه‌های تاریخی'
2026-01-03 18:11:31,905 - INFO -   Number of extractions: 1
2026-01-03 18:11:31,907 - INFO -   JSON payload size: 29,103 bytes (28.42 KB)
2026-01-03 18:11:31,907 - INFO -   Sending topic JSON to model (full subchapter context with 10 topics)...
2026-01-03 18:11:31,907 - INFO -   Calling model API...
2026-01-03 18:11:34,163 - ERROR - Text processing failed: 429 Resource has been exhausted (e.g. check quota).
2026-01-03 18:11:34,163 - ERROR -   ✗ No response received for topic: فتوتراپی با UVB > جنبه‌های تاریخی
2026-01-03 18:11:34,164 - INFO - 
2026-01-03 18:11:34,164 - INFO - ================================================================================
2026-01-03 18:11:34,164 - INFO - PROCESSING TOPIC 2/29
2026-01-03 18:11:34,165 - INFO - ================================================================================
2026-01-03 18:11:34,165 - INFO -   Subchapter: 'فتوتراپی با UVB'
2026-01-03 18:11:34,165 - INFO -   Topic: 'اصول و مکانیسم‌ها'
2026-01-03 18:11:34,165 - INFO -   Number of extractions: 1
2026-01-03 18:11:34,166 - INFO -   JSON payload size: 29,103 bytes (28.42 KB)
2026-01-03 18:11:34,167 - INFO -   Sending topic JSON to model (full subchapter context with 10 topics)...
2026-01-03 18:11:34,167 - INFO -   Calling model API...
2026-01-03 18:11:35,605 - ERROR - Text processing failed: 429 Resource has been exhausted (e.g. check quota).
2026-01-03 18:11:35,606 - ERROR -   ✗ No response received for topic: فتوتراپی با UVB > اصول و مکانیسم‌ها
2026-01-03 18:11:35,606 - INFO - 
2026-01-03 18:11:35,607 - INFO - ================================================================================
2026-01-03 18:11:35,607 - INFO - PROCESSING TOPIC 3/29
2026-01-03 18:11:35,607 - INFO - ================================================================================
2026-01-03 18:11:35,607 - INFO -   Subchapter: 'فتوتراپی با UVB'
2026-01-03 18:11:35,607 - INFO -   Topic: 'طیف اثر و منابع تابش'
2026-01-03 18:11:35,607 - INFO -   Number of extractions: 3
2026-01-03 18:11:35,609 - INFO -   JSON payload size: 29,103 bytes (28.42 KB)
2026-01-03 18:11:35,609 - INFO -   Sending topic JSON to model (full subchapter context with 10 topics)...
2026-01-03 18:11:35,609 - INFO -   Calling model API...
2026-01-03 18:11:37,060 - ERROR - Text processing failed: 429 Resource has been exhausted (e.g. check quota).
2026-01-03 18:11:37,061 - ERROR -   ✗ No response received for topic: فتوتراپی با UVB > طیف اثر و منابع تابش
2026-01-03 18:11:37,061 - INFO - 
2026-01-03 18:11:37,061 - INFO - ================================================================================
2026-01-03 18:11:37,062 - INFO - PROCESSING TOPIC 4/29
2026-01-03 18:11:37,062 - INFO - ================================================================================
2026-01-03 18:11:37,062 - INFO -   Subchapter: 'فتوتراپی با UVB'
2026-01-03 18:11:37,062 - INFO -   Topic: 'پروتکل‌های درمانی'
2026-01-03 18:11:37,062 - INFO -   Number of extractions: 4
2026-01-03 18:11:37,064 - INFO -   JSON payload size: 29,103 bytes (28.42 KB)
2026-01-03 18:11:37,064 - INFO -   Sending topic JSON to model (full subchapter context with 10 topics)...
2026-01-03 18:11:37,064 - INFO -   Calling model API...
2026-01-03 18:11:38,493 - ERROR - Text processing failed: 429 Resource has been exhausted (e.g. check quota).
2026-01-03 18:11:38,494 - ERROR -   ✗ No response received for topic: فتوتراپی با UVB > پروتکل‌های درمانی
2026-01-03 18:11:38,495 - INFO - 
2026-01-03 18:11:38,495 - INFO - ================================================================================
2026-01-03 18:11:38,495 - INFO - PROCESSING TOPIC 5/29
2026-01-03 18:11:38,495 - INFO - ================================================================================
2026-01-03 18:11:38,495 - INFO -   Subchapter: 'فتوتراپی با UVB'
2026-01-03 18:11:38,495 - INFO -   Topic: 'فتوتراپی برای پسوریازیس'
2026-01-03 18:11:38,495 - INFO -   Number of extractions: 1
2026-01-03 18:11:38,496 - INFO -   JSON payload size: 29,103 bytes (28.42 KB)
2026-01-03 18:11:38,497 - INFO -   Sending topic JSON to model (full subchapter context with 10 topics)...
2026-01-03 18:11:38,497 - INFO -   Calling model API...
2026-01-03 18:11:40,032 - ERROR - Text processing failed: 429 Resource has been exhausted (e.g. check quota).
2026-01-03 18:11:40,033 - ERROR -   ✗ No response received for topic: فتوتراپی با UVB > فتوتراپی برای پسوریازیس
2026-01-03 18:11:40,034 - INFO - 
2026-01-03 18:11:40,034 - INFO - ================================================================================
2026-01-03 18:11:40,034 - INFO - PROCESSING TOPIC 6/29
2026-01-03 18:11:40,034 - INFO - ================================================================================
2026-01-03 18:11:40,034 - INFO -   Subchapter: 'فتوتراپی با UVB'
2026-01-03 18:11:40,035 - INFO -   Topic: 'فتوتراپی برای لنفوم سلول T پوستی، به ویژه مایكوزیس فونگوئیدس'
2026-01-03 18:11:40,035 - INFO -   Number of extractions: 1
2026-01-03 18:11:40,036 - INFO -   JSON payload size: 29,103 bytes (28.42 KB)
2026-01-03 18:11:40,036 - INFO -   Sending topic JSON to model (full subchapter context with 10 topics)...
2026-01-03 18:11:40,036 - INFO -   Calling model API...
2026-01-03 18:11:41,661 - ERROR - Text processing failed: 429 Resource has been exhausted (e.g. check quota).
2026-01-03 18:11:41,661 - ERROR -   ✗ No response received for topic: فتوتراپی با UVB > فتوتراپی برای لنفوم سلول T پوستی، به ویژه مایكوزیس فونگوئیدس
2026-01-03 18:11:41,662 - INFO - 
2026-01-03 18:11:41,662 - INFO - ================================================================================
2026-01-03 18:11:41,663 - INFO - PROCESSING TOPIC 7/29
2026-01-03 18:11:41,663 - INFO - ================================================================================
2026-01-03 18:11:41,663 - INFO -   Subchapter: 'فتوتراپی با UVB'
2026-01-03 18:11:41,663 - INFO -   Topic: 'فتوتراپی برای ویتیلیگو'
2026-01-03 18:11:41,663 - INFO -   Number of extractions: 2
2026-01-03 18:11:41,664 - INFO -   JSON payload size: 29,103 bytes (28.42 KB)
2026-01-03 18:11:41,665 - INFO -   Sending topic JSON to model (full subchapter context with 10 topics)...
2026-01-03 18:11:41,665 - INFO -   Calling model API...
2026-01-03 18:11:43,278 - ERROR - Text processing failed: 429 Resource has been exhausted (e.g. check quota).
2026-01-03 18:11:43,279 - ERROR -   ✗ No response received for topic: فتوتراپی با UVB > فتوتراپی برای ویتیلیگو
2026-01-03 18:11:43,280 - INFO - 
2026-01-03 18:11:43,280 - INFO - ================================================================================
2026-01-03 18:11:43,280 - INFO - PROCESSING TOPIC 8/29
2026-01-03 18:11:43,280 - INFO - ================================================================================
2026-01-03 18:11:43,280 - INFO -   Subchapter: 'فتوتراپی با UVB'
2026-01-03 18:11:43,280 - INFO -   Topic: 'فتوتراپی برای درماتیت آتوپیک و فتوتراپی برای فتودرماتوزها'
2026-01-03 18:11:43,281 - INFO -   Number of extractions: 1
2026-01-03 18:11:43,282 - INFO -   JSON payload size: 29,103 bytes (28.42 KB)
2026-01-03 18:11:43,282 - INFO -   Sending topic JSON to model (full subchapter context with 10 topics)...
2026-01-03 18:11:43,282 - INFO -   Calling model API...
2026-01-03 18:11:45,034 - ERROR - Text processing failed: 429 Resource has been exhausted (e.g. check quota).
2026-01-03 18:11:45,035 - ERROR -   ✗ No response received for topic: فتوتراپی با UVB > فتوتراپی برای درماتیت آتوپیک و فتوتراپی برای فتودرماتوزها
2026-01-03 18:11:45,035 - INFO - 
2026-01-03 18:11:45,035 - INFO - ================================================================================
2026-01-03 18:11:45,036 - INFO - PROCESSING TOPIC 9/29
2026-01-03 18:11:45,036 - INFO - ================================================================================
2026-01-03 18:11:45,036 - INFO -   Subchapter: 'فتوتراپی با UVB'
2026-01-03 18:11:45,036 - INFO -   Topic: 'فتوتراپی برای پیتیریازیس لیکنوئیدس، فتوتراپی برای درماتیت سبورئیک و فتوتراپی برای خارش'
2026-01-03 18:11:45,036 - INFO -   Number of extractions: 1
2026-01-03 18:11:45,037 - INFO -   JSON payload size: 29,103 bytes (28.42 KB)
2026-01-03 18:11:45,038 - INFO -   Sending topic JSON to model (full subchapter context with 10 topics)...
2026-01-03 18:11:45,038 - INFO -   Calling model API...
2026-01-03 18:11:46,455 - ERROR - Text processing failed: 429 Resource has been exhausted (e.g. check quota).
2026-01-03 18:11:46,456 - ERROR -   ✗ No response received for topic: فتوتراپی با UVB > فتوتراپی برای پیتیریازیس لیکنوئیدس، فتوتراپی برای درماتیت سبورئیک و فتوتراپی برای خارش
2026-01-03 18:11:46,457 - INFO - 
2026-01-03 18:11:46,457 - INFO - ================================================================================
2026-01-03 18:11:46,457 - INFO - PROCESSING TOPIC 10/29
2026-01-03 18:11:46,458 - INFO - ================================================================================
2026-01-03 18:11:46,458 - INFO -   Subchapter: 'فتوتراپی با UVB'
2026-01-03 18:11:46,458 - INFO -   Topic: 'عوارض جانبی فتوتراپی با UVB'
2026-01-03 18:11:46,458 - INFO -   Number of extractions: 2
2026-01-03 18:11:46,459 - INFO -   JSON payload size: 29,103 bytes (28.42 KB)
2026-01-03 18:11:46,459 - INFO -   Sending topic JSON to model (full subchapter context with 10 topics)...
2026-01-03 18:11:46,459 - INFO -   Calling model API...
2026-01-03 18:11:47,847 - ERROR - Text processing failed: 429 Resource has been exhausted (e.g. check quota).
2026-01-03 18:11:47,848 - ERROR -   ✗ No response received for topic: فتوتراپی با UVB > عوارض جانبی فتوتراپی با UVB
2026-01-03 18:11:47,848 - INFO - 
2026-01-03 18:11:47,848 - INFO - ================================================================================
2026-01-03 18:11:47,848 - INFO - PROCESSING TOPIC 11/29
2026-01-03 18:11:47,849 - INFO - ================================================================================
2026-01-03 18:11:47,849 - INFO -   Subchapter: 'فتوتراپی با لیزر یا لامپ اگزایمر 308 نانومتر'
2026-01-03 18:11:47,849 - INFO -   Topic: 'فتوتراپی با لیزر یا لامپ اگزایمر 308 نانومتر'
2026-01-03 18:11:47,849 - INFO -   Number of extractions: 1
2026-01-03 18:11:47,850 - INFO -   JSON payload size: 1,943 bytes (1.90 KB)
2026-01-03 18:11:47,850 - INFO -   Sending topic JSON to model (full subchapter context with 1 topics)...
2026-01-03 18:11:47,850 - INFO -   Calling model API...
2026-01-03 18:11:48,500 - ERROR - Text processing failed: 429 Resource has been exhausted (e.g. check quota).
2026-01-03 18:11:48,501 - ERROR -   ✗ No response received for topic: فتوتراپی با لیزر یا لامپ اگزایمر 308 نانومتر > فتوتراپی با لیزر یا لامپ اگزایمر 308 نانومتر
2026-01-03 18:11:48,502 - INFO - 
2026-01-03 18:11:48,502 - INFO - ================================================================================
2026-01-03 18:11:48,502 - INFO - PROCESSING TOPIC 12/29
2026-01-03 18:11:48,502 - INFO - ================================================================================
2026-01-03 18:11:48,502 - INFO -   Subchapter: 'فتوتراپی با UVA1'
2026-01-03 18:11:48,502 - INFO -   Topic: 'عوارض جانبی فتوتراپی با UVA1'
2026-01-03 18:11:48,503 - INFO -   Number of extractions: 1
2026-01-03 18:11:48,503 - INFO -   JSON payload size: 1,550 bytes (1.51 KB)
2026-01-03 18:11:48,503 - INFO -   Sending topic JSON to model (full subchapter context with 1 topics)...
2026-01-03 18:11:48,503 - INFO -   Calling model API...
2026-01-03 18:11:49,117 - ERROR - Text processing failed: 429 Resource has been exhausted (e.g. check quota).
2026-01-03 18:11:49,117 - ERROR -   ✗ No response received for topic: فتوتراپی با UVA1 > عوارض جانبی فتوتراپی با UVA1
2026-01-03 18:11:49,118 - INFO - 
2026-01-03 18:11:49,119 - INFO - ================================================================================
2026-01-03 18:11:49,119 - INFO - PROCESSING TOPIC 13/29
2026-01-03 18:11:49,119 - INFO - ================================================================================
2026-01-03 18:11:49,119 - INFO -   Subchapter: 'فتوکموتراپی با پسورالن‌ها (PUVA)'
2026-01-03 18:11:49,119 - INFO -   Topic: 'جنبه‌های تاریخی'
2026-01-03 18:11:49,119 - INFO -   Number of extractions: 2
2026-01-03 18:11:49,121 - INFO -   JSON payload size: 57,608 bytes (56.26 KB)
2026-01-03 18:11:49,121 - INFO -   Sending topic JSON to model (full subchapter context with 17 topics)...
2026-01-03 18:11:49,121 - INFO -   Calling model API...
2026-01-03 18:11:51,263 - ERROR - Text processing failed: 429 Resource has been exhausted (e.g. check quota).
2026-01-03 18:11:51,263 - ERROR -   ✗ No response received for topic: فتوکموتراپی با پسورالن‌ها (PUVA) > جنبه‌های تاریخی
2026-01-03 18:11:51,264 - INFO - 
2026-01-03 18:11:51,265 - INFO - ================================================================================
2026-01-03 18:11:51,265 - INFO - PROCESSING TOPIC 14/29
2026-01-03 18:11:51,265 - INFO - ================================================================================
2026-01-03 18:11:51,265 - INFO -   Subchapter: 'فتوکموتراپی با پسورالن‌ها (PUVA)'
2026-01-03 18:11:51,265 - INFO -   Topic: 'پسورالن‌ها'
2026-01-03 18:11:51,265 - INFO -   Number of extractions: 2
2026-01-03 18:11:51,267 - INFO -   JSON payload size: 57,608 bytes (56.26 KB)
2026-01-03 18:11:51,268 - INFO -   Sending topic JSON to model (full subchapter context with 17 topics)...
2026-01-03 18:11:51,268 - INFO -   Calling model API...
2026-01-03 18:11:53,393 - ERROR - Text processing failed: 429 Resource has been exhausted (e.g. check quota).
2026-01-03 18:11:53,394 - ERROR -   ✗ No response received for topic: فتوکموتراپی با پسورالن‌ها (PUVA) > پسورالن‌ها
2026-01-03 18:11:53,395 - INFO - 
2026-01-03 18:11:53,395 - INFO - ================================================================================
2026-01-03 18:11:53,395 - INFO - PROCESSING TOPIC 15/29
2026-01-03 18:11:53,396 - INFO - ================================================================================
2026-01-03 18:11:53,396 - INFO -   Subchapter: 'فتوکموتراپی با پسورالن‌ها (PUVA)'
2026-01-03 18:11:53,396 - INFO -   Topic: 'فتوشیمی پسورالن و طیف اثر و منابع نوری'
2026-01-03 18:11:53,396 - INFO -   Number of extractions: 3
2026-01-03 18:11:53,398 - INFO -   JSON payload size: 57,608 bytes (56.26 KB)
2026-01-03 18:11:53,398 - INFO -   Sending topic JSON to model (full subchapter context with 17 topics)...
2026-01-03 18:11:53,398 - INFO -   Calling model API...
2026-01-03 18:11:55,576 - ERROR - Text processing failed: 429 Resource has been exhausted (e.g. check quota).
2026-01-03 18:11:55,577 - ERROR -   ✗ No response received for topic: فتوکموتراپی با پسورالن‌ها (PUVA) > فتوشیمی پسورالن و طیف اثر و منابع نوری
2026-01-03 18:11:55,577 - INFO - 
2026-01-03 18:11:55,577 - INFO - ================================================================================
2026-01-03 18:11:55,577 - INFO - PROCESSING TOPIC 16/29
2026-01-03 18:11:55,578 - INFO - ================================================================================
2026-01-03 18:11:55,578 - INFO -   Subchapter: 'فتوکموتراپی با پسورالن‌ها (PUVA)'
2026-01-03 18:11:55,578 - INFO -   Topic: 'اثرات فتوبیولوژیک PUVA'
2026-01-03 18:11:55,578 - INFO -   Number of extractions: 1
2026-01-03 18:11:55,580 - INFO -   JSON payload size: 57,608 bytes (56.26 KB)
2026-01-03 18:11:55,581 - INFO -   Sending topic JSON to model (full subchapter context with 17 topics)...
2026-01-03 18:11:55,581 - INFO -   Calling model API...
2026-01-03 18:11:57,905 - ERROR - Text processing failed: 429 Resource has been exhausted (e.g. check quota).
2026-01-03 18:11:57,905 - ERROR -   ✗ No response received for topic: فتوکموتراپی با پسورالن‌ها (PUVA) > اثرات فتوبیولوژیک PUVA
2026-01-03 18:11:57,906 - INFO - 
2026-01-03 18:11:57,906 - INFO - ================================================================================
2026-01-03 18:11:57,906 - INFO - PROCESSING TOPIC 17/29
2026-01-03 18:11:57,906 - INFO - ================================================================================
2026-01-03 18:11:57,906 - INFO -   Subchapter: 'فتوکموتراپی با پسورالن‌ها (PUVA)'
2026-01-03 18:11:57,906 - INFO -   Topic: 'پروتکل‌های درمانی'
2026-01-03 18:11:57,907 - INFO -   Number of extractions: 2
2026-01-03 18:11:57,909 - INFO -   JSON payload size: 57,608 bytes (56.26 KB)
2026-01-03 18:11:57,909 - INFO -   Sending topic JSON to model (full subchapter context with 17 topics)...
2026-01-03 18:11:57,909 - INFO -   Calling model API...
2026-01-03 18:12:00,036 - ERROR - Text processing failed: 429 Resource has been exhausted (e.g. check quota).
2026-01-03 18:12:00,037 - ERROR -   ✗ No response received for topic: فتوکموتراپی با پسورالن‌ها (PUVA) > پروتکل‌های درمانی
2026-01-03 18:12:00,037 - INFO - 
2026-01-03 18:12:00,037 - INFO - ================================================================================
2026-01-03 18:12:00,037 - INFO - PROCESSING TOPIC 18/29
2026-01-03 18:12:00,037 - INFO - ================================================================================
2026-01-03 18:12:00,037 - INFO -   Subchapter: 'فتوکموتراپی با پسورالن‌ها (PUVA)'
2026-01-03 18:12:00,037 - INFO -   Topic: 'مرحله درمان اولیه (پاکسازی)'
2026-01-03 18:12:00,038 - INFO -   Number of extractions: 2
2026-01-03 18:12:00,040 - INFO -   JSON payload size: 57,608 bytes (56.26 KB)
2026-01-03 18:12:00,040 - INFO -   Sending topic JSON to model (full subchapter context with 17 topics)...
2026-01-03 18:12:00,040 - INFO -   Calling model API...
2026-01-03 18:12:02,145 - ERROR - Text processing failed: 429 Resource has been exhausted (e.g. check quota).
2026-01-03 18:12:02,146 - ERROR -   ✗ No response received for topic: فتوکموتراپی با پسورالن‌ها (PUVA) > مرحله درمان اولیه (پاکسازی)
2026-01-03 18:12:02,147 - INFO - 
2026-01-03 18:12:02,148 - INFO - ================================================================================
2026-01-03 18:12:02,148 - INFO - PROCESSING TOPIC 19/29
2026-01-03 18:12:02,148 - INFO - ================================================================================
2026-01-03 18:12:02,148 - INFO -   Subchapter: 'فتوکموتراپی با پسورالن‌ها (PUVA)'
2026-01-03 18:12:02,148 - INFO -   Topic: 'مرحله نگهدارنده'
2026-01-03 18:12:02,148 - INFO -   Number of extractions: 1
2026-01-03 18:12:02,150 - INFO -   JSON payload size: 57,608 bytes (56.26 KB)
2026-01-03 18:12:02,150 - INFO -   Sending topic JSON to model (full subchapter context with 17 topics)...
2026-01-03 18:12:02,151 - INFO -   Calling model API...
2026-01-03 18:12:04,300 - ERROR - Text processing failed: 429 Resource has been exhausted (e.g. check quota).
2026-01-03 18:12:04,300 - ERROR -   ✗ No response received for topic: فتوکموتراپی با پسورالن‌ها (PUVA) > مرحله نگهدارنده
2026-01-03 18:12:04,301 - INFO - 
2026-01-03 18:12:04,302 - INFO - ================================================================================
2026-01-03 18:12:04,302 - INFO - PROCESSING TOPIC 20/29
2026-01-03 18:12:04,302 - INFO - ================================================================================
2026-01-03 18:12:04,303 - INFO -   Subchapter: 'فتوکموتراپی با پسورالن‌ها (PUVA)'
2026-01-03 18:12:04,303 - INFO -   Topic: 'PUVA برای پسوریازیس'
2026-01-03 18:12:04,303 - INFO -   Number of extractions: 2
2026-01-03 18:12:04,305 - INFO -   JSON payload size: 57,608 bytes (56.26 KB)
2026-01-03 18:12:04,305 - INFO -   Sending topic JSON to model (full subchapter context with 17 topics)...
2026-01-03 18:12:04,305 - INFO -   Calling model API...
2026-01-03 18:12:06,742 - ERROR - Text processing failed: 429 Resource has been exhausted (e.g. check quota).
2026-01-03 18:12:06,743 - ERROR -   ✗ No response received for topic: فتوکموتراپی با پسورالن‌ها (PUVA) > PUVA برای پسوریازیس
2026-01-03 18:12:06,744 - INFO - 
2026-01-03 18:12:06,744 - INFO - ================================================================================
2026-01-03 18:12:06,744 - INFO - PROCESSING TOPIC 21/29
2026-01-03 18:12:06,744 - INFO - ================================================================================
2026-01-03 18:12:06,744 - INFO -   Subchapter: 'فتوکموتراپی با پسورالن‌ها (PUVA)'
2026-01-03 18:12:06,744 - INFO -   Topic: 'درمان‌های ترکیبی'
2026-01-03 18:12:06,745 - INFO -   Number of extractions: 1
2026-01-03 18:12:06,747 - INFO -   JSON payload size: 57,608 bytes (56.26 KB)
2026-01-03 18:12:06,747 - INFO -   Sending topic JSON to model (full subchapter context with 17 topics)...
2026-01-03 18:12:06,747 - INFO -   Calling model API...
2026-01-03 18:12:09,203 - ERROR - Text processing failed: 429 Resource has been exhausted (e.g. check quota).
2026-01-03 18:12:09,203 - ERROR -   ✗ No response received for topic: فتوکموتراپی با پسورالن‌ها (PUVA) > درمان‌های ترکیبی
2026-01-03 18:12:09,204 - INFO - 
2026-01-03 18:12:09,204 - INFO - ================================================================================
2026-01-03 18:12:09,204 - INFO - PROCESSING TOPIC 22/29
2026-01-03 18:12:09,205 - INFO - ================================================================================
2026-01-03 18:12:09,205 - INFO -   Subchapter: 'فتوکموتراپی با پسورالن‌ها (PUVA)'
2026-01-03 18:12:09,206 - INFO -   Topic: 'PUVA برای لنفوم سلول T پوستی، به ویژه مایکوزیس فونگوئیدس'
2026-01-03 18:12:09,206 - INFO -   Number of extractions: 2
2026-01-03 18:12:09,208 - INFO -   JSON payload size: 57,608 bytes (56.26 KB)
2026-01-03 18:12:09,208 - INFO -   Sending topic JSON to model (full subchapter context with 17 topics)...
2026-01-03 18:12:09,209 - INFO -   Calling model API...
2026-01-03 18:12:11,807 - ERROR - Text processing failed: 429 Resource has been exhausted (e.g. check quota).
2026-01-03 18:12:11,808 - ERROR -   ✗ No response received for topic: فتوکموتراپی با پسورالن‌ها (PUVA) > PUVA برای لنفوم سلول T پوستی، به ویژه مایکوزیس فونگوئیدس
2026-01-03 18:12:11,808 - INFO - 
2026-01-03 18:12:11,809 - INFO - ================================================================================
2026-01-03 18:12:11,809 - INFO - PROCESSING TOPIC 23/29
2026-01-03 18:12:11,809 - INFO - ================================================================================
2026-01-03 18:12:11,809 - INFO -   Subchapter: 'فتوکموتراپی با پسورالن‌ها (PUVA)'
2026-01-03 18:12:11,809 - INFO -   Topic: 'PUVA برای ویتیلیگو'
2026-01-03 18:12:11,809 - INFO -   Number of extractions: 1
2026-01-03 18:12:11,811 - INFO -   JSON payload size: 57,608 bytes (56.26 KB)
2026-01-03 18:12:11,811 - INFO -   Sending topic JSON to model (full subchapter context with 17 topics)...
2026-01-03 18:12:11,812 - INFO -   Calling model API...
2026-01-03 18:12:14,034 - ERROR - Text processing failed: 429 Resource has been exhausted (e.g. check quota).
2026-01-03 18:12:14,035 - ERROR -   ✗ No response received for topic: فتوکموتراپی با پسورالن‌ها (PUVA) > PUVA برای ویتیلیگو
2026-01-03 18:12:14,035 - INFO - 
2026-01-03 18:12:14,036 - INFO - ================================================================================
2026-01-03 18:12:14,036 - INFO - PROCESSING TOPIC 24/29
2026-01-03 18:12:14,036 - INFO - ================================================================================
2026-01-03 18:12:14,036 - INFO -   Subchapter: 'فتوکموتراپی با پسورالن‌ها (PUVA)'
2026-01-03 18:12:14,036 - INFO -   Topic: 'PUVA برای درماتیت آتوپیک و PUVA برای لیکن پلان'
2026-01-03 18:12:14,036 - INFO -   Number of extractions: 1
2026-01-03 18:12:14,038 - INFO -   JSON payload size: 57,608 bytes (56.26 KB)
2026-01-03 18:12:14,038 - INFO -   Sending topic JSON to model (full subchapter context with 17 topics)...
2026-01-03 18:12:14,038 - INFO -   Calling model API...
2026-01-03 18:12:16,265 - ERROR - Text processing failed: 429 Resource has been exhausted (e.g. check quota).
2026-01-03 18:12:16,265 - ERROR -   ✗ No response received for topic: فتوکموتراپی با پسورالن‌ها (PUVA) > PUVA برای درماتیت آتوپیک و PUVA برای لیکن پلان
2026-01-03 18:12:16,265 - INFO - 
2026-01-03 18:12:16,266 - INFO - ================================================================================
2026-01-03 18:12:16,266 - INFO - PROCESSING TOPIC 25/29
2026-01-03 18:12:16,266 - INFO - ================================================================================
2026-01-03 18:12:16,267 - INFO -   Subchapter: 'فتوکموتراپی با پسورالن‌ها (PUVA)'
2026-01-03 18:12:16,267 - INFO -   Topic: 'PUVA برای بیماری پیوند علیه میزبان'
2026-01-03 18:12:16,267 - INFO -   Number of extractions: 1
2026-01-03 18:12:16,269 - INFO -   JSON payload size: 57,608 bytes (56.26 KB)
2026-01-03 18:12:16,269 - INFO -   Sending topic JSON to model (full subchapter context with 17 topics)...
2026-01-03 18:12:16,269 - INFO -   Calling model API...
2026-01-03 18:12:18,379 - ERROR - Text processing failed: 429 Resource has been exhausted (e.g. check quota).
2026-01-03 18:12:18,380 - ERROR -   ✗ No response received for topic: فتوکموتراپی با پسورالن‌ها (PUVA) > PUVA برای بیماری پیوند علیه میزبان
2026-01-03 18:12:18,381 - INFO - 
2026-01-03 18:12:18,381 - INFO - ================================================================================
2026-01-03 18:12:18,381 - INFO - PROCESSING TOPIC 26/29
2026-01-03 18:12:18,382 - INFO - ================================================================================
2026-01-03 18:12:18,382 - INFO -   Subchapter: 'فتوکموتراپی با پسورالن‌ها (PUVA)'
2026-01-03 18:12:18,382 - INFO -   Topic: 'PUVA برای کهیر پیگمنتوزا و PUVA برای درماتوزهای متفرقه'
2026-01-03 18:12:18,382 - INFO -   Number of extractions: 1
2026-01-03 18:12:18,384 - INFO -   JSON payload size: 57,608 bytes (56.26 KB)
2026-01-03 18:12:18,384 - INFO -   Sending topic JSON to model (full subchapter context with 17 topics)...
2026-01-03 18:12:18,384 - INFO -   Calling model API...
2026-01-03 18:12:20,518 - ERROR - Text processing failed: 429 Resource has been exhausted (e.g. check quota).
2026-01-03 18:12:20,519 - ERROR -   ✗ No response received for topic: فتوکموتراپی با پسورالن‌ها (PUVA) > PUVA برای کهیر پیگمنتوزا و PUVA برای درماتوزهای متفرقه
2026-01-03 18:12:20,519 - INFO - 
2026-01-03 18:12:20,519 - INFO - ================================================================================
2026-01-03 18:12:20,519 - INFO - PROCESSING TOPIC 27/29
2026-01-03 18:12:20,519 - INFO - ================================================================================
2026-01-03 18:12:20,519 - INFO -   Subchapter: 'فتوکموتراپی با پسورالن‌ها (PUVA)'
2026-01-03 18:12:20,520 - INFO -   Topic: 'PUVA برای فتودرماتوزها'
2026-01-03 18:12:20,520 - INFO -   Number of extractions: 1
2026-01-03 18:12:20,522 - INFO -   JSON payload size: 57,608 bytes (56.26 KB)
2026-01-03 18:12:20,522 - INFO -   Sending topic JSON to model (full subchapter context with 17 topics)...
2026-01-03 18:12:20,522 - INFO -   Calling model API...
2026-01-03 18:12:22,624 - ERROR - Text processing failed: 429 Resource has been exhausted (e.g. check quota).
2026-01-03 18:12:22,625 - ERROR -   ✗ No response received for topic: فتوکموتراپی با پسورالن‌ها (PUVA) > PUVA برای فتودرماتوزها
2026-01-03 18:12:22,625 - INFO - 
2026-01-03 18:12:22,625 - INFO - ================================================================================
2026-01-03 18:12:22,626 - INFO - PROCESSING TOPIC 28/29
2026-01-03 18:12:22,626 - INFO - ================================================================================
2026-01-03 18:12:22,626 - INFO -   Subchapter: 'فتوکموتراپی با پسورالن‌ها (PUVA)'
2026-01-03 18:12:22,626 - INFO -   Topic: 'عوارض جانبی و خطرات بلندمدت PUVA'
2026-01-03 18:12:22,626 - INFO -   Number of extractions: 2
2026-01-03 18:12:22,628 - INFO -   JSON payload size: 57,608 bytes (56.26 KB)
2026-01-03 18:12:22,628 - INFO -   Sending topic JSON to model (full subchapter context with 17 topics)...
2026-01-03 18:12:22,628 - INFO -   Calling model API...
2026-01-03 18:12:25,203 - ERROR - Text processing failed: 429 Resource has been exhausted (e.g. check quota).
2026-01-03 18:12:25,204 - ERROR -   ✗ No response received for topic: فتوکموتراپی با پسورالن‌ها (PUVA) > عوارض جانبی و خطرات بلندمدت PUVA
2026-01-03 18:12:25,204 - INFO - 
2026-01-03 18:12:25,205 - INFO - ================================================================================
2026-01-03 18:12:25,205 - INFO - PROCESSING TOPIC 29/29
2026-01-03 18:12:25,205 - INFO - ================================================================================
2026-01-03 18:12:25,205 - INFO -   Subchapter: 'فتوکموتراپی با پسورالن‌ها (PUVA)'
2026-01-03 18:12:25,205 - INFO -   Topic: 'UVB و PUVA در بیماران آلوده به HIV'
2026-01-03 18:12:25,205 - INFO -   Number of extractions: 1
2026-01-03 18:12:25,207 - INFO -   JSON payload size: 57,608 bytes (56.26 KB)
2026-01-03 18:12:25,207 - INFO -   Sending topic JSON to model (full subchapter context with 17 topics)...
2026-01-03 18:12:25,207 - INFO -   Calling model API...
2026-01-03 18:12:27,415 - ERROR - Text processing failed: 429 Resource has been exhausted (e.g. check quota).
2026-01-03 18:12:27,416 - ERROR -   ✗ No response received for topic: فتوکموتراپی با پسورالن‌ها (PUVA) > UVB و PUVA در بیماران آلوده به HIV
2026-01-03 18:12:27,417 - INFO - 
2026-01-03 18:12:27,417 - INFO - ================================================================================
2026-01-03 18:12:27,417 - INFO - SAVING TXT FILES FOR EACH SUBCHAPTER
2026-01-03 18:12:27,417 - INFO - ================================================================================
2026-01-03 18:12:27,418 - INFO - ================================================================================
2026-01-03 18:12:27,418 - ERROR - No responses produced by Document Processing
2026-01-03 19:06:25,726 - INFO - Loaded 3 API keys
2026-01-03 19:06:40,015 - INFO - [get_default_model] ComboBox value: gemini-2.5-pro, StringVar value: gemini-2.5-pro
2026-01-03 19:06:40,016 - INFO - [get_default_model] Returning model from ComboBox: gemini-2.5-pro
2026-01-03 19:06:40,016 - INFO - Loading OCR Extraction JSON: /home/shahmir/Downloads/OCR Extraction.json
2026-01-03 19:06:40,018 - INFO - Chapter name from input JSON: درمان با اشعه ماوراء بنفش
2026-01-03 19:06:40,018 - INFO - ================================================================================
2026-01-03 19:06:40,018 - INFO - DOCUMENT PROCESSING - PROCESSING BY TOPIC
2026-01-03 19:06:40,019 - INFO - ================================================================================
2026-01-03 19:06:40,019 - INFO - Found 29 topics to process
2026-01-03 19:06:40,019 - INFO - Found 4 unique subchapters
2026-01-03 19:06:40,019 - INFO - 
2026-01-03 19:06:40,019 - INFO -   Subchapter 1: 'فتوتراپی با UVA1' - 1 topics
2026-01-03 19:06:40,020 - INFO -     Topic 1: 'عوارض جانبی فتوتراپی با UVA1'
2026-01-03 19:06:40,020 - INFO -   Subchapter 2: 'فتوتراپی با UVB' - 10 topics
2026-01-03 19:06:40,020 - INFO -     Topic 1: 'جنبه‌های تاریخی'
2026-01-03 19:06:40,020 - INFO -     Topic 2: 'اصول و مکانیسم‌ها'
2026-01-03 19:06:40,021 - INFO -     Topic 3: 'طیف اثر و منابع تابش'
2026-01-03 19:06:40,021 - INFO -     Topic 4: 'پروتکل‌های درمانی'
2026-01-03 19:06:40,021 - INFO -     Topic 5: 'فتوتراپی برای پسوریازیس'
2026-01-03 19:06:40,021 - INFO -     Topic 6: 'فتوتراپی برای لنفوم سلول T پوستی، به ویژه مایكوزیس فونگوئیدس'
2026-01-03 19:06:40,021 - INFO -     Topic 7: 'فتوتراپی برای ویتیلیگو'
2026-01-03 19:06:40,022 - INFO -     Topic 8: 'فتوتراپی برای درماتیت آتوپیک و فتوتراپی برای فتودرماتوزها'
2026-01-03 19:06:40,022 - INFO -     Topic 9: 'فتوتراپی برای پیتیریازیس لیکنوئیدس، فتوتراپی برای درماتیت سبورئیک و فتوتراپی برای خارش'
2026-01-03 19:06:40,022 - INFO -     Topic 10: 'عوارض جانبی فتوتراپی با UVB'
2026-01-03 19:06:40,022 - INFO -   Subchapter 3: 'فتوتراپی با لیزر یا لامپ اگزایمر 308 نانومتر' - 1 topics
2026-01-03 19:06:40,023 - INFO -     Topic 1: 'فتوتراپی با لیزر یا لامپ اگزایمر 308 نانومتر'
2026-01-03 19:06:40,023 - INFO -   Subchapter 4: 'فتوکموتراپی با پسورالن‌ها (PUVA)' - 17 topics
2026-01-03 19:06:40,023 - INFO -     Topic 1: 'جنبه‌های تاریخی'
2026-01-03 19:06:40,023 - INFO -     Topic 2: 'پسورالن‌ها'
2026-01-03 19:06:40,023 - INFO -     Topic 3: 'فتوشیمی پسورالن و طیف اثر و منابع نوری'
2026-01-03 19:06:40,023 - INFO -     Topic 4: 'اثرات فتوبیولوژیک PUVA'
2026-01-03 19:06:40,024 - INFO -     Topic 5: 'پروتکل‌های درمانی'
2026-01-03 19:06:40,024 - INFO -     Topic 6: 'مرحله درمان اولیه (پاکسازی)'
2026-01-03 19:06:40,024 - INFO -     Topic 7: 'مرحله نگهدارنده'
2026-01-03 19:06:40,024 - INFO -     Topic 8: 'PUVA برای پسوریازیس'
2026-01-03 19:06:40,024 - INFO -     Topic 9: 'درمان‌های ترکیبی'
2026-01-03 19:06:40,024 - INFO -     Topic 10: 'PUVA برای لنفوم سلول T پوستی، به ویژه مایکوزیس فونگوئیدس'
2026-01-03 19:06:40,024 - INFO -     Topic 11: 'PUVA برای ویتیلیگو'
2026-01-03 19:06:40,025 - INFO -     Topic 12: 'PUVA برای درماتیت آتوپیک و PUVA برای لیکن پلان'
2026-01-03 19:06:40,025 - INFO -     Topic 13: 'PUVA برای بیماری پیوند علیه میزبان'
2026-01-03 19:06:40,025 - INFO -     Topic 14: 'PUVA برای کهیر پیگمنتوزا و PUVA برای درماتوزهای متفرقه'
2026-01-03 19:06:40,025 - INFO -     Topic 15: 'PUVA برای فتودرماتوزها'
2026-01-03 19:06:40,025 - INFO -     Topic 16: 'عوارض جانبی و خطرات بلندمدت PUVA'
2026-01-03 19:06:40,025 - INFO -     Topic 17: 'UVB و PUVA در بیماران آلوده به HIV'
2026-01-03 19:06:40,025 - INFO - ================================================================================
2026-01-03 19:06:40,026 - INFO - 
2026-01-03 19:06:40,026 - INFO - ================================================================================
2026-01-03 19:06:40,026 - INFO - PROCESSING TOPIC 1/29
2026-01-03 19:06:40,026 - INFO - ================================================================================
2026-01-03 19:06:40,027 - INFO -   Subchapter: 'فتوتراپی با UVB'
2026-01-03 19:06:40,027 - INFO -   Topic: 'جنبه‌های تاریخی'
2026-01-03 19:06:40,027 - INFO -   Number of extractions: 1
2026-01-03 19:06:40,030 - INFO -   JSON payload size: 29,103 bytes (28.42 KB)
2026-01-03 19:06:40,030 - INFO -   Sending topic JSON to model (full subchapter context with 10 topics)...
2026-01-03 19:06:40,030 - INFO -   Calling model API...
2026-01-03 19:06:42,466 - ERROR - Text processing failed: 429 Resource has been exhausted (e.g. check quota).
2026-01-03 19:06:42,467 - ERROR -   ✗ No response received for topic: فتوتراپی با UVB > جنبه‌های تاریخی
2026-01-03 19:06:42,467 - INFO - 
2026-01-03 19:06:42,468 - INFO - ================================================================================
2026-01-03 19:06:42,468 - INFO - PROCESSING TOPIC 2/29
2026-01-03 19:06:42,468 - INFO - ================================================================================
2026-01-03 19:06:42,468 - INFO -   Subchapter: 'فتوتراپی با UVB'
2026-01-03 19:06:42,468 - INFO -   Topic: 'اصول و مکانیسم‌ها'
2026-01-03 19:06:42,468 - INFO -   Number of extractions: 1
2026-01-03 19:06:42,470 - INFO -   JSON payload size: 29,103 bytes (28.42 KB)
2026-01-03 19:06:42,470 - INFO -   Sending topic JSON to model (full subchapter context with 10 topics)...
2026-01-03 19:06:42,470 - INFO -   Calling model API...
2026-01-03 19:06:43,892 - ERROR - Text processing failed: 429 Resource has been exhausted (e.g. check quota).
2026-01-03 19:06:43,893 - ERROR -   ✗ No response received for topic: فتوتراپی با UVB > اصول و مکانیسم‌ها
2026-01-03 19:06:43,893 - INFO - 
2026-01-03 19:06:43,894 - INFO - ================================================================================
2026-01-03 19:06:43,894 - INFO - PROCESSING TOPIC 3/29
2026-01-03 19:06:43,894 - INFO - ================================================================================
2026-01-03 19:06:43,894 - INFO -   Subchapter: 'فتوتراپی با UVB'
2026-01-03 19:06:43,894 - INFO -   Topic: 'طیف اثر و منابع تابش'
2026-01-03 19:06:43,894 - INFO -   Number of extractions: 3
2026-01-03 19:06:43,896 - INFO -   JSON payload size: 29,103 bytes (28.42 KB)
2026-01-03 19:06:43,896 - INFO -   Sending topic JSON to model (full subchapter context with 10 topics)...
2026-01-03 19:06:43,896 - INFO -   Calling model API...
2026-01-03 19:06:45,377 - ERROR - Text processing failed: 429 Resource has been exhausted (e.g. check quota).
2026-01-03 19:06:45,378 - ERROR -   ✗ No response received for topic: فتوتراپی با UVB > طیف اثر و منابع تابش
2026-01-03 19:06:45,379 - INFO - 
2026-01-03 19:06:45,379 - INFO - ================================================================================
2026-01-03 19:06:45,379 - INFO - PROCESSING TOPIC 4/29
2026-01-03 19:06:45,379 - INFO - ================================================================================
2026-01-03 19:06:45,380 - INFO -   Subchapter: 'فتوتراپی با UVB'
2026-01-03 19:06:45,380 - INFO -   Topic: 'پروتکل‌های درمانی'
2026-01-03 19:06:45,380 - INFO -   Number of extractions: 4
2026-01-03 19:06:45,382 - INFO -   JSON payload size: 29,103 bytes (28.42 KB)
2026-01-03 19:06:45,382 - INFO -   Sending topic JSON to model (full subchapter context with 10 topics)...
2026-01-03 19:06:45,382 - INFO -   Calling model API...
2026-01-03 19:06:46,791 - ERROR - Text processing failed: 429 Resource has been exhausted (e.g. check quota).
2026-01-03 19:06:46,792 - ERROR -   ✗ No response received for topic: فتوتراپی با UVB > پروتکل‌های درمانی
2026-01-03 19:06:46,793 - INFO - 
2026-01-03 19:06:46,793 - INFO - ================================================================================
2026-01-03 19:06:46,793 - INFO - PROCESSING TOPIC 5/29
2026-01-03 19:06:46,793 - INFO - ================================================================================
2026-01-03 19:06:46,793 - INFO -   Subchapter: 'فتوتراپی با UVB'
2026-01-03 19:06:46,793 - INFO -   Topic: 'فتوتراپی برای پسوریازیس'
2026-01-03 19:06:46,793 - INFO -   Number of extractions: 1
2026-01-03 19:06:46,795 - INFO -   JSON payload size: 29,103 bytes (28.42 KB)
2026-01-03 19:06:46,795 - INFO -   Sending topic JSON to model (full subchapter context with 10 topics)...
2026-01-03 19:06:46,795 - INFO -   Calling model API...
2026-01-03 19:06:48,431 - ERROR - Text processing failed: 429 Resource has been exhausted (e.g. check quota).
2026-01-03 19:06:48,432 - ERROR -   ✗ No response received for topic: فتوتراپی با UVB > فتوتراپی برای پسوریازیس
2026-01-03 19:06:48,433 - INFO - 
2026-01-03 19:06:48,434 - INFO - ================================================================================
2026-01-03 19:06:48,434 - INFO - PROCESSING TOPIC 6/29
2026-01-03 19:06:48,434 - INFO - ================================================================================
2026-01-03 19:06:48,434 - INFO -   Subchapter: 'فتوتراپی با UVB'
2026-01-03 19:06:48,434 - INFO -   Topic: 'فتوتراپی برای لنفوم سلول T پوستی، به ویژه مایكوزیس فونگوئیدس'
2026-01-03 19:06:48,434 - INFO -   Number of extractions: 1
2026-01-03 19:06:48,436 - INFO -   JSON payload size: 29,103 bytes (28.42 KB)
2026-01-03 19:06:48,436 - INFO -   Sending topic JSON to model (full subchapter context with 10 topics)...
2026-01-03 19:06:48,436 - INFO -   Calling model API...
2026-01-03 19:06:50,206 - ERROR - Text processing failed: 429 Resource has been exhausted (e.g. check quota).
2026-01-03 19:06:50,206 - ERROR -   ✗ No response received for topic: فتوتراپی با UVB > فتوتراپی برای لنفوم سلول T پوستی، به ویژه مایكوزیس فونگوئیدس
2026-01-03 19:06:50,207 - INFO - 
2026-01-03 19:06:50,207 - INFO - ================================================================================
2026-01-03 19:06:50,207 - INFO - PROCESSING TOPIC 7/29
2026-01-03 19:06:50,207 - INFO - ================================================================================
2026-01-03 19:06:50,207 - INFO -   Subchapter: 'فتوتراپی با UVB'
2026-01-03 19:06:50,208 - INFO -   Topic: 'فتوتراپی برای ویتیلیگو'
2026-01-03 19:06:50,208 - INFO -   Number of extractions: 2
2026-01-03 19:06:50,209 - INFO -   JSON payload size: 29,103 bytes (28.42 KB)
2026-01-03 19:06:50,209 - INFO -   Sending topic JSON to model (full subchapter context with 10 topics)...
2026-01-03 19:06:50,210 - INFO -   Calling model API...
2026-01-03 19:06:52,066 - ERROR - Text processing failed: 429 Resource has been exhausted (e.g. check quota).
2026-01-03 19:06:52,067 - ERROR -   ✗ No response received for topic: فتوتراپی با UVB > فتوتراپی برای ویتیلیگو
2026-01-03 19:06:52,068 - INFO - 
2026-01-03 19:06:52,068 - INFO - ================================================================================
2026-01-03 19:06:52,068 - INFO - PROCESSING TOPIC 8/29
2026-01-03 19:06:52,068 - INFO - ================================================================================
2026-01-03 19:06:52,069 - INFO -   Subchapter: 'فتوتراپی با UVB'
2026-01-03 19:06:52,069 - INFO -   Topic: 'فتوتراپی برای درماتیت آتوپیک و فتوتراپی برای فتودرماتوزها'
2026-01-03 19:06:52,069 - INFO -   Number of extractions: 1
2026-01-03 19:06:52,070 - INFO -   JSON payload size: 29,103 bytes (28.42 KB)
2026-01-03 19:06:52,071 - INFO -   Sending topic JSON to model (full subchapter context with 10 topics)...
2026-01-03 19:06:52,071 - INFO -   Calling model API...
2026-01-03 19:06:54,421 - ERROR - Text processing failed: 429 Resource has been exhausted (e.g. check quota).
2026-01-03 19:06:54,422 - ERROR -   ✗ No response received for topic: فتوتراپی با UVB > فتوتراپی برای درماتیت آتوپیک و فتوتراپی برای فتودرماتوزها
2026-01-03 19:06:54,423 - INFO - 
2026-01-03 19:06:54,423 - INFO - ================================================================================
2026-01-03 19:06:54,423 - INFO - PROCESSING TOPIC 9/29
2026-01-03 19:06:54,424 - INFO - ================================================================================
2026-01-03 19:06:54,424 - INFO -   Subchapter: 'فتوتراپی با UVB'
2026-01-03 19:06:54,424 - INFO -   Topic: 'فتوتراپی برای پیتیریازیس لیکنوئیدس، فتوتراپی برای درماتیت سبورئیک و فتوتراپی برای خارش'
2026-01-03 19:06:54,424 - INFO -   Number of extractions: 1
2026-01-03 19:06:54,425 - INFO -   JSON payload size: 29,103 bytes (28.42 KB)
2026-01-03 19:06:54,425 - INFO -   Sending topic JSON to model (full subchapter context with 10 topics)...
2026-01-03 19:06:54,425 - INFO -   Calling model API...
2026-01-03 19:06:56,581 - ERROR - Text processing failed: 429 Resource has been exhausted (e.g. check quota).
2026-01-03 19:06:56,582 - ERROR -   ✗ No response received for topic: فتوتراپی با UVB > فتوتراپی برای پیتیریازیس لیکنوئیدس، فتوتراپی برای درماتیت سبورئیک و فتوتراپی برای خارش
2026-01-03 19:06:56,582 - INFO - 
2026-01-03 19:06:56,582 - INFO - ================================================================================
2026-01-03 19:06:56,583 - INFO - PROCESSING TOPIC 10/29
2026-01-03 19:06:56,583 - INFO - ================================================================================
2026-01-03 19:06:56,583 - INFO -   Subchapter: 'فتوتراپی با UVB'
2026-01-03 19:06:56,583 - INFO -   Topic: 'عوارض جانبی فتوتراپی با UVB'
2026-01-03 19:06:56,583 - INFO -   Number of extractions: 2
2026-01-03 19:06:56,584 - INFO -   JSON payload size: 29,103 bytes (28.42 KB)
2026-01-03 19:06:56,585 - INFO -   Sending topic JSON to model (full subchapter context with 10 topics)...
2026-01-03 19:06:56,585 - INFO -   Calling model API...
2026-01-03 19:06:58,331 - ERROR - Text processing failed: 429 Resource has been exhausted (e.g. check quota).
2026-01-03 19:06:58,331 - ERROR -   ✗ No response received for topic: فتوتراپی با UVB > عوارض جانبی فتوتراپی با UVB
2026-01-03 19:06:58,332 - INFO - 
2026-01-03 19:06:58,333 - INFO - ================================================================================
2026-01-03 19:06:58,333 - INFO - PROCESSING TOPIC 11/29
2026-01-03 19:06:58,333 - INFO - ================================================================================
2026-01-03 19:06:58,333 - INFO -   Subchapter: 'فتوتراپی با لیزر یا لامپ اگزایمر 308 نانومتر'
2026-01-03 19:06:58,333 - INFO -   Topic: 'فتوتراپی با لیزر یا لامپ اگزایمر 308 نانومتر'
2026-01-03 19:06:58,333 - INFO -   Number of extractions: 1
2026-01-03 19:06:58,334 - INFO -   JSON payload size: 1,943 bytes (1.90 KB)
2026-01-03 19:06:58,334 - INFO -   Sending topic JSON to model (full subchapter context with 1 topics)...
2026-01-03 19:06:58,335 - INFO -   Calling model API...
2026-01-03 19:08:07,196 - INFO - Text processed successfully with gemini-2.5-pro
2026-01-03 19:08:07,196 - INFO -   ✓ Topic 'فتوتراپی با لیزر یا لامپ اگزایمر 308 نانومتر' processed successfully
2026-01-03 19:08:07,197 - INFO -   Response size: 5,138 bytes (5.02 KB)
2026-01-03 19:08:07,197 - INFO -   Response length: 4,010 characters
2026-01-03 19:08:07,197 - INFO -   ✓ Topic 'فتوتراپی با لیزر یا لامپ اگزایمر 308 نانومتر' completed
2026-01-03 19:08:07,197 - INFO - ================================================================================
2026-01-03 19:08:07,197 - INFO - 
2026-01-03 19:08:07,198 - INFO - ================================================================================
2026-01-03 19:08:07,198 - INFO - PROCESSING TOPIC 12/29
2026-01-03 19:08:07,198 - INFO - ================================================================================
2026-01-03 19:08:07,198 - INFO -   Subchapter: 'فتوتراپی با UVA1'
2026-01-03 19:08:07,198 - INFO -   Topic: 'عوارض جانبی فتوتراپی با UVA1'
2026-01-03 19:08:07,198 - INFO -   Number of extractions: 1
2026-01-03 19:08:07,199 - INFO -   JSON payload size: 1,550 bytes (1.51 KB)
2026-01-03 19:08:07,199 - INFO -   Sending topic JSON to model (full subchapter context with 1 topics)...
2026-01-03 19:08:07,199 - INFO -   Calling model API...
2026-01-03 19:08:07,906 - ERROR - Text processing failed: 429 Resource has been exhausted (e.g. check quota).
2026-01-03 19:08:07,907 - ERROR -   ✗ No response received for topic: فتوتراپی با UVA1 > عوارض جانبی فتوتراپی با UVA1
2026-01-03 19:08:07,908 - INFO - 
2026-01-03 19:08:07,908 - INFO - ================================================================================
2026-01-03 19:08:07,908 - INFO - PROCESSING TOPIC 13/29
2026-01-03 19:08:07,908 - INFO - ================================================================================
2026-01-03 19:08:07,908 - INFO -   Subchapter: 'فتوکموتراپی با پسورالن‌ها (PUVA)'
2026-01-03 19:08:07,908 - INFO -   Topic: 'جنبه‌های تاریخی'
2026-01-03 19:08:07,908 - INFO -   Number of extractions: 2
2026-01-03 19:08:07,910 - INFO -   JSON payload size: 57,608 bytes (56.26 KB)
2026-01-03 19:08:07,910 - INFO -   Sending topic JSON to model (full subchapter context with 17 topics)...
2026-01-03 19:08:07,910 - INFO -   Calling model API...
2026-01-03 19:08:10,193 - ERROR - Text processing failed: 429 Resource has been exhausted (e.g. check quota).
2026-01-03 19:08:10,194 - ERROR -   ✗ No response received for topic: فتوکموتراپی با پسورالن‌ها (PUVA) > جنبه‌های تاریخی
2026-01-03 19:08:10,194 - INFO - 
2026-01-03 19:08:10,194 - INFO - ================================================================================
2026-01-03 19:08:10,195 - INFO - PROCESSING TOPIC 14/29
2026-01-03 19:08:10,195 - INFO - ================================================================================
2026-01-03 19:08:10,195 - INFO -   Subchapter: 'فتوکموتراپی با پسورالن‌ها (PUVA)'
2026-01-03 19:08:10,195 - INFO -   Topic: 'پسورالن‌ها'
2026-01-03 19:08:10,195 - INFO -   Number of extractions: 2
2026-01-03 19:08:10,197 - INFO -   JSON payload size: 57,608 bytes (56.26 KB)
2026-01-03 19:08:10,197 - INFO -   Sending topic JSON to model (full subchapter context with 17 topics)...
2026-01-03 19:08:10,197 - INFO -   Calling model API...
2026-01-03 19:08:12,452 - ERROR - Text processing failed: 429 Resource has been exhausted (e.g. check quota).
2026-01-03 19:08:12,453 - ERROR -   ✗ No response received for topic: فتوکموتراپی با پسورالن‌ها (PUVA) > پسورالن‌ها
2026-01-03 19:08:12,453 - INFO - 
2026-01-03 19:08:12,454 - INFO - ================================================================================
2026-01-03 19:08:12,454 - INFO - PROCESSING TOPIC 15/29
2026-01-03 19:08:12,454 - INFO - ================================================================================
2026-01-03 19:08:12,454 - INFO -   Subchapter: 'فتوکموتراپی با پسورالن‌ها (PUVA)'
2026-01-03 19:08:12,454 - INFO -   Topic: 'فتوشیمی پسورالن و طیف اثر و منابع نوری'
2026-01-03 19:08:12,454 - INFO -   Number of extractions: 3
2026-01-03 19:08:12,456 - INFO -   JSON payload size: 57,608 bytes (56.26 KB)
2026-01-03 19:08:12,456 - INFO -   Sending topic JSON to model (full subchapter context with 17 topics)...
2026-01-03 19:08:12,456 - INFO -   Calling model API...
2026-01-03 19:08:14,861 - ERROR - Text processing failed: 429 Resource has been exhausted (e.g. check quota).
2026-01-03 19:08:14,862 - ERROR -   ✗ No response received for topic: فتوکموتراپی با پسورالن‌ها (PUVA) > فتوشیمی پسورالن و طیف اثر و منابع نوری
2026-01-03 19:08:14,862 - INFO - 
2026-01-03 19:08:14,862 - INFO - ================================================================================
2026-01-03 19:08:14,862 - INFO - PROCESSING TOPIC 16/29
2026-01-03 19:08:14,863 - INFO - ================================================================================
2026-01-03 19:08:14,863 - INFO -   Subchapter: 'فتوکموتراپی با پسورالن‌ها (PUVA)'
2026-01-03 19:08:14,863 - INFO -   Topic: 'اثرات فتوبیولوژیک PUVA'
2026-01-03 19:08:14,863 - INFO -   Number of extractions: 1
2026-01-03 19:08:14,865 - INFO -   JSON payload size: 57,608 bytes (56.26 KB)
2026-01-03 19:08:14,866 - INFO -   Sending topic JSON to model (full subchapter context with 17 topics)...
2026-01-03 19:08:14,866 - INFO -   Calling model API...
2026-01-03 19:08:16,993 - ERROR - Text processing failed: 429 Resource has been exhausted (e.g. check quota).
2026-01-03 19:08:16,994 - ERROR -   ✗ No response received for topic: فتوکموتراپی با پسورالن‌ها (PUVA) > اثرات فتوبیولوژیک PUVA
2026-01-03 19:08:16,995 - INFO - 
2026-01-03 19:08:16,996 - INFO - ================================================================================
2026-01-03 19:08:16,996 - INFO - PROCESSING TOPIC 17/29
2026-01-03 19:08:16,996 - INFO - ================================================================================
2026-01-03 19:08:16,996 - INFO -   Subchapter: 'فتوکموتراپی با پسورالن‌ها (PUVA)'
2026-01-03 19:08:16,996 - INFO -   Topic: 'پروتکل‌های درمانی'
2026-01-03 19:08:16,996 - INFO -   Number of extractions: 2
2026-01-03 19:08:16,999 - INFO -   JSON payload size: 57,608 bytes (56.26 KB)
2026-01-03 19:08:16,999 - INFO -   Sending topic JSON to model (full subchapter context with 17 topics)...
2026-01-03 19:08:16,999 - INFO -   Calling model API...
2026-01-03 19:08:19,228 - ERROR - Text processing failed: 429 Resource has been exhausted (e.g. check quota).
2026-01-03 19:08:19,229 - ERROR -   ✗ No response received for topic: فتوکموتراپی با پسورالن‌ها (PUVA) > پروتکل‌های درمانی
2026-01-03 19:08:19,229 - INFO - 
2026-01-03 19:08:19,229 - INFO - ================================================================================
2026-01-03 19:08:19,229 - INFO - PROCESSING TOPIC 18/29
2026-01-03 19:08:19,229 - INFO - ================================================================================
2026-01-03 19:08:19,229 - INFO -   Subchapter: 'فتوکموتراپی با پسورالن‌ها (PUVA)'
2026-01-03 19:08:19,230 - INFO -   Topic: 'مرحله درمان اولیه (پاکسازی)'
2026-01-03 19:08:19,230 - INFO -   Number of extractions: 2
2026-01-03 19:08:19,231 - INFO -   JSON payload size: 57,608 bytes (56.26 KB)
2026-01-03 19:08:19,232 - INFO -   Sending topic JSON to model (full subchapter context with 17 topics)...
2026-01-03 19:08:19,232 - INFO -   Calling model API...
2026-01-03 19:08:21,406 - ERROR - Text processing failed: 429 Resource has been exhausted (e.g. check quota).
2026-01-03 19:08:21,407 - ERROR -   ✗ No response received for topic: فتوکموتراپی با پسورالن‌ها (PUVA) > مرحله درمان اولیه (پاکسازی)
2026-01-03 19:08:21,407 - INFO - 
2026-01-03 19:08:21,408 - INFO - ================================================================================
2026-01-03 19:08:21,408 - INFO - PROCESSING TOPIC 19/29
2026-01-03 19:08:21,408 - INFO - ================================================================================
2026-01-03 19:08:21,408 - INFO -   Subchapter: 'فتوکموتراپی با پسورالن‌ها (PUVA)'
2026-01-03 19:08:21,408 - INFO -   Topic: 'مرحله نگهدارنده'
2026-01-03 19:08:21,409 - INFO -   Number of extractions: 1
2026-01-03 19:08:21,411 - INFO -   JSON payload size: 57,608 bytes (56.26 KB)
2026-01-03 19:08:21,411 - INFO -   Sending topic JSON to model (full subchapter context with 17 topics)...
2026-01-03 19:08:21,411 - INFO -   Calling model API...
2026-01-03 19:08:23,497 - ERROR - Text processing failed: 429 Resource has been exhausted (e.g. check quota).
2026-01-03 19:08:23,498 - ERROR -   ✗ No response received for topic: فتوکموتراپی با پسورالن‌ها (PUVA) > مرحله نگهدارنده
2026-01-03 19:08:23,498 - INFO - 
2026-01-03 19:08:23,499 - INFO - ================================================================================
2026-01-03 19:08:23,499 - INFO - PROCESSING TOPIC 20/29
2026-01-03 19:08:23,499 - INFO - ================================================================================
2026-01-03 19:08:23,499 - INFO -   Subchapter: 'فتوکموتراپی با پسورالن‌ها (PUVA)'
2026-01-03 19:08:23,500 - INFO -   Topic: 'PUVA برای پسوریازیس'
2026-01-03 19:08:23,500 - INFO -   Number of extractions: 2
2026-01-03 19:08:23,502 - INFO -   JSON payload size: 57,608 bytes (56.26 KB)
2026-01-03 19:08:23,502 - INFO -   Sending topic JSON to model (full subchapter context with 17 topics)...
2026-01-03 19:08:23,502 - INFO -   Calling model API...
2026-01-03 19:08:25,777 - ERROR - Text processing failed: 429 Resource has been exhausted (e.g. check quota).
2026-01-03 19:08:25,777 - ERROR -   ✗ No response received for topic: فتوکموتراپی با پسورالن‌ها (PUVA) > PUVA برای پسوریازیس
2026-01-03 19:08:25,778 - INFO - 
2026-01-03 19:08:25,778 - INFO - ================================================================================
2026-01-03 19:08:25,779 - INFO - PROCESSING TOPIC 21/29
2026-01-03 19:08:25,779 - INFO - ================================================================================
2026-01-03 19:08:25,779 - INFO -   Subchapter: 'فتوکموتراپی با پسورالن‌ها (PUVA)'
2026-01-03 19:08:25,779 - INFO -   Topic: 'درمان‌های ترکیبی'
2026-01-03 19:08:25,779 - INFO -   Number of extractions: 1
2026-01-03 19:08:25,781 - INFO -   JSON payload size: 57,608 bytes (56.26 KB)
2026-01-03 19:08:25,781 - INFO -   Sending topic JSON to model (full subchapter context with 17 topics)...
2026-01-03 19:08:25,781 - INFO -   Calling model API...
2026-01-03 19:08:28,080 - ERROR - Text processing failed: 429 Resource has been exhausted (e.g. check quota).
2026-01-03 19:08:28,081 - ERROR -   ✗ No response received for topic: فتوکموتراپی با پسورالن‌ها (PUVA) > درمان‌های ترکیبی
2026-01-03 19:08:28,081 - INFO - 
2026-01-03 19:08:28,082 - INFO - ================================================================================
2026-01-03 19:08:28,082 - INFO - PROCESSING TOPIC 22/29
2026-01-03 19:08:28,082 - INFO - ================================================================================
2026-01-03 19:08:28,082 - INFO -   Subchapter: 'فتوکموتراپی با پسورالن‌ها (PUVA)'
2026-01-03 19:08:28,082 - INFO -   Topic: 'PUVA برای لنفوم سلول T پوستی، به ویژه مایکوزیس فونگوئیدس'
2026-01-03 19:08:28,082 - INFO -   Number of extractions: 2
2026-01-03 19:08:28,084 - INFO -   JSON payload size: 57,608 bytes (56.26 KB)
2026-01-03 19:08:28,085 - INFO -   Sending topic JSON to model (full subchapter context with 17 topics)...
2026-01-03 19:08:28,085 - INFO -   Calling model API...
2026-01-03 19:08:30,287 - ERROR - Text processing failed: 429 Resource has been exhausted (e.g. check quota).
2026-01-03 19:08:30,288 - ERROR -   ✗ No response received for topic: فتوکموتراپی با پسورالن‌ها (PUVA) > PUVA برای لنفوم سلول T پوستی، به ویژه مایکوزیس فونگوئیدس
2026-01-03 19:08:30,288 - INFO - 
2026-01-03 19:08:30,289 - INFO - ================================================================================
2026-01-03 19:08:30,289 - INFO - PROCESSING TOPIC 23/29
2026-01-03 19:08:30,289 - INFO - ================================================================================
2026-01-03 19:08:30,289 - INFO -   Subchapter: 'فتوکموتراپی با پسورالن‌ها (PUVA)'
2026-01-03 19:08:30,289 - INFO -   Topic: 'PUVA برای ویتیلیگو'
2026-01-03 19:08:30,289 - INFO -   Number of extractions: 1
2026-01-03 19:08:30,291 - INFO -   JSON payload size: 57,608 bytes (56.26 KB)
2026-01-03 19:08:30,292 - INFO -   Sending topic JSON to model (full subchapter context with 17 topics)...
2026-01-03 19:08:30,292 - INFO -   Calling model API...
2026-01-03 19:08:32,477 - ERROR - Text processing failed: 429 Resource has been exhausted (e.g. check quota).
2026-01-03 19:08:32,477 - ERROR -   ✗ No response received for topic: فتوکموتراپی با پسورالن‌ها (PUVA) > PUVA برای ویتیلیگو
2026-01-03 19:08:32,477 - INFO - 
2026-01-03 19:08:32,478 - INFO - ================================================================================
2026-01-03 19:08:32,478 - INFO - PROCESSING TOPIC 24/29
2026-01-03 19:08:32,478 - INFO - ================================================================================
2026-01-03 19:08:32,478 - INFO -   Subchapter: 'فتوکموتراپی با پسورالن‌ها (PUVA)'
2026-01-03 19:08:32,478 - INFO -   Topic: 'PUVA برای درماتیت آتوپیک و PUVA برای لیکن پلان'
2026-01-03 19:08:32,478 - INFO -   Number of extractions: 1
2026-01-03 19:08:32,480 - INFO -   JSON payload size: 57,608 bytes (56.26 KB)
2026-01-03 19:08:32,480 - INFO -   Sending topic JSON to model (full subchapter context with 17 topics)...
2026-01-03 19:08:32,481 - INFO -   Calling model API...
2026-01-03 19:08:34,639 - ERROR - Text processing failed: 429 Resource has been exhausted (e.g. check quota).
2026-01-03 19:08:34,640 - ERROR -   ✗ No response received for topic: فتوکموتراپی با پسورالن‌ها (PUVA) > PUVA برای درماتیت آتوپیک و PUVA برای لیکن پلان
2026-01-03 19:08:34,640 - INFO - 
2026-01-03 19:08:34,641 - INFO - ================================================================================
2026-01-03 19:08:34,641 - INFO - PROCESSING TOPIC 25/29
2026-01-03 19:08:34,641 - INFO - ================================================================================
2026-01-03 19:08:34,641 - INFO -   Subchapter: 'فتوکموتراپی با پسورالن‌ها (PUVA)'
2026-01-03 19:08:34,642 - INFO -   Topic: 'PUVA برای بیماری پیوند علیه میزبان'
2026-01-03 19:08:34,642 - INFO -   Number of extractions: 1
2026-01-03 19:08:34,644 - INFO -   JSON payload size: 57,608 bytes (56.26 KB)
2026-01-03 19:08:34,644 - INFO -   Sending topic JSON to model (full subchapter context with 17 topics)...
2026-01-03 19:08:34,645 - INFO -   Calling model API...
2026-01-03 19:08:36,854 - ERROR - Text processing failed: 429 Resource has been exhausted (e.g. check quota).
2026-01-03 19:08:36,855 - ERROR -   ✗ No response received for topic: فتوکموتراپی با پسورالن‌ها (PUVA) > PUVA برای بیماری پیوند علیه میزبان
2026-01-03 19:08:36,856 - INFO - 
2026-01-03 19:08:36,856 - INFO - ================================================================================
2026-01-03 19:08:36,856 - INFO - PROCESSING TOPIC 26/29
2026-01-03 19:08:36,856 - INFO - ================================================================================
2026-01-03 19:08:36,857 - INFO -   Subchapter: 'فتوکموتراپی با پسورالن‌ها (PUVA)'
2026-01-03 19:08:36,857 - INFO -   Topic: 'PUVA برای کهیر پیگمنتوزا و PUVA برای درماتوزهای متفرقه'
2026-01-03 19:08:36,857 - INFO -   Number of extractions: 1
2026-01-03 19:08:36,859 - INFO -   JSON payload size: 57,608 bytes (56.26 KB)
2026-01-03 19:08:36,859 - INFO -   Sending topic JSON to model (full subchapter context with 17 topics)...
2026-01-03 19:08:36,859 - INFO -   Calling model API...
2026-01-03 19:08:39,062 - ERROR - Text processing failed: 429 Resource has been exhausted (e.g. check quota).
2026-01-03 19:08:39,063 - ERROR -   ✗ No response received for topic: فتوکموتراپی با پسورالن‌ها (PUVA) > PUVA برای کهیر پیگمنتوزا و PUVA برای درماتوزهای متفرقه
2026-01-03 19:08:39,063 - INFO - 
2026-01-03 19:08:39,064 - INFO - ================================================================================
2026-01-03 19:08:39,064 - INFO - PROCESSING TOPIC 27/29
2026-01-03 19:08:39,064 - INFO - ================================================================================
2026-01-03 19:08:39,064 - INFO -   Subchapter: 'فتوکموتراپی با پسورالن‌ها (PUVA)'
2026-01-03 19:08:39,064 - INFO -   Topic: 'PUVA برای فتودرماتوزها'
2026-01-03 19:08:39,064 - INFO -   Number of extractions: 1
2026-01-03 19:08:39,066 - INFO -   JSON payload size: 57,608 bytes (56.26 KB)
2026-01-03 19:08:39,066 - INFO -   Sending topic JSON to model (full subchapter context with 17 topics)...
2026-01-03 19:08:39,067 - INFO -   Calling model API...
2026-01-03 19:08:41,163 - ERROR - Text processing failed: 429 Resource has been exhausted (e.g. check quota).
2026-01-03 19:08:41,163 - ERROR -   ✗ No response received for topic: فتوکموتراپی با پسورالن‌ها (PUVA) > PUVA برای فتودرماتوزها
2026-01-03 19:08:41,164 - INFO - 
2026-01-03 19:08:41,164 - INFO - ================================================================================
2026-01-03 19:08:41,164 - INFO - PROCESSING TOPIC 28/29
2026-01-03 19:08:41,165 - INFO - ================================================================================
2026-01-03 19:08:41,165 - INFO -   Subchapter: 'فتوکموتراپی با پسورالن‌ها (PUVA)'
2026-01-03 19:08:41,165 - INFO -   Topic: 'عوارض جانبی و خطرات بلندمدت PUVA'
2026-01-03 19:08:41,165 - INFO -   Number of extractions: 2
2026-01-03 19:08:41,167 - INFO -   JSON payload size: 57,608 bytes (56.26 KB)
2026-01-03 19:08:41,167 - INFO -   Sending topic JSON to model (full subchapter context with 17 topics)...
2026-01-03 19:08:41,167 - INFO -   Calling model API...
2026-01-03 19:08:43,296 - ERROR - Text processing failed: 429 Resource has been exhausted (e.g. check quota).
2026-01-03 19:08:43,297 - ERROR -   ✗ No response received for topic: فتوکموتراپی با پسورالن‌ها (PUVA) > عوارض جانبی و خطرات بلندمدت PUVA
2026-01-03 19:08:43,297 - INFO - 
2026-01-03 19:08:43,297 - INFO - ================================================================================
2026-01-03 19:08:43,297 - INFO - PROCESSING TOPIC 29/29
2026-01-03 19:08:43,297 - INFO - ================================================================================
2026-01-03 19:08:43,297 - INFO -   Subchapter: 'فتوکموتراپی با پسورالن‌ها (PUVA)'
2026-01-03 19:08:43,298 - INFO -   Topic: 'UVB و PUVA در بیماران آلوده به HIV'
2026-01-03 19:08:43,298 - INFO -   Number of extractions: 1
2026-01-03 19:08:43,300 - INFO -   JSON payload size: 57,608 bytes (56.26 KB)
2026-01-03 19:08:43,300 - INFO -   Sending topic JSON to model (full subchapter context with 17 topics)...
2026-01-03 19:08:43,300 - INFO -   Calling model API...
2026-01-03 19:08:45,512 - ERROR - Text processing failed: 429 Resource has been exhausted (e.g. check quota).
2026-01-03 19:08:45,513 - ERROR -   ✗ No response received for topic: فتوکموتراپی با پسورالن‌ها (PUVA) > UVB و PUVA در بیماران آلوده به HIV
2026-01-03 19:08:45,514 - INFO - 
2026-01-03 19:08:45,514 - INFO - ================================================================================
2026-01-03 19:08:45,514 - INFO - SAVING TXT FILES FOR EACH SUBCHAPTER
2026-01-03 19:08:45,515 - INFO - ================================================================================
2026-01-03 19:08:45,515 - INFO - Saved subchapter 'فتوتراپی با لیزر یا لامپ اگزایمر 308 نانومتر' response to: /home/shahmir/Downloads/OCR Extraction_subchapter_3_فتوتراپی_با_لیزر_یا_لامپ_اگزایمر_308_نانومتر.txt (1 topics)
2026-01-03 19:08:45,516 - INFO - ================================================================================
2026-01-03 19:08:45,516 - INFO - ================================================================================
2026-01-03 19:08:45,517 - INFO - EXTRACTING JSON BLOCKS FROM RESPONSES
2026-01-03 19:08:45,518 - INFO - ================================================================================
2026-01-03 19:08:45,518 - INFO - Extracting JSON blocks from 1 responses (one per topic)...
2026-01-03 19:08:45,519 - INFO -   Topic 1/1: 'فتوتراپی با لیزر یا لامپ اگزایمر 308 نانومتر' > 'فتوتراپی با لیزر یا لامپ اگزایمر 308 نانومتر'
2026-01-03 19:08:45,520 - INFO -     ✓ Extracted 1 JSON block(s)
2026-01-03 19:08:45,520 - INFO - Total JSON blocks extracted: 1
2026-01-03 19:08:45,521 - INFO - ================================================================================
2026-01-03 19:08:45,521 - INFO - ================================================================================
2026-01-03 19:08:45,521 - INFO - CALCULATING POINTS PER SUBCHAPTER
2026-01-03 19:08:45,521 - INFO - ================================================================================
2026-01-03 19:08:45,521 - INFO - Combining 1 JSON block(s) into final structure...
2026-01-03 19:08:45,521 - INFO - Final structure: chapter 'درمان با اشعه ماوراء بنفش' with 1 content items
2026-01-03 19:08:45,522 - INFO - Processing chapter: 'درمان با اشعه ماوراء بنفش' with 1 top-level items
2026-01-03 19:08:45,522 - INFO -   Subchapter 'فتوتراپی با لیزر یا لامپ اگزایمر 308 نانومتر': 24 points (1 topics)
2026-01-03 19:08:45,523 - INFO - ================================================================================
2026-01-03 19:08:45,523 - INFO - Combining JSON blocks into final structure...
2026-01-03 19:08:45,523 - INFO - Combining 1 JSON block(s) into final structure...
2026-01-03 19:08:45,523 - INFO - Final structure: chapter 'درمان با اشعه ماوراء بنفش' with 1 content items
2026-01-03 19:08:45,523 - INFO - Flattening hierarchical structure to points...
2026-01-03 19:08:45,524 - INFO - Processing chapter: 'درمان با اشعه ماوراء بنفش' with 1 top-level items
2026-01-03 19:08:45,524 - INFO - Extracted 24 points from Document Processing
2026-01-03 19:08:45,524 - INFO - Assigning PointId and chapter/subchapter/topic to 24 points (starting from 1)...
2026-01-03 19:08:45,525 - INFO - ================================================================================
2026-01-03 19:08:45,525 - INFO - ASSIGNING POINT IDs AND SUBCHAPTER INFO
2026-01-03 19:08:45,525 - INFO - ================================================================================
2026-01-03 19:08:45,526 - INFO - Using tracked points per subchapter for correct mapping:
2026-01-03 19:08:45,526 - INFO -   Subchapter 'فتوتراپی با لیزر یا لامپ اگزایمر 308 نانومتر': 24 points
2026-01-03 19:08:45,527 - INFO - Total tracked points: 24, Actual flattened points: 24
2026-01-03 19:08:45,527 - INFO -   Assigning PointIds for subchapter 'فتوتراپی با لیزر یا لامپ اگزایمر 308 نانومتر' (24 points)...
2026-01-03 19:08:45,527 - INFO -     ✓ Assigned 24 PointIds for subchapter 'فتوتراپی با لیزر یا لامپ اگزایمر 308 نانومتر'
2026-01-03 19:08:45,527 - INFO - ================================================================================
2026-01-03 19:08:45,528 - INFO - Saving Document Processing output to: /home/shahmir/Downloads/Lesson_file_120_134.json
2026-01-03 19:08:45,529 - INFO - Document Processing completed successfully: /home/shahmir/Downloads/Lesson_file_120_134.json
2026-01-03 19:18:59,539 - INFO - [get_default_model] ComboBox value: gemini-2.5-pro, StringVar value: gemini-2.5-pro
2026-01-03 19:18:59,541 - INFO - [get_default_model] Returning model from ComboBox: gemini-2.5-pro
2026-01-03 19:18:59,541 - INFO - Loading OCR Extraction JSON: /home/shahmir/Downloads/OCR Extraction.json
2026-01-03 19:18:59,543 - INFO - Chapter name from input JSON: درمان با اشعه ماوراء بنفش
2026-01-03 19:18:59,543 - INFO - ================================================================================
2026-01-03 19:18:59,543 - INFO - DOCUMENT PROCESSING - PROCESSING BY TOPIC
2026-01-03 19:18:59,544 - INFO - ================================================================================
2026-01-03 19:18:59,544 - INFO - Found 29 topics to process
2026-01-03 19:18:59,544 - INFO - Found 4 unique subchapters
2026-01-03 19:18:59,544 - INFO - 
2026-01-03 19:18:59,544 - INFO -   Subchapter 1: 'فتوتراپی با UVA1' - 1 topics
2026-01-03 19:18:59,545 - INFO -     Topic 1: 'عوارض جانبی فتوتراپی با UVA1'
2026-01-03 19:18:59,545 - INFO -   Subchapter 2: 'فتوتراپی با UVB' - 10 topics
2026-01-03 19:18:59,545 - INFO -     Topic 1: 'جنبه‌های تاریخی'
2026-01-03 19:18:59,545 - INFO -     Topic 2: 'اصول و مکانیسم‌ها'
2026-01-03 19:18:59,546 - INFO -     Topic 3: 'طیف اثر و منابع تابش'
2026-01-03 19:18:59,546 - INFO -     Topic 4: 'پروتکل‌های درمانی'
2026-01-03 19:18:59,546 - INFO -     Topic 5: 'فتوتراپی برای پسوریازیس'
2026-01-03 19:18:59,546 - INFO -     Topic 6: 'فتوتراپی برای لنفوم سلول T پوستی، به ویژه مایكوزیس فونگوئیدس'
2026-01-03 19:18:59,546 - INFO -     Topic 7: 'فتوتراپی برای ویتیلیگو'
2026-01-03 19:18:59,547 - INFO -     Topic 8: 'فتوتراپی برای درماتیت آتوپیک و فتوتراپی برای فتودرماتوزها'
2026-01-03 19:18:59,547 - INFO -     Topic 9: 'فتوتراپی برای پیتیریازیس لیکنوئیدس، فتوتراپی برای درماتیت سبورئیک و فتوتراپی برای خارش'
2026-01-03 19:18:59,547 - INFO -     Topic 10: 'عوارض جانبی فتوتراپی با UVB'
2026-01-03 19:18:59,547 - INFO -   Subchapter 3: 'فتوتراپی با لیزر یا لامپ اگزایمر 308 نانومتر' - 1 topics
2026-01-03 19:18:59,547 - INFO -     Topic 1: 'فتوتراپی با لیزر یا لامپ اگزایمر 308 نانومتر'
2026-01-03 19:18:59,548 - INFO -   Subchapter 4: 'فتوکموتراپی با پسورالن‌ها (PUVA)' - 17 topics
2026-01-03 19:18:59,548 - INFO -     Topic 1: 'جنبه‌های تاریخی'
2026-01-03 19:18:59,548 - INFO -     Topic 2: 'پسورالن‌ها'
2026-01-03 19:18:59,548 - INFO -     Topic 3: 'فتوشیمی پسورالن و طیف اثر و منابع نوری'
2026-01-03 19:18:59,548 - INFO -     Topic 4: 'اثرات فتوبیولوژیک PUVA'
2026-01-03 19:18:59,549 - INFO -     Topic 5: 'پروتکل‌های درمانی'
2026-01-03 19:18:59,549 - INFO -     Topic 6: 'مرحله درمان اولیه (پاکسازی)'
2026-01-03 19:18:59,549 - INFO -     Topic 7: 'مرحله نگهدارنده'
2026-01-03 19:18:59,549 - INFO -     Topic 8: 'PUVA برای پسوریازیس'
2026-01-03 19:18:59,550 - INFO -     Topic 9: 'درمان‌های ترکیبی'
2026-01-03 19:18:59,550 - INFO -     Topic 10: 'PUVA برای لنفوم سلول T پوستی، به ویژه مایکوزیس فونگوئیدس'
2026-01-03 19:18:59,550 - INFO -     Topic 11: 'PUVA برای ویتیلیگو'
2026-01-03 19:18:59,550 - INFO -     Topic 12: 'PUVA برای درماتیت آتوپیک و PUVA برای لیکن پلان'
2026-01-03 19:18:59,550 - INFO -     Topic 13: 'PUVA برای بیماری پیوند علیه میزبان'
2026-01-03 19:18:59,551 - INFO -     Topic 14: 'PUVA برای کهیر پیگمنتوزا و PUVA برای درماتوزهای متفرقه'
2026-01-03 19:18:59,551 - INFO -     Topic 15: 'PUVA برای فتودرماتوزها'
2026-01-03 19:18:59,551 - INFO -     Topic 16: 'عوارض جانبی و خطرات بلندمدت PUVA'
2026-01-03 19:18:59,551 - INFO -     Topic 17: 'UVB و PUVA در بیماران آلوده به HIV'
2026-01-03 19:18:59,551 - INFO - ================================================================================
2026-01-03 19:18:59,552 - INFO - 
2026-01-03 19:18:59,552 - INFO - ================================================================================
2026-01-03 19:18:59,552 - INFO - PROCESSING TOPIC 1/29
2026-01-03 19:18:59,552 - INFO - ================================================================================
2026-01-03 19:18:59,553 - INFO -   Subchapter: 'فتوتراپی با UVB'
2026-01-03 19:18:59,553 - INFO -   Topic: 'جنبه‌های تاریخی'
2026-01-03 19:18:59,553 - INFO -   Number of extractions: 1
2026-01-03 19:18:59,555 - INFO -   JSON payload size: 29,103 bytes (28.42 KB)
2026-01-03 19:18:59,555 - INFO -   Sending topic JSON to model (full subchapter context with 10 topics)...
2026-01-03 19:18:59,555 - INFO -   Calling model API...
2026-01-03 19:19:02,856 - ERROR - Text processing failed: 429 Resource has been exhausted (e.g. check quota).
2026-01-03 19:19:02,857 - ERROR -   ✗ No response received for topic: فتوتراپی با UVB > جنبه‌های تاریخی
2026-01-03 19:19:02,858 - INFO - 
2026-01-03 19:19:02,858 - INFO - ================================================================================
2026-01-03 19:19:02,858 - INFO - PROCESSING TOPIC 2/29
2026-01-03 19:19:02,859 - INFO - ================================================================================
2026-01-03 19:19:02,859 - INFO -   Subchapter: 'فتوتراپی با UVB'
2026-01-03 19:19:02,859 - INFO -   Topic: 'اصول و مکانیسم‌ها'
2026-01-03 19:19:02,860 - INFO -   Number of extractions: 1
2026-01-03 19:19:02,862 - INFO -   JSON payload size: 29,103 bytes (28.42 KB)
2026-01-03 19:19:02,862 - INFO -   Sending topic JSON to model (full subchapter context with 10 topics)...
2026-01-03 19:19:02,862 - INFO -   Calling model API...
2026-01-03 19:19:04,523 - ERROR - Text processing failed: 429 Resource has been exhausted (e.g. check quota).
2026-01-03 19:19:04,523 - ERROR -   ✗ No response received for topic: فتوتراپی با UVB > اصول و مکانیسم‌ها
2026-01-03 19:19:04,524 - INFO - 
2026-01-03 19:19:04,524 - INFO - ================================================================================
2026-01-03 19:19:04,524 - INFO - PROCESSING TOPIC 3/29
2026-01-03 19:19:04,524 - INFO - ================================================================================
2026-01-03 19:19:04,525 - INFO -   Subchapter: 'فتوتراپی با UVB'
2026-01-03 19:19:04,525 - INFO -   Topic: 'طیف اثر و منابع تابش'
2026-01-03 19:19:04,525 - INFO -   Number of extractions: 3
2026-01-03 19:19:04,527 - INFO -   JSON payload size: 29,103 bytes (28.42 KB)
2026-01-03 19:19:04,527 - INFO -   Sending topic JSON to model (full subchapter context with 10 topics)...
2026-01-03 19:19:04,527 - INFO -   Calling model API...
2026-01-03 19:19:06,286 - ERROR - Text processing failed: 429 Resource has been exhausted (e.g. check quota).
2026-01-03 19:19:06,288 - ERROR -   ✗ No response received for topic: فتوتراپی با UVB > طیف اثر و منابع تابش
2026-01-03 19:19:06,288 - INFO - 
2026-01-03 19:19:06,288 - INFO - ================================================================================
2026-01-03 19:19:06,289 - INFO - PROCESSING TOPIC 4/29
2026-01-03 19:19:06,289 - INFO - ================================================================================
2026-01-03 19:19:06,289 - INFO -   Subchapter: 'فتوتراپی با UVB'
2026-01-03 19:19:06,289 - INFO -   Topic: 'پروتکل‌های درمانی'
2026-01-03 19:19:06,289 - INFO -   Number of extractions: 4
2026-01-03 19:19:06,290 - INFO -   JSON payload size: 29,103 bytes (28.42 KB)
2026-01-03 19:19:06,290 - INFO -   Sending topic JSON to model (full subchapter context with 10 topics)...
2026-01-03 19:19:06,290 - INFO -   Calling model API...
2026-01-03 19:19:07,904 - ERROR - Text processing failed: 429 Resource has been exhausted (e.g. check quota).
2026-01-03 19:19:07,904 - ERROR -   ✗ No response received for topic: فتوتراپی با UVB > پروتکل‌های درمانی
2026-01-03 19:19:07,905 - INFO - 
2026-01-03 19:19:07,905 - INFO - ================================================================================
2026-01-03 19:19:07,905 - INFO - PROCESSING TOPIC 5/29
2026-01-03 19:19:07,906 - INFO - ================================================================================
2026-01-03 19:19:07,906 - INFO -   Subchapter: 'فتوتراپی با UVB'
2026-01-03 19:19:07,906 - INFO -   Topic: 'فتوتراپی برای پسوریازیس'
2026-01-03 19:19:07,906 - INFO -   Number of extractions: 1
2026-01-03 19:19:07,907 - INFO -   JSON payload size: 29,103 bytes (28.42 KB)
2026-01-03 19:19:07,907 - INFO -   Sending topic JSON to model (full subchapter context with 10 topics)...
2026-01-03 19:19:07,907 - INFO -   Calling model API...
2026-01-03 19:19:09,285 - ERROR - Text processing failed: 429 Resource has been exhausted (e.g. check quota).
2026-01-03 19:19:09,286 - ERROR -   ✗ No response received for topic: فتوتراپی با UVB > فتوتراپی برای پسوریازیس
2026-01-03 19:19:09,287 - INFO - 
2026-01-03 19:19:09,287 - INFO - ================================================================================
2026-01-03 19:19:09,287 - INFO - PROCESSING TOPIC 6/29
2026-01-03 19:19:09,288 - INFO - ================================================================================
2026-01-03 19:19:09,288 - INFO -   Subchapter: 'فتوتراپی با UVB'
2026-01-03 19:19:09,288 - INFO -   Topic: 'فتوتراپی برای لنفوم سلول T پوستی، به ویژه مایكوزیس فونگوئیدس'
2026-01-03 19:19:09,288 - INFO -   Number of extractions: 1
2026-01-03 19:19:09,289 - INFO -   JSON payload size: 29,103 bytes (28.42 KB)
2026-01-03 19:19:09,289 - INFO -   Sending topic JSON to model (full subchapter context with 10 topics)...
2026-01-03 19:19:09,290 - INFO -   Calling model API...
2026-01-03 19:19:11,028 - ERROR - Text processing failed: 429 Resource has been exhausted (e.g. check quota).
2026-01-03 19:19:11,029 - ERROR -   ✗ No response received for topic: فتوتراپی با UVB > فتوتراپی برای لنفوم سلول T پوستی، به ویژه مایكوزیس فونگوئیدس
2026-01-03 19:19:11,030 - INFO - 
2026-01-03 19:19:11,030 - INFO - ================================================================================
2026-01-03 19:19:11,030 - INFO - PROCESSING TOPIC 7/29
2026-01-03 19:19:11,030 - INFO - ================================================================================
2026-01-03 19:19:11,030 - INFO -   Subchapter: 'فتوتراپی با UVB'
2026-01-03 19:19:11,031 - INFO -   Topic: 'فتوتراپی برای ویتیلیگو'
2026-01-03 19:19:11,031 - INFO -   Number of extractions: 2
2026-01-03 19:19:11,032 - INFO -   JSON payload size: 29,103 bytes (28.42 KB)
2026-01-03 19:19:11,032 - INFO -   Sending topic JSON to model (full subchapter context with 10 topics)...
2026-01-03 19:19:11,032 - INFO -   Calling model API...
2026-01-03 19:19:12,507 - ERROR - Text processing failed: 429 Resource has been exhausted (e.g. check quota).
2026-01-03 19:19:12,508 - ERROR -   ✗ No response received for topic: فتوتراپی با UVB > فتوتراپی برای ویتیلیگو
2026-01-03 19:19:12,509 - INFO - 
2026-01-03 19:19:12,509 - INFO - ================================================================================
2026-01-03 19:19:12,510 - INFO - PROCESSING TOPIC 8/29
2026-01-03 19:19:12,510 - INFO - ================================================================================
2026-01-03 19:19:12,510 - INFO -   Subchapter: 'فتوتراپی با UVB'
2026-01-03 19:19:12,510 - INFO -   Topic: 'فتوتراپی برای درماتیت آتوپیک و فتوتراپی برای فتودرماتوزها'
2026-01-03 19:19:12,510 - INFO -   Number of extractions: 1
2026-01-03 19:19:12,512 - INFO -   JSON payload size: 29,103 bytes (28.42 KB)
2026-01-03 19:19:12,512 - INFO -   Sending topic JSON to model (full subchapter context with 10 topics)...
2026-01-03 19:19:12,512 - INFO -   Calling model API...
2026-01-03 19:19:13,786 - ERROR - Text processing failed: 429 Resource has been exhausted (e.g. check quota).
2026-01-03 19:19:13,786 - ERROR -   ✗ No response received for topic: فتوتراپی با UVB > فتوتراپی برای درماتیت آتوپیک و فتوتراپی برای فتودرماتوزها
2026-01-03 19:19:13,787 - INFO - 
2026-01-03 19:19:13,787 - INFO - ================================================================================
2026-01-03 19:19:13,788 - INFO - PROCESSING TOPIC 9/29
2026-01-03 19:19:13,788 - INFO - ================================================================================
2026-01-03 19:19:13,788 - INFO -   Subchapter: 'فتوتراپی با UVB'
2026-01-03 19:19:13,789 - INFO -   Topic: 'فتوتراپی برای پیتیریازیس لیکنوئیدس، فتوتراپی برای درماتیت سبورئیک و فتوتراپی برای خارش'
2026-01-03 19:19:13,789 - INFO -   Number of extractions: 1
2026-01-03 19:19:13,790 - INFO -   JSON payload size: 29,103 bytes (28.42 KB)
2026-01-03 19:19:13,791 - INFO -   Sending topic JSON to model (full subchapter context with 10 topics)...
2026-01-03 19:19:13,791 - INFO -   Calling model API...
2026-01-03 19:19:15,088 - ERROR - Text processing failed: 429 Resource has been exhausted (e.g. check quota).
2026-01-03 19:19:15,089 - ERROR -   ✗ No response received for topic: فتوتراپی با UVB > فتوتراپی برای پیتیریازیس لیکنوئیدس، فتوتراپی برای درماتیت سبورئیک و فتوتراپی برای خارش
2026-01-03 19:19:15,090 - INFO - 
2026-01-03 19:19:15,090 - INFO - ================================================================================
2026-01-03 19:19:15,091 - INFO - PROCESSING TOPIC 10/29
2026-01-03 19:19:15,091 - INFO - ================================================================================
2026-01-03 19:19:15,091 - INFO -   Subchapter: 'فتوتراپی با UVB'
2026-01-03 19:19:15,092 - INFO -   Topic: 'عوارض جانبی فتوتراپی با UVB'
2026-01-03 19:19:15,092 - INFO -   Number of extractions: 2
2026-01-03 19:19:15,093 - INFO -   JSON payload size: 29,103 bytes (28.42 KB)
2026-01-03 19:19:15,093 - INFO -   Sending topic JSON to model (full subchapter context with 10 topics)...
2026-01-03 19:19:15,093 - INFO -   Calling model API...
2026-01-03 19:19:16,331 - ERROR - Text processing failed: 429 Resource has been exhausted (e.g. check quota).
2026-01-03 19:19:16,332 - ERROR -   ✗ No response received for topic: فتوتراپی با UVB > عوارض جانبی فتوتراپی با UVB
2026-01-03 19:19:16,333 - INFO - 
2026-01-03 19:19:16,333 - INFO - ================================================================================
2026-01-03 19:19:16,333 - INFO - PROCESSING TOPIC 11/29
2026-01-03 19:19:16,333 - INFO - ================================================================================
2026-01-03 19:19:16,333 - INFO -   Subchapter: 'فتوتراپی با لیزر یا لامپ اگزایمر 308 نانومتر'
2026-01-03 19:19:16,333 - INFO -   Topic: 'فتوتراپی با لیزر یا لامپ اگزایمر 308 نانومتر'
2026-01-03 19:19:16,334 - INFO -   Number of extractions: 1
2026-01-03 19:19:16,334 - INFO -   JSON payload size: 1,943 bytes (1.90 KB)
2026-01-03 19:19:16,334 - INFO -   Sending topic JSON to model (full subchapter context with 1 topics)...
2026-01-03 19:19:16,334 - INFO -   Calling model API...
2026-01-03 19:19:36,264 - INFO - Loaded 14 predefined prompts
2026-01-03 19:19:36,281 - INFO - python-docx library is available
2026-01-03 19:19:36,281 - INFO - python-docx library is available
2026-01-03 19:20:05,580 - INFO - Loaded 3 API keys
2026-01-03 19:21:13,080 - INFO - [get_default_model] ComboBox value: gemini-2.5-pro, StringVar value: gemini-2.5-pro
2026-01-03 19:21:13,081 - INFO - [get_default_model] Returning model from ComboBox: gemini-2.5-pro
2026-01-03 19:21:13,082 - INFO - Loading OCR Extraction JSON: /home/shahmir/Downloads/OCR Extraction.json
2026-01-03 19:21:13,083 - INFO - Chapter name from input JSON: درمان با اشعه ماوراء بنفش
2026-01-03 19:21:13,083 - INFO - ================================================================================
2026-01-03 19:21:13,084 - INFO - DOCUMENT PROCESSING - PROCESSING BY TOPIC
2026-01-03 19:21:13,084 - INFO - ================================================================================
2026-01-03 19:21:13,084 - INFO - Found 29 topics to process
2026-01-03 19:21:13,084 - INFO - Found 4 unique subchapters
2026-01-03 19:21:13,084 - INFO - 
2026-01-03 19:21:13,084 - INFO -   Subchapter 1: 'فتوتراپی با UVA1' - 1 topics
2026-01-03 19:21:13,085 - INFO -     Topic 1: 'عوارض جانبی فتوتراپی با UVA1'
2026-01-03 19:21:13,085 - INFO -   Subchapter 2: 'فتوتراپی با UVB' - 10 topics
2026-01-03 19:21:13,085 - INFO -     Topic 1: 'جنبه‌های تاریخی'
2026-01-03 19:21:13,085 - INFO -     Topic 2: 'اصول و مکانیسم‌ها'
2026-01-03 19:21:13,085 - INFO -     Topic 3: 'طیف اثر و منابع تابش'
2026-01-03 19:21:13,085 - INFO -     Topic 4: 'پروتکل‌های درمانی'
2026-01-03 19:21:13,085 - INFO -     Topic 5: 'فتوتراپی برای پسوریازیس'
2026-01-03 19:21:13,085 - INFO -     Topic 6: 'فتوتراپی برای لنفوم سلول T پوستی، به ویژه مایكوزیس فونگوئیدس'
2026-01-03 19:21:13,086 - INFO -     Topic 7: 'فتوتراپی برای ویتیلیگو'
2026-01-03 19:21:13,086 - INFO -     Topic 8: 'فتوتراپی برای درماتیت آتوپیک و فتوتراپی برای فتودرماتوزها'
2026-01-03 19:21:13,086 - INFO -     Topic 9: 'فتوتراپی برای پیتیریازیس لیکنوئیدس، فتوتراپی برای درماتیت سبورئیک و فتوتراپی برای خارش'
2026-01-03 19:21:13,086 - INFO -     Topic 10: 'عوارض جانبی فتوتراپی با UVB'
2026-01-03 19:21:13,086 - INFO -   Subchapter 3: 'فتوتراپی با لیزر یا لامپ اگزایمر 308 نانومتر' - 1 topics
2026-01-03 19:21:13,087 - INFO -     Topic 1: 'فتوتراپی با لیزر یا لامپ اگزایمر 308 نانومتر'
2026-01-03 19:21:13,087 - INFO -   Subchapter 4: 'فتوکموتراپی با پسورالن‌ها (PUVA)' - 17 topics
2026-01-03 19:21:13,087 - INFO -     Topic 1: 'جنبه‌های تاریخی'
2026-01-03 19:21:13,087 - INFO -     Topic 2: 'پسورالن‌ها'
2026-01-03 19:21:13,087 - INFO -     Topic 3: 'فتوشیمی پسورالن و طیف اثر و منابع نوری'
2026-01-03 19:21:13,087 - INFO -     Topic 4: 'اثرات فتوبیولوژیک PUVA'
2026-01-03 19:21:13,087 - INFO -     Topic 5: 'پروتکل‌های درمانی'
2026-01-03 19:21:13,088 - INFO -     Topic 6: 'مرحله درمان اولیه (پاکسازی)'
2026-01-03 19:21:13,088 - INFO -     Topic 7: 'مرحله نگهدارنده'
2026-01-03 19:21:13,088 - INFO -     Topic 8: 'PUVA برای پسوریازیس'
2026-01-03 19:21:13,088 - INFO -     Topic 9: 'درمان‌های ترکیبی'
2026-01-03 19:21:13,088 - INFO -     Topic 10: 'PUVA برای لنفوم سلول T پوستی، به ویژه مایکوزیس فونگوئیدس'
2026-01-03 19:21:13,088 - INFO -     Topic 11: 'PUVA برای ویتیلیگو'
2026-01-03 19:21:13,089 - INFO -     Topic 12: 'PUVA برای درماتیت آتوپیک و PUVA برای لیکن پلان'
2026-01-03 19:21:13,089 - INFO -     Topic 13: 'PUVA برای بیماری پیوند علیه میزبان'
2026-01-03 19:21:13,089 - INFO -     Topic 14: 'PUVA برای کهیر پیگمنتوزا و PUVA برای درماتوزهای متفرقه'
2026-01-03 19:21:13,089 - INFO -     Topic 15: 'PUVA برای فتودرماتوزها'
2026-01-03 19:21:13,089 - INFO -     Topic 16: 'عوارض جانبی و خطرات بلندمدت PUVA'
2026-01-03 19:21:13,089 - INFO -     Topic 17: 'UVB و PUVA در بیماران آلوده به HIV'
2026-01-03 19:21:13,089 - INFO - ================================================================================
2026-01-03 19:21:13,090 - INFO - 
2026-01-03 19:21:13,090 - INFO - ================================================================================
2026-01-03 19:21:13,090 - INFO - PROCESSING TOPIC 1/29
2026-01-03 19:21:13,090 - INFO - ================================================================================
2026-01-03 19:21:13,090 - INFO -   Subchapter: 'فتوتراپی با UVB'
2026-01-03 19:21:13,090 - INFO -   Topic: 'جنبه‌های تاریخی'
2026-01-03 19:21:13,091 - INFO -   Number of extractions: 1
2026-01-03 19:21:13,092 - INFO -   JSON payload size: 29,103 bytes (28.42 KB)
2026-01-03 19:21:13,092 - INFO -   Sending topic JSON to model (full subchapter context with 10 topics)...
2026-01-03 19:21:13,092 - INFO -   Calling model API...
2026-01-03 19:21:13,092 - INFO - Initialized/recreated text client with model: gemini-2.5-pro
2026-01-03 19:21:42,982 - INFO - Text processed successfully with gemini-2.5-pro
2026-01-03 19:21:42,983 - INFO -   ✓ Topic 'جنبه‌های تاریخی' processed successfully
2026-01-03 19:21:42,984 - INFO -   Response size: 2,939 bytes (2.87 KB)
2026-01-03 19:21:42,984 - INFO -   Response length: 2,142 characters
2026-01-03 19:21:42,984 - INFO -   ✓ Topic 'جنبه‌های تاریخی' completed
2026-01-03 19:21:42,984 - INFO - ================================================================================
2026-01-03 19:21:42,984 - INFO - 
2026-01-03 19:21:42,985 - INFO - ================================================================================
2026-01-03 19:21:42,985 - INFO - PROCESSING TOPIC 2/29
2026-01-03 19:21:42,985 - INFO - ================================================================================
2026-01-03 19:21:42,985 - INFO -   Subchapter: 'فتوتراپی با UVB'
2026-01-03 19:21:42,985 - INFO -   Topic: 'اصول و مکانیسم‌ها'
2026-01-03 19:21:42,985 - INFO -   Number of extractions: 1
2026-01-03 19:21:42,987 - INFO -   JSON payload size: 29,103 bytes (28.42 KB)
2026-01-03 19:21:42,987 - INFO -   Sending topic JSON to model (full subchapter context with 10 topics)...
2026-01-03 19:21:42,987 - INFO -   Calling model API...
2026-01-03 19:22:16,489 - INFO - Text processed successfully with gemini-2.5-pro
2026-01-03 19:22:16,490 - INFO -   ✓ Topic 'اصول و مکانیسم‌ها' processed successfully
2026-01-03 19:22:16,490 - INFO -   Response size: 6,528 bytes (6.38 KB)
2026-01-03 19:22:16,491 - INFO -   Response length: 4,617 characters
2026-01-03 19:22:16,491 - INFO -   ✓ Topic 'اصول و مکانیسم‌ها' completed
2026-01-03 19:22:16,491 - INFO - ================================================================================
2026-01-03 19:22:16,491 - INFO - 
2026-01-03 19:22:16,491 - INFO - ================================================================================
2026-01-03 19:22:16,492 - INFO - PROCESSING TOPIC 3/29
2026-01-03 19:22:16,492 - INFO - ================================================================================
2026-01-03 19:22:16,492 - INFO -   Subchapter: 'فتوتراپی با UVB'
2026-01-03 19:22:16,492 - INFO -   Topic: 'طیف اثر و منابع تابش'
2026-01-03 19:22:16,492 - INFO -   Number of extractions: 3
2026-01-03 19:22:16,493 - INFO -   JSON payload size: 29,103 bytes (28.42 KB)
2026-01-03 19:22:16,493 - INFO -   Sending topic JSON to model (full subchapter context with 10 topics)...
2026-01-03 19:22:16,494 - INFO -   Calling model API...
2026-01-03 19:22:52,357 - INFO - Text processed successfully with gemini-2.5-pro
2026-01-03 19:22:52,358 - INFO -   ✓ Topic 'طیف اثر و منابع تابش' processed successfully
2026-01-03 19:22:52,359 - INFO -   Response size: 3,957 bytes (3.86 KB)
2026-01-03 19:22:52,359 - INFO -   Response length: 2,950 characters
2026-01-03 19:22:52,360 - INFO -   ✓ Topic 'طیف اثر و منابع تابش' completed
2026-01-03 19:22:52,360 - INFO - ================================================================================
2026-01-03 19:22:52,360 - INFO - 
2026-01-03 19:22:52,360 - INFO - ================================================================================
2026-01-03 19:22:52,361 - INFO - PROCESSING TOPIC 4/29
2026-01-03 19:22:52,361 - INFO - ================================================================================
2026-01-03 19:22:52,361 - INFO -   Subchapter: 'فتوتراپی با UVB'
2026-01-03 19:22:52,361 - INFO -   Topic: 'پروتکل‌های درمانی'
2026-01-03 19:22:52,361 - INFO -   Number of extractions: 4
2026-01-03 19:22:52,362 - INFO -   JSON payload size: 29,103 bytes (28.42 KB)
2026-01-03 19:22:52,362 - INFO -   Sending topic JSON to model (full subchapter context with 10 topics)...
2026-01-03 19:22:52,362 - INFO -   Calling model API...
2026-01-03 19:23:35,603 - INFO - Text processed successfully with gemini-2.5-pro
2026-01-03 19:23:35,604 - INFO -   ✓ Topic 'پروتکل‌های درمانی' processed successfully
2026-01-03 19:23:35,605 - INFO -   Response size: 9,972 bytes (9.74 KB)
2026-01-03 19:23:35,605 - INFO -   Response length: 7,435 characters
2026-01-03 19:23:35,605 - INFO -   ✓ Topic 'پروتکل‌های درمانی' completed
2026-01-03 19:23:35,606 - INFO - ================================================================================
2026-01-03 19:23:35,606 - INFO - 
2026-01-03 19:23:35,606 - INFO - ================================================================================
2026-01-03 19:23:35,606 - INFO - PROCESSING TOPIC 5/29
2026-01-03 19:23:35,606 - INFO - ================================================================================
2026-01-03 19:23:35,606 - INFO -   Subchapter: 'فتوتراپی با UVB'
2026-01-03 19:23:35,606 - INFO -   Topic: 'فتوتراپی برای پسوریازیس'
2026-01-03 19:23:35,607 - INFO -   Number of extractions: 1
2026-01-03 19:23:35,608 - INFO -   JSON payload size: 29,103 bytes (28.42 KB)
2026-01-03 19:23:35,608 - INFO -   Sending topic JSON to model (full subchapter context with 10 topics)...
2026-01-03 19:23:35,608 - INFO -   Calling model API...
2026-01-03 19:24:04,569 - INFO - Text processed successfully with gemini-2.5-pro
2026-01-03 19:24:04,570 - INFO -   ✓ Topic 'فتوتراپی برای پسوریازیس' processed successfully
2026-01-03 19:24:04,571 - INFO -   Response size: 4,471 bytes (4.37 KB)
2026-01-03 19:24:04,571 - INFO -   Response length: 3,242 characters
2026-01-03 19:24:04,572 - INFO -   ✓ Topic 'فتوتراپی برای پسوریازیس' completed
2026-01-03 19:24:04,572 - INFO - ================================================================================
2026-01-03 19:24:04,572 - INFO - 
2026-01-03 19:24:04,572 - INFO - ================================================================================
2026-01-03 19:24:04,572 - INFO - PROCESSING TOPIC 6/29
2026-01-03 19:24:04,572 - INFO - ================================================================================
2026-01-03 19:24:04,573 - INFO -   Subchapter: 'فتوتراپی با UVB'
2026-01-03 19:24:04,573 - INFO -   Topic: 'فتوتراپی برای لنفوم سلول T پوستی، به ویژه مایكوزیس فونگوئیدس'
2026-01-03 19:24:04,573 - INFO -   Number of extractions: 1
2026-01-03 19:24:04,574 - INFO -   JSON payload size: 29,103 bytes (28.42 KB)
2026-01-03 19:24:04,574 - INFO -   Sending topic JSON to model (full subchapter context with 10 topics)...
2026-01-03 19:24:04,575 - INFO -   Calling model API...
2026-01-03 19:24:53,645 - INFO - Text processed successfully with gemini-2.5-pro
2026-01-03 19:24:53,646 - INFO -   ✓ Topic 'فتوتراپی برای لنفوم سلول T پوستی، به ویژه مایكوزیس فونگوئیدس' processed successfully
2026-01-03 19:24:53,646 - INFO -   Response size: 5,197 bytes (5.08 KB)
2026-01-03 19:24:53,647 - INFO -   Response length: 3,638 characters
2026-01-03 19:24:53,647 - INFO -   ✓ Topic 'فتوتراپی برای لنفوم سلول T پوستی، به ویژه مایكوزیس فونگوئیدس' completed
2026-01-03 19:24:53,647 - INFO - ================================================================================
2026-01-03 19:24:53,647 - INFO - 
2026-01-03 19:24:53,648 - INFO - ================================================================================
2026-01-03 19:24:53,648 - INFO - PROCESSING TOPIC 7/29
2026-01-03 19:24:53,648 - INFO - ================================================================================
2026-01-03 19:24:53,648 - INFO -   Subchapter: 'فتوتراپی با UVB'
2026-01-03 19:24:53,648 - INFO -   Topic: 'فتوتراپی برای ویتیلیگو'
2026-01-03 19:24:53,648 - INFO -   Number of extractions: 2
2026-01-03 19:24:53,650 - INFO -   JSON payload size: 29,103 bytes (28.42 KB)
2026-01-03 19:24:53,650 - INFO -   Sending topic JSON to model (full subchapter context with 10 topics)...
2026-01-03 19:24:53,650 - INFO -   Calling model API...
2026-01-03 19:25:33,234 - INFO - Text processed successfully with gemini-2.5-pro
2026-01-03 19:25:33,235 - INFO -   ✓ Topic 'فتوتراپی برای ویتیلیگو' processed successfully
2026-01-03 19:25:33,236 - INFO -   Response size: 7,428 bytes (7.25 KB)
2026-01-03 19:25:33,236 - INFO -   Response length: 5,381 characters
2026-01-03 19:25:33,236 - INFO -   ✓ Topic 'فتوتراپی برای ویتیلیگو' completed
2026-01-03 19:25:33,236 - INFO - ================================================================================
2026-01-03 19:25:33,237 - INFO - 
2026-01-03 19:25:33,237 - INFO - ================================================================================
2026-01-03 19:25:33,237 - INFO - PROCESSING TOPIC 8/29
2026-01-03 19:25:33,237 - INFO - ================================================================================
2026-01-03 19:25:33,237 - INFO -   Subchapter: 'فتوتراپی با UVB'
2026-01-03 19:25:33,237 - INFO -   Topic: 'فتوتراپی برای درماتیت آتوپیک و فتوتراپی برای فتودرماتوزها'
2026-01-03 19:25:33,237 - INFO -   Number of extractions: 1
2026-01-03 19:25:33,239 - INFO -   JSON payload size: 29,103 bytes (28.42 KB)
2026-01-03 19:25:33,239 - INFO -   Sending topic JSON to model (full subchapter context with 10 topics)...
2026-01-03 19:25:33,239 - INFO -   Calling model API...
2026-01-03 19:26:06,775 - INFO - Text processed successfully with gemini-2.5-pro
2026-01-03 19:26:06,776 - INFO -   ✓ Topic 'فتوتراپی برای درماتیت آتوپیک و فتوتراپی برای فتودرماتوزها' processed successfully
2026-01-03 19:26:06,777 - INFO -   Response size: 5,031 bytes (4.91 KB)
2026-01-03 19:26:06,777 - INFO -   Response length: 3,619 characters
2026-01-03 19:26:06,778 - INFO -   ✓ Topic 'فتوتراپی برای درماتیت آتوپیک و فتوتراپی برای فتودرماتوزها' completed
2026-01-03 19:26:06,778 - INFO - ================================================================================
2026-01-03 19:26:06,778 - INFO - 
2026-01-03 19:26:06,778 - INFO - ================================================================================
2026-01-03 19:26:06,778 - INFO - PROCESSING TOPIC 9/29
2026-01-03 19:26:06,778 - INFO - ================================================================================
2026-01-03 19:26:06,778 - INFO -   Subchapter: 'فتوتراپی با UVB'
2026-01-03 19:26:06,779 - INFO -   Topic: 'فتوتراپی برای پیتیریازیس لیکنوئیدس، فتوتراپی برای درماتیت سبورئیک و فتوتراپی برای خارش'
2026-01-03 19:26:06,779 - INFO -   Number of extractions: 1
2026-01-03 19:26:06,780 - INFO -   JSON payload size: 29,103 bytes (28.42 KB)
2026-01-03 19:26:06,780 - INFO -   Sending topic JSON to model (full subchapter context with 10 topics)...
2026-01-03 19:26:06,780 - INFO -   Calling model API...
2026-01-03 19:26:34,839 - INFO - Text processed successfully with gemini-2.5-pro
2026-01-03 19:26:34,839 - INFO -   ✓ Topic 'فتوتراپی برای پیتیریازیس لیکنوئیدس، فتوتراپی برای درماتیت سبورئیک و فتوتراپی برای خارش' processed successfully
2026-01-03 19:26:34,840 - INFO -   Response size: 3,947 bytes (3.85 KB)
2026-01-03 19:26:34,840 - INFO -   Response length: 2,902 characters
2026-01-03 19:26:34,841 - INFO -   ✓ Topic 'فتوتراپی برای پیتیریازیس لیکنوئیدس، فتوتراپی برای درماتیت سبورئیک و فتوتراپی برای خارش' completed
2026-01-03 19:26:34,841 - INFO - ================================================================================
2026-01-03 19:26:34,841 - INFO - 
2026-01-03 19:26:34,841 - INFO - ================================================================================
2026-01-03 19:26:34,841 - INFO - PROCESSING TOPIC 10/29
2026-01-03 19:26:34,841 - INFO - ================================================================================
2026-01-03 19:26:34,841 - INFO -   Subchapter: 'فتوتراپی با UVB'
2026-01-03 19:26:34,842 - INFO -   Topic: 'عوارض جانبی فتوتراپی با UVB'
2026-01-03 19:26:34,842 - INFO -   Number of extractions: 2
2026-01-03 19:26:34,843 - INFO -   JSON payload size: 29,103 bytes (28.42 KB)
2026-01-03 19:26:34,844 - INFO -   Sending topic JSON to model (full subchapter context with 10 topics)...
2026-01-03 19:26:34,844 - INFO -   Calling model API...
2026-01-03 19:27:13,695 - INFO - Text processed successfully with gemini-2.5-pro
2026-01-03 19:27:13,696 - INFO -   ✓ Topic 'عوارض جانبی فتوتراپی با UVB' processed successfully
2026-01-03 19:27:13,696 - INFO -   Response size: 2,947 bytes (2.88 KB)
2026-01-03 19:27:13,697 - INFO -   Response length: 2,185 characters
2026-01-03 19:27:13,697 - INFO -   ✓ Topic 'عوارض جانبی فتوتراپی با UVB' completed
2026-01-03 19:27:13,697 - INFO - ================================================================================
2026-01-03 19:27:13,697 - INFO - 
2026-01-03 19:27:13,697 - INFO - ================================================================================
2026-01-03 19:27:13,697 - INFO - PROCESSING TOPIC 11/29
2026-01-03 19:27:13,697 - INFO - ================================================================================
2026-01-03 19:27:13,698 - INFO -   Subchapter: 'فتوتراپی با لیزر یا لامپ اگزایمر 308 نانومتر'
2026-01-03 19:27:13,698 - INFO -   Topic: 'فتوتراپی با لیزر یا لامپ اگزایمر 308 نانومتر'
2026-01-03 19:27:13,698 - INFO -   Number of extractions: 1
2026-01-03 19:27:13,698 - INFO -   JSON payload size: 1,943 bytes (1.90 KB)
2026-01-03 19:27:13,698 - INFO -   Sending topic JSON to model (full subchapter context with 1 topics)...
2026-01-03 19:27:13,698 - INFO -   Calling model API...
2026-01-03 19:27:47,209 - INFO - Text processed successfully with gemini-2.5-pro
2026-01-03 19:27:47,210 - INFO -   ✓ Topic 'فتوتراپی با لیزر یا لامپ اگزایمر 308 نانومتر' processed successfully
2026-01-03 19:27:47,211 - INFO -   Response size: 3,671 bytes (3.58 KB)
2026-01-03 19:27:47,211 - INFO -   Response length: 2,481 characters
2026-01-03 19:27:47,211 - INFO -   ✓ Topic 'فتوتراپی با لیزر یا لامپ اگزایمر 308 نانومتر' completed
2026-01-03 19:27:47,212 - INFO - ================================================================================
2026-01-03 19:27:47,212 - INFO - 
2026-01-03 19:27:47,212 - INFO - ================================================================================
2026-01-03 19:27:47,212 - INFO - PROCESSING TOPIC 12/29
2026-01-03 19:27:47,212 - INFO - ================================================================================
2026-01-03 19:27:47,213 - INFO -   Subchapter: 'فتوتراپی با UVA1'
2026-01-03 19:27:47,213 - INFO -   Topic: 'عوارض جانبی فتوتراپی با UVA1'
2026-01-03 19:27:47,213 - INFO -   Number of extractions: 1
2026-01-03 19:27:47,214 - INFO -   JSON payload size: 1,550 bytes (1.51 KB)
2026-01-03 19:27:47,214 - INFO -   Sending topic JSON to model (full subchapter context with 1 topics)...
2026-01-03 19:27:47,214 - INFO -   Calling model API...
2026-01-03 19:28:17,322 - INFO - Text processed successfully with gemini-2.5-pro
2026-01-03 19:28:17,323 - INFO -   ✓ Topic 'عوارض جانبی فتوتراپی با UVA1' processed successfully
2026-01-03 19:28:17,324 - INFO -   Response size: 3,004 bytes (2.93 KB)
2026-01-03 19:28:17,324 - INFO -   Response length: 2,188 characters
2026-01-03 19:28:17,324 - INFO -   ✓ Topic 'عوارض جانبی فتوتراپی با UVA1' completed
2026-01-03 19:28:17,324 - INFO - ================================================================================
2026-01-03 19:28:17,324 - INFO - 
2026-01-03 19:28:17,324 - INFO - ================================================================================
2026-01-03 19:28:17,325 - INFO - PROCESSING TOPIC 13/29
2026-01-03 19:28:17,325 - INFO - ================================================================================
2026-01-03 19:28:17,325 - INFO -   Subchapter: 'فتوکموتراپی با پسورالن‌ها (PUVA)'
2026-01-03 19:28:17,325 - INFO -   Topic: 'جنبه‌های تاریخی'
2026-01-03 19:28:17,325 - INFO -   Number of extractions: 2
2026-01-03 19:28:17,327 - INFO -   JSON payload size: 57,608 bytes (56.26 KB)
2026-01-03 19:28:17,327 - INFO -   Sending topic JSON to model (full subchapter context with 17 topics)...
2026-01-03 19:28:17,327 - INFO -   Calling model API...
2026-01-03 19:29:03,946 - INFO - Text processed successfully with gemini-2.5-pro
2026-01-03 19:29:03,947 - INFO -   ✓ Topic 'جنبه‌های تاریخی' processed successfully
2026-01-03 19:29:03,948 - INFO -   Response size: 6,488 bytes (6.34 KB)
2026-01-03 19:29:03,948 - INFO -   Response length: 4,800 characters
2026-01-03 19:29:03,949 - INFO -   ✓ Topic 'جنبه‌های تاریخی' completed
2026-01-03 19:29:03,949 - INFO - ================================================================================
2026-01-03 19:29:03,949 - INFO - 
2026-01-03 19:29:03,949 - INFO - ================================================================================
2026-01-03 19:29:03,949 - INFO - PROCESSING TOPIC 14/29
2026-01-03 19:29:03,950 - INFO - ================================================================================
2026-01-03 19:29:03,950 - INFO -   Subchapter: 'فتوکموتراپی با پسورالن‌ها (PUVA)'
2026-01-03 19:29:03,950 - INFO -   Topic: 'پسورالن‌ها'
2026-01-03 19:29:03,950 - INFO -   Number of extractions: 2
2026-01-03 19:29:03,952 - INFO -   JSON payload size: 57,608 bytes (56.26 KB)
2026-01-03 19:29:03,953 - INFO -   Sending topic JSON to model (full subchapter context with 17 topics)...
2026-01-03 19:29:03,953 - INFO -   Calling model API...
2026-01-03 19:29:39,665 - INFO - Text processed successfully with gemini-2.5-pro
2026-01-03 19:29:39,666 - INFO -   ✓ Topic 'پسورالن‌ها' processed successfully
2026-01-03 19:29:39,666 - INFO -   Response size: 7,601 bytes (7.42 KB)
2026-01-03 19:29:39,667 - INFO -   Response length: 5,613 characters
2026-01-03 19:29:39,667 - INFO -   ✓ Topic 'پسورالن‌ها' completed
2026-01-03 19:29:39,667 - INFO - ================================================================================
2026-01-03 19:29:39,667 - INFO - 
2026-01-03 19:29:39,667 - INFO - ================================================================================
2026-01-03 19:29:39,667 - INFO - PROCESSING TOPIC 15/29
2026-01-03 19:29:39,668 - INFO - ================================================================================
2026-01-03 19:29:39,668 - INFO -   Subchapter: 'فتوکموتراپی با پسورالن‌ها (PUVA)'
2026-01-03 19:29:39,668 - INFO -   Topic: 'فتوشیمی پسورالن و طیف اثر و منابع نوری'
2026-01-03 19:29:39,668 - INFO -   Number of extractions: 3
2026-01-03 19:29:39,670 - INFO -   JSON payload size: 57,608 bytes (56.26 KB)
2026-01-03 19:29:39,670 - INFO -   Sending topic JSON to model (full subchapter context with 17 topics)...
2026-01-03 19:29:39,671 - INFO -   Calling model API...
2026-01-03 19:30:16,975 - INFO - Text processed successfully with gemini-2.5-pro
2026-01-03 19:30:16,975 - INFO -   ✓ Topic 'فتوشیمی پسورالن و طیف اثر و منابع نوری' processed successfully
2026-01-03 19:30:16,976 - INFO -   Response size: 7,896 bytes (7.71 KB)
2026-01-03 19:30:16,977 - INFO -   Response length: 5,667 characters
2026-01-03 19:30:16,977 - INFO -   ✓ Topic 'فتوشیمی پسورالن و طیف اثر و منابع نوری' completed
2026-01-03 19:30:16,977 - INFO - ================================================================================
2026-01-03 19:30:16,977 - INFO - 
2026-01-03 19:30:16,977 - INFO - ================================================================================
2026-01-03 19:30:16,977 - INFO - PROCESSING TOPIC 16/29
2026-01-03 19:30:16,978 - INFO - ================================================================================
2026-01-03 19:30:16,978 - INFO -   Subchapter: 'فتوکموتراپی با پسورالن‌ها (PUVA)'
2026-01-03 19:30:16,978 - INFO -   Topic: 'اثرات فتوبیولوژیک PUVA'
2026-01-03 19:30:16,978 - INFO -   Number of extractions: 1
2026-01-03 19:30:16,980 - INFO -   JSON payload size: 57,608 bytes (56.26 KB)
2026-01-03 19:30:16,980 - INFO -   Sending topic JSON to model (full subchapter context with 17 topics)...
2026-01-03 19:30:16,981 - INFO -   Calling model API...
2026-01-03 19:30:49,247 - INFO - Text processed successfully with gemini-2.5-pro
2026-01-03 19:30:49,248 - INFO -   ✓ Topic 'اثرات فتوبیولوژیک PUVA' processed successfully
2026-01-03 19:30:49,249 - INFO -   Response size: 5,008 bytes (4.89 KB)
2026-01-03 19:30:49,249 - INFO -   Response length: 3,739 characters
2026-01-03 19:30:49,250 - INFO -   ✓ Topic 'اثرات فتوبیولوژیک PUVA' completed
2026-01-03 19:30:49,250 - INFO - ================================================================================
2026-01-03 19:30:49,250 - INFO - 
2026-01-03 19:30:49,251 - INFO - ================================================================================
2026-01-03 19:30:49,251 - INFO - PROCESSING TOPIC 17/29
2026-01-03 19:30:49,251 - INFO - ================================================================================
2026-01-03 19:30:49,251 - INFO -   Subchapter: 'فتوکموتراپی با پسورالن‌ها (PUVA)'
2026-01-03 19:30:49,251 - INFO -   Topic: 'پروتکل‌های درمانی'
2026-01-03 19:30:49,252 - INFO -   Number of extractions: 2
2026-01-03 19:30:49,254 - INFO -   JSON payload size: 57,608 bytes (56.26 KB)
2026-01-03 19:30:49,254 - INFO -   Sending topic JSON to model (full subchapter context with 17 topics)...
2026-01-03 19:30:49,255 - INFO -   Calling model API...
2026-01-03 19:31:35,645 - INFO - Text processed successfully with gemini-2.5-pro
2026-01-03 19:31:35,646 - INFO -   ✓ Topic 'پروتکل‌های درمانی' processed successfully
2026-01-03 19:31:35,646 - INFO -   Response size: 9,674 bytes (9.45 KB)
2026-01-03 19:31:35,647 - INFO -   Response length: 6,998 characters
2026-01-03 19:31:35,647 - INFO -   ✓ Topic 'پروتکل‌های درمانی' completed
2026-01-03 19:31:35,647 - INFO - ================================================================================
2026-01-03 19:31:35,647 - INFO - 
2026-01-03 19:31:35,647 - INFO - ================================================================================
2026-01-03 19:31:35,648 - INFO - PROCESSING TOPIC 18/29
2026-01-03 19:31:35,648 - INFO - ================================================================================
2026-01-03 19:31:35,648 - INFO -   Subchapter: 'فتوکموتراپی با پسورالن‌ها (PUVA)'
2026-01-03 19:31:35,648 - INFO -   Topic: 'مرحله درمان اولیه (پاکسازی)'
2026-01-03 19:31:35,648 - INFO -   Number of extractions: 2
2026-01-03 19:31:35,650 - INFO -   JSON payload size: 57,608 bytes (56.26 KB)
2026-01-03 19:31:35,650 - INFO -   Sending topic JSON to model (full subchapter context with 17 topics)...
2026-01-03 19:31:35,651 - INFO -   Calling model API...
2026-01-03 19:32:06,316 - INFO - Text processed successfully with gemini-2.5-pro
2026-01-03 19:32:06,317 - INFO -   ✓ Topic 'مرحله درمان اولیه (پاکسازی)' processed successfully
2026-01-03 19:32:06,317 - INFO -   Response size: 5,167 bytes (5.05 KB)
2026-01-03 19:32:06,318 - INFO -   Response length: 3,773 characters
2026-01-03 19:32:06,318 - INFO -   ✓ Topic 'مرحله درمان اولیه (پاکسازی)' completed
2026-01-03 19:32:06,318 - INFO - ================================================================================
2026-01-03 19:32:06,318 - INFO - 
2026-01-03 19:32:06,318 - INFO - ================================================================================
2026-01-03 19:32:06,318 - INFO - PROCESSING TOPIC 19/29
2026-01-03 19:32:06,319 - INFO - ================================================================================
2026-01-03 19:32:06,319 - INFO -   Subchapter: 'فتوکموتراپی با پسورالن‌ها (PUVA)'
2026-01-03 19:32:06,319 - INFO -   Topic: 'مرحله نگهدارنده'
2026-01-03 19:32:06,320 - INFO -   Number of extractions: 1
2026-01-03 19:32:06,322 - INFO -   JSON payload size: 57,608 bytes (56.26 KB)
2026-01-03 19:32:06,323 - INFO -   Sending topic JSON to model (full subchapter context with 17 topics)...
2026-01-03 19:32:06,323 - INFO -   Calling model API...
2026-01-03 19:32:36,211 - INFO - Text processed successfully with gemini-2.5-pro
2026-01-03 19:32:36,212 - INFO -   ✓ Topic 'مرحله نگهدارنده' processed successfully
2026-01-03 19:32:36,212 - INFO -   Response size: 3,138 bytes (3.06 KB)
2026-01-03 19:32:36,213 - INFO -   Response length: 2,360 characters
2026-01-03 19:32:36,213 - INFO -   ✓ Topic 'مرحله نگهدارنده' completed
2026-01-03 19:32:36,213 - INFO - ================================================================================
2026-01-03 19:32:36,213 - INFO - 
2026-01-03 19:32:36,213 - INFO - ================================================================================
2026-01-03 19:32:36,213 - INFO - PROCESSING TOPIC 20/29
2026-01-03 19:32:36,213 - INFO - ================================================================================
2026-01-03 19:32:36,214 - INFO -   Subchapter: 'فتوکموتراپی با پسورالن‌ها (PUVA)'
2026-01-03 19:32:36,214 - INFO -   Topic: 'PUVA برای پسوریازیس'
2026-01-03 19:32:36,214 - INFO -   Number of extractions: 2
2026-01-03 19:32:36,216 - INFO -   JSON payload size: 57,608 bytes (56.26 KB)
2026-01-03 19:32:36,216 - INFO -   Sending topic JSON to model (full subchapter context with 17 topics)...
2026-01-03 19:32:36,216 - INFO -   Calling model API...
2026-01-03 19:33:09,257 - INFO - Text processed successfully with gemini-2.5-pro
2026-01-03 19:33:09,258 - INFO -   ✓ Topic 'PUVA برای پسوریازیس' processed successfully
2026-01-03 19:33:09,258 - INFO -   Response size: 3,584 bytes (3.50 KB)
2026-01-03 19:33:09,259 - INFO -   Response length: 2,783 characters
2026-01-03 19:33:09,259 - INFO -   ✓ Topic 'PUVA برای پسوریازیس' completed
2026-01-03 19:33:09,259 - INFO - ================================================================================
2026-01-03 19:33:09,259 - INFO - 
2026-01-03 19:33:09,259 - INFO - ================================================================================
2026-01-03 19:33:09,260 - INFO - PROCESSING TOPIC 21/29
2026-01-03 19:33:09,260 - INFO - ================================================================================
2026-01-03 19:33:09,260 - INFO -   Subchapter: 'فتوکموتراپی با پسورالن‌ها (PUVA)'
2026-01-03 19:33:09,260 - INFO -   Topic: 'درمان‌های ترکیبی'
2026-01-03 19:33:09,260 - INFO -   Number of extractions: 1
2026-01-03 19:33:09,263 - INFO -   JSON payload size: 57,608 bytes (56.26 KB)
2026-01-03 19:33:09,263 - INFO -   Sending topic JSON to model (full subchapter context with 17 topics)...
2026-01-03 19:33:09,264 - INFO -   Calling model API...
2026-01-03 19:33:51,457 - INFO - Text processed successfully with gemini-2.5-pro
2026-01-03 19:33:51,457 - INFO -   ✓ Topic 'درمان‌های ترکیبی' processed successfully
2026-01-03 19:33:51,458 - INFO -   Response size: 6,558 bytes (6.40 KB)
2026-01-03 19:33:51,458 - INFO -   Response length: 4,718 characters
2026-01-03 19:33:51,458 - INFO -   ✓ Topic 'درمان‌های ترکیبی' completed
2026-01-03 19:33:51,458 - INFO - ================================================================================
2026-01-03 19:33:51,458 - INFO - 
2026-01-03 19:33:51,458 - INFO - ================================================================================
2026-01-03 19:33:51,458 - INFO - PROCESSING TOPIC 22/29
2026-01-03 19:33:51,459 - INFO - ================================================================================
2026-01-03 19:33:51,459 - INFO -   Subchapter: 'فتوکموتراپی با پسورالن‌ها (PUVA)'
2026-01-03 19:33:51,459 - INFO -   Topic: 'PUVA برای لنفوم سلول T پوستی، به ویژه مایکوزیس فونگوئیدس'
2026-01-03 19:33:51,459 - INFO -   Number of extractions: 2
2026-01-03 19:33:51,461 - INFO -   JSON payload size: 57,608 bytes (56.26 KB)
2026-01-03 19:33:51,461 - INFO -   Sending topic JSON to model (full subchapter context with 17 topics)...
2026-01-03 19:33:51,461 - INFO -   Calling model API...
2026-01-03 19:34:34,218 - INFO - Text processed successfully with gemini-2.5-pro
2026-01-03 19:34:34,218 - INFO -   ✓ Topic 'PUVA برای لنفوم سلول T پوستی، به ویژه مایکوزیس فونگوئیدس' processed successfully
2026-01-03 19:34:34,219 - INFO -   Response size: 10,428 bytes (10.18 KB)
2026-01-03 19:34:34,219 - INFO -   Response length: 7,500 characters
2026-01-03 19:34:34,219 - INFO -   ✓ Topic 'PUVA برای لنفوم سلول T پوستی، به ویژه مایکوزیس فونگوئیدس' completed
2026-01-03 19:34:34,220 - INFO - ================================================================================
2026-01-03 19:34:34,220 - INFO - 
2026-01-03 19:34:34,220 - INFO - ================================================================================
2026-01-03 19:34:34,220 - INFO - PROCESSING TOPIC 23/29
2026-01-03 19:34:34,220 - INFO - ================================================================================
2026-01-03 19:34:34,220 - INFO -   Subchapter: 'فتوکموتراپی با پسورالن‌ها (PUVA)'
2026-01-03 19:34:34,221 - INFO -   Topic: 'PUVA برای ویتیلیگو'
2026-01-03 19:34:34,221 - INFO -   Number of extractions: 1
2026-01-03 19:34:34,222 - INFO -   JSON payload size: 57,608 bytes (56.26 KB)
2026-01-03 19:34:34,223 - INFO -   Sending topic JSON to model (full subchapter context with 17 topics)...
2026-01-03 19:34:34,223 - INFO -   Calling model API...
2026-01-03 19:35:16,905 - INFO - Text processed successfully with gemini-2.5-pro
2026-01-03 19:35:16,906 - INFO -   ✓ Topic 'PUVA برای ویتیلیگو' processed successfully
2026-01-03 19:35:16,906 - INFO -   Response size: 8,470 bytes (8.27 KB)
2026-01-03 19:35:16,907 - INFO -   Response length: 6,101 characters
2026-01-03 19:35:16,907 - INFO -   ✓ Topic 'PUVA برای ویتیلیگو' completed
2026-01-03 19:35:16,908 - INFO - ================================================================================
2026-01-03 19:35:16,908 - INFO - 
2026-01-03 19:35:16,908 - INFO - ================================================================================
2026-01-03 19:35:16,908 - INFO - PROCESSING TOPIC 24/29
2026-01-03 19:35:16,909 - INFO - ================================================================================
2026-01-03 19:35:16,909 - INFO -   Subchapter: 'فتوکموتراپی با پسورالن‌ها (PUVA)'
2026-01-03 19:35:16,909 - INFO -   Topic: 'PUVA برای درماتیت آتوپیک و PUVA برای لیکن پلان'
2026-01-03 19:35:16,909 - INFO -   Number of extractions: 1
2026-01-03 19:35:16,912 - INFO -   JSON payload size: 57,608 bytes (56.26 KB)
2026-01-03 19:35:16,912 - INFO -   Sending topic JSON to model (full subchapter context with 17 topics)...
2026-01-03 19:35:16,913 - INFO -   Calling model API...
2026-01-03 19:35:48,763 - INFO - Text processed successfully with gemini-2.5-pro
2026-01-03 19:35:48,763 - INFO -   ✓ Topic 'PUVA برای درماتیت آتوپیک و PUVA برای لیکن پلان' processed successfully
2026-01-03 19:35:48,764 - INFO -   Response size: 5,179 bytes (5.06 KB)
2026-01-03 19:35:48,764 - INFO -   Response length: 3,877 characters
2026-01-03 19:35:48,765 - INFO -   ✓ Topic 'PUVA برای درماتیت آتوپیک و PUVA برای لیکن پلان' completed
2026-01-03 19:35:48,765 - INFO - ================================================================================
2026-01-03 19:35:48,765 - INFO - 
2026-01-03 19:35:48,766 - INFO - ================================================================================
2026-01-03 19:35:48,766 - INFO - PROCESSING TOPIC 25/29
2026-01-03 19:35:48,766 - INFO - ================================================================================
2026-01-03 19:35:48,766 - INFO -   Subchapter: 'فتوکموتراپی با پسورالن‌ها (PUVA)'
2026-01-03 19:35:48,766 - INFO -   Topic: 'PUVA برای بیماری پیوند علیه میزبان'
2026-01-03 19:35:48,767 - INFO -   Number of extractions: 1
2026-01-03 19:35:48,769 - INFO -   JSON payload size: 57,608 bytes (56.26 KB)
2026-01-03 19:35:48,769 - INFO -   Sending topic JSON to model (full subchapter context with 17 topics)...
2026-01-03 19:35:48,769 - INFO -   Calling model API...
2026-01-03 19:36:24,674 - INFO - Text processed successfully with gemini-2.5-pro
2026-01-03 19:36:24,675 - INFO -   ✓ Topic 'PUVA برای بیماری پیوند علیه میزبان' processed successfully
2026-01-03 19:36:24,675 - INFO -   Response size: 5,436 bytes (5.31 KB)
2026-01-03 19:36:24,676 - INFO -   Response length: 4,049 characters
2026-01-03 19:36:24,676 - INFO -   ✓ Topic 'PUVA برای بیماری پیوند علیه میزبان' completed
2026-01-03 19:36:24,676 - INFO - ================================================================================
2026-01-03 19:36:24,676 - INFO - 
2026-01-03 19:36:24,677 - INFO - ================================================================================
2026-01-03 19:36:24,677 - INFO - PROCESSING TOPIC 26/29
2026-01-03 19:36:24,678 - INFO - ================================================================================
2026-01-03 19:36:24,678 - INFO -   Subchapter: 'فتوکموتراپی با پسورالن‌ها (PUVA)'
2026-01-03 19:36:24,678 - INFO -   Topic: 'PUVA برای کهیر پیگمنتوزا و PUVA برای درماتوزهای متفرقه'
2026-01-03 19:36:24,678 - INFO -   Number of extractions: 1
2026-01-03 19:36:24,680 - INFO -   JSON payload size: 57,608 bytes (56.26 KB)
2026-01-03 19:36:24,681 - INFO -   Sending topic JSON to model (full subchapter context with 17 topics)...
2026-01-03 19:36:24,681 - INFO -   Calling model API...
2026-01-03 19:36:55,922 - INFO - Text processed successfully with gemini-2.5-pro
2026-01-03 19:36:55,923 - INFO -   ✓ Topic 'PUVA برای کهیر پیگمنتوزا و PUVA برای درماتوزهای متفرقه' processed successfully
2026-01-03 19:36:55,924 - INFO -   Response size: 5,784 bytes (5.65 KB)
2026-01-03 19:36:55,924 - INFO -   Response length: 4,245 characters
2026-01-03 19:36:55,925 - INFO -   ✓ Topic 'PUVA برای کهیر پیگمنتوزا و PUVA برای درماتوزهای متفرقه' completed
2026-01-03 19:36:55,925 - INFO - ================================================================================
2026-01-03 19:36:55,925 - INFO - 
2026-01-03 19:36:55,925 - INFO - ================================================================================
2026-01-03 19:36:55,925 - INFO - PROCESSING TOPIC 27/29
2026-01-03 19:36:55,925 - INFO - ================================================================================
2026-01-03 19:36:55,926 - INFO -   Subchapter: 'فتوکموتراپی با پسورالن‌ها (PUVA)'
2026-01-03 19:36:55,926 - INFO -   Topic: 'PUVA برای فتودرماتوزها'
2026-01-03 19:36:55,926 - INFO -   Number of extractions: 1
2026-01-03 19:36:55,928 - INFO -   JSON payload size: 57,608 bytes (56.26 KB)
2026-01-03 19:36:55,929 - INFO -   Sending topic JSON to model (full subchapter context with 17 topics)...
2026-01-03 19:36:55,929 - INFO -   Calling model API...
2026-01-03 19:37:43,262 - INFO - Text processed successfully with gemini-2.5-pro
2026-01-03 19:37:43,262 - INFO -   ✓ Topic 'PUVA برای فتودرماتوزها' processed successfully
2026-01-03 19:37:43,263 - INFO -   Response size: 6,230 bytes (6.08 KB)
2026-01-03 19:37:43,264 - INFO -   Response length: 4,621 characters
2026-01-03 19:37:43,264 - INFO -   ✓ Topic 'PUVA برای فتودرماتوزها' completed
2026-01-03 19:37:43,264 - INFO - ================================================================================
2026-01-03 19:37:43,265 - INFO - 
2026-01-03 19:37:43,265 - INFO - ================================================================================
2026-01-03 19:37:43,265 - INFO - PROCESSING TOPIC 28/29
2026-01-03 19:37:43,265 - INFO - ================================================================================
2026-01-03 19:37:43,265 - INFO -   Subchapter: 'فتوکموتراپی با پسورالن‌ها (PUVA)'
2026-01-03 19:37:43,265 - INFO -   Topic: 'عوارض جانبی و خطرات بلندمدت PUVA'
2026-01-03 19:37:43,265 - INFO -   Number of extractions: 2
2026-01-03 19:37:43,268 - INFO -   JSON payload size: 57,608 bytes (56.26 KB)
2026-01-03 19:37:43,268 - INFO -   Sending topic JSON to model (full subchapter context with 17 topics)...
2026-01-03 19:37:43,268 - INFO -   Calling model API...
2026-01-03 19:38:39,652 - INFO - Text processed successfully with gemini-2.5-pro
2026-01-03 19:38:39,653 - INFO -   ✓ Topic 'عوارض جانبی و خطرات بلندمدت PUVA' processed successfully
2026-01-03 19:38:39,654 - INFO -   Response size: 10,085 bytes (9.85 KB)
2026-01-03 19:38:39,654 - INFO -   Response length: 7,080 characters
2026-01-03 19:38:39,654 - INFO -   ✓ Topic 'عوارض جانبی و خطرات بلندمدت PUVA' completed
2026-01-03 19:38:39,654 - INFO - ================================================================================
2026-01-03 19:38:39,655 - INFO - 
2026-01-03 19:38:39,655 - INFO - ================================================================================
2026-01-03 19:38:39,655 - INFO - PROCESSING TOPIC 29/29
2026-01-03 19:38:39,655 - INFO - ================================================================================
2026-01-03 19:38:39,655 - INFO -   Subchapter: 'فتوکموتراپی با پسورالن‌ها (PUVA)'
2026-01-03 19:38:39,655 - INFO -   Topic: 'UVB و PUVA در بیماران آلوده به HIV'
2026-01-03 19:38:39,655 - INFO -   Number of extractions: 1
2026-01-03 19:38:39,657 - INFO -   JSON payload size: 57,608 bytes (56.26 KB)
2026-01-03 19:38:39,658 - INFO -   Sending topic JSON to model (full subchapter context with 17 topics)...
2026-01-03 19:38:39,659 - INFO -   Calling model API...
2026-01-03 19:39:03,981 - INFO - Text processed successfully with gemini-2.5-pro
2026-01-03 19:39:03,982 - INFO -   ✓ Topic 'UVB و PUVA در بیماران آلوده به HIV' processed successfully
2026-01-03 19:39:03,983 - INFO -   Response size: 2,446 bytes (2.39 KB)
2026-01-03 19:39:03,983 - INFO -   Response length: 1,839 characters
2026-01-03 19:39:03,983 - INFO -   ✓ Topic 'UVB و PUVA در بیماران آلوده به HIV' completed
2026-01-03 19:39:03,983 - INFO - ================================================================================
2026-01-03 19:39:03,984 - INFO - 
2026-01-03 19:39:03,984 - INFO - ================================================================================
2026-01-03 19:39:03,984 - INFO - SAVING TXT FILES FOR EACH SUBCHAPTER
2026-01-03 19:39:03,984 - INFO - ================================================================================
2026-01-03 19:39:03,985 - INFO - Saved subchapter 'فتوتراپی با UVB' response to: /home/shahmir/Downloads/OCR Extraction_subchapter_2_فتوتراپی_با_UVB.txt (10 topics)
2026-01-03 19:39:03,986 - INFO - Saved subchapter 'فتوتراپی با لیزر یا لامپ اگزایمر 308 نانومتر' response to: /home/shahmir/Downloads/OCR Extraction_subchapter_3_فتوتراپی_با_لیزر_یا_لامپ_اگزایمر_308_نانومتر.txt (1 topics)
2026-01-03 19:39:03,987 - INFO - Saved subchapter 'فتوتراپی با UVA1' response to: /home/shahmir/Downloads/OCR Extraction_subchapter_1_فتوتراپی_با_UVA1.txt (1 topics)
2026-01-03 19:39:03,989 - INFO - Saved subchapter 'فتوکموتراپی با پسورالن‌ها (PUVA)' response to: /home/shahmir/Downloads/OCR Extraction_subchapter_4_فتوکموتراپی_با_پسورالنها_PUVA.txt (17 topics)
2026-01-03 19:39:03,990 - INFO - ================================================================================
2026-01-03 19:39:03,991 - INFO - ================================================================================
2026-01-03 19:39:03,991 - INFO - EXTRACTING JSON BLOCKS FROM RESPONSES
2026-01-03 19:39:03,992 - INFO - ================================================================================
2026-01-03 19:39:03,992 - INFO - Extracting JSON blocks from 29 responses (one per topic)...
2026-01-03 19:39:03,992 - INFO -   Topic 1/29: 'فتوتراپی با UVB' > 'جنبه‌های تاریخی'
2026-01-03 19:39:03,993 - INFO -     ✓ Extracted 1 JSON block(s)
2026-01-03 19:39:03,994 - INFO -   Topic 2/29: 'فتوتراپی با UVB' > 'اصول و مکانیسم‌ها'
2026-01-03 19:39:03,995 - INFO -     ✓ Extracted 1 JSON block(s)
2026-01-03 19:39:03,995 - INFO -   Topic 3/29: 'فتوتراپی با UVB' > 'طیف اثر و منابع تابش'
2026-01-03 19:39:03,996 - INFO -     ✓ Extracted 1 JSON block(s)
2026-01-03 19:39:03,996 - INFO -   Topic 4/29: 'فتوتراپی با UVB' > 'پروتکل‌های درمانی'
2026-01-03 19:39:03,997 - INFO -     ✓ Extracted 1 JSON block(s)
2026-01-03 19:39:03,997 - INFO -   Topic 5/29: 'فتوتراپی با UVB' > 'فتوتراپی برای پسوریازیس'
2026-01-03 19:39:03,998 - INFO -     ✓ Extracted 1 JSON block(s)
2026-01-03 19:39:03,998 - INFO -   Topic 6/29: 'فتوتراپی با UVB' > 'فتوتراپی برای لنفوم سلول T پوستی، به ویژه مایكوزیس فونگوئیدس'
2026-01-03 19:39:03,998 - INFO -     ✓ Extracted 1 JSON block(s)
2026-01-03 19:39:03,999 - INFO -   Topic 7/29: 'فتوتراپی با UVB' > 'فتوتراپی برای ویتیلیگو'
2026-01-03 19:39:03,999 - INFO -     ✓ Extracted 1 JSON block(s)
2026-01-03 19:39:03,999 - INFO -   Topic 8/29: 'فتوتراپی با UVB' > 'فتوتراپی برای درماتیت آتوپیک و فتوتراپی برای فتودرماتوزها'
2026-01-03 19:39:04,000 - INFO -     ✓ Extracted 1 JSON block(s)
2026-01-03 19:39:04,000 - INFO -   Topic 9/29: 'فتوتراپی با UVB' > 'فتوتراپی برای پیتیریازیس لیکنوئیدس، فتوتراپی برای درماتیت سبورئیک و فتوتراپی برای خارش'
2026-01-03 19:39:04,001 - INFO -     ✓ Extracted 1 JSON block(s)
2026-01-03 19:39:04,001 - INFO -   Topic 10/29: 'فتوتراپی با UVB' > 'عوارض جانبی فتوتراپی با UVB'
2026-01-03 19:39:04,001 - INFO -     ✓ Extracted 1 JSON block(s)
2026-01-03 19:39:04,001 - INFO -   Topic 11/29: 'فتوتراپی با لیزر یا لامپ اگزایمر 308 نانومتر' > 'فتوتراپی با لیزر یا لامپ اگزایمر 308 نانومتر'
2026-01-03 19:39:04,002 - INFO -     ✓ Extracted 1 JSON block(s)
2026-01-03 19:39:04,002 - INFO -   Topic 12/29: 'فتوتراپی با UVA1' > 'عوارض جانبی فتوتراپی با UVA1'
2026-01-03 19:39:04,002 - INFO -     ✓ Extracted 1 JSON block(s)
2026-01-03 19:39:04,002 - INFO -   Topic 13/29: 'فتوکموتراپی با پسورالن‌ها (PUVA)' > 'جنبه‌های تاریخی'
2026-01-03 19:39:04,003 - INFO -     ✓ Extracted 1 JSON block(s)
2026-01-03 19:39:04,003 - INFO -   Topic 14/29: 'فتوکموتراپی با پسورالن‌ها (PUVA)' > 'پسورالن‌ها'
2026-01-03 19:39:04,003 - INFO -     ✓ Extracted 1 JSON block(s)
2026-01-03 19:39:04,003 - INFO -   Topic 15/29: 'فتوکموتراپی با پسورالن‌ها (PUVA)' > 'فتوشیمی پسورالن و طیف اثر و منابع نوری'
2026-01-03 19:39:04,004 - INFO -     ✓ Extracted 1 JSON block(s)
2026-01-03 19:39:04,004 - INFO -   Topic 16/29: 'فتوکموتراپی با پسورالن‌ها (PUVA)' > 'اثرات فتوبیولوژیک PUVA'
2026-01-03 19:39:04,004 - INFO -     ✓ Extracted 1 JSON block(s)
2026-01-03 19:39:04,004 - INFO -   Topic 17/29: 'فتوکموتراپی با پسورالن‌ها (PUVA)' > 'پروتکل‌های درمانی'
2026-01-03 19:39:04,005 - INFO -     ✓ Extracted 1 JSON block(s)
2026-01-03 19:39:04,005 - INFO -   Topic 18/29: 'فتوکموتراپی با پسورالن‌ها (PUVA)' > 'مرحله درمان اولیه (پاکسازی)'
2026-01-03 19:39:04,005 - INFO -     ✓ Extracted 1 JSON block(s)
2026-01-03 19:39:04,005 - INFO -   Topic 19/29: 'فتوکموتراپی با پسورالن‌ها (PUVA)' > 'مرحله نگهدارنده'
2026-01-03 19:39:04,005 - INFO -     ✓ Extracted 1 JSON block(s)
2026-01-03 19:39:04,006 - INFO -   Topic 20/29: 'فتوکموتراپی با پسورالن‌ها (PUVA)' > 'PUVA برای پسوریازیس'
2026-01-03 19:39:04,006 - INFO -     ✓ Extracted 1 JSON block(s)
2026-01-03 19:39:04,006 - INFO -   Topic 21/29: 'فتوکموتراپی با پسورالن‌ها (PUVA)' > 'درمان‌های ترکیبی'
2026-01-03 19:39:04,006 - INFO -     ✓ Extracted 1 JSON block(s)
2026-01-03 19:39:04,006 - INFO -   Topic 22/29: 'فتوکموتراپی با پسورالن‌ها (PUVA)' > 'PUVA برای لنفوم سلول T پوستی، به ویژه مایکوزیس فونگوئیدس'
2026-01-03 19:39:04,007 - INFO -     ✓ Extracted 1 JSON block(s)
2026-01-03 19:39:04,007 - INFO -   Topic 23/29: 'فتوکموتراپی با پسورالن‌ها (PUVA)' > 'PUVA برای ویتیلیگو'
2026-01-03 19:39:04,007 - INFO -     ✓ Extracted 1 JSON block(s)
2026-01-03 19:39:04,007 - INFO -   Topic 24/29: 'فتوکموتراپی با پسورالن‌ها (PUVA)' > 'PUVA برای درماتیت آتوپیک و PUVA برای لیکن پلان'
2026-01-03 19:39:04,007 - INFO -     ✓ Extracted 1 JSON block(s)
2026-01-03 19:39:04,008 - INFO -   Topic 25/29: 'فتوکموتراپی با پسورالن‌ها (PUVA)' > 'PUVA برای بیماری پیوند علیه میزبان'
2026-01-03 19:39:04,008 - INFO -     ✓ Extracted 1 JSON block(s)
2026-01-03 19:39:04,008 - INFO -   Topic 26/29: 'فتوکموتراپی با پسورالن‌ها (PUVA)' > 'PUVA برای کهیر پیگمنتوزا و PUVA برای درماتوزهای متفرقه'
2026-01-03 19:39:04,008 - INFO -     ✓ Extracted 1 JSON block(s)
2026-01-03 19:39:04,008 - INFO -   Topic 27/29: 'فتوکموتراپی با پسورالن‌ها (PUVA)' > 'PUVA برای فتودرماتوزها'
2026-01-03 19:39:04,008 - INFO -     ✓ Extracted 1 JSON block(s)
2026-01-03 19:39:04,008 - INFO -   Topic 28/29: 'فتوکموتراپی با پسورالن‌ها (PUVA)' > 'عوارض جانبی و خطرات بلندمدت PUVA'
2026-01-03 19:39:04,009 - INFO -     ✓ Extracted 1 JSON block(s)
2026-01-03 19:39:04,009 - INFO -   Topic 29/29: 'فتوکموتراپی با پسورالن‌ها (PUVA)' > 'UVB و PUVA در بیماران آلوده به HIV'
2026-01-03 19:39:04,009 - INFO -     ✓ Extracted 1 JSON block(s)
2026-01-03 19:39:04,009 - INFO - Total JSON blocks extracted: 29
2026-01-03 19:39:04,009 - INFO - ================================================================================
2026-01-03 19:39:04,009 - INFO - ================================================================================
2026-01-03 19:39:04,009 - INFO - CALCULATING POINTS PER SUBCHAPTER
2026-01-03 19:39:04,009 - INFO - ================================================================================
2026-01-03 19:39:04,009 - INFO - Combining 10 JSON block(s) into final structure...
2026-01-03 19:39:04,009 - INFO - Final structure: chapter 'درمان با اشعه ماوراء بنفش' with 10 content items
2026-01-03 19:39:04,009 - INFO - Processing chapter: 'درمان با اشعه ماوراء بنفش' with 10 top-level items
2026-01-03 19:39:04,010 - INFO -   Subchapter 'فتوتراپی با UVB': 232 points (10 topics)
2026-01-03 19:39:04,010 - INFO - Combining 1 JSON block(s) into final structure...
2026-01-03 19:39:04,010 - INFO - Final structure: chapter 'درمان با اشعه ماوراء بنفش' with 1 content items
2026-01-03 19:39:04,010 - INFO - Processing chapter: 'درمان با اشعه ماوراء بنفش' with 1 top-level items
2026-01-03 19:39:04,010 - INFO -   Subchapter 'فتوتراپی با لیزر یا لامپ اگزایمر 308 نانومتر': 18 points (1 topics)
2026-01-03 19:39:04,010 - INFO - Combining 1 JSON block(s) into final structure...
2026-01-03 19:39:04,010 - INFO - Final structure: chapter 'درمان با اشعه ماوراء بنفش' with 1 content items
2026-01-03 19:39:04,010 - INFO - Processing chapter: 'درمان با اشعه ماوراء بنفش' with 1 top-level items
2026-01-03 19:39:04,010 - INFO -   Subchapter 'فتوتراپی با UVA1': 11 points (1 topics)
2026-01-03 19:39:04,010 - INFO - Combining 17 JSON block(s) into final structure...
2026-01-03 19:39:04,010 - INFO - Final structure: chapter 'درمان با اشعه ماوراء بنفش' with 17 content items
2026-01-03 19:39:04,010 - INFO - Processing chapter: 'درمان با اشعه ماوراء بنفش' with 17 top-level items
2026-01-03 19:39:04,011 - INFO -   Subchapter 'فتوکموتراپی با پسورالن‌ها (PUVA)': 495 points (17 topics)
2026-01-03 19:39:04,011 - INFO - ================================================================================
2026-01-03 19:39:04,011 - INFO - Combining JSON blocks into final structure...
2026-01-03 19:39:04,011 - INFO - Combining 29 JSON block(s) into final structure...
2026-01-03 19:39:04,011 - INFO - Final structure: chapter 'درمان با اشعه ماوراء بنفش' with 29 content items
2026-01-03 19:39:04,011 - INFO - Flattening hierarchical structure to points...
2026-01-03 19:39:04,011 - INFO - Processing chapter: 'درمان با اشعه ماوراء بنفش' with 29 top-level items
2026-01-03 19:39:04,012 - INFO - Extracted 756 points from Document Processing
2026-01-03 19:39:04,012 - INFO - Assigning PointId and chapter/subchapter/topic to 756 points (starting from 1)...
2026-01-03 19:39:04,012 - INFO - ================================================================================
2026-01-03 19:39:04,012 - INFO - ASSIGNING POINT IDs AND SUBCHAPTER INFO
2026-01-03 19:39:04,013 - INFO - ================================================================================
2026-01-03 19:39:04,013 - INFO - Using tracked points per subchapter for correct mapping:
2026-01-03 19:39:04,013 - INFO -   Subchapter 'فتوتراپی با UVB': 232 points
2026-01-03 19:39:04,013 - INFO -   Subchapter 'فتوتراپی با لیزر یا لامپ اگزایمر 308 نانومتر': 18 points
2026-01-03 19:39:04,013 - INFO -   Subchapter 'فتوتراپی با UVA1': 11 points
2026-01-03 19:39:04,013 - INFO -   Subchapter 'فتوکموتراپی با پسورالن‌ها (PUVA)': 495 points
2026-01-03 19:39:04,013 - INFO - Total tracked points: 756, Actual flattened points: 756
2026-01-03 19:39:04,013 - INFO -   Assigning PointIds for subchapter 'فتوتراپی با UVB' (232 points)...
2026-01-03 19:39:04,013 - INFO -     ✓ Assigned 232 PointIds for subchapter 'فتوتراپی با UVB'
2026-01-03 19:39:04,013 - INFO -   Assigning PointIds for subchapter 'فتوتراپی با لیزر یا لامپ اگزایمر 308 نانومتر' (18 points)...
2026-01-03 19:39:04,013 - INFO -     ✓ Assigned 18 PointIds for subchapter 'فتوتراپی با لیزر یا لامپ اگزایمر 308 نانومتر'
2026-01-03 19:39:04,013 - INFO -   Assigning PointIds for subchapter 'فتوتراپی با UVA1' (11 points)...
2026-01-03 19:39:04,013 - INFO -     ✓ Assigned 11 PointIds for subchapter 'فتوتراپی با UVA1'
2026-01-03 19:39:04,013 - INFO -   Assigning PointIds for subchapter 'فتوکموتراپی با پسورالن‌ها (PUVA)' (495 points)...
2026-01-03 19:39:04,013 - INFO -     ✓ Assigned 495 PointIds for subchapter 'فتوکموتراپی با پسورالن‌ها (PUVA)'
2026-01-03 19:39:04,013 - INFO - ================================================================================
2026-01-03 19:39:04,013 - INFO - Saving Document Processing output to: /home/shahmir/Downloads/Lesson_file_120_134.json
2026-01-03 19:39:04,017 - INFO - Document Processing completed successfully: /home/shahmir/Downloads/Lesson_file_120_134.json
2026-01-03 19:45:57,527 - INFO - [get_default_model] ComboBox value: gemini-2.5-pro, StringVar value: gemini-2.5-pro
2026-01-03 19:45:57,527 - INFO - [get_default_model] Returning model from ComboBox: gemini-2.5-pro
2026-01-03 19:45:57,528 - INFO - Starting Stage E processing...
2026-01-03 19:45:57,529 - INFO - Loading OCR Extraction JSON (Stage 1)...
2026-01-03 19:45:57,530 - INFO - Successfully loaded JSON: /home/shahmir/Downloads/OCR Extraction.json
2026-01-03 19:45:57,531 - INFO - Loading Stage 4 JSON...
2026-01-03 19:45:57,538 - INFO - Successfully loaded JSON: /home/shahmir/Downloads/Lesson_file_120_134.json
2026-01-03 19:45:57,539 - INFO - Detected Book ID: 120, Chapter ID: 134
2026-01-03 19:45:57,539 - INFO - Last PointId in Stage 4: 1201340756, Starting image notes from index: 757
2026-01-03 19:45:57,540 - INFO - Preparing OCR Extraction JSON (Stage 1)...
2026-01-03 19:45:57,544 - INFO - Preparing Stage 4 JSON (complete)...
2026-01-03 19:45:57,553 - INFO - ============================================================
2026-01-03 19:45:57,553 - INFO - Processing Stage 4 as complete file (no subchapter division)...
2026-01-03 19:45:57,553 - INFO - ============================================================
2026-01-03 19:45:57,553 - INFO - Calling model gemini-2.5-pro for complete Stage 4...
2026-01-03 19:48:18,227 - INFO - Text processed successfully with gemini-2.5-pro
2026-01-03 19:48:18,228 - INFO - Saving model response as TXT file...
2026-01-03 19:48:18,229 - INFO - Stage E raw text saved: /home/shahmir/Downloads/Lesson_file_120_134_stage_e.txt
2026-01-03 19:48:18,230 - INFO - Converting TXT to JSON...
2026-01-03 19:48:18,231 - INFO - Successfully extracted JSON from TXT using ThirdStageConverter for /home/shahmir/Downloads/Lesson_file_120_134_stage_e.txt
2026-01-03 19:48:18,232 - INFO - Successfully loaded JSON from TXT: /home/shahmir/Downloads/Lesson_file_120_134_stage_e.txt
2026-01-03 19:48:18,233 - INFO - Successfully extracted JSON (attempt 1)
2026-01-03 19:48:18,233 - INFO - Extracted 16 image note records
2026-01-03 19:48:18,234 - INFO - Extracted 16 image note records
2026-01-03 19:48:18,235 - INFO - Processing image notes...
2026-01-03 19:48:18,236 - INFO - Processed 16 image notes
2026-01-03 19:48:18,237 - INFO - First image PointId: 1201340757
2026-01-03 19:48:18,238 - INFO - Saving filepic JSON for Stage F...
2026-01-03 19:48:18,239 - INFO - Found 16 records with caption out of 16
2026-01-03 19:48:18,240 - INFO - Successfully saved JSON: /home/shahmir/Downloads/Lesson_file_120_134_filepic.json (16 records)
2026-01-03 19:48:18,241 - INFO - Filepic saved to: /home/shahmir/Downloads/Lesson_file_120_134_filepic.json
2026-01-03 19:48:18,242 - INFO - Verified: filepic contains caption field (first caption: 755 chars)
2026-01-03 19:48:18,242 - INFO - Stage 4 points already contain chapter/subchapter fields
2026-01-03 19:48:18,243 - INFO - Merging Stage 4 points with image notes...
2026-01-03 19:48:18,243 - INFO - Saving merged JSON to: /home/shahmir/Downloads/e120134.json
2026-01-03 19:48:18,254 - INFO - Successfully saved JSON: /home/shahmir/Downloads/e120134.json (772 records)
2026-01-03 19:48:18,254 - INFO - Stage E completed successfully: /home/shahmir/Downloads/e120134.json
2026-01-03 19:57:36,309 - INFO - Starting Stage F processing...
2026-01-03 19:57:36,309 - INFO - Loading Stage E JSON...
2026-01-03 19:57:36,314 - INFO - Successfully loaded JSON: /home/shahmir/Downloads/e120134.json
2026-01-03 19:57:36,314 - INFO - First image PointId: 1201340757
2026-01-03 19:57:36,315 - INFO - Found 16 image records starting from index 756
2026-01-03 19:57:36,316 - INFO - Using filepic path from metadata: /home/shahmir/Downloads/Lesson_file_120_134_filepic.json
2026-01-03 19:57:36,316 - INFO - Loading descriptions from filepic JSON...
2026-01-03 19:57:36,317 - INFO - Successfully loaded JSON: /home/shahmir/Downloads/Lesson_file_120_134_filepic.json
2026-01-03 19:57:36,318 - INFO - Found 16 records in filepic JSON
2026-01-03 19:57:36,319 - INFO - Loaded 16 descriptions from filepic JSON
2026-01-03 19:57:36,319 - INFO - Found 16 non-empty captions out of 16
2026-01-03 19:57:36,319 - INFO - Processing image records...
2026-01-03 19:57:36,321 - INFO - Generated 16 image records
2026-01-03 19:57:36,321 - INFO - Saving image file JSON to: /home/shahmir/Downloads/f.json
2026-01-03 19:57:36,323 - INFO - Successfully saved JSON: /home/shahmir/Downloads/f.json (16 records)
2026-01-03 19:57:36,324 - INFO - Stage F completed successfully: /home/shahmir/Downloads/f.json
2026-01-03 19:59:10,939 - INFO - [get_default_model] ComboBox value: gemini-2.5-pro, StringVar value: gemini-2.5-pro
2026-01-03 19:59:10,940 - INFO - [get_default_model] Returning model from ComboBox: gemini-2.5-pro
2026-01-03 19:59:10,941 - INFO - Starting Stage J processing...
2026-01-03 19:59:10,942 - INFO - Loading Stage E JSON...
2026-01-03 19:59:10,949 - INFO - Successfully loaded JSON: /home/shahmir/Downloads/e120134.json
2026-01-03 19:59:10,951 - INFO - Loaded 772 records from Stage E
2026-01-03 19:59:10,952 - INFO - Detected Book ID: 120, Chapter ID: 134
2026-01-03 19:59:10,953 - INFO - Reading Word file...
2026-01-03 19:59:10,997 - INFO - Successfully read Word file using python-docx: /home/shahmir/Downloads/تست ها 134.docx (6930 chars)
2026-01-03 19:59:10,997 - INFO - Read Word file: 6930 characters
2026-01-03 19:59:10,998 - INFO - Loading Stage F JSON...
2026-01-03 19:59:10,998 - INFO - Successfully loaded JSON: /home/shahmir/Downloads/f.json
2026-01-03 19:59:10,998 - INFO - Loaded 16 records from Stage F
2026-01-03 19:59:10,999 - INFO - Splitting Stage E data into 4 parts: Part 1 (193 records), Part 2 (193 records), Part 3 (193 records), Part 4 (193 records)
2026-01-03 19:59:10,999 - INFO - Processing Part 1...
2026-01-03 20:01:04,296 - INFO - Text processed successfully with gemini-2.5-pro
2026-01-03 20:01:04,297 - INFO - Part 1 response received (16766 characters)
2026-01-03 20:01:04,298 - INFO - Processing Part 2...
2026-01-03 20:03:30,169 - INFO - Text processed successfully with gemini-2.5-pro
2026-01-03 20:03:30,170 - INFO - Part 2 response received (15513 characters)
2026-01-03 20:03:30,171 - INFO - Processing Part 3...
2026-01-03 20:05:24,857 - INFO - Text processed successfully with gemini-2.5-pro
2026-01-03 20:05:24,858 - INFO - Part 3 response received (15504 characters)
2026-01-03 20:05:24,859 - INFO - Processing Part 4...
2026-01-03 20:07:21,023 - INFO - Text processed successfully with gemini-2.5-pro
2026-01-03 20:07:21,024 - INFO - Part 4 response received (15486 characters)
2026-01-03 20:07:21,025 - INFO - Combining responses from all parts...
2026-01-03 20:07:21,027 - INFO - Saved combined response to: /home/shahmir/Downloads/e120134_stage_j.txt
2026-01-03 20:07:21,027 - INFO - Extracting JSON from Part 1 response...
2026-01-03 20:07:21,028 - INFO - Successfully extracted JSON from response
2026-01-03 20:07:21,029 - INFO - Extracting JSON from Part 2 response...
2026-01-03 20:07:21,029 - INFO - Successfully extracted JSON from response
2026-01-03 20:07:21,030 - INFO - Extracting JSON from Part 3 response...
2026-01-03 20:07:21,030 - INFO - Successfully extracted JSON from response
2026-01-03 20:07:21,031 - INFO - Extracting JSON from Part 4 response...
2026-01-03 20:07:21,032 - INFO - Successfully extracted JSON from response
2026-01-03 20:07:21,033 - INFO - Combining JSON from all four parts...
2026-01-03 20:07:21,034 - INFO - Extracted 788 records from combined model output (Part 1: 209, Part 2: 193, Part 3: 193, Part 4: 193)
2026-01-03 20:07:21,036 - INFO - Created mapping for 772 PointIds
2026-01-03 20:07:21,037 - INFO - Merging Stage E data with Imp and Type columns...
2026-01-03 20:07:21,038 - INFO - Merged 772 records
2026-01-03 20:07:21,038 - INFO - Matched 772 records with Imp/Type data
2026-01-03 20:07:21,038 - INFO - Saving Stage J output to: /home/shahmir/Downloads/a120134.json
2026-01-03 20:07:21,047 - INFO - Successfully saved JSON: /home/shahmir/Downloads/a120134.json (772 records)
2026-01-03 20:07:21,047 - INFO - Stage J completed successfully: /home/shahmir/Downloads/a120134.json
2026-01-03 20:23:54,677 - INFO - [get_default_model] ComboBox value: gemini-2.5-pro, StringVar value: gemini-2.5-pro
2026-01-03 20:23:54,678 - INFO - [get_default_model] Returning model from ComboBox: gemini-2.5-pro
2026-01-03 20:23:54,679 - INFO - Starting Stage H processing...
2026-01-03 20:23:54,679 - INFO - Loading Stage J JSON...
2026-01-03 20:23:54,685 - INFO - Successfully loaded JSON: /home/shahmir/Downloads/a120134.json
2026-01-03 20:23:54,685 - INFO - Loaded 772 records from Stage J
2026-01-03 20:23:54,687 - INFO - Prepared 772 records from Stage J for prompt (without Imp column)
2026-01-03 20:23:54,687 - INFO - Detected Book ID: 120, Chapter ID: 134
2026-01-03 20:23:54,687 - INFO - Loading Stage F JSON...
2026-01-03 20:23:54,688 - INFO - Successfully loaded JSON: /home/shahmir/Downloads/f.json
2026-01-03 20:23:54,688 - INFO - Loaded 16 records from Stage F
2026-01-03 20:23:54,689 - INFO - Splitting Stage J data into 5 parts (160 records per part, total: 772 records)
2026-01-03 20:23:54,689 - INFO - Processing Part 1/5 (160 records, indices 0 to 159)...
